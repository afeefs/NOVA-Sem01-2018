webpackJsonp([31],[function(t,e,i){i(1825),i(1826),i(1827),i(1828),i(1829),i(1830),i(1831),i(1832),i(1833),i(1834),i(1835),i(1836),i(1837),i(1838),i(1839),i(1840),i(1841),i(1842),i(1843),i(1844),i(1845),i(1846),i(1847),i(1848),i(1849),i(1850),i(1851),i(1852),i(1853),i(1854),i(1855),i(1856),i(1857),i(1858),i(1859),i(1860),i(1861),i(1862),i(1863),i(1864),i(1865),i(1866),i(1867),i(1868),i(1869),i(1870),i(1871),i(1872),i(1873),i(1874),i(1875),i(1876),i(1877),i(1878),i(1879),i(1880),i(1881),i(1882),i(1883),t.exports=i(1884)},,,,,function(t,e,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(7),r=i(9),a=i(126),l=i(178);l();var c=i(129),u=i(132),h=i(180),d=i(181),p=i(182),_=i(224),g=i(833),f=i(836),m=i(837),v=i(1081),b=i(1085),y=i(551),w=i(1116),k=a.extend({getName:function(){return this.name=c.get("Context/name"),s("Context/%s",this.name)},logs:function(){var t=[i(1119),i(1134),i(1135),i(1136),i(1137),i(1138),i(1139),i(1140),i(1141),i(1142),i(1143),i(1144),i(1145).default,i(1148).default,i(1154),i(1155),i(1156),i(1157),i(1158),i(1159),i(1160)];return n.union(t,a.prototype.logs.apply(this))},constructor:function(){a.apply(this,arguments),this.startHistory(),this.initializeApp()},bootloader:function(t){a.prototype.bootloader.apply(this,arguments),d.init(),u.log("Exec","Bootstrap/DOMEventor"),u.log("Exec","Bootstrap/Legacy"),i(1161)},initializeApp:function(){h.bool("is_mobile_handset")&&h.bool("responsive_help_docs")?new b:new _,new g,new f,h.bool("indash_blogs")&&(this.peepr=new m),h.bool("ask_form")&&(this.askForm=new v({user:p()})),h.bool("livephotos_web")&&(this.livePhotos=y.getInstance()),r.locale(c.get("Context.language")),h.bool("lrec_on_blog_pages_peepr")&&(this.yamPlusAd=new w)},startHistory:function(t){o.History.started||n.isEmpty(this.routes)||(this.routeFound=o.history.start({pushState:"pushState"in window.history,hashChange:!!t&&!("pushState"in window.history),root:this.root}))}});t.exports=k},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(127),r=i(129),a=i(130),l=i(132),c=i(134),u=i(135),h=s.Router.extend({root:"/",constructor:function(t){t||(t={}),t.bootstrap||(t.bootstrap=o()),this.bootloader(t.bootstrap),s.Router.apply(this,arguments)},getName:function(){return"Prima/Router"},logs:function(){return[]},bootloader:function(t){n.isEmpty(t),r.setup(t),l.log("Exec","Bootstrap/Data"),a.setup(t.Translations,n.get(t,"Context.language_simple","en")),l.log("Exec","Bootstrap/Translations"),c.startLogs(this.logs()),l.log("Exec","Bootstrap/logs"),new u({})}},{start:function(t){return new this(t)}});t.exports=h},function(t,e,i){"use strict";var n=i(128),s=function(){var t=n("JSON"),e={},i=document.getElementById("bootloader");if(i){try{e=t.parse(i.getAttribute("data-bootstrap"))}catch(t){}i.parentNode.removeChild(i)}return e};t.exports=s},function(t,e){"use strict";function i(t,e){if(t in n)return n[t];var i=window[t];if(!e||!e(i)){var s=document.createElement("iframe");document.body.appendChild(s),i=s.contentWindow[t],document.body.removeChild(s)}return n[t]=i,i}var n={};t.exports=i},function(t,e,i){"use strict";function n(t){if(!r)throw new Error("Data hasn't been initialized with `setup`.");if(!a.isString(t))return null;var e=a.get(r,t.replace(/\//g,"."));return a.cloneDeep(e)}function s(t){if(!r)throw new Error("Data hasn't been initialized with `setup`.");return a.isString(t)?a.has(r,t.replace(/\//g,".")):null}function o(t){r=a.isObject(t)?t:{}}var r,a=i(3);t.exports={get:n,has:s,setup:a.once(o)}},function(t,e,i){"use strict";function n(t,e){r.addEntries(s.isObject(t)?t:{}),this.locale=e}var s=i(3),o=i(131),r=new o({name:"Translations"}),a=s.bind(r.get,r);a.setup=s.once(n),t.exports=a},function(t,e,i){"use strict";function n(t){t=s.extend({entries:{},name:"Dictionary"},t),this._hadLastLookup=!1,this._entries=t.entries,this._name=t.name}var s=i(3),o=(i(132),i(6).sprintf),r=function(t,e,i){null!=i||(i=this);var n=t.apply(i,e);return e=Array.prototype.slice.call(e,1),e.unshift(n),e};n.prototype.addEntries=function(t){return s.extend(this._entries,t),this},n.prototype.lookup=function(t){return s.has(this._entries,t)?(this._hadLastLookup=!0,this._entries[t]):(this._hadLastLookup=!1,t)},n.prototype.lookupWithFormatting=function(t){var e;return arguments.length>1?(e=this.lookup(o.apply(this,arguments)),this._hadLastLookup||(e=o.apply(this,r(this.lookup,arguments,this)))):e=this.lookup(t),e},n.prototype.get=function(t){var e=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup&&this.logMissing,e},n.prototype.getEntries=function(){return s.cloneDeep(this._entries)},t.exports=n},,,function(t,e,i){"use strict";var n=i(3),s={loadedLogs:[],startLogs:function(t){n.each(t,function(t){var e=t.start();this.loadedLogs.push(e.logKey)},this)},startLog:function(t){this.startLogs([t])}};t.exports=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(129),a=n(r),l=i(8),c=n(l),u=i(136),h=n(u),d=i(137),p=n(d),_=i(3),g=n(_),f=function(){function t(e){var i=this;s(this,t);var n=!1;this.globalProperties={},this.pixels={},g.default.get(e,"supplyLogging")?(this.data=e.supplyLogging,n=!0):this.data=a.default.get("Components/SupplyLogging"),this.data&&this._checkForAdblockers().then(this._getGlobalProperties.bind(null,e)).catch(this._getGlobalProperties.bind(null,e)).then(function(t){if(i.globalProperties=t,(0,c.default)(window).on("beforeunload",i._onBeforeUnload.bind(i)),!n&&g.default.get(i,"data.dashboard_right_rail")&&(i.pixels.dashboard_right_rail=new p.default((0,c.default)("#sidebar-ad"),g.default.assign({location_id:"dashboard_right_rail"},i.globalProperties),i)),!n&&g.default.get(i,"data.dashboard_sponsored_day")){var e=(0,c.default)(".takeover-container");e.length<1&&(e=(0,c.default)("#posts li:not(:empty)").not("#new_post_buttons, :not([class])").get(0)),i.pixels.dashboard_sponsored_day=new p.default(e,g.default.assign({location_id:"dashboard_sponsored_day"},i.globalProperties),i)}var s=!1,o=!1,r=!1;for(var a in i.data)g.default.includes(a,"dashboard_instream_")?s=!0:g.default.includes(a,"peepr_instream_")?o=!0:g.default.includes(a,"blog_network_instream_")&&(r=!0);!n&&s&&(h.default.on("dashboard:nextPageLoaded",i._processDashboardInstreamPixels,i),i._processDashboardInstreamPixels()),!n&&o&&(h.default.on("indashblog:nextPageLoaded",i._processPeeprInstreamPixels,i),h.default.on("peepr:close",i._unloadPeeprPixels,i)),n&&g.default.get(i,"data.blog_network_sticky")&&(i.pixels.blog_network_sticky=new p.default((0,c.default)(".sticky-darla-ad"),g.default.assign({location_id:"blog_network_sticky"},i.globalProperties),i)),n&&g.default.get(i,"data.blog_network_related_posts")&&(i.pixels.blog_network_related_posts,new p.default((0,c.default)(".related-posts-wrapper .related-posts"),g.default.assign({location_id:"blog_network_related_posts"},i.globalProperties),i)),n&&g.default.get(i,"data.blog_network_permalink")&&(i.pixels.blog_network_permalink=new p.default((0,c.default)("body.permalink .post-wrapper"),g.default.assign({location_id:"blog_network_permalink"},i.globalProperties),i)),n&&r&&(window.Optica.$win.on("next_page_loaded",function(){i._processOpticaInsteamPixels()}),i._processOpticaInsteamPixels())})}return o(t,[{key:"_processOpticaInsteamPixels",value:function(){this._processInstreamPixels("section#posts .container article")}},{key:"_processDashboardInstreamPixels",value:function(){this._processInstreamPixels("[data-supply-logging]")}},{key:"_processPeeprInstreamPixels",value:function(){this._processInstreamPixels("div.indash_blog .posts .post",".peepr-drawer-container .peepr-drawer")}},{key:"_processInstreamPixels",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,c.default)(t),s=null;i&&(s=(0,c.default)(i)),(0,c.default)(t+"[data-supply-logging]").each(function(t,i){var o=(0,c.default)(i),r=n.index(o)+1,a=o.data("supply-logging"),l=!0,u=!1,h=void 0;try{for(var d,_=a[Symbol.iterator]();!(l=(d=_.next()).done);l=!0){var f=d.value,m=f+"_"+r;e.pixels.hasOwnProperty(m)||(e.pixels[m]=new p.default(o,g.default.assign({location_id:f,ad_position:r},e.globalProperties),e,s))}}catch(t){u=!0,h=t}finally{try{!l&&_.return&&_.return()}finally{if(u)throw h}}})}},{key:"_getGlobalProperties",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],i=!1;e&&"error"===e.err.type&&(i=!0);var n={adblock_enabled:i,client_timestamp:Date.now(),view_duration:0};return g.default.get(t,"supplyLogging")&&(n.opt_out=!t.adsEnabled,n.nsfw=!!t.isAdult,n.optica_theme=!!t.isOptica),n}},{key:"_checkForAdblockers",value:function(){var t="Promise"in window?Promise:i(139);return new t(function(t,e){window.Tumblr.ABP&&e({err:{type:"error"}});var i=document.createElement("script");i.async=!0;var n=document.getElementsByTagName("head")[0];i.src="/assets/src/scripts/tumblr/dashboard/showads.js",n.appendChild(i);var s=function e(){i.removeEventListener("load",e),t()};i.addEventListener("load",s),i.addEventListener("error",function(t){e({err:t})})})}},{key:"_unloadPeeprPixels",value:function(){for(var t in this.pixels)if(this.pixels.hasOwnProperty(t)){var e=this.pixels[t];g.default.startsWith(t,"peepr")&&(e.onBeforeUnload(),delete this.pixels[t])}}},{key:"_onBeforeUnload",value:function(){for(var t in this.pixels)this.pixels.hasOwnProperty(t)&&this.pixels[t].onBeforeUnload()}},{key:"supplyLog",value:function(t){g.default.has(t,"event")&&h.default.trigger("Kraken:supply_"+t.event,{loggingData:t})}}]),t}();t.exports=f},function(t,e,i){"use strict";var n=i(3),s=i(7),o=function(){};o.extend=s.Model.extend,n.extend(o.prototype,s.Events),o.prototype.trigger=function(){return n.isObject(arguments[1])&&(arguments[1].loggingData=arguments[1].loggingData||{}),s.Events.trigger.apply(this,arguments)},t.exports=new o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){var i=[],n=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){s=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(s)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(138),l=n(a),c=i(136),u=n(c),h=i(3),d=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,r=arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;s(this,t),this.element=e,this.manager=r,this.properties=i,this._onServed(),this.visibleTime=null,this.minimumVisibleTime=1e3,this.maximumVisibleTime=1e4,(0,h.isEmpty)(this.properties)||"dashboard_right_rail"!==this.properties.placement_id||u.default.on("darla:success",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=o(t,2),i=e[0],s=e[1];"AUTO"===i&&"LREC4"===s[0]&&"LREC"===s[1]&&n._onRotate()}),this._setupWatcher(a)}return r(t,[{key:"_setupWatcher",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.watcher=l.default.createContainer(e).create(this.element):this.watcher=l.default.create(this.element),this.watcher.enterViewport(function(){t._onVisible()}),(0,h.isEmpty)(this.properties)||"dashboard_right_rail"!==this.properties.placement_id?this.watcher.exitViewport(function(){t._onInvisible()}):u.default.on("ads-interaction:sidebar-ad-hidden",this._onInvisible,this)}},{key:"_onServed",value:function(){this._fireEvent("serve")}},{key:"_onVisible",value:function(){this.visibleTime=Date.now()}},{key:"_onInvisible",value:function(){this._setViewDuration(),!(0,h.isEmpty)(this.properties)&&this.properties.view_duration>=this.minimumVisibleTime&&(this._fireEvent("view"),this.watcher.destroy(),u.default.off("ads-interaction:sidebar-ad-hidden"))}},{key:"_setViewDuration",value:function(){this.visibleTime&&(this.properties.view_duration=Date.now()-this.visibleTime,this.properties.view_duration>=this.maximumVisibleTime&&(this.properties.view_duration=this.maximumVisibleTime))}},{key:"_fireEvent",value:function(t){this.properties.event=t,this.manager.supplyLog(this.properties)}},{key:"_onRotate",value:function(){this._setViewDuration(),this._fireEvent("rotate"),this._onVisible(),this.properties.view_duration=0}},{key:"onBeforeUnload",value:function(){this._setViewDuration(),this._fireEvent("unload"),this.watcher.destroy()}}]),t}();t.exports=d},,function(t,e,i){"use strict";function n(){try{Promise===o&&(Promise=s)}catch(t){}return o}var s;"undefined"!=typeof Promise&&(s=Promise);var o=i(140)();o.noConflict=n,t.exports=o},function(t,e,i){(function(e){"use strict";t.exports=function(){function n(){}function s(t,e){if(null==t||t.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new b("expecting a function but got "+_.classString(e))}function o(t){t!==w&&s(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function r(t){this.promise._resolveCallback(t)}function a(t){this.promise._rejectCallback(t,!1)}function l(t){var e=new o(w);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var c,u=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},h=function(){return new o.PromiseInspection(this._target())},d=function(t){return o.reject(new b(t))},p={},_=i(142);c=_.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},_.notEnumerableProp(o,"_getDomain",c);var g=i(143),f=i(144),m=new f;g.defineProperty(o,"_async",{value:m});var v=i(149),b=o.TypeError=v.TypeError;o.RangeError=v.RangeError;var y=o.CancellationError=v.CancellationError;o.TimeoutError=v.TimeoutError,o.OperationalError=v.OperationalError,o.RejectionError=v.OperationalError,o.AggregateError=v.AggregateError;var w=function(){},k={},C={},x=i(150)(o,w),S=i(151)(o,w,x,d,n),T=i(152)(o),E=T.create,P=i(153)(o,T),F=(P.CapturedTrace,i(154)(o,x,C)),I=i(155)(C),j=i(156),A=_.errorObj,M=_.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),s=0;for(i=0;i<e-1;++i){var o=arguments[i];if(!_.isObject(o))return d("Catch statement predicate: expecting an object but got "+_.classString(o));n[s++]=o}return n.length=s,t=arguments[i],this.then(void 0,I(n,t,this))}return this.then(void 0,t)},o.prototype.reflect=function(){return this._then(h,h,void 0,this,void 0)},o.prototype.then=function(t,e){if(P.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+_.classString(t);arguments.length>1&&(i+=", "+_.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},o.prototype.done=function(t,e){var i=this._then(t,e,void 0,void 0,void 0);i._setIsFinal()},o.prototype.spread=function(t){return"function"!=typeof t?d("expecting a function but got "+_.classString(t)):this.all()._then(t,void 0,void 0,k,void 0)},o.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new S(this).promise()},o.prototype.error=function(t){return this.caught(_.originatesFromRejection,t)},o.getNewLibraryCopy=t.exports,o.is=function(t){return t instanceof o},o.fromNode=o.fromCallback=function(t){var e=new o(w);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=M(t)(j(e,i));return n===A&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},o.all=function(t){return new S(t).promise()},o.cast=function(t){var e=x(t);return e instanceof o||(e=new o(w),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(t){var e=new o(w);return e._captureStackTrace(),e._rejectCallback(t,!0),e},o.setScheduler=function(t){if("function"!=typeof t)throw new b("expecting a function but got "+_.classString(t));return m.setScheduler(t)},o.prototype._then=function(t,e,i,n,s){var r=void 0!==s,a=r?s:new o(w),l=this._target(),u=l._bitField;r||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!==(2097152&this._bitField)&&(n=0!==(50397184&u)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=c();if(0!==(50397184&u)){var d,p,g=l._settlePromiseCtx;0!==(33554432&u)?(p=l._rejectionHandler0,d=t):0!==(16777216&u)?(p=l._fulfillmentHandler0,d=e,l._unsetRejectionIsUnhandled()):(g=l._settlePromiseLateCancellationObserver,p=new y("late cancellation observer"),l._attachExtraTrace(p),d=e),m.invoke(g,l,{handler:null===h?d:"function"==typeof d&&_.domainBind(h,d),promise:a,receiver:n,value:p})}else l._addCallbacks(t,e,a,n,h);return a},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},o.prototype._setLength=function(t){this._bitField=this._bitField&-65536|65535&t},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==p)return void 0===e&&this._isBound()?this._boundValue():e},o.prototype._promiseAt=function(t){return this[4*t-4+2]},o.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},o.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),i=t._rejectionHandler0,n=t._promise0,s=t._receiverAt(0);void 0===s&&(s=p),this._addCallbacks(e,i,n,s,null)},o.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),s=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=p),this._addCallbacks(i,n,s,o,null)},o.prototype._addCallbacks=function(t,e,i,n,s){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===s?t:_.domainBind(s,t)),"function"==typeof e&&(this._rejectionHandler0=null===s?e:_.domainBind(s,e));else{var r=4*o-4;this[r+2]=i,this[r+3]=n,"function"==typeof t&&(this[r+0]=null===s?t:_.domainBind(s,t)),"function"==typeof e&&(this[r+1]=null===s?e:_.domainBind(s,e))}return this._setLength(o+1),o},o.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},o.prototype._resolveCallback=function(t,e){if(0===(117506048&this._bitField)){if(t===this)return this._rejectCallback(u(),!1);var i=x(t,this);if(!(i instanceof o))return this._fulfill(t);e&&this._propagateFrom(i,2);var n=i._target();if(n===this)return void this._reject(u());var s=n._bitField;if(0===(50397184&s)){var r=this._length();r>0&&n._migrateCallback0(this);for(var a=1;a<r;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!==(33554432&s))this._fulfill(n._value());else if(0!==(16777216&s))this._reject(n._reason());else{var l=new y("late cancellation observer");n._attachExtraTrace(l),this._reject(l)}}},o.prototype._rejectCallback=function(t,e,i){var n=_.ensureErrorObject(t),s=n===t;if(!s&&!i&&P.warnings()){var o="a promise was rejected with a non-error: "+_.classString(t);this._warn(o,!0)}this._attachExtraTrace(n,!!e&&s),this._reject(t)},o.prototype._resolveFromExecutor=function(t){if(t!==w){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)});i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},o.prototype._settlePromiseFromHandler=function(t,e,i,n){var s=n._bitField;if(0===(65536&s)){n._pushContext();var o;e===k?i&&"number"==typeof i.length?o=M(t).apply(this._boundValue(),i):(o=A,o.e=new b("cannot .spread() a non-array: "+_.classString(i))):o=M(t).call(e,i);var r=n._popContext();s=n._bitField,0===(65536&s)&&(o===C?n._reject(i):o===A?n._rejectCallback(o.e,!1):(P.checkForgottenReturns(o,r,"",n,this),n._resolveCallback(o)))}},o.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(t){this._rejectionHandler0=t},o.prototype._settlePromise=function(t,e,i,s){var r=t instanceof o,a=this._bitField,l=0!==(134217728&a);0!==(65536&a)?(r&&t._invokeInternalOnCancel(),i instanceof F&&i.isFinallyHandler()?(i.cancelPromise=t,M(e).call(i,s)===A&&t._reject(A.e)):e===h?t._fulfill(h.call(i)):i instanceof n?i._promiseCancelled(t):r||t instanceof S?t._cancel():i.cancel()):"function"==typeof e?r?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,s,t)):e.call(i,s,t):i instanceof n?i._isResolved()||(0!==(33554432&a)?i._promiseFulfilled(s,t):i._promiseRejected(s,t)):r&&(l&&t._setAsyncGuaranteed(),0!==(33554432&a)?t._fulfill(s):t._reject(s))},o.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,s=t.value;"function"==typeof e?i instanceof o?this._settlePromiseFromHandler(e,n,s,i):e.call(n,s,i):i instanceof o&&i._reject(s)},o.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},o.prototype._settlePromise0=function(t,e,i){var n=this._promise0,s=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,s,e)},o.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},o.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=u();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!==(134217728&e)?this._settlePromises():m.settlePromises(this))}},o.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?m.fatalError(t,_.isNode):void((65535&e)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled())},o.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),s=this._promiseAt(i),o=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(s,n,o,e)}},o.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),s=this._promiseAt(i),o=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(s,n,o,e)}},o.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!==(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var t=this._bitField;return 0!==(33554432&t)?this._rejectionHandler0:0!==(16777216&t)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){P.deprecated("Promise.defer","new Promise");var t=new o(w);return{promise:t,resolve:r,reject:a}},_.notEnumerableProp(o,"_makeSelfResolutionError",u),i(157)(o,w,x,d,P),i(158)(o,w,x,P),i(159)(o,S,d,P),i(160)(o),i(161)(o),i(162)(o,S,x,w,m,c),o.Promise=o,o.version="3.5.1",i(163)(o,S,d,x,w,P),i(164)(o),i(165)(o,d,x,E,w,P),i(166)(o,w,P),i(167)(o,d,w,x,n,P),i(168)(o),i(169)(o,w),i(170)(o,S,x,d),i(171)(o,w,x,d),i(172)(o,S,d,x,w,P),i(173)(o,S,P),i(174)(o,S,d),i(175)(o,w),i(176)(o,w),i(177)(o),_.toFastProperties(o),_.toFastProperties(o.prototype),l({a:1}),l({b:2}),l({c:3}),l(1),l(function(){}),l(void 0),l(!1),l(new o(w)),P.setBounds(f.firstLineError,_.lastLineError),o}}).call(e,i(141))},,function(t,e,i){(function(e,n){"use strict";function s(){try{var t=I;return I=null,t.apply(this,arguments)}catch(t){return F.e=t,F}}function o(t){return I=t,s}function r(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function a(t){return"function"==typeof t||"object"==typeof t&&null!==t}function l(t){return r(t)?new Error(m(t)):t}function c(t,e){var i,n=t.length,s=new Array(n+1);for(i=0;i<n;++i)s[i]=t[i];return s[i]=e,s}function u(t,e,i){if(!E.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function h(t,e,i){if(r(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return E.defineProperty(t,e,n),t}function d(t){throw t}function p(t){try{if("function"==typeof t){var e=E.names(t.prototype),i=E.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),s=N.test(t+"")&&E.names(t).length>0;if(i||n||s)return!0}return!1}catch(t){return!1}}function _(t){function e(){}e.prototype=t;for(var i=8;i--;)new e;return t}function g(t){return O.test(t)}function f(t,e,i){for(var n=new Array(t),s=0;s<t;++s)n[s]=e+s+i;return n}function m(t){try{return t+""}catch(t){return"[no string representation]"}}function v(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function b(t){try{h(t,"isOperational",!0)}catch(t){}}function y(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0)}function w(t){return v(t)&&E.propertyIsWritable(t,"stack")}function k(t){return{}.toString.call(t)}function C(t,e,i){for(var n=E.names(t),s=0;s<n.length;++s){var o=n[s];if(i(o))try{E.defineProperty(e,o,E.getDescriptor(t,o))}catch(t){}}}function x(t){return L?n.env[t]:void 0}function S(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function T(t,e){return t.bind(e)}var E=i(143),P="undefined"==typeof navigator,F={e:{}},I,j="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof e?e:void 0!==this?this:null,A=function(t,e){function i(){this.constructor=t,this.constructor$=e;for(var i in e.prototype)n.call(e.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=e.prototype[i])}var n={}.hasOwnProperty;return i.prototype=e.prototype,t.prototype=new i,t.prototype},M=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(E.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],s=Object.create(null);null!=t&&!e(t);){var o;try{o=i(t)}catch(t){return n}for(var r=0;r<o.length;++r){var a=o[r];if(!s[a]){s[a]=!0;var l=Object.getOwnPropertyDescriptor(t,a);null!=l&&null==l.get&&null==l.set&&n.push(a)}}t=E.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var s=[];t:for(var o in i)if(n.call(i,o))s.push(o);else{for(var r=0;r<t.length;++r)if(n.call(t[r],o))continue t;s.push(o)}return s}}(),N=/this\s*\.\s*\S+\s*=/,O=/^[a-z$_][a-z$_0-9]*$/i,R=function(){return"stack"in new Error?function(t){return w(t)?t:new Error(m(t))}:function(t){if(w(t))return t;try{throw new Error(m(t))}catch(t){return t}}}(),D=function(t){return E.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var $="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};D=function(t){return E.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?$(t):null}}var B="undefined"!=typeof n&&"[object process]"===k(n).toLowerCase(),L="undefined"!=typeof n&&"undefined"!=typeof n.env,V={isClass:p,isIdentifier:g,inheritedDataKeys:M,getDataPropertyOrDefault:u,thrower:d,isArray:E.isArray,asArray:D,notEnumerableProp:h,isPrimitive:r,isObject:a,isError:v,canEvaluate:P,errorObj:F,tryCatch:o,inherits:A,withAppended:c,maybeWrapAsError:l,toFastProperties:_,filledRange:f,toString:m,canAttachTrace:w,ensureErrorObject:R,originatesFromRejection:y,markAsOriginatingFromRejection:b,classString:k,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,hasEnvVariables:L,env:x,global:j,getNativePromise:S,domainBind:T};V.isRecentNode=V.isNode&&function(){var t=n.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),V.isNode&&V.toFastProperties(n);try{throw new Error}catch(t){V.lastLineError=t}t.exports=V}).call(e,function(){return this}(),i(141))},function(t,e){var i=function(){"use strict";return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var n={}.hasOwnProperty,s={}.toString,o={}.constructor.prototype,r=function(t){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e},a=function(t,e){return{value:t[e]}},l=function(t,e,i){return t[e]=i.value,t},c=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch(t){return o}},h=function(t){try{return"[object Array]"===s.call(t)}catch(t){return!1}};t.exports={isArray:h,keys:r,names:r,defineProperty:l,getDescriptor:a,freeze:c,getPrototypeOf:u,isES5:i,propertyIsWritable:function(){return!0}}}},function(t,e,i){(function(e){"use strict";function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=l}function s(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function o(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function r(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(t){a=t}var l=i(145),c=i(148),u=i(142);n.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,
e},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},n.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(n.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?s.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},n.prototype.invoke=function(t,e,i){this._trampolineEnabled?o.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},n.prototype.settlePromises=function(t){this._trampolineEnabled?r.call(this,t):this._schedule(function(){t._settlePromises()})}):(n.prototype.invokeLater=s,n.prototype.invoke=o,n.prototype.settlePromises=r),n.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var i=t.shift(),n=t.shift();e.call(i,n)}else e._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},t.exports=n,t.exports.firstLineError=a}).call(e,i(141))},function(t,e,i){(function(e,n,s){"use strict";var o,r=i(142),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},l=r.getNativePromise();if(r.isNode&&"undefined"==typeof MutationObserver){var c=e.setImmediate,u=n.nextTick;o=r.isRecentNode?function(t){c.call(e,t)}:function(t){u.call(n,t)}}else if("function"==typeof l&&"function"==typeof l.resolve){var h=l.resolve();o=function(t){h.then(t)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof s?function(t){s(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:a:function(){var t=document.createElement("div"),e={attributes:!0},i=!1,n=document.createElement("div"),s=new MutationObserver(function(){t.classList.toggle("foo"),i=!1});s.observe(n,e);var o=function(){i||(i=!0,n.classList.toggle("foo"))};return function(i){var n=new MutationObserver(function(){n.disconnect(),i()});n.observe(t,e),o()}}();t.exports=o}).call(e,function(){return this}(),i(141),i(146).setImmediate)},function(t,e,i){function n(t,e){this._id=t,this._clearFn=e}var s=Function.prototype.apply;e.setTimeout=function(){return new n(s.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new n(s.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(147),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,i){(function(t,e){!function(t,i){"use strict";function n(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var n={callback:t,args:e};return g[_]=n,p(_),_++}function s(t){delete g[t]}function o(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}function r(t){if(f)setTimeout(r,0,t);else{var e=g[t];if(e){f=!0;try{o(e)}finally{s(t),f=!1}}}}function a(){p=function(t){e.nextTick(function(){r(t)})}}function l(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}function c(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&r(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),p=function(i){t.postMessage(e+i,"*")}}function u(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;r(e)},p=function(e){t.port2.postMessage(e)}}function h(){var t=m.documentElement;p=function(e){var i=m.createElement("script");i.onreadystatechange=function(){r(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}function d(){p=function(t){setTimeout(r,0,t)}}if(!t.setImmediate){var p,_=1,g={},f=!1,m=t.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t,"[object process]"==={}.toString.call(t.process)?a():l()?c():t.MessageChannel?u():m&&"onreadystatechange"in m.createElement("script")?h():d(),v.setImmediate=n,v.clearImmediate=s}}("undefined"==typeof self?"undefined"==typeof t?this:t:self)}).call(e,function(){return this}(),i(141))},function(t,e){"use strict";function i(t,e,i,n,s){for(var o=0;o<s;++o)i[o+n]=t[o+e],t[o+e]=void 0}function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var i=this._front+e&this._capacity-1;this[i]=t,this._length=e+1},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var s=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[s+0&o]=t,this[s+1&o]=e,this[s+2&o]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,s=this._length,o=n+s&e-1;i(this,0,this,e,o)},t.exports=n},function(t,e,i){"use strict";function n(t,e){function i(n){return this instanceof i?(h(this,"message","string"==typeof n?n:e),h(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new i(n)}return u(i,Error),i}function s(t){return this instanceof s?(h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new s(t)}var o,r,a=i(143),l=a.freeze,c=i(142),u=c.inherits,h=c.notEnumerableProp,d=n("Warning","warning"),p=n("CancellationError","cancellation error"),_=n("TimeoutError","timeout error"),g=n("AggregateError","aggregate error");try{o=TypeError,r=RangeError}catch(t){o=n("TypeError","type error"),r=n("RangeError","range error")}for(var f="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<f.length;++m)"function"==typeof Array.prototype[f[m]]&&(g.prototype[f[m]]=Array.prototype[f[m]]);a.defineProperty(g.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),g.prototype.isOperational=!0;var v=0;g.prototype.toString=function(){var t=Array(4*v+1).join(" "),e="\n"+t+"AggregateError of:\n";v++,t=Array(4*v+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",s=n.split("\n"),o=0;o<s.length;++o)s[o]=t+s[o];n=s.join("\n"),e+=n+"\n"}return v--,e},u(s,Error);var b=Error.__BluebirdErrorTypes__;b||(b=l({CancellationError:p,TimeoutError:_,OperationalError:s,RejectionError:s,AggregateError:g}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:r,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:d}},function(t,e,i){"use strict";t.exports=function(t,e){function n(i,n){if(u(i)){if(i instanceof t)return i;var s=o(i);if(s===c){n&&n._pushContext();var l=t.reject(s.e);return n&&n._popContext(),l}if("function"==typeof s){if(r(i)){var l=new t(e);return i._then(l._fulfill,l._reject,void 0,l,null),l}return a(i,s,n)}}return i}function s(t){return t.then}function o(t){try{return s(t)}catch(t){return c.e=t,c}}function r(t){try{return h.call(t,"_promise0")}catch(t){return!1}}function a(i,n,s){function o(t){a&&(a._resolveCallback(t),a=null)}function r(t){a&&(a._rejectCallback(t,h,!0),a=null)}var a=new t(e),u=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var h=!0,d=l.tryCatch(n).call(i,o,r);return h=!1,a&&d===c&&(a._rejectCallback(d.e,!0,!0),a=null),u}var l=i(142),c=l.errorObj,u=l.isObject,h={}.hasOwnProperty;return n}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o){function r(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}function a(i){var n=this._promise=new t(e);i instanceof t&&n._propagateFrom(i,3),n._setOnCancel(this),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=i(142);l.isArray;return l.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(i,o){var a=n(this._values,this._promise);if(a instanceof t){a=a._target();var c=a._bitField;if(this._values=a,0===(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0===(33554432&c))return 0!==(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(a=l.asArray(a),null===a){var u=s("expecting an array or an iterable object but got "+l.classString(a)).reason();return void this._promise._rejectCallback(u,!1)}return 0===a.length?void(o===-5?this._resolveEmptyArray():this._resolve(r(o))):void this._iterate(a)},a.prototype._iterate=function(e){var i=this.getActualLength(e.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var s=this._promise,o=!1,r=null,a=0;a<i;++a){var l=n(e[a],s);l instanceof t?(l=l._target(),r=l._bitField):r=null,o?null!==r&&l.suppressUnhandledRejections():null!==r?0===(50397184&r)?(l._proxy(this,a),this._values[a]=l):o=0!==(33554432&r)?this._promiseFulfilled(l._value(),a):0!==(16777216&r)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(l,a)}o||s._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var i=0;i<e.length;++i)e[i]instanceof t&&e[i].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},function(t,e){"use strict";t.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function i(){if(s)return new e}function n(){var t=o.length-1;if(t>=0)return o[t]}var s=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=i,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var i=t.prototype._pushContext,o=t.prototype._popContext,r=t._peekContext,a=t.prototype._peekContext,l=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=o,t._peekContext=r,t.prototype._peekContext=a,t.prototype._promiseCreated=l,s=!1},s=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},function(t,e,i){(function(e){"use strict";t.exports=function(t,n){function s(t,e){return{promise:e}}function o(){return!1}function r(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+B.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function a(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?B.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function l(){return this._onCancelField}function c(t){this._onCancelField=t}function u(){this._cancellationParent=void 0,this._onCancelField=void 0}function h(t,e){if(0!==(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function d(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function _(){this._trace=new A(this._peekContext())}function g(t,e){if(L(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=x(t);B.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),B.notEnumerableProp(t,"__stackCleaned__",!0)}}}function f(t,e,i,n,s){if(void 0===t&&null!==e&&J){if(void 0!==s&&s._returnedNonUndefined())return;if(0===(65535&n._bitField))return;i&&(i+=" ");var o="",r="";if(e._trace){for(var a=e._trace.stack.split("\n"),l=k(a),c=l.length-1;c>=0;--c){var u=l[c];if(!U.test(u)){var h=u.match(z);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(l.length>0)for(var d=l[0],c=0;c<a.length;++c)if(a[c]===d){c>0&&(r="\n"+a[c-1]);break}}var p="a promise was created in a "+i+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+r;n._warn(p,!0,e)}}function m(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),v(i)}function v(e,i,n){if(rt.warnings){var s,o=new $(e);if(i)n._attachExtraTrace(o);else if(rt.longStackTraces&&(s=t._peekContext()))s.attachExtraTrace(o);else{var r=x(o);o.stack=r.message+"\n"+r.stack.join("\n")}et("warning",o)||S(o,"",!0)}}function b(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}function y(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function w(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],s=e.length-1,o=e[s],r=-1,a=n.length-1;a>=0;--a)if(n[a]===o){r=a;break}for(var a=r;a>=0;--a){var l=n[a];if(e[s]!==l)break;e.pop(),s--}e=n}}function k(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],s="    (No stack trace)"===n||H.test(n),o=s&&nt(n);s&&!o&&(W&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function C(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||H.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}function x(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?C(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:k(e)}}function S(t,e,i){if("undefined"!=typeof console){var n;if(B.isObject(t)){var s=t.stack;n=e+q(s,t)}else n=e+String(t);"function"==typeof O?O(n,i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function T(t,e,i,n){var s=!1;try{"function"==typeof e&&(s=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){D.throwLater(t)}"unhandledRejection"===t?et(t,i,n)||s||S(i,"Unhandled rejection "):et(t,n)}function E(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():B.toString(t);var i=/\[object [a-zA-Z0-9$_]+\]/;if(i.test(e))try{var n=JSON.stringify(t);e=n}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+P(e)+">, no stack trace)"}function P(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function F(){return"function"==typeof ot}function I(t){var e=t.match(st);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function j(t,e){if(F()){for(var i,n,s=t.stack.split("\n"),o=e.stack.split("\n"),r=-1,a=-1,l=0;l<s.length;++l){var c=I(s[l]);if(c){i=c.fileName,r=c.line;break}}for(var l=0;l<o.length;++l){var c=I(o[l]);if(c){n=c.fileName,a=c.line;break}}r<0||a<0||!i||!n||i!==n||r>=a||(nt=function(t){if(V.test(t))return!0;var e=I(t);return!!(e&&e.fileName===i&&r<=e.line&&e.line<=a)})}}function A(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);ot(this,A),e>32&&this.uncycle()}var M,N,O,R=t._getDomain,D=t._async,$=i(149).Warning,B=i(142),L=B.canAttachTrace,V=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,U=/\((?:timers\.js):\d+:\d+\)/,z=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,H=null,q=null,W=!1,K=!(0==B.env("BLUEBIRD_DEBUG")||!B.env("BLUEBIRD_DEBUG")&&"development"!==B.env("NODE_ENV")),G=!(0==B.env("BLUEBIRD_WARNINGS")||!K&&!B.env("BLUEBIRD_WARNINGS")),Q=!(0==B.env("BLUEBIRD_LONG_STACK_TRACES")||!K&&!B.env("BLUEBIRD_LONG_STACK_TRACES")),J=0!=B.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(G||!!B.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=t._bitField&-1048577|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0===(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){T("rejectionHandled",M,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),T("unhandledRejection",N,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,i){return v(t,e,i||this)},t.onPossiblyUnhandledRejection=function(t){var e=R();N="function"==typeof t?null===e?t:B.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=R();M="function"==typeof t?null===e?t:B.domainBind(e,t):void 0};var Y=function(){};t.longStackTraces=function(){if(D.haveItemsQueued()&&!rt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!rt.longStackTraces&&F()){var e=t.prototype._captureStackTrace,i=t.prototype._attachExtraTrace;rt.longStackTraces=!0,Y=function(){if(D.haveItemsQueued()&&!rt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=i,n.deactivateLongStackTraces(),D.enableTrampoline(),rt.longStackTraces=!1},t.prototype._captureStackTrace=_,t.prototype._attachExtraTrace=g,n.activateLongStackTraces(),D.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return rt.longStackTraces&&F()};var X=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return B.global.dispatchEvent(t),function(t,e){var i=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!B.global.dispatchEvent(i)}}if("function"==typeof Event){var t=new Event("CustomEvent");return B.global.dispatchEvent(t),function(t,e){var i=new Event(t.toLowerCase(),{cancelable:!0});return i.detail=e,!B.global.dispatchEvent(i)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),B.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!B.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),Z=function(){return B.isNode?function(){return e.emit.apply(e,arguments)}:B.global?function(t){var e="on"+t.toLowerCase(),i=B.global[e];return!!i&&(i.apply(B.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),tt={promiseCreated:s,promiseFulfilled:s,promiseRejected:s,promiseResolved:s,promiseCancelled:s,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:s},et=function(t){var e=!1;try{e=Z.apply(null,arguments)}catch(t){D.throwLater(t),e=!0}var i=!1;try{i=X(t,tt[t].apply(null,arguments))}catch(t){D.throwLater(t),i=!0}return i||e};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Y()),"warnings"in e){var i=e.warnings;rt.warnings=!!i,J=rt.warnings,B.isObject(i)&&"wForgottenReturn"in i&&(J=!!i.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!rt.cancellation){if(D.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=u,t.prototype._propagateFrom=h,t.prototype._onCancel=l,t.prototype._setOnCancel=c,t.prototype._attachCancellationCallback=a,t.prototype._execute=r,it=h,rt.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!rt.monitoring?(rt.monitoring=!0,t.prototype._fireEvent=et):!e.monitoring&&rt.monitoring&&(rt.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var it=d,nt=function(){return!1},st=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;B.inherits(A,Error),n.CapturedTrace=A,A.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,s=this;void 0!==s;++n)e.push(s),s=s._parent;t=this._length=n;for(var n=t-1;n>=0;--n){var o=e[n].stack;void 0===i[o]&&(i[o]=n)}for(var n=0;n<t;++n){var r=e[n].stack,a=i[r];if(void 0!==a&&a!==n){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var l=n>0?e[n-1]:this;a<t-1?(l._parent=e[a+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var c=l._length+1,u=n-2;u>=0;--u)e[u]._length=c,c++;return}}}},A.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=x(t),i=e.message,n=[e.stack],s=this;void 0!==s;)n.push(k(s.stack.split("\n"))),s=s._parent;w(n),y(n),B.notEnumerableProp(t,"stack",b(i,n)),B.notEnumerableProp(t,"__stackCleaned__",!0)}};var ot=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():E(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,H=t,q=e;var i=Error.captureStackTrace;return nt=function(t){return V.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return H=/@/,q=e,W=!0,function(t){t.stack=(new Error).stack};var s;try{throw new Error}catch(t){s="stack"in t}return"stack"in n||!s||"number"!=typeof Error.stackTraceLimit?(q=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?E(e):e.toString()},null):(H=t,q=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(O=function(t){console.warn(t)},B.isNode&&e.stderr.isTTY?O=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:B.isNode||"string"!=typeof(new Error).stack||(O=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var rt={warnings:G,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&t.longStackTraces(),{longStackTraces:function(){return rt.longStackTraces},warnings:function(){return rt.warnings},cancellation:function(){return rt.cancellation},monitoring:function(){return rt.monitoring},propagateFromFunction:function(){return it},boundValueFunction:function(){return p},checkForgottenReturns:f,setBounds:j,warn:v,deprecated:m,CapturedTrace:A,fireDomEvent:X,fireGlobalEvent:Z}}}).call(e,i(141))},function(t,e,i){"use strict";t.exports=function(t,e,n){function s(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function o(t){this.finallyHandler=t}function r(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function a(){return c.call(this,this.promise._target()._settledValue())}function l(t){if(!r(this,t))return d.e=t,d}function c(i){var s=this.promise,c=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?c.call(s._boundValue()):c.call(s._boundValue(),i);if(u===n)return u;if(void 0!==u){s._setReturnedNonUndefined();var p=e(u,s);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var _=new h("late cancellation observer");return s._attachExtraTrace(_),d.e=_,d}p.isPending()&&p._attachCancellationCallback(new o(this))}return p._then(a,l,void 0,this,void 0)}}}return s.isRejected()?(r(this),d.e=i,d):(r(this),i)}var u=i(142),h=t.CancellationError,d=u.errorObj,p=i(155)(n);return s.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){r(this.finallyHandler)},t.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new s(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,c,c)},t.prototype.tap=function(t){return this._passThrough(t,1,c)},t.prototype.tapCatch=function(e){var i=arguments.length;if(1===i)return this._passThrough(e,1,void 0,c);var n,s=new Array(i-1),o=0;for(n=0;n<i-1;++n){var r=arguments[n];if(!u.isObject(r))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(r)));s[o++]=r}s.length=o;var a=arguments[n];return this._passThrough(p(s,a,this),1,void 0,c)},s}},function(t,e,i){"use strict";t.exports=function(t){function e(e,i,a){return function(l){var c=a._boundValue();t:for(var u=0;u<e.length;++u){var h=e[u];if(h===Error||null!=h&&h.prototype instanceof Error){if(l instanceof h)return o(i).call(c,l)}else if("function"==typeof h){var d=o(h).call(c,l);if(d===r)return d;if(d)return o(i).call(c,l)}else if(n.isObject(l)){for(var p=s(h),_=0;_<p.length;++_){var g=p[_];if(h[g]!=l[g])continue t}return o(i).call(c,l)}}return t}}var n=i(142),s=i(143).keys,o=n.tryCatch,r=n.errorObj;return e}},function(t,e,i){"use strict";function n(t){return t instanceof Error&&u.getPrototypeOf(t)===Error.prototype}function s(t){var e;if(n(t)){e=new c(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var i=u.keys(t),s=0;s<i.length;++s){var o=i[s];h.test(o)||(e[o]=t[o])}return e}return r.markAsOriginatingFromRejection(t),t}function o(t,e){return function(i,n){if(null!==t){if(i){var o=s(a(i));t._attachExtraTrace(o),t._reject(o)}else if(e){for(var r=arguments.length,l=new Array(Math.max(r-1,0)),c=1;c<r;++c)l[c-1]=arguments[c];t._fulfill(l)}else t._fulfill(n);t=null}}}var r=i(142),a=r.maybeWrapAsError,l=i(149),c=l.OperationalError,u=i(143),h=/^(?:name|message|stack|cause)$/;t.exports=o},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o){var r=i(142),a=r.tryCatch;t.method=function(i){if("function"!=typeof i)throw new t.TypeError("expecting a function but got "+r.classString(i));return function(){var n=new t(e);n._captureStackTrace(),n._pushContext();var s=a(i).apply(this,arguments),r=n._popContext();return o.checkForgottenReturns(s,r,"Promise.method",n),n._resolveFromSyncValue(s),n}},t.attempt=t.try=function(i){if("function"!=typeof i)return s("expecting a function but got "+r.classString(i));var n=new t(e);n._captureStackTrace(),n._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],u=arguments[2];l=r.isArray(c)?a(i).apply(u,c):a(i).call(u,c)}else l=a(i)();var h=n._popContext();return o.checkForgottenReturns(l,h,"Promise.try",n),n._resolveFromSyncValue(l),n},t.prototype._resolveFromSyncValue=function(t){t===r.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e){"use strict";t.exports=function(t,e,i,n){var s=!1,o=function(t,e){this._reject(e)},r=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0===(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){s||(s=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var c=i(o),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(c),c instanceof t){var d={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:c};h._then(e,r,void 0,u,d),c._then(a,l,void 0,u,d),u._setOnCancel(c)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=this._bitField&-2097153},t.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s){var o=i(142),r=o.tryCatch,a=o.errorObj,l=t._async;t.prototype.break=t.prototype.cancel=function(){if(!s.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){
return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=r(t).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e){"use strict";t.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1],n=function(){throw e};return this.caught(t,n)},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();var s=function(){return n};return this.caught(i,s)}}},function(t,e){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},s=e.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},r=e.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},t.prototype.isPending=function(){return r.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return s.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o,r){var a,l=i(142),c=l.canEvaluate,u=l.tryCatch,h=l.errorObj;if(c){for(var d=function(t){return new Function("value","holder","                             \n\t            'use strict';                                                    \n\t            holder.pIndex = value;                                           \n\t            holder.checkFulfillment(this);                                   \n\t            ".replace(/Index/g,t))},p=function(t){return new Function("promise","holder","                           \n\t            'use strict';                                                    \n\t            holder.pIndex = promise;                                         \n\t            ".replace(/Index/g,t))},_=function(e){for(var i=new Array(e),n=0;n<i.length;++n)i[n]="this.p"+(n+1);var s=i.join(" = ")+" = null;",r="var promise;\n"+i.map(function(t){return"                                                         \n\t                promise = "+t+";                                      \n\t                if (promise instanceof Promise) {                            \n\t                    promise.cancel();                                        \n\t                }                                                            \n\t            "}).join("\n"),a=i.join(", "),l="Holder$"+e,c="return function(tryCatch, errorObj, Promise, async) {    \n\t            'use strict';                                                    \n\t            function [TheName](fn) {                                         \n\t                [TheProperties]                                              \n\t                this.fn = fn;                                                \n\t                this.asyncNeeded = true;                                     \n\t                this.now = 0;                                                \n\t            }                                                                \n\t                                                                             \n\t            [TheName].prototype._callFunction = function(promise) {          \n\t                promise._pushContext();                                      \n\t                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n\t                promise._popContext();                                       \n\t                if (ret === errorObj) {                                      \n\t                    promise._rejectCallback(ret.e, false);                   \n\t                } else {                                                     \n\t                    promise._resolveCallback(ret);                           \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype.checkFulfillment = function(promise) {       \n\t                var now = ++this.now;                                        \n\t                if (now === [TheTotal]) {                                    \n\t                    if (this.asyncNeeded) {                                  \n\t                        async.invoke(this._callFunction, this, promise);     \n\t                    } else {                                                 \n\t                        this._callFunction(promise);                         \n\t                    }                                                        \n\t                                                                             \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype._resultCancelled = function() {              \n\t                [CancellationCode]                                           \n\t            };                                                               \n\t                                                                             \n\t            return [TheName];                                                \n\t        }(tryCatch, errorObj, Promise, async);                               \n\t        ";return c=c.replace(/\[TheName\]/g,l).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,a).replace(/\[TheProperties\]/g,s).replace(/\[CancellationCode\]/g,r),new Function("tryCatch","errorObj","Promise","async",c)(u,h,t,o)},g=[],f=[],m=[],v=0;v<8;++v)g.push(_(v+1)),f.push(d(v+1)),m.push(p(v+1));a=function(t){this._reject(t)}}t.join=function(){var i,o=arguments.length-1;if(o>0&&"function"==typeof arguments[o]&&(i=arguments[o],o<=8&&c)){var u=new t(s);u._captureStackTrace();for(var h=g[o-1],d=new h(i),p=f,_=0;_<o;++_){var v=n(arguments[_],u);if(v instanceof t){v=v._target();var b=v._bitField;0===(50397184&b)?(v._then(p[_],a,void 0,u,d),m[_](v,d),d.asyncNeeded=!1):0!==(33554432&b)?p[_].call(u,v._value(),d):0!==(16777216&b)?u._reject(v._reason()):u._cancel()}else p[_].call(u,v,d)}if(!u._isFateSealed()){if(d.asyncNeeded){var y=r();null!==y&&(d.fn=l.domainBind(y,d.fn))}u._setAsyncGuaranteed(),u._setOnCancel(d)}return u}for(var w=arguments.length,k=new Array(w),C=0;C<w;++C)k[C]=arguments[C];i&&k.pop();var u=new e(k).promise();return void 0!==i?u.spread(i):u}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o,r){function a(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();var s=c();this._callback=null===s?e:u.domainBind(s,e),this._preservedValues=n===o?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function l(e,i,s,o){if("function"!=typeof i)return n("expecting a function but got "+u.classString(i));var r=0;if(void 0!==s){if("object"!=typeof s||null===s)return t.reject(new TypeError("options argument must be an object but it is "+u.classString(s)));if("number"!=typeof s.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(s.concurrency)));r=s.concurrency}return r="number"==typeof r&&isFinite(r)&&r>=1?r:0,new a(e,i,r,o).promise()}var c=t._getDomain,u=i(142),h=u.tryCatch,d=u.errorObj,p=t._async;u.inherits(a,e),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,i){var n=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(i<0){if(i=i*-1-1,n[i]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return n[i]=e,this._queue.push(i),!1;null!==a&&(a[i]=e);var c=this._promise,u=this._callback,p=c._boundValue();c._pushContext();var _=h(u).call(p,e,i,o),g=c._popContext();if(r.checkForgottenReturns(_,g,null!==a?"Promise.filter":"Promise.map",c),_===d)return this._reject(_.e),!0;var f=s(_,this._promise);if(f instanceof t){f=f._target();var m=f._bitField;if(0===(50397184&m))return l>=1&&this._inFlight++,n[i]=f,f._proxy(this,(i+1)*-1),!1;if(0===(33554432&m))return 0!==(16777216&m)?(this._reject(f._reason()),!0):(this._cancel(),!0);_=f._value()}n[i]=_}var v=++this._totalResolved;return v>=o&&(null!==a?this._filter(n,a):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},a.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),s=0,o=0;o<i;++o)t[o]&&(n[s++]=e[o]);n.length=s,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return l(this,t,e,null)},t.map=function(t,e,i,n){return l(t,e,i,n)}}},function(t,e,i){"use strict";var n=Object.create;if(n){var s=n(null),o=n(null);s[" size"]=o[" size"]=0}t.exports=function(t){function e(e,i){var n;if(null!=e&&(n=e[i]),"function"!=typeof n){var s="Object "+u.classString(e)+" has no method '"+u.toString(i)+"'";throw new t.TypeError(s)}return n}function n(t){var i=this.pop(),n=e(t,i);return n.apply(t,this)}function r(t){return t[this]}function a(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var l,c,u=i(142),h=u.canEvaluate,d=u.isIdentifier,p=function(t){return new Function("ensureMethod","                                    \n\t        return function(obj) {                                               \n\t            'use strict'                                                     \n\t            var len = this.length;                                           \n\t            ensureMethod(obj, 'methodName');                                 \n\t            switch(len) {                                                    \n\t                case 1: return obj.methodName(this[0]);                      \n\t                case 2: return obj.methodName(this[0], this[1]);             \n\t                case 3: return obj.methodName(this[0], this[1], this[2]);    \n\t                case 0: return obj.methodName();                             \n\t                default:                                                     \n\t                    return obj.methodName.apply(obj, this);                  \n\t            }                                                                \n\t        };                                                                   \n\t        ".replace(/methodName/g,t))(e)},_=function(t){return new Function("obj","                                             \n\t        'use strict';                                                        \n\t        return obj.propertyName;                                             \n\t        ".replace("propertyName",t))},g=function(t,e,i){var n=i[t];if("function"!=typeof n){if(!d(t))return null;if(n=e(t),i[t]=n,i[" size"]++,i[" size"]>512){for(var s=Object.keys(i),o=0;o<256;++o)delete i[s[o]];i[" size"]=s.length-256}}return n};l=function(t){return g(t,p,s)},c=function(t){return g(t,_,o)},t.prototype.call=function(t){for(var e=arguments.length,i=new Array(Math.max(e-1,0)),s=1;s<e;++s)i[s-1]=arguments[s];if(h){var o=l(t);if(null!==o)return this._then(o,void 0,void 0,i,void 0)}return i.push(t),this._then(n,void 0,void 0,i,void 0)},t.prototype.get=function(t){var e,i="number"==typeof t;if(i)e=a;else if(h){var n=c(t);e=null!==n?n:r}else e=r;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o,r){function a(t){setTimeout(function(){throw t},0)}function l(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function c(e,i){function s(){if(r>=c)return u._fulfill();var o=l(e[r++]);if(o instanceof t&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(i),e.promise)}catch(t){return a(t)}if(o instanceof t)return o._then(s,a,null,null,null)}s()}var r=0,c=e.length,u=new t(o);return s(),u}function u(t,e,i){this._data=t,this._promise=e,this._context=i}function h(t,e,i){this.constructor$(t,e,i)}function d(t){return u.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function p(t){this.length=t,this.promise=null,this[t-1]=null}var _=i(142),g=i(149).TypeError,f=i(142).inherits,m=_.errorObj,v=_.tryCatch,b={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},u.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==b?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},u.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},f(h,u),h.prototype.doDispose=function(t,e){var i=this.data();return i.call(t,t,e)},p.prototype._resultCancelled=function(){for(var e=this.length,i=0;i<e;++i){var n=this[i];n instanceof t&&n.cancel()}},t.using=function(){var i=arguments.length;if(i<2)return e("you must pass at least 2 arguments to Promise.using");var s=arguments[i-1];if("function"!=typeof s)return e("expecting a function but got "+_.classString(s));var o,a=!0;2===i&&Array.isArray(arguments[0])?(o=arguments[0],i=o.length,a=!1):(o=arguments,i--);for(var l=new p(i),h=0;h<i;++h){var g=o[h];if(u.isDisposer(g)){var f=g;g=g.promise(),g._setDisposable(f)}else{var b=n(g);b instanceof t&&(g=b._then(d,null,null,{resources:l,index:h},void 0))}l[h]=g}for(var y=new Array(l.length),h=0;h<y.length;++h)y[h]=t.resolve(l[h]).reflect();var w=t.all(y).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return m.e=i.error(),m;if(!i.isFulfilled())return void w.cancel();t[e]=i.value()}k._pushContext(),s=v(s);var n=a?s.apply(void 0,t):s(t),o=k._popContext();return r.checkForgottenReturns(n,o,"Promise.using",k),n}),k=w.lastly(function(){var e=new t.PromiseInspection(w);return c(l,e)});return l.promise=k,k._setOnCancel(l),k},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this,s());throw new g}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function s(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function r(t){throw clearTimeout(this.handle),t}var a=i(142),l=t.TimeoutError;s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(t){return u(+this).thenReturn(t)},u=t.delay=function(i,o){var r,a;return void 0!==o?(r=t.resolve(o)._then(c,null,null,i,void 0),n.cancellation()&&o instanceof t&&r._setOnCancel(o)):(r=new t(e),a=setTimeout(function(){r._fulfill()},+i),n.cancellation()&&r._setOnCancel(new s(a)),r._captureStackTrace()),r._setAsyncGuaranteed(),r};t.prototype.delay=function(t){return u(t,this)};var h=function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new l("operation timed out"):new l(e),a.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()};t.prototype.timeout=function(t,e){t=+t;var i,a,l=new s(setTimeout(function(){i.isPending()&&h(i,e,a)},t));return n.cancellation()?(a=this.then(),i=a._then(o,r,void 0,l,void 0),i._setOnCancel(l)):i=this._then(o,r,void 0,l,void 0),i}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o,r){function a(e,i,n){for(var o=0;o<i.length;++o){n._pushContext();var r=p(i[o])(e);if(n._popContext(),r===d){n._pushContext();var a=t.reject(d.e);return n._popContext(),a}var l=s(r,n);if(l instanceof t)return l}return null}function l(e,i,s,o){if(r.cancellation()){var a=new t(n),l=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return l}),a._captureStackTrace(),a._setOnCancel(this)}else{var c=this._promise=new t(n);c._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof s?[s].concat(_):_,this._yieldedPromise=null,this._cancellationPhase=!1}var c=i(149),u=c.TypeError,h=i(142),d=h.errorObj,p=h.tryCatch,_=[];h.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,r.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,i="undefined"!=typeof this._generator.return;if(i)this._promise._pushContext(),e=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=p(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=p(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var i=this._promise;if(e===d)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(e.e,!1);var n=e.value;if(e.done===!0)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var o=s(n,this._promise);if(!(o instanceof t)&&(o=a(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var r=o._bitField;0===(50397184&r)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&r)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!==(16777216&r)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=l,s=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new n(void 0,void 0,i,s),r=o.promise();return o._generator=e,o._promiseFulfilled(void 0),r}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("expecting a function but got "+h.classString(t));_.push(t)},t.spawn=function(i){if(r.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof i)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new l(i,this),s=n.promise();return n._run(t.spawn),s}}},function(t,e,i){"use strict";t.exports=function(t){function e(t,e){var i=this;if(!o.isArray(t))return n.call(i,t,e);var s=a(e).apply(i._boundValue(),[null].concat(t));s===l&&r.throwLater(s.e)}function n(t,e){var i=this,n=i._boundValue(),s=void 0===t?a(e).call(n,null):a(e).call(n,null,t);s===l&&r.throwLater(s.e)}function s(t,e){var i=this;if(!t){var n=new Error(t+"");n.cause=t,t=n}var s=a(e).call(i._boundValue(),t);s===l&&r.throwLater(s.e)}var o=i(142),r=t._async,a=o.tryCatch,l=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(t,i){if("function"==typeof t){var o=n;void 0!==i&&Object(i).spread&&(o=e),this._then(o,s,void 0,this,t)}return this}}},function(t,e,i){"use strict";t.exports=function(t,e){function n(t){return!k.test(t)}function s(t){try{return t.__isPromisified__===!0}catch(t){return!1}}function o(t,e,i){var n=p.getDataPropertyOrDefault(t,e+i,y);return!!n&&s(n)}function r(t,e,i){for(var n=0;n<t.length;n+=2){var s=t[n];if(i.test(s))for(var o=s.replace(i,""),r=0;r<t.length;r+=2)if(t[r]===o)throw new v("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function a(t,e,i,n){for(var a=p.inheritedDataKeys(t),l=[],c=0;c<a.length;++c){var u=a[c],h=t[u],d=n===C||C(u,h,t);"function"!=typeof h||s(h)||o(t,u,e)||!n(u,h,t,d)||l.push(u,h)}return r(l,e,i),l}function l(i,n,s,o,r,a){function l(){var s=n;n===d&&(s=this);var o=new t(e);o._captureStackTrace();var r="string"==typeof u&&this!==c?this[u]:i,l=_(o,a);try{r.apply(s,g(arguments,l))}catch(t){o._rejectCallback(f(t),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),u=i;return"string"==typeof u&&(i=o),p.notEnumerableProp(l,"__isPromisified__",!0),l}function c(t,e,i,n,s){for(var o=new RegExp(x(e)+"$"),r=a(t,e,o,i),l=0,c=r.length;l<c;l+=2){var u=r[l],h=r[l+1],_=u+e;if(n===F)t[_]=F(u,d,u,h,e,s);else{var g=n(h,function(){return F(u,d,u,h,e,s)});p.notEnumerableProp(g,"__isPromisified__",!0),t[_]=g}}return p.toFastProperties(t),t}function u(t,e,i){return F(t,e,void 0,t,null,i)}var h,d={},p=i(142),_=i(156),g=p.withAppended,f=p.maybeWrapAsError,m=p.canEvaluate,v=i(149).TypeError,b="Async",y={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],k=new RegExp("^(?:"+w.join("|")+")$"),C=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},x=function(t){return t.replace(/([$])/,"\\$")},S=function(t){for(var e=[t],i=Math.max(0,t-1-3),n=t-1;n>=i;--n)e.push(n);for(var n=t+1;n<=3;++n)e.push(n);return e},T=function(t){return p.filledRange(t,"_arg","")},E=function(t){return p.filledRange(Math.max(t,3),"_arg","")},P=function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0};h=function(i,n,s,o,r,a){function l(t){var e,i=T(t).join(", "),s=t>0?", ":"";return e=m?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===n?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n",e.replace("{{args}}",i).replace(", ",s)}function c(){for(var t="",e=0;e<h.length;++e)t+="case "+h[e]+":"+l(h[e]);return t+="                                                             \n\t        default:                                                             \n\t            var args = new Array(len + 1);                                   \n\t            var i = 0;                                                       \n\t            for (var i = 0; i < len; ++i) {                                  \n\t               args[i] = arguments[i];                                       \n\t            }                                                                \n\t            args[i] = nodeback;                                              \n\t            [CodeForCall]                                                    \n\t            break;                                                           \n\t        ".replace("[CodeForCall]",m?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}var u=Math.max(0,P(o)-1),h=S(u),m="string"==typeof i||n===d,v="string"==typeof i?"this != null ? this['"+i+"'] : fn":"fn",b="'use strict';                                                \n\t        var ret = function (Parameters) {                                    \n\t            'use strict';                                                    \n\t            var len = arguments.length;                                      \n\t            var promise = new Promise(INTERNAL);                             \n\t            promise._captureStackTrace();                                    \n\t            var nodeback = nodebackForPromise(promise, "+a+");   \n\t            var ret;                                                         \n\t            var callback = tryCatch([GetFunctionCode]);                      \n\t            switch(len) {                                                    \n\t                [CodeForSwitchCase]                                          \n\t            }                                                                \n\t            if (ret === errorObj) {                                          \n\t                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n\t            }                                                                \n\t            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n\t            return promise;                                                  \n\t        };                                                                   \n\t        notEnumerableProp(ret, '__isPromisified__', true);                   \n\t        return ret;                                                          \n\t    ".replace("[CodeForSwitchCase]",c()).replace("[GetFunctionCode]",v);return b=b.replace("Parameters",E(u)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",b)(t,o,n,g,f,_,p.tryCatch,p.errorObj,p.notEnumerableProp,e)};var F=m?h:l;t.promisify=function(t,e){if("function"!=typeof t)throw new v("expecting a function but got "+p.classString(t));if(s(t))return t;e=Object(e);var i=void 0===e.context?d:e.context,o=!!e.multiArgs,r=u(t,i,o);return p.copyDescriptors(t,r,n),r},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new v("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var i=!!e.multiArgs,n=e.suffix;"string"!=typeof n&&(n=b);var s=e.filter;"function"!=typeof s&&(s=C);var o=e.promisifier;if("function"!=typeof o&&(o=F),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var r=p.inheritedDataKeys(t),a=0;a<r.length;++a){var l=t[r[a]];"constructor"!==r[a]&&p.isClass(l)&&(c(l.prototype,n,s,o,i),c(l,n,s,o,i))}return c(t,n,s,o,i)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s){function o(t){var e,i=!1;if(void 0!==a&&t instanceof a)e=h(t),i=!0;else{var n=u.keys(t),s=n.length;e=new Array(2*s);for(var o=0;o<s;++o){var r=n[o];e[o]=t[r],e[o+s]=r}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function r(e){var i,r=n(e);return c(r)?(i=r instanceof t?r._then(t.props,void 0,void 0,void 0,void 0):new o(r).promise(),r instanceof t&&i._propagateFrom(r,2),i):s("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,l=i(142),c=l.isObject,u=i(143);"function"==typeof Map&&(a=Map);var h=function(){function t(t,n){this[e]=t,this[e+i]=n,e++}var e=0,i=0;return function(n){i=n.size,e=0;var s=new Array(2*n.size);return n.forEach(t,s),s}}(),d=function(t){for(var e=new a,i=t.length/2|0,n=0;n<i;++n){var s=t[i+n],o=t[n];e.set(s,o)}return e};l.inherits(o,e),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;if(i>=this._length){var n;if(this._isMap)n=d(this._values);else{n={};for(var s=this.length(),o=0,r=this.length();o<r;++o)n[this._values[o+s]]=this._values[o]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return r(this)},t.props=function(t){return r(t)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s){function o(i,o){var l=n(i);if(l instanceof t)return a(l);if(i=r.asArray(i),null===i)return s("expecting an array or an iterable object but got "+r.classString(i));var c=new t(e);void 0!==o&&c._propagateFrom(o,3);for(var u=c._fulfill,h=c._reject,d=0,p=i.length;d<p;++d){var _=i[d];(void 0!==_||d in i)&&t.cast(_)._then(u,h,void 0,c,null)}return c}var r=i(142),a=function(t){return t.then(function(e){return o(e,t)})};t.race=function(t){return o(t,void 0)},t.prototype.race=function(){return o(this,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,s,o,r){function a(e,i,n,s){this.constructor$(e);var r=d();this._fn=null===r?i:p.domainBind(r,i),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,s===o?this._eachValues=Array(this._length):0===s?this._eachValues=null:this._eachValues=void 0,
this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function c(t,e,i,s){if("function"!=typeof e)return n("expecting a function but got "+p.classString(e));var o=new a(t,e,i,s);return o.promise()}function u(e){this.accum=e,this.array._gotAccum(e);var i=s(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(h,void 0,void 0,this,void 0)):h.call(this,i)}function h(e){var i=this.array,n=i._promise,s=_(i._fn);n._pushContext();var o;o=void 0!==i._eachValues?s.call(n._boundValue(),e,this.index,this.length):s.call(n._boundValue(),this.accum,e,this.index,this.length),o instanceof t&&(i._currentCancellable=o);var a=n._popContext();return r.checkForgottenReturns(o,a,void 0!==i._eachValues?"Promise.each":"Promise.reduce",n),o}var d=t._getDomain,p=i(142),_=p.tryCatch;p.inherits(a,e),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==o&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},a.prototype._iterate=function(e){this._values=e;var i,n,s=e.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=t.resolve(e[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<s;++n){var o={accum:null,value:e[n],index:n,length:s,array:this};i=i._then(u,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(l,l,void 0,i,this)},t.prototype.reduce=function(t,e){return c(this,t,e,null)},t.reduce=function(t,e,i,n){return c(t,e,i,n)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function s(t){this.constructor$(t)}var o=t.PromiseInspection,r=i(142);r.inherits(s,e),s.prototype._promiseResolved=function(t,e){this._values[t]=e;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseFulfilled=function(t,e){var i=new o;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},s.prototype._promiseRejected=function(t,e){var i=new o;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return n.deprecated(".settle()",".reflect()"),new s(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function s(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new s(t),o=i.promise();return i.setHowMany(e),i.init(),o}var r=i(142),a=i(149).RangeError,l=i(149).AggregateError,c=r.isArray,u={};r.inherits(s,e),s.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=c(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},s.prototype.init=function(){this._initialized=!0,this._init()},s.prototype.setUnwrap=function(){this._unwrap=!0},s.prototype.howMany=function(){return this._howMany},s.prototype.setHowMany=function(t){this._howMany=t},s.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},s.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},s.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},s.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new l,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},s.prototype._fulfilled=function(){return this._totalResolved},s.prototype._rejected=function(){return this._values.length-this.length()},s.prototype._addRejected=function(t){this._values.push(t)},s.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},s.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},s.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},s.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return o(t,e)},t.prototype.some=function(t){return o(this,t)},t._SomePromiseArray=s}},function(t,e){"use strict";t.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,s){return i(t,n,s,e)}}},function(t,e){"use strict";t.exports=function(t,e){function i(){return o(this)}function n(t,i){return s(t,i,e,e)}var s=t.reduce,o=t.all;t.prototype.each=function(t){return s(this,t,e,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return s(this,t,e,e)},t.each=function(t,n){return s(t,n,e,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=n}},function(t,e){"use strict";t.exports=function(t){function e(t){var e=new i(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}var i=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},function(t,e,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(130),r=i(179),a=(i(132),{__:o,sprintf:s,_subview:r}),l=function(){return n.extend(n.templateSettings.imports,a),a};t.exports=l},function(t,e){"use strict";t.exports=function(t){return'<noscript data-subview="'+t+'"></noscript>'}},,function(t,e,i){"use strict";function n(){_.documentHeight=p.documentHeight,p.documentHeight=h.height(),_.windowHeight=p.windowHeight,p.windowHeight=d.height(),_.windowWidth=p.windowWidth,p.windowWidth=d.width(),_.windowScrollTop=_.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop()}function s(){function t(t){n(),u.trigger("DOMEventor:flatresize",p),e=!1}var e;d.on("resize.DOMEventor-nextResizeLoop",function(){e||(f(t),e=!0)})}function o(){function t(t){i--||(_.documentHeight=p.documentHeight,p.documentHeight=h.height(),i=1),_.windowScrollTop=_.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop(),u.trigger("DOMEventor:flatscroll",p),e=!1}var e,i=0;d.on("scroll.DOMEventor-nextScrollLoop",function(){e||(f(t),e=!0)})}function r(){h.off("keydown.DOMEventor keyup.DOMEventor"),u.on("DOMEventor:startKeyboardObserver",g),u.off("DOMEventor:stopKeyboardObserver")}function a(){n(),o(),s(),g(),u.on("DOMEventor:updateRect",n)}var l=i(3),c=i(8),u=i(136),h=c(document),d=c(window),p={},_={};p.documentHeight=_.documentHeight=null,p.windowHeight=_.windowHeight=null,p.windowWidth=_.windowHeight=null,p.windowScrollTop=_.windowScrollTop=null,p.windowScrollY=_.windowScrollY=null;var g,f=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(t){window.setTimeout(function(){t()},50)};g=function(){var t=[],e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};h.on("keydown.DOMEventor keyup.DOMEventor",function(i){var n=i.type;if("keyup"===n||"keydown"===n){var s=c(i.target),o=i.which;if(!((s.is("input")||s.is("textarea")||s.is("select"))&&o>=48&&o<=90)||i.metaKey||i.ctrlKey||i.altKey){o>=48&&o<=90&&"keydown"===n&&(t[o]=1);var r="";for(var a in t)"keydown"===n&&o!==parseInt(a,10)&&(r+=e[a]?e[a]+"+":"");var l=n+":"+(i.altKey&&18!==o?"alt+":"")+(i.ctrlKey&&17!==o?"ctrl+":"")+(i.metaKey&&91!==o&&92!==o&&93!==o?"meta+":"")+(i.shiftKey&&16!==o?"shift+":"")+(r||"")+(e[o]||"");u.trigger("DOMEventor:"+l,i,l),"keyup"===n&&(t=[])}}}),u.off("DOMEventor:startKeyboardObserver"),u.on("DOMEventor:stopKeyboardObserver",r)};var m={init:l.once(a),rect:function(){return p},lastRect:function(){return _}};t.exports=m},function(t,e,i){"use strict";var n,s=i(183),o=i(129),r=i(136),a=function(){if(null==n){var t=o.get("Context/userinfo");n=!(!t||!t.name)&&new s(t),n&&(n.listenTo(r,"post:like:set",n.incrementLikeCount),n.listenTo(r,"post:unlike:set",n.decrementLikeCount),n.listenTo(r,"tumblelog:follow",n.incrementFollowingCount),n.listenTo(r,"tumblelog:unfollow",n.decrementFollowingCount))}return n};t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(184),o=i(185),r=i(189),a=s.extend({idAttribute:"name",initialize:function(t){this.channels=new r(t.channels)},incrementLikeCount:function(){var t=this.get("liked_post_count");this.set("liked_post_count",t+1)},decrementLikeCount:function(){var t=this.get("liked_post_count");t>0&&this.set("liked_post_count",t-1)},incrementFollowingCount:function(){var t=this.get("friend_count");this.set("friend_count",t+1)},decrementFollowingCount:function(){var t=this.get("friend_count");t>0&&this.set("friend_count",t-1)},getUnreadCount:function(){return this.channels.reduce(function(t,e){return parseInt(t,10)+parseInt(e.get("unread_count"),10)},0)},getChannel:function(t){return null==t&&(t=this.get("primary")),this.channels.findWhere({name:t})},canMessage:function(){return this.get("can_message")},isSoundsEnabled:function(){return this.get("is_sounds_enabled")},isVerifiedEmail:function(){return this.get("is_verified_email")},getChannelsEnabledForMessaging:function(){return this.channels.where({can_send_messages:!0})},getCurrentMessagingChannelUuid:function(){var t;return n.isEmpty(this._currentMessagingChannelUuid)&&(t=this.channels.findWhere({is_current:!0,can_send_messages:!0})||n.first(this.getChannelsEnabledForMessaging()),t&&(this._currentMessagingChannelUuid=t.get("uuid"))),this._currentMessagingChannelUuid},setCurrentMessagingChannelUuid:function(t){this._currentMessagingChannelUuid=t},toJSON:function(){var t=o.prototype.toJSON.apply(this,arguments);return t.channels=this.channels.toJSON(),t},getChannelProperty:function(t,e){var i=this.getChannel(t);if(!(i&&"get"in i))return null;var n=i.get(e);return"undefined"==typeof n?null:n}});t.exports=a},function(t,e,i){"use strict";function n(t,e){function i(t,e){var i,n;if(!s.isObject(t))throw new Error("SingletonModel requires attributes");if(i=t[d],s.isEmpty(i)&&!s.isNumber(i)&&s.defer(function(){throw new Error('SingletonModel attributes require a "'+d+'"')}),n=u[i],h[i]++||(h[i]=1),n)s.keys(t).length>=2&&n.set(t,e),n.collection!==!0&&(n.collection=!0);else{u[i]=this;try{Object.defineProperty(this,"collection",{value:!0,configurable:!1,enumerable:!0,writable:!1})}finally{this.collection||(this.collection=!0)}this.constructor.__super__.constructor.call(this,t,e),c.add(this)}return n||this}function n(){return this.id}function a(){return c}function l(){0===--h[this.id]&&(delete u[this.id],delete h[this.id],c.remove(this))}t||(t={}),e||(e={});var c=new o.Collection,u=Object.create(null),h=Object.create(null),d=t.idAttribute||r.prototype.idAttribute;return t.constructor=i,t.release=l,t.toString=n,t.toJSON=t.toJSON||r.prototype.toJSON,e.getCollection=a,r.extend(t,e)}var s=i(3),o=i(7),r=i(185);t.exports.extend=n},function(t,e,i){"use strict";var n=i(7),s=i(186),o=i(188),r=n.Model.extend({});s.applyTo(r.prototype),o.applyTo(r),t.exports=r},function(t,e,i){"use strict";var n=i(187),s=new n({before:{sync:function(t,e,i){i.withFormKey=!0}}});t.exports=s},function(t,e,i){"use strict";function n(t,e){u.each(e,function(e,i){var n=t[i];t[i]=function(){return e.apply(this,arguments),n.apply(this,arguments)}})}function s(t,e){u.each(e,function(e,i){var n=t[i];t[i]=function(){var t=n.apply(this,arguments);return e.apply(this,arguments),t}})}function o(t,e){u.each(e,function(e,i){var n=t[i];t[i]=function(){var t=u.toArray(arguments);return t.unshift(u.bind(n,this)),e.apply(this,t)}})}function r(t,e){u.each(e,function(e,i){var n=i in t&&t[i];t[i]=function(){var t=u.toArray(arguments),i=n?u.bind(n,this):u.noop;return t.unshift(i),e.apply(this,t)}})}function a(t,e){u.defaults(t,e)}function l(t,e){u.extend(t,e)}function c(){this.mixins=u.filter(arguments,function(t){return t instanceof c}),this.properties=arguments[this.mixins.length]||{}}var u=i(3);c.prototype.mixins=null,c.prototype.properties=null,c.prototype.applyTo=function(t){var e=this.properties;a(t,e.defaults),l(t,e.extend),u.extend(t,u.omit(e,"before","after","around","onto","defaults","extend","applyTo")),u.invoke(this.mixins,"applyTo",t),n(t,e.before),s(t,e.after),o(t,e.around),r(t,e.onto),u.isFunction(e.applyTo)&&e.applyTo.apply(this,arguments)},c.before=n,c.after=s,c.around=o,c.onto=r,t.exports=c},function(t,e,i){"use strict";function n(t){var e=r.apply(this,arguments);return o.has(t,"mixins")&&t.mixins.forEach(function(t){t.applyTo(e.prototype)}),e}function s(t){t.extend=n}var o=i(3),r=i(7).Model.extend;t.exports.applyTo=s},function(t,e,i){"use strict";var n=i(190),s=i(191),o=n.extend({model:s});t.exports=o},function(t,e,i){"use strict";var n=i(7).Collection,s=i(186),o=i(188),n=n.extend();s.applyTo(n.prototype),o.applyTo(n),t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=a.Deferred(),s={data:{tumblelog:t.get("name"),page_url:window.location.href}};["placement_id","pt","source","context","tlt","offset"].forEach(function(t){i.hasOwnProperty(t)&&(s.data[t]=i[t])});var o=function(){i.wait||t.set({following:e.following},i)},r=function(s,o){i.wait||t.set({following:!e.following},i),n.reject(o)},l=function(){i.wait&&t.set({following:e.following},i),n.resolve()},c=e.following?"/svc/follow":"/svc/unfollow";return a.ajax({beforeSend:o,cache:!i.force,data:s,error:r,type:"POST",success:l,url:c,withFormKey:!0}),n.promise()}function s(t,e){var i=a.Deferred(),n={};l.has(e,"is_tumblelog_popover")&&(n.is_tumblelog_popover=e.is_tumblelog_popover),l.has(e,"is_user_mention")&&(n.is_user_mention=e.is_user_mention);var s=function(t,e){i.reject(e)},o=function(e){l.has(e,"highlighted_posts")||(e={highlighted_posts:e}),t.set(e),i.resolve()};return a.ajax({cache:!e.force,data:n,error:s,type:"GET",success:o,url:p(t),withFormKey:!0}),i.promise()}function o(t,e){return c.promise(function(i,n){var s={tumblelog:t.get("name")};l.has(e,"include_member_data")&&(s.include_member_data=e.include_member_data),l.has(e,"include_activity_data")&&l.has(e,"include_member_data")&&(s.include_activity_data=e.include_activity_data),l.has(e,"include_activity_notifications")&&l.has(e,"include_member_data")&&(s.include_activity_notifications=e.include_activity_notifications);var o=function(t,e){n(e)},r=function(e){t.set(e.response),i()};a.ajax({data:s,type:"GET",error:o,success:r,url:"/svc/data/tumblelog",withFormKey:!0})})}function r(t,e){return a.ajax({cache:!e.force,data:e.data,type:"GET",url:"/svc/tumblelog_popover/"+t,withFormKey:!0})}var a=i(8),l=i(3),c=i(192),u=i(136),h=i(212),d=i(184),p=function(){function t(t){return t.has("avatar_url")&&t.has("global_theme_params")}return function(e){return t(e)?"/svc/"+e.get("name")+"/posts/highlighted":"/svc/tumblelog_popover/"+e.get("name")}}(),_=d.extend({save_following:function(t,e){e||(e={}),t||(t={}),t.following=!!t.following;var i=this;return e.force||i.get("following")!==t.following?n(i,t,e).then(l.bindKey(i,"save_following",t)):a.when(i.get("following"))},fetch_popover_data:function(t){t||(t={}),t.is_user_mention=!!t.is_user_mention,t.is_tumblelog_popover=!!t.is_tumblelog_popover;var e=this;return!t.force&&e.has("highlighted_posts")?a.when(e.get("highlighted_posts")):s(e,t).then(l.bindKey(e,"fetch_popover_data",null))},fetch_analytics_data:function(){return o(this,{include_member_data:!0,include_activity_data:!0})},fetch_activity_notifications:function(){return o(this,{include_member_data:!0,include_activity_data:!0,include_activity_notifications:!0})},toggle_spam:function(){return a.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_nsfw:function(){return a.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_adult:function(){return a.ajax({url:"/adult/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_uniblock:function(){return a.ajax({url:"/uniblock/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_suspended:function(){return a.ajax({url:"/suspended/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},follow:function(t){return this.save_following({following:!0},t)},_unfollow:function(t){this.save_following({following:!1},t)},requestUnfollow:function(t){var e=c.defer();return e.promise.then(l.bind(this._unfollow,this,t)).catch(l.noop),e},block:function(){return h.block({blockedTumblelog:this.id})},unblock:function(){return h.unblock({blockedTumblelog:this.id})},toggleSubscription:function(t){var e=this.get("name"),i=!!this.get("is_subscribed"),n=i?"DELETE":"POST",s={url:"/svc/blog/"+e+"/subscription",type:n,withFormKey:!0};return t&&(s.data={source:t}),c.promise(function(t,e){a.ajax(l.assign(s,{success:t,error:e}))}).then(l.bind(function(){this.set({is_subscribed:!i})},this))},defaults:null,idAttribute:"name",initialize:function(){this.bindEvents()},bindEvents:function(){var t=this.get("name");this.on("change:following",function(){if(this.previous("following")){var e=this.get("following")?"tumblelog:follow":"tumblelog:unfollow";u.trigger(e,{name:t,loggingData:t})}this._updateSubscriptionStatus()},this),this.on("change:twitter_send_posts",this._updateUserSocial),this.on("change:facebook_opengraph_send_posts",this._updateUserSocial)},_updateSubscriptionStatus:function(){this.get("following")?this.set("can_subscribe",!0):this.set({can_subscribe:!1,is_subscribed:!1})},_updateUserSocial:function(){var t={tumblelog_name_or_id:this.get("name"),page:"tumblelog","tumblelog[facebook_opengraph_send_posts]":this.get("facebook_opengraph_send_posts")?"on":"off","tumblelog[twitter_send_posts]":this.get("twitter_send_posts")?"on":"off"};a.ajax({data:t,type:"POST",url:"/settings/save",withFormKey:!0})},getDisplayName:function(){return this.get("is_legacy_private_channel")?this.get("directory_safe_title"):this.get("name")},parse:function(t){return t},validate:function(){return!1},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},{collection:null,modelFromToken:function(t){var e,i=_.getCollection(),n=a.Deferred(),s=i.findWhere({token:t});return s?n.resolve(s):(e={data:{is_user_mention:!0}},r(t,e).then(function(e){var i=new _(e);i.set({token:t}),n.resolve(i)},function(){n.reject()})),n.promise()}});_.collection=_.getCollection(),t.exports=_},,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(130),r=i(129),a=i(213),l=i(192),c={_getCurrentTumblelog:function(){var t="",e=r.get("Context/userinfo");return e&&s.each(e.channels,function(e){e.is_current&&(t=e.name)}),t},block:function(t){t=t||{};var e={};return e.tumblelog=t.currentTumblelog||this._getCurrentTumblelog(),t.blockedTumblelog?e.blocked_tumblelog=t.blockedTumblelog:t.blockedPost&&(e.blocked_post=t.blockedPost),t.context&&(e.block_context=t.context),n.ajax({url:"/svc/block/add",type:"POST",data:e,withFormKey:!0})},unblock:function(t){t=t||{};var e={};return e.tumblelog=t.currentTumblelog||this._getCurrentTumblelog(),e.blocked_tumblelog=t.blockedTumblelog,n.ajax({url:"/svc/block/remove",type:"POST",data:e,withFormKey:!0})},confirmBlock:function(t){t=t||{};var e,i=t.currentTumblelog||this._getCurrentTumblelog(),n=l.defer();if(t.blockedTumblelog)e=o("%1$sAre you sure you want to block %2$s from %3$s?%4$sThey won't be able to follow %3$s, send %3$s messages, see %3$s in search results, or interact with any of %3$s's posts.%5$s","<h3>",t.blockedTumblelog,i,"</h3><small>","</small>");else{if(!t.blockedPost)return n.reject(),n.promise;e=o("%1$sBlock messages from this sender?%2$sAny further messages sent from their IP address will be blocked from your inbox. This can't be undone, by the way.%3$s","<h3>","</h3><small>","</small>")}return a.confirm(e,function(){n.resolve(t.blockedTumblelog?t.blockedTumblelog:t.blockedPost)},function(){n.reject()},o("Block"),o("Nevermind")),n.promise.catch(s.noop),n.promise}};t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(218),r=s.extend({name:"Dialog",initialize:function(t){this.dialogView=o,this.options=n.extend({},this.defaults,t)},alert:function(t,e,i){return this.dialogView.alert.call(this.dialogView,t,e,i)},confirm:function(t,e,i,n,s){return this.dialogView.confirm.call(this.dialogView,t,e,i,n,s)},dialog:function(t){return this.dialogView.dialog.call(this.dialogView,t)},isActive:function(t){return this.dialogView.isActive.call(this.dialogView,t)},close:function(t){return this.dialogView.close.call(this.dialogView,t)},getDialogEl:function(){return this.dialogView.getDialogEl.call(this.dialogView)},__:function(t){return this.dialogView.__.call(this.dialogView,t)}});t.exports=new r},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(215),r=i(129),a=(i(132),i(216)),l=i(217),c=["selector","container","rootEl","view","viewOptions","autoAppend"],u=o.extend({name:null,rootEl:null,selector:null,view:null,viewOptions:{},autoAppend:!1,defaults:{},constructor:function(t){t||(t={}),this.cid=n.uniqueId("component"),n.extend(this,n.pick(t,c));var e=n.result(this,"defaults"),i=n.extend({},e,n.pick(t,n.keys(e)));this.attributes={},this.set(i,{silent:!0}),this.changed={},(this.autoAppend||this.selector)&&this.setContainer(),this.selector||(this.selector=this.defaultSelector);var o=n.isFunction(this.viewOptions)?this.viewOptions.call(this.viewOptions,this):this.viewOptions;this.view&&this.view.prototype&&this.view.prototype instanceof s.View?this.view=new this.view(o):n.isFunction(this.view)&&(this.view=this.view.call(this,o)),this.initialize.apply(this,arguments),this.autoAppend&&this.append()},initialize:n.noop,setContainer:function(){return this.selector||(this.selector=this.defaultSelector),this.container=this.selector,this.container},getOwnData:function(){return this.data},remove:function(){n.result(this,"beforeRemove"),this.view&&n.isFunction(this.view.remove)&&this.view.remove();var t=["container","view","defaults","attributes"];return n.each(t,n.bind(function(t){this[t]&&delete this[t]},this)),this.stopListening(),this.trigger("remove"),this},append:function(){return this.view&&n.isFunction(this.view.render)&&(this.container?this.container.appendChild(this.view.render().el):this.view.render()),this.trigger("append"),this}});Object.defineProperties(u.prototype,{defaultSelector:{get:function(){return"[prima-component="+this.name+"]"},set:function(){}},container:{get:function(){return this._container},set:function(t){var e=a(t,this.rootEl);this._container=e}},data:{get:function(){return this._data||(this._data=r.get("Components/"+this.name)),this._data},set:function(t){this._data=t}}}),l.mixin.applyTo(u.prototype),t.exports=u},function(t,e,i){"use strict";function n(){}var s=i(7),o=i(188);n.extend=s.Model.extend,o.applyTo(n),t.exports=n},function(t,e,i){"use strict";function n(t){return t&&t.nodeType&&1===t.nodeType}var s=i(3);t.exports=function(t,e){if(n(t))return t;if(s.isString(t)){var i=(e||document).querySelector(t);if(n(i))return i}return!(!t||!t.jquery)&&t.get(0)}},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(187),r=s.Model.prototype,a={get:r.get,has:r.has,set:r.set,unset:r.unset,clear:r.clear,hasChanged:r.hasChanged,changedAttributes:r.changedAttributes,previous:r.previous,toJSON:r.toJSON,toggle:function(t){this.set(t,!this.get(t))},_validate:n.constant(!0)},l=new o(n.extend({},a,{defaults:n.extend({},s.Events)}));t.exports={props:a,mixin:l}},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(136),a=i(130),l=i(220),c=o.extend({el:".ui_dialog",translations:{},defaultTemplates:{dialog:i(221),content:i(222),button:i(223)},events:{"click .ui_button":"buttonClick"},defaultDialog:{text:"",type:"default",has_form:"auto",visible_glass:!0,confirm_by_enter:!0,close_by_space:!0,key_tab:!0,key_close:!0,scroll_lock:!1,keycommand_maintain:!1,animate:!0,animate_in:{dialog_el:".ui_dialog",dialog_class:"fade-in-up"},on_close:function(){},on_open:function(){}},initialize:function(t){this.options=s.extend(this.defaults,this.options),this.templates=this.defaultTemplates,this.is_visible=!1,this.dialogQueueOrder=[],this.dialogQueue={},this.queueCounter=0,this.currentDialog=!1,this.currentDialogId=0,this.uid=0,this.$body=n("body"),this._initClickLock(),this._setupKeys(),r&&!e.Dialog&&(this.listenTo(r,"dialog:dialog",this.dialog),this.listenTo(r,"dialog:confirm",this.confirm),this.listenTo(r,"dialog:confirm:promise",this.confirmPromise),this.listenTo(r,"dialog:alert",this.alert),this.listenTo(r,"dialog:close",this.close))},dialog:function(t){return!!s.isObject(t)&&this._dialog(t)},confirm:function(t,e,i,n,o){s.isString(t)&&(t={text:t});var r={callback_ok:e,callback_cancel:i,text_ok:n,text_cancel:o};t=s.extend(this.defaultDialog,r,t);var l={text:t.text,customClass:t.customClass||null,type:"confirm",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,animate_in:{dialog_el:t.animate_in.dialog_el||".ui_dialog",dialog_class:t.animate_in.dialog_class||"fade-in-up"},buttons:{0:{text:t.text_cancel||a("Cancel"),close:!0,callback:s.isFunction(t.callback_cancel)?t.callback_cancel:function(){}},1:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:s.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(l)},confirmPromise:function(t,e){this.confirm(e,t.resolve,t.reject)},alert:function(t,e,i){s.isString(t)&&(t={text:t});var n={callback_ok:e,text_ok:i};t=s.extend({},n,t);var o={text:t.text,customClass:t.customClass||null,type:"alert",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:s.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(o)},getDialogEl:function(){return this.el},buttonClick:function(t){var e=n(t.currentTarget),i=e.data("btn-id");if(s.isUndefined(this.currentDialog.buttons[i])||e.hasClass("disabled"))return!1;var o=this.currentDialog.buttons[i],r=null;s.isFunction(o.callback)&&(r=o.callback(this)),r!==!1&&(!s.isUndefined(o.close)&&o.close||s.isUndefined(o.close))&&this.close()},isActive:function(t){return this.currentDialog!==!1&&this.currentDialog.uid===t},close:function(t){if(this.currentDialog===!1)return!1;if(s.isUndefined(t)&&(t=!1),t!==!1&&this.currentDialog.uid!==t)return!1;if(this.$dialog_lock.removeClass("opaque"),this.$dialog_el.addClass("fade-out-down"),l.transition(this.$dialog_lock,s.bind(function(){this.$dialog_lock.hide()},this)),l.animation(this.$dialog_el,s.bind(function(){n(".ui_dialog_pos").remove()},this)),this.is_visible=!1,this.currentDialog.keycommand_maintain||r.trigger("keycommands:resume"),s.isFunction(this.currentDialog.on_close)&&this.currentDialog.on_close(),r.trigger("dialog:closed"),this.currentDialog=!1,n("html").removeClass("dialog_lock"),this.dialogQueueOrder.length>0){var e=this.dialogQueueOrder.shift(),i=this.dialogQueue[e];delete this.dialogQueue[e],this._dialog(i)}},_tab:function(t){var e=this.$el.find(".buttons .tab_frame"),i=e.filter(".focus"),n=e.index(i),s=e.length,o=!1;o=n+1<s?n+1:0,i.removeClass("focus init_focus");var r=e.eq(o);r.length>0&&(r.addClass("focus"),r.find("button").focus())},_formIsTabToButton:function(t,e){var i=this.$el.find(":focus");if(0===i.length)return!0;var n=this.$el.find(".buttons .tab_frame"),s=this.$el.find(":input:visible"),o=s.index(i);if(e&&o===s.length-1)return this.$el.find(":input:visible:first").focus(),t.preventDefault(),n.removeClass("focus init_focus"),!1;if(o>=0){var r=this.$el.find(":input:visible:eq("+(o+1)+")");if(r.length>0&&r.hasClass("ui_button"))return!0}return n.removeClass("focus init_focus"),!1},_select:function(t){var e=this.$el.find(".buttons .tab_frame.focus"),i=e;1===i.length&&i.find(".ui_button").click()},_formIsFocusOnButton:function(t){var e=this.$el.find(":focus");return 0!==e.length&&e.hasClass("ui_button")},_escape:function(t){if(!s.isUndefined(this.currentDialog.escape_button)){var e=this.$el.find(".btn_"+this.currentDialog.escape_button);e.length&&e.click()}},_dialog:function(t){if(s.isUndefined(t.uid)&&(t.uid=this._getUid()),this.currentDialog!==!1)return this.dialogQueueOrder.push(this.queueCounter),this.dialogQueue[this.queueCounter]=t,this.queueCounter++,t.uid;s.defaults(t,this.defaultDialog);var e=this._buildButtons(t.buttons);s.extend(t,{buttons_html:e});var i=this.templates;s.isObject(t.templates)&&(i=s.extend({},this.templates,t.templates));var o=s.isString(i.dialog)?s.template(i.dialog):i.dialog,a=s.isString(i.content)?s.template(i.content):i.content;t.content_html=a(t);var l=o(t);this.$dialog_lock.show(),s.isUndefined(t.visible_glass)?this.$dialog_lock.removeClass("opaque"):t.visible_glass&&s.defer(s.bind(function(){this.$dialog_lock.addClass("opaque")},this)),!s.isUndefined(t.scroll_lock)&&t.scroll_lock&&n("html").addClass("dialog_lock"),this.currentDialogId=t.uid,this.currentDialog=t;var c=n('<div id="dialog_'+this.currentDialogId+'" class="ui_dialog_pos">'+l+"</div>");return s.isString(t.customClass)&&c.addClass(t.customClass),c.appendTo(this.$body),this.setElement(c),this.is_visible=!0,this.$dialog_el=this.$el.find(t.animate_in.dialog_el),t.animate&&s.isObject(t.animate_in)&&this.$dialog_el.length&&this.$dialog_el.addClass(t.animate_in.dialog_class),this._focus(),this.currentDialog.keycommand_maintain||r.trigger("keycommands:suspend"),s.isUndefined(t.has_form)&&(t.has_form="auto"),"auto"===t.has_form&&(t.has_form=this.$el.find("form, input").length>0),s.isFunction(t.on_open)&&t.on_open(),this.el=this.$el[0],this.delegateEvents(),r.trigger("dialog:opened"),t.uid},_button:function(t,e,i,n){var o=s.isString(this.templates.button)?s.template(this.templates.button):this.templates.button,r=o({btn_class:e,text:t,btn_id:s.isUndefined(i)?"":i});return r='<div class="tab_frame">'+r+"</div>"},_focus:function(){if(!this.currentDialog)return!1;for(var t in this.currentDialog.buttons){var e=this.currentDialog.buttons[t];if(!s.isUndefined(e.selected)&&e.selected){var i=this.$el.find(".btn_"+t);i.length>0&&i.parent().addClass("focus init_focus")}}},_setupKeys:function(){n(document).on("keydown",s.bind(function(t){
var e=t.ctrlKey||t.shiftKey||t.metaKey;if(this.is_visible&&!e){var i=t.keyCode||t.which;if(9===i&&this.currentDialog.key_tab){if(this.currentDialog.has_form&&!this._formIsTabToButton(t,!0))return;t.preventDefault(),this._tab(t)}if(13===i&&this.currentDialog.confirm_by_enter||32===i&&this.currentDialog.close_by_space){if(this.currentDialog.has_form&&32===i&&!this._formIsFocusOnButton(t))return;t.preventDefault(),this._select(t)}27===i&&this.currentDialog.key_close&&(t.preventDefault(),this._escape(t))}},this))},_buildButtons:function(t){if(!s.isObject(t))return"";var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;for(var n="",o=0;o<e;o++)if(!s.isUndefined(t[o])){var r=s.isUndefined(t[o].text)?"":t[o].text,a=s.isUndefined(t[o].btn_class)?"":t[o].btn_class,l=!s.isUndefined(t[o].selected)&&t[o].selected;n+=this._button(r,a,o,l)}return n},_initClickLock:function(){var t=this.$dialog_lock=n("<div>",{class:"ui_dialog_lock",css:{display:"none"}});n(document).ready(function(){t.prependTo("body")})},_getUid:function(){return this.uid++},__:function(t){return a(t)}});t.exports=new c},function(t,e,i){"use strict";function n(t,e){e||(e={}),t||(t=[]),s.each(t,function(t){s.isFunction(this[t])&&this[t].call(this,e)},this)}var s=i(3),o=i(7),r=i(188),a=["model","collection","el","id","attributes","className","tagName","events"],l=["_setup"],c=o.View.extend({constructor:function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,a)),this._elAttributes=this.attributes,this.attributes={},this._ensureElement(),this.setupMethods=s.union(l,this.constructor.__super__.setupMethods,this.setupMethods),n.call(this,this.setupMethods,t),this.initialize.apply(this,arguments),this.delegateEvents()},_setup:s.noop,_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var t=s.extend({},s.result(this,"_elAttributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t.class=s.result(this,"className"));var e=o.$("<"+s.result(this,"tagName")+">").attr(t);this.setElement(e,!1)}}});r.applyTo(c),t.exports=c},function(t,e,i){"use strict";function n(){var t,e,i={animation:null,transition:null},n=document.createElement("div"),s={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in s)if(e in n.style){i.animation=s[e];break}var o={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in o)if(t in n.style){i.transition=o[t];break}return i}function s(t,e){a.animation?r(t).one(a.animation,function(t){e(t)}):setTimeout(function(t){e(t)},0)}function o(t,e){a.transition?r(t).one(a.transition,function(t){e(t)}):setTimeout(function(t){e(t)},0)}var r=i(8),a=n();t.exports={animation:s,transition:o}},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ui_dialog '+(null==(__t=type)?"":__t)+'"> '+(null==(__t=content_html)?"":__t)+' <div class="buttons">'+(null==(__t=buttons_html)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="text">'+(null==(__t=text)?"":__t)+"</span>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<button class="ui_button btn_'+(null==(__t=btn_id)?"":__t)+" chrome "+(null==(__t=btn_class)?"":__t)+'" data-btn-id="'+(null==(__t=btn_id)?"":__t)+'"><span>'+(null==(__t=text)?"":__t)+"</span></button>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n,s=i(214),o=i(225),r=s.extend({name:"header",autoAppend:!0,append:function(){this.headerView=new o({el:this.container}),this.enableFunctionality()},enableFunctionality:function(){this.headerView.enableCompose()},disableSticky:function(){this.headerView.disableSticky()}});t.exports=function(){return n||(n=new r),n}},function(t,e,i){"use strict";var n=i(8),s=i(226),o=i(180),r=i(136),a=i(129),l=i(229),c=i(231),u=i(635),h=i(636),d=i(646),p=i(693),_=i(182),g=s.extend({defaults:{headerHeight:52,headerTop:0},events:{"click .tab_discover > a":"onClickExplore",mouseenter:"__mouseenter",mouseleave:"__mouseleave"},initialize:function(){var t=o.bool("is_logged_in");this.logo=new u({el:'[prima-component="header-logo"]',data:a.get("Components/DesktopDashboardLogo")}),t&&(this.accountMenu=new h({el:".tab_nav_account"}),n(".tab_activity").length&&(this.activityMenu=new d({el:".tab_activity"})),this._initializeMessaging()),this.set("headerTop",this.$el.position().top),this.listenTo(r,"Header:hide",this.hide),this.listenTo(r,"Header:show",this.show),this.listenTo(r,"Header:setTransparent",this.setTransparent),this.$window=n(window)},enableCompose:function(){this.composeBtn=new l,this.switcher=new c},disableSticky:function(){this.$el.addClass("l-header-container--unstuck")},setTransparent:function(t){this.$el.toggleClass("l-header-container--transparent",!!t)},hide:function(){var t=this.$window.scrollTop()+this.get("headerTop"),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px"}),this.$el.velocity({translateY:[-e,0],translateZ:"0px"},150).velocity({translateY:"0px",translateZ:"0px",top:0},0)},show:function(){var t=this.$window.scrollTop(),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px",transform:"translateY("+-e+"px) translateZ(0)"}),this.$el.velocity({translateY:[0,-e],translateZ:"0px"},150).css({position:"fixed",top:this.get("headerTop")})},onClickExplore:function(){r.trigger("explore-links:click",{loggingData:{source:"app-header"}})},_initializeMessaging:function(){var t=_(),e=this.$(".tab_messaging"),i=o.bool("is_logged_in")&&e.length>0&&t.canMessage();i?this.messaging=new p({inboxAnchorEl:e,inboxPopoverOptions:{isFixedPosition:"fixed"===this.$el.css("position")}}).render():e.length&&e.hide()},__mouseenter:function(){r.trigger("Header:mouseenter")},__mouseleave:function(){r.trigger("Header:mouseleave")}});t.exports=g},function(t,e,i){"use strict";function n(t,e,i){return s.isFunction(t)&&(t=t(e,i)),t instanceof o?t:e.$(t)}var s=i(3),o=i(8),r=i(7),a=i(192),l=i(227),c=i(228),u=i(217),h=i(219),d=h.extend({rendered:!1,disposed:!1,keepElement:!1,_setup:function(t){t||(t={});var e=s.extend({},s.result(this.constructor.__super__,"defaults"),s.result(this,"defaults"));s.extend(e,s.pick(t,s.keys(e))),this.attributes={},this.set(e),this.changed={};var i=this.render;this.render=s.bind(function(){this._beforeRender.apply(this,arguments),this.beforeRender.apply(this,arguments);var t=i.apply(this,arguments);return this.afterRender.apply(this,arguments),this._afterRender.apply(this,arguments),t},this);var n=this.remove;this.remove=s.bind(function(){if(this.disposed)return this;this._beforeRemove.apply(this,arguments),this.beforeRemove.apply(this,arguments);var t=n.apply(this,arguments);return this.afterRemove.apply(this,arguments),this._afterRemove.apply(this,arguments),t},this),this.subviews=s.extend({},this.subviews,t.subviews)},initialize:s.noop,_registerSubview:function(t){return this._subviews||(this._subviews=[]),this._subviews.push(t),t},appendSubview:function(t,e){return s.isString(e)&&(e=this.$(e)),this._registerSubview(t),t.render(),(e||this.$el).append(t.el),t},removeSubviews:function(){var t=s.flatten(this._subviews);t&&(s.invoke(t,"remove"),delete this._subviews)},renderSubviews:function(){this.subviews&&s.forEach(this.subviews,function(t,e){t instanceof r.View?this.renderSubview(t,{name:e}):t.collection?this.renderCollectionSubviews(e):this.renderSubview(e)},this)},_createDefaultContainerFunction:function(t){return s.bind(function(){return this.$('[data-subview="'+t+'[]"]')},this)},_createDefaultPrepareViewFunction:function(t){var e=this.subviews[t];return s.bind(function(i,n){var s=new e.constructor(n);return s.$el.attr("data-subview",t),i.append(s.$el),s},this)},renderCollectionSubviews:function(t){var e=this.subviews[t];if(e){var i=e.container||this._createDefaultContainerFunction(t),n=e.prepareView||this._createDefaultPrepareViewFunction(t),s=e.options||{},o=this.createCollectionSubviewRenderer(e.collection,i,n,s,t);this.rendered?o():this.once("rendered",o,this)}},renderSubview:function(t,e){var i,n,o,a;if(s.isString(t)){if(a=t,t=this.subviews[a],!t)return;i=t.container||'[data-subview="'+a+'"]',o=t.options||{},n=t.prepareView||function(e,i){if(!s.isEmpty(e)){var n=new t.constructor(i);return n.$el.attr("data-subview",a),e.replaceWith(n.$el),n}}}else t instanceof r.View&&(e||(e={}),a=e.name||"",i=e.container||'[data-subview="'+a+'"]',o=e.options||{},n=e.prepareView||function(e){return t.$el.attr("data-subview",a),e.replaceWith(t.$el),t});var l=this.createSubviewRenderer(i,n,o,a);this.rendered?l():this.once("rendered",l,this)},createSubviewRenderer:function(t,e,i,o){return s.bind(function(){if(this.el){i=i||{},s.isFunction(i)&&(i=i.call(i,this));var r=n(t,this,o);if(!s.isEmpty(r)){var a=e.call(this,r,i);o&&s.set(this,o,a),a.render(),this._registerSubview(a)}}},this)},createCollectionSubviewRenderer:function(t,e,i,o,a,l,c){var u;return s.bind(function(){if(this.el){var h=0;if(a&&(l?h=this[a].length:this[a]=[]),t===!0&&(t=this.collection),s.isFunction(t)&&(t=t(this)),t instanceof r.Collection&&(t=t.models),!s.isEmpty(t)){var d=n(e,this,a);s.isEmpty(d)||(l||(u=d,d=u.clone()),s.forEach(t,function(t,e){var n;n=s.isFunction(o)?o.call(o,this,t)||{}:s.extend({},o),n.model||(n.model=t);var r="";a&&(r=a+"["+(h+e)+"]"),c&&s.extend(n,c),this.createSubviewRenderer(d,i,n,r).call(this)},this),l||u.replaceWith(d))}}},this)},_beforeRender:s.noop,beforeRender:s.noop,render:function(){return!this.disposed&&(this.renderWithTemplate(),this)},afterRender:s.noop,_afterRender:function(){this.renderSubviews(),this.rendered=!0,this.trigger("rendered",this),this._verifySubviewsRendered()},getTemplateData:function(){var t=l(this);return this.model&&(t.model=l(this.model)),this.collection&&(t.collection={items:l(this.collection),length:this.collection.length}),t},renderWithTemplate:function(t){if(s.isUndefined(this.template))throw new Error("Template function needed.");var e;return e=s.isFunction(this.template)?this.template(t||this.getTemplateData()):this.template,this.$el.html(e),this},afterRenderSubviews:s.noop,_verifySubviewsRendered:function(){var t=s.bind(function(){this.afterRenderSubviews(),this.trigger("renderedSubviews")},this),e=s.reject(this._subviews,function(t){return t.rendered===!0||t._rendered===!0});s.isEmpty(e)?t():a.map(e,function(t){return a.promise(s.partial(function(e,i){t.once("rendered",e)},t))}).then(t)},_beforeRemove:function(){this.removeSubviews()},beforeRemove:s.noop,remove:function(){return this.keepElement?(this.undelegateEvents(),this.stopListening()):h.prototype.remove.apply(this,arguments),this},afterRemove:s.noop,_afterRemove:function(){var t=["el","$el","options","model","collection","subviews","_subviews","defaults","attributes"];s.forEach(t,s.bind(function(t){this[t]&&delete this[t]},this)),this.rendered=!1,this.disposed=!0}},{subviewWithOptions:function(t){return c.call(null,this,t)}});u.mixin.applyTo(d.prototype),t.exports=d},function(t,e,i){"use strict";function n(t){return s.isFunction(t.serialize)?t.serialize():s.isFunction(t.toJSON)?t.toJSON():void 0}var s=i(3);t.exports=n},function(t,e,i){"use strict";function n(t,e){return{constructor:t,options:function(t){var i=s.isFunction(e)?e(t):e;return s.extend(s.pick(t,t.viewOptionKeys),i)}}}var s=i(3);t.exports=n},function(t,e,i){"use strict";var n=i(180),s=i(219),o=i(136),r=i(230),a=s.extend({mixins:[r],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),n.bool("dashboard_refresh")?(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close)):(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close))},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(t,e){n.bool("dashboard_refresh")?e?o.trigger("fastCompose:init",{loggingData:this.loggingData}):o.trigger("fastCompose:dismiss",{loggingData:this.loggingData}):e?o.trigger("fastCompose:init"):o.trigger("fastCompose:dismiss")}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(187),r=i(217),a=new o(n.extend({},r.props,{defaults:n.extend({},s.Events),before:{initialize:function(){var t=n.defaults({},n.result(this,"defaults"));this.attributes={},this.set(t),this.changed={}}}}));t.exports=a},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=i(232),l=i(234),c=o.extend({name:"switcher",mixins:[a],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=n("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(r,"keycommands:suspend",this.suspend),this.listenTo(r,"keycommands:resume",this.resume),this.listenTo(r,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(r,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(r,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(t){"MacIntel"===navigator.platform&&this.initFastCompose(t)},winFastCompose:function(t){"Win32"===navigator.platform&&this.initFastCompose(t)},initFastCompose:function(t){this.suspended||this.fastCompose||(this.determineSource(t),this.fastCompose=new l({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),r.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),r.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=n("<div>",{class:"glass show"}).appendTo(this.$body),s.defer(s.bind(function(){this.$glass.addClass("blue")},this)),r.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,r.trigger("drawer:resume")},determineSource:function(t){this.loggingData.source="fast-compose",t&&(t.originalEvent instanceof window.KeyboardEvent?this.loggingData.source="keycommand":t.loggingData&&t.loggingData.source&&(this.loggingData.source=t.loggingData.source))}});t.exports=c},function(t,e,i){"use strict";var n=i(187),s=i(136),o=i(3),r=i(233),a=new n({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),r.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(t,e){this.listenTo(s,"DOMEventor:"+e,this.__keyFn)},__keyFn:function(t,e){!this.__keysDisabled&&r.shouldRun(e,this.__keyId)&&this[this.keycommands[e]].apply(this,arguments)},focusKeys:function(){r.focus(this.__keyId)},unfocusKeys:function(){r.unfocus(this.__keyId)},soloKeys:function(t){r.solo(this.__keyId,t)},unSoloKeys:function(){r.unSolo(this.__keyId)},disableKeys:function(){this.__keysDisabled=!0},enableKeys:function(){this.__keysDisabled=!1},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keysDisabled=!1,this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(t){(o.isEmpty(t)||t===this)&&r.remove(this.__keyId)}}});t.exports=a},function(t,e,i){"use strict";var n=i(215),s=i(3),o=n.extend({soloId:null,constructor:function(){this.keySets=[],this.soloBubblingWhitelist=[]},add:function(t){this.keySets.unshift(t)},remove:function(t){var e=this.getSetForId(t);e&&(this.unSolo(t),this.keySets=s.without(this.keySets,e),this.soloBubblingWhitelist=s.without(this.soloBubblingWhitelist,t))},focus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.unshift(e))},unfocus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.push(e))},solo:function(t,e){var i=this.getSetForId(t);i&&(this.soloId=t,e===!0&&this.soloBubblingWhitelist.push(t))},unSolo:function(t){this.soloId===t&&(this.soloId=null,this.soloBubblingWhitelist=s.without(this.soloBubblingWhitelist,t))},getSetForId:function(t){return this.keySets[s.findIndex(this.keySets,{id:t})]},getSetsWithKey:function(t){return s.where(this.keySets,{keys:[t]})},shouldRun:function(t,e){var i=this.getSetsWithKey(t);return this.soloId===e||!(!s.isEmpty(this.soloBubblingWhitelist)&&!s.contains(this.soloBubblingWhitelist,e))&&(!(i.length>1)||i[0].id===e)}});t.exports=new o},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(235),r=i(129),a=i(130),l=i(192),c=i(219),u=i(136),h=i(180),d=i(232),p=i(230),_=i(236),g=i(634),f=c.extend({template:g,className:"fast-compose",defaults:{tabIndex:-1,icons:[{name:"text",label:"Text"},{name:"photo",label:"Photo"},{name:"quote",label:"Quote"},{name:"link",label:"Link"},{name:"chat",label:"Chat"},{name:"audio",label:"Audio"},{name:"video",label:"Video"}]},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[p,d],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(t){this.loggingData=t?t.loggingData:{},s.forEach(this.get("icons"),function(t){t.label=a(t.label)}),this.$body=n("body"),this.$glass=null,this.$plexiInstance=n('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0},bindEvents:function(){this.listenTo(u,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(u,"DOMEventor:keydown:shift+tab",this.disableKey),this.listenTo(this,"change:tabIndex",function(t,e){this.$(".selected").removeClass("selected"),this.$('[data-index="'+e+'"]').addClass("selected")})},render:function(){return this.$el.append(this.template(this.toJSON())),this.bindEvents(),this},open:function(){s.defer(s.bind(this.show,this))},show:function(){u.trigger("keycommands:suspend");var t=50;s.forEach(this.$(".tab-post-type"),function(e,i){var s=n(e),r=s.find(".post-type-icon"),a=s.find(".post-type-name");o.animate(r,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:i*t}),o.animate(a,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:i*t})},this),n(".post-tab-switching").addClass("finish-animating")},enterCreate:function(t){var e=this.$(".selected");if(e.length){var i=e.attr("data-post-type");this.createNew(i),this.close()}},clickCreate:function(t){this.createNew(n(t.currentTarget).data("postType"))},disableKey:function(t){t.preventDefault()},mouseoverIcon:function(t){this.$(".selected").removeClass("selected"),this.set("tabIndex",n(t.currentTarget).data("index"))},nextIcon:function(t){var e=this.get("tabIndex")+1;e>=this.get("icons").length&&(e=0),this.set("tabIndex",e)},previousIcon:function(t){var e=this.get("tabIndex")-1;e<0&&(e=this.get("icons").length-1),this.set("tabIndex",e)},createNew:function(t){this.resumeKeycommandsOnClose=!1,r.has("Components/PostFormBuilder")?u.trigger("postForms:open",{updateURL:!1,postFormType:_.containerType("modal"),postType:t,fastCompose:!0,loggingData:this.loggingData}):u.trigger("fastCompose:create",{type:t,loggingData:this.loggingData})},close:function(){var t=50,e=this.$(".tab-post-type"),i=Math.floor(.5*(e.length-1));l.all(s.map(e,function(e,s){var r=n(e),a=Math.floor(Math.abs(s-i))*t;return o.animate(r,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:a})},this)).then(function(){u.trigger("fastCompose:close:complete")})},teardown:function(){return this.resumeKeycommandsOnClose&&u.trigger("keycommands:resume"),this.remove()}});t.exports=h.bool("is_logged_in")?f:s.noop},,function(t,e,i){"use strict";var n=(i(237),i(3)),s=i(8),o=i(192),r=i(238),a=i(240),l=i(214),c=i(136),u=i(181),h=(i(132),i(7)),d=(i(241),i(242)),p=i(243),_=i(246),g="/dashboard",f=i(130),m=s("body"),v=i(247),b=i(213),y=i(182),w=i(251),k=i(353),C=i(625),x=i(626),S=i(628),T=i(633),E=l.extend({name:"PostFormBuilder",initialize:function(){var t=this.data;if(this.user=y(),this.user){v(n.bind(function(t){this.PostFormComponent=t},this));var e={baseRoute:null,currentChannel:null,supportImageSearch:!1,minFullWidthSize:300,redirectTo:!1,reblogActionContext:!1,updateURL:!0};n.extend(this,e,n.pick(t,n.keys(e))),this._addGlobalEventListeners(),this.user.set(t.limits),this.user.set(t.dashboardSettings),this.user.set("language",t.language||"en_US"),k.setEmbedRegexes(t.embedRegexes),this.glass=new C,this.modal=new x,this.modalContainer=new S({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new T({el:"#new_post"}),this.postButtonsContainer=new S({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new d,this.saveHook=new p(n.extend({$postButtonsContainer:this.postButtonsContainer.$el},t)),this.legacyEvents(),this._updateData=n.once(this.updateData),this.render()}},updateData:function(){var t=s.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",withFormKey:!0,data:{}});return t.then(n.bind(function(t){var e=t.response;return n.forEach(e.channels,function(t){var e=!!t.name&&this.user.getChannel(t.name);e&&e.set(n.omit(t,"name"))},this),this.user.set(e.limits),e},this))},legacyEvents:function t(){var t={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["post:form:show","keycommands:suspend"]};n.forEach(t,function(t,e){this.listenTo(c,e,function(){var e=n.toArray(arguments);n.each(t,function(t){c.trigger.apply(c,[].concat(t,e))},this)})},this)},_addGlobalEventListeners:function(){this.listenTo(c,"postForms:open",this.fetchAndCreatePostFormComponent),this.listenTo(c,"postForms:new",this._createPostFormNew),this.listenTo(c,"postForms:edit",this._createPostFormEdit),this.listenTo(c,"postForms:reblog",this._createPostFormReblog),this.listenTo(c,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(c,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(c,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(t){this.stopListening(c,"postForms:close"),t&&this._registerDismissListener()},_registerDismissListener:function(){this.listenTo(c,"postForms:close",this.dismissPostForm)},createInlineContainer:function(t){return!!t&&new S({el:t.parent(),originalContent:t,transitionBackground:!0})},fetchAndCreatePostFormComponent:function(t){n.isEmpty(this.PostFormComponent)?v(n.bind(function(e){this.PostFormComponent=e,this._createPostForm(t)},this)):this._createPostForm(t)},_createPostFormNew:function(t){this.fetchAndCreatePostFormComponent(t)},_createPostFormEdit:function(t){t.postEl&&(t.containerView=this.createInlineContainer(t.postEl),t.postFormType=_.inline),this.fetchAndCreatePostFormComponent(t)},_createPostFormReblog:function(t){this.fetchAndCreatePostFormComponent(t)},_createPostForm:function(t){if(this.postForm)return this.destroyPostForm(t).then(n.bind(function(){return this._createPostForm(t)},this));t=n.extend({fastCompose:!1,supportImageSearch:this.supportImageSearch,minFullWidthSize:this.minFullWidthSize,updateURL:this.updateURL,glass:!0,postFormType:_.modal},t),n.defaults(t,{containerView:t.postFormType===_.inline?this.postButtonsContainer:null}),t.post||(t.post=this._createPostModel(t)),t.url||(t.url=this._postFormUrl(t.post)),t.containerView===this.postButtonsContainer&&this.postButtons.setPostType(t.post.get("type")),this._updateData();var e=t.postFormType===_.modal,i=["supportImageSearch","minFullWidthSize","post"];"photo"===t.post.get("type")&&i.push("showPhotoBooth");var a=this.postForm=new this.PostFormComponent(n.extend(n.pick(t,i),{isModal:e,popoverContainer:e?this.modal.$el:m,redirectTo:this.redirectTo,reblogActionContext:this.reblogActionContext,fastCompose:t.fastCompose})),l=this.postFormContainer=t.containerView||this.modalContainer;if(!l)throw new Error("No post form container!");this.listenTo(a,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(a,"resumeScrollHelper",this.resumeScrollHelper),l.isRendered()||l.render(),l.setPostFormComponent(a);var d=n.once(n.bind(function(){return t.glass?this.glass.show():o.resolve()},this)),p=r([function(){return c.trigger("Header:hide"),o.join(l.prepare(d),a.whenRendered(!0))},function(){return a.disable(),l.attach(d)},function(){return t.updateURL&&h.history.navigate(t.url,{replace:!0}),function(){var t=u.rect(),i=t.windowScrollTop,o=t.windowHeight,r=a.getRect(),h=r.offsetHeight,d=l.$el.offset().top,p=d+h,_=20,g=s("[prima-component=header]").height()||0,f=h+2*_<o,m=this.scrollHelper.calculateScrollTop(d-_,p+_+g,o,f),v=400,b=e?this.modal.$el:null;l===this.postButtonsContainer&&i<m&&o>h&&(m=i),this.previousScrollPosition=!e&&i,this.scrollHelper.scrollToPosition(m,v,b),this.listenTo(c,"Photoset:dragScroll",function(t,e){n.isNumber(e)||(e=50);var i=u.rect().windowScrollTop+t;this.scrollHelper.scrollToPosition(i,e,b)}),this.listenTo(c,"Photoset:scrollToRow",function(t,e,i){n.isNumber(i)||(i=50),t+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:t,offsetHeight:e}})})}.call(this),l.showPostForm(d)},function(){return d()},function(){a.enable()}],this).then(n.bind(function(){return c.trigger("postForms:opened"),m.addClass("postforms-open"),a},this),n.bind(function(){this.destroyPostForm()},this));return t.postFormType===_.inline&&p.then(n.bind(function(){this.scrollHelper.start({el:l.$el})},this)),p.catch(function(t){t instanceof Error&&n.defer(function(){throw t})}),p},_postFormStateChanged:function(t){if(this.postForm){var e=this.postForm.initialPostState,i=this.postForm.post;return i.deepHasChanged(e)}return!1},dismissPostForm:function(){this.postForm&&!this.postForm.isEnabled()||(this._postFormStateChanged()?this._buildDismissPrompt():this.destroyPostForm())},_buildDismissPrompt:function(){var t=f("Discard this post?");this.postForm&&this.postForm.post&&"edit"===this.postForm.post.get("mode")&&(t=f("Discard edits to this post?"));var e={text:t,text_ok:f("Discard"),text_cancel:f("Nevermind"),keycommand_maintain:!0};b.confirm(e,n.bind(function(){this.destroyPostForm(),c.trigger("postForms:dismissListener:resume")},this),function(){n.defer(function(){c.trigger("postForms:dismissListener:resume")})}),c.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(t,e){t=n.extend({updateURL:this.updateURL,url:this.baseRoute,glass:!0},t),this.scrollHelper.stop();var i=this.postForm,s=this.postFormContainer,a=!!i.fastCompose;this.postForm=null,this.postFormContainer=null,this.stopListening(i),this.stopListening(c,"Photoset:dragScroll");var l=n.once(n.bind(function(){return t.glass?this.glass.hide():o.resolve()},this)),u=i&&!!i.postForm.get("saved"),d=r([function(){u&&this.saveHook.preExecute(e)},function(){i&&i.disable()},function(){if(function(){if(this.previousScrollPosition!==!1){var t=this.previousScrollPosition,e=400;this.scrollHelper.scrollToPosition(t,e)}}.call(this),s)return s.hidePostForm(l).then(function(){s.teardown()})},function(){if(i&&i.remove(),t.updateURL){var e=h.history.root||"",n=t.url?t.url.replace(new RegExp("^"+e),""):"";h.history.navigate(n,{replace:!0})}},function(){return l()},function(){u&&e&&(this.saveHook.$inlinePostEl=s.$el,this.saveHook.execute(e,{fastCompose:a}))}],this).then(function(){return c.trigger("postForms:closed"),c.trigger("Header:show"),m.removeClass("postforms-open"),i});return d.catch(function(t){t instanceof Error&&n.defer(function(){throw t})}),d},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(t){"string"==typeof t&&(t={postType:t});var e=n.extend({tumblelog:t.channelId||this.currentChannel||this.user.getChannel().get("name"),editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute}},n.pick(t,"tags","sourceUrl","loggingData"));return t.reblogId?n.defaults(e,{lookupData:{reblog_id:t.reblogId,reblog_key:t.reblogKey,carousel_index:t.carousel_index},mode:"reblog",pt:t.pt,reblogSource:t.reblogSource}):t.editId?n.defaults(e,{lookupData:{post_id:t.editId,channel_id:t.channelId||this.redirectChannel},mode:"edit"}):n.defaults(e,{type:t.postType||t.type||"text",mode:"new"}),new w(e)},_postFormUrl:function(t){if(t){if(t.has("lookupData")){var e=t.get("lookupData");return e.reblog_id?this._reblogPostUrl(e.reblog_id,e.reblog_key):e.post_id?this._editPostUrl(e.post_id):this._newPostUrl(t.get("type"))}return t.has("reblog_id")?this._reblogPostUrl(t.get("reblog_id"),t.get("reblog_key")):t.has("id")?this._editPostUrl(t.get("id")):this._newPostUrl(t.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(t){var e=this.baseRoute!==g?this.baseRoute:"";return e+"/new/"+t},_editPostUrl:function(t){return"/edit/"+t},_reblogPostUrl:function(t,e){return"/reblog/"+t+"/"+e},render:function(){return this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this},updateBaseRoute:function(t){var e;t?this.baseRoute=t:(e=h&&h.history?h.history.location.pathname:g,this.baseRoute=e)}},{containerType:function(t){return _[t]}});a.applyTo(E.prototype),t.exports=E},function(t,e,i){"use strict";function n(t,e){e=e||"Exposer";var i=window;s.each(t,function(t,n){if(s.has(i,n))throw new Error('"'+n+'" already exists');o.log(e,"%s.%s",i,n),s.set(i,n,t)})}var s=i(3),o=i(132);t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(239),o=function(t,e){t=n.map(t,function(t){return n.bind(t,this)},e||this);var i=Array.prototype.slice.call(arguments,1);return i[0]=t,s.apply(null,i)};t.exports=o},function(t,e,i){var n;/** @license MIT License (c) copyright 2011-2013 original author or authors */
!function(s){n=function(t){var e=i(192),n=e.Promise.all,s=Array.prototype.slice;return function(t){function i(t){return o.push(t),o}var o=[];return n(s.call(arguments,1)).then(function(n){return e.reduce(t,function(t,s){return e(s.apply(void 0,n),i)},o)})}}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))}(i(196))},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(187),r=new o({defaults:{whenEvent:function(t,e){return 1===arguments.length&&(e=t,t=this),s.promise(n.bind(function(i,n){this.listenToOnce(t,e,function(){i.call(null,arguments)})},this))}}});t.exports=r},function(t,e){"use strict";var i=1,n=function(t){return t*i};n.get=function(){return i},n.set=function(t){i=t},t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(235).animate,r=i(241),a=i(215),l=i(7),c=i(181),u=i(136),h=i(132),d=s("html"),p=a.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(t){return this._running&&this.stop(),this._running=!0,t&&!n.isPlainObject(t)&&(t={el:t}),this.options=t=n.extend({},this.defaults,t),this.$el=s(t.el),this.updateContentRect(),this.listenTo(u,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this._ignoreScroll=!0,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:function(){this._running&&(this._ignoreScroll=!0)},resume:function(){this._running&&this._ignoreScroll&&(this._ignoreScroll=!1,this.checkScrollBounds())},updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var t=this.$el.offset();return this.contentRect.offsetTop=t.top,this.contentRect.offsetLeft=t.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=n.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(t,e,i,n){return n?t:e-i},checkScrollBounds:function(t,e){if(!this._ignoreScroll){e=e?n.extend({},this.defaults,this.options,e):this.options,t||(t=c.rect());var i,s,o=e.contentRect||this.updateContentRect(),r=e.triggerPadding||0,a=e.contentPadding||0,l=o.offsetHeight,u=o.offsetTop,h=u+l,d=t.windowHeight,p=Math.max(0,t.windowScrollTop),_=p+d;return e.keepInside?(i=p-u,s=h-_):(i=p-h,s=u-_),s>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,l+2*a>d),this.enforceScrollBounds(e),!0):i>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,e.bottom||l+2*a<d),this.enforceScrollBounds(e),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(t){var e=null!=t.scrollTop?t.scrollTop:this._scrollTop,i=t.scrollSpeedMs,s=t.debounceMs,o=t.container;s?this._enforceTimeout||(this._enforceTimeout=n.delay(n.bind(function(){null==t.scrollTop&&(e=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(e,i,o)},this),s)):this.scrollToPosition(e,i,o)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(t,e,i){return this._ignoreScroll||"undefined"==typeof t||null===t?void h.logSaw("PostFormBuilder","scrollToPosition -- returning early",this._ignoreScroll,t):(this._ignoreScroll=!0,o(d,"stop"),void o(d,"scroll",{offset:t,container:i,duration:r(e||this.defaults.scrollSpeedMs)}).then(n.bind(function(){this._ignoreScroll=!1},this)))}});n.extend(p.prototype,l.Events),t.exports=p},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(244),r=i(136),a=i(245),l=i(182),c=function(){var t=".post_container",e=".post:not([data-is-pinned])",i=["dashboard","drafts","inbox"],c={preExecute:function(){if("queue"===this.contextData.contextPage)return s(window).off("beforeunload"),void window.location.replace(this.contextData.baseRoute)},execute:function(t,e){if(e=n.merge({fastCompose:!1},e||{}),this.saveResponse=t.responseJSON,i.indexOf(this.contextData.contextPage)!==-1){var r=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,a="post_dashboard_html"in this.saveResponse,c=!(!this.saveResponse.post||!this.saveResponse.post.is_edit)&&this.contextData.contextPage!==this.saveResponse.post_context_page&&this.$inlinePostEl.hasClass("post_container");if(r?this._fetchMorePosts():a&&(c?this._removeInline():this._updateInline()),this._displayNotification(this.saveResponse,e),this.saveResponse.context_tumblelog){var u=this.saveResponse.context_tumblelog.name_or_id,h=s('#dashboard_controls_open_blog[data-blog-name="'+u+'"]');n.forEach(this.saveResponse.context_tumblelog,function(t,e){if(e.match(/_count$/i)){var i=h.find('[data-blog-controls-count="'+e+'"]');i.toggleClass("count_0",t<="0"),i.find(".count").text(o(t).format("0,0"))}},this);var d=l().getChannel(u),p=n.pick(this.saveResponse.context_tumblelog,d.keys());d.set(p)}}},_fetchMorePosts:function(){var t=this.contextData.baseRoute.replace(/^\/|\/$/g,""),e="drafts"===this.contextData.contextPage?"after":"before",i=this._findLatestPostId(),s=new a;s.fetch({pageRoot:t,direction:e,refPostID:i,success:n.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(i){var n=s(i.get("dashboardHTML")),o=this.contextData.$postButtonsContainer.nextAll(t).has(e).first();0===o.length?this.contextData.$postButtonsContainer.parent().append(n):n.insertBefore(o),s(".no_posts_found").remove(),r.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_findLatestPostId:function(){var i=this.contextData.$postButtonsContainer.nextAll(t).find(e).first().data("post-id");return i},_updateInline:function(){var t=s(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(t.eq(0)),r.trigger("posts:load")},_removeInline:function(){var t=this.contextData.baseRoute.split("/");t.splice(-1,1);var e=this.$inlinePostEl;if(e.fadeOut(200,function(){e.remove()}),s("#posts .post").not(".new_post").length<=1)return void(window.location=t.join("/"))},_displayNotification:function(t,e){var i=this.contextData.baseRoute.split("/"),s=i[1]||"",o=t.message,a=n.parseInt(this.contextData.notificationDelay),l={type:"dashboard"===t.post_context_page?"dashReblog":t.post_context_page,url:t.post_tumblelog.post_url,tumblelog:{name:t.post_tumblelog.name_or_id,url:t.post_tumblelog.url,avatar:t.post_tumblelog.avatar}};(!t.created_post||t.post.is_reblog||e&&e.fastCompose||"tagged"===s.toLowerCase())&&n.delay(function(){r.trigger("postForms:saveHook:toast",o,l)},a)}},u=function(t){this.contextData=n.defaults(t||{},{notificationDelay:250}),n.extend(this,c)};return u}();t.exports=c},,function(t,e,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(185),r=o.extend({endpoint:"/svc/post/%s/%s/%s",parse:function(t){return{dashboardHTML:t.trim()}},sync:function(t,e,i){if("read"!==t)throw new Error("The DashboardPostFetch model may only READ from server!");if(i=n.defaults(i||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(i.pageRoot&&i.direction))throw new Error(s("These two fetch params must be passed: pageRoot [%s], direction [%s]",i.pageRoot,i.direction));return n.defaults(i,{dataType:"html",emulateHTTP:!0,url:s(this.endpoint,i.pageRoot,i.direction,i.refPostID)}),o.prototype.sync.call(this,t,e,i)}});t.exports=r},function(t,e){"use strict";var i={modal:1,inline:2};t.exports=i},function(t,e,i){"use strict";var n=i(248),s=function(t){i.e(1,function(e){try{t(i(249))}catch(t){n(t,"post-form")}})};t.exports=s},function(t,e,i){"use strict";var n=i(130),s=i(213),o=function(t,e,i){var o=n("Sorry, we seem to be having technical trouble. Please try again later.");throw"function"==typeof i?i(t):s.alert("string"==typeof i?i:o),new Error("require.ensure error: "+e+": "+t)};t.exports=o},,function(t,e,i){"use strict";var n=i(3),s=[16,24,30,40,48,64,96,128,512],o=n.last(s),r=128,a=function(t){return t>=o?o:n.find(s,function(e){return e>=t})},l=function(t,e){var i=function(e){return e=null==e?r:a(e),(t||"").replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+e+"$3")};return i.toString=function(){return this()},null!=e?i(e):i};t.exports=l},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(3),o=i(185),r=i(237),a=i(252),l=i(253),c=i(255),u=i(263),h=i(264),d=i(267),p=i(268),_=i(269),g=i(271),f=i(272),m=i(254),v=i(265),b=i(266),y=o.extend({mixins:[a],typeDelegateMap:{text:l,photo:c,quote:u,link:h,chat:d,audio:p,video:_,note:g},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2",private:"private",unapproved:"0 3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{published:"published",0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled",private:"private"},defaults:{carouselDisplay:!1,postDate:String(),customUrl:String(),sourceUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new",contentStats:{},loading:!1,hasLoadingInlineImages:!1,members_only:!1,owner_flagged_nsfw:!1,canBeLiked:!0,canBeReblogged:!0,enableCTA:!1,ctaTextCode:"0",enableRedirectUrls:!1,redirectUrlPrimary:String(),redirectUrlIOS:String(),redirectUrlAndroid:String()},shortUrlLength:29,typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],allowAnswerFields:[],_syntheticAttributes:{pseudoState:function(){var t=this.get("state"),e=this.get("publish_on");return"published"===t&&1===parseInt(this.get("is_private"),10)&&(t="private"),"queued"===t?s.isEmpty(e)?"queued":"scheduled":t},formattedSourceUrl:function(){var t,e=this.get("sourceUrl");return s.isEmpty(e)?"":(t=v.addProtocolIfMissing(e,"https:"),b.isUrl(t)?t:e)},formattedRedirectUrlPrimary:function(){var t,e=this.get("redirectUrlPrimary");return s.isEmpty(e)?"":(t=v.addProtocolIfMissing(e,"https:"),b.isUrl(t)?t:e)}},initialize:function(t,e){s.has(t,"tags")||this.set("tags",[]),this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var t=this.get("type"),e=s.bind(function(t){return t in this.typeDelegateMap&&this.typeDelegateMap[t].prototype},this);t?(this.delegateObject(e(t)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(t,i){this.delegateObject(e(i)),this.afterDelegate()})},afterDelegate:function(){s.defaults(this.attributes,this.typeAttributes)},_normalizeType:function(t,e){var i={regular:"text",conversation:"chat"};return e===!1&&(i=s.invert(i)),t in i?i[t]:t},get:function(t){return(this._syntheticAttributes[t]||o.prototype.get).apply(this,arguments)},getHtmlStripped:function(t,e,i){return"undefined"!=typeof e||(e=!0),"undefined"!=typeof i||(i=" "),s.trim(m.stripHtml(this.get(t)||"",e,i))},fetch:function(t){var e={data:t};return o.prototype.fetch.call(this,e)},parse:function(t,e){if(e.parse===!1)return this.attributes;var i=t.post,n=e.data,o={},r=i.id?"edit":"reblog";o.type=this._normalizeType(i.type,!0),o.can_reblog_as=s.map(i.can_reblog_as,s.bind(function(t){return this._normalizeType(t,!0)},this)),this.set("type",o.type),s.forEach(this.genericFieldMap,function(t,e){o[t]=i[e]});var a=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return s.extend(o,s.omit(i,a),{createdPost:!!t.created_post,postTumblelog:t.post_tumblelog||{},postContextPage:t.post_context_page}),"edit"===r?(o["post-id"]=i.id,o.tags=i.tags?i.tags.split(","):[],o.tumblelog=o.postTumblelog.name_or_id||!1):"reblog"===r&&s.extend(o,s.pick(n,["reblog_id","reblog_key"])),"state"in i&&(o.state=this._extractState(i)),i.from_app&&1===s.parseInt(i.format)||(o.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[s.parseInt(i.format||0)]),o.editorType||(o.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),s.has(i,"custom_tweet")&&(o.customTweet=i.custom_tweet),s.extend(o,{sourceUrl:o.source_url||"",carouselDisplay:o.carousel_display||!1,htmlEdited:"rich"!==o.format&&!(this.editorField&&!i[this.editorField]),postDate:o.date||"",customUrl:o.slug||"",canBeLiked:o.can_be_liked,canBeReblogged:o.can_be_reblogged},s.mapValues(s.pick(o,["html_mode","members_only","carousel_display","owner_flagged_nsfw"]),f)),s.has(i,"ads_cta_text_code")&&null!==i.ads_cta_text_code&&(o.enableCTA=!0,o.ctaTextCode=i.ads_cta_text_code||"0"),s.has(i,"redirect_url_primary")&&null!==i.redirect_url_primary&&(o.enableRedirectUrls=!0,o.redirectUrlPrimary=i.redirect_url_primary||"",o.redirectUrlIOS=i.redirect_url_ios||"",o.redirectUrlAndroid=i.redirect_url_android||""),"edit"!==r||"queued"!==o.state||s.isEmpty(i.publish_on)||(o.state="scheduled",o.publish_on=i.publish_on),this.parseForType(o,i)},parseForType:function(t,e){return t},sync:function(t,e,i){var n={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return s.defaults(i||(i={}),{emulateHTTP:!0,forServer:!0,url:n[t]}),i.parse="read"===t,o.prototype.sync.call(this,t,e,i)},toJSON:function(t){return t=s.defaults(t||{},{forServer:!1}),t.forServer?this.serializeForServer(t):o.prototype.toJSON.call(this,t)},serializeForServer:function(){var t=this,e=t.attributes,i={channel_id:e.tumblelog,post_id:e["post-id"],"post[date]":e.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":e.publish_on,"post[slug]":e.customUrl,"post[tags]":e.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:e.editorType,send_to_twitter:e.send_to_twitter,custom_tweet:e.customTweet,send_to_fbog:e.send_to_fbog,loggingData:e.loggingData,carousel_display:e.carouselDisplay,members_only:e.members_only,owner_flagged_nsfw:e.owner_flagged_nsfw,content_stats:e.contentStats,carousel_index:e.carousel_index,can_be_liked:e.canBeLiked,can_be_reblogged:e.canBeReblogged,enable_cta:e.enableCTA,cta_text_code:e.ctaTextCode,enable_redirect_urls:e.enableRedirectUrls,redirect_url_primary:t.get("formattedRedirectUrlPrimary"),redirect_url_ios:e.redirectUrlIOS,redirect_url_android:e.redirectUrlAndroid};"edit"===e.mode&&(i.edit_post_id=e["post-id"]),i["post[source_url]"]=t.get("formattedSourceUrl"),i["post[state]"]=t._VALID_STATES[e.state],i["post[type]"]=this._normalizeType(e.type,!1);var n={reblog:e.is_reblog,reblog_key:e.reblog_key,reblog_post_id:e.reblog_id,pt:e.pt,remove_reblog_tree:e.remove_reblog_tree,reblog_source:e.reblogSource};s.extend(i,s.pick(n,function(t){return!s.isUndefined(t)})),this.getAttributeFromGeneric("thumbnail")&&(i.thumbnail_pre_upload="1");var o=this.getContextPage();return s.extend(i,{context_id:e.tumblelog,context_page:o,"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(i["is_rich_text["+this.editorField+"]"]="1"),e.reblogActionContext&&(i.reblog_source=e.reblogActionContext),e.shareData&&s.isObject(e.shareData)&&(e.shareData.canonicalUrl=i["post[source_url]"],i.share_data=e.shareData),i},validate:function(t,e){var i="errors"in e?e.errors:[];if(t.state&&(s.has(this._VALID_STATES,t.state)||i.push('Invalid "state" value')),t.hasLoadingInlineImages&&i.push("There are still pending images."),s.each(this.defaults,function(e,s){("undefined"==typeof e?"undefined":n(e))!==n(t[s])&&i.push('Invalid "'+s+'" type. Expected '+("undefined"==typeof e?"undefined":n(e))+", got "+n(t[s])+".")}),i.length)return i},_extractState:function(t){var e=this._STATE_CODE_TO_TEXT[t.state];return 1===parseInt(t.is_private,10)&&(e="private"),e},findBlogChannelByName:function(t){if(this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection)return this.attributes.tumblelog.collection.findWhere({name_or_id:t})},getPreservedData:function(){return this.resetPreserveFields.some(s.bind(function(t){return this.get(t)&&this.get(t).length>0},this))},softReset:function(){s.forEach(this.resetAttributes,function(t){s.has(this.typeAttributes,t)?this.set(t,this.typeAttributes[t]):s.has(this.defaults,t)?this.set(t,this.defaults[t]):this.unset(t)},this)},getLookupData:function(){if("reblog"===this.get("mode"))return{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}},getContextPage:function(){var t=this.attributes,e="dashboard";return t.contextData&&"baseRoute"in t.contextData&&(e=t.contextData.baseRoute.split("/").pop()),e},getAttributeFromGeneric:function(t){return this.get(this.genericFieldMap[t])},getTweetText:function(){var t=this.get("customTweet");return s.isString(t)||(t=this.generateTweetText(140-this.shortUrlLength-1),t?t+=" [URL]":t="[URL]"),t},getTweetTextLength:function(t){s.isString(t)||(t=this.getTweetText()),t=s.trim(t).replace(/([^\s])\[URL\]/gi,"$1 [URL]").replace(/\[URL\]([^\s])/gi,"[URL] $1");var e=t.length;return e+=(this.shortUrlLength-5)*(t.match(/\[URL\]/gi)||"").length},generateTweetText:function(t){return""},canEditMedia:function(){return!this.get("is_reblog")},isReblog:function(){return!!this.get("is_reblog")},allowsTypeSwitch:function(t){return!1},canPreview:function(){return this.isValid()},deepHasChanged:function(t){var e=this.toJSON(),i=this.get("mode"),n=s.keys(t),o=s.keys(e);if(s.isEqual(t,e))return!1;if("new"!==i)return!0;var r=s.difference(o,n),a=s.reduce(r,function(t,i){var n=e[i],o=s.isUndefined(n)||s.isNull(n)?0:n.length;return t+o},0);return a>0||(t=s.omit(t,r),e=s.omit(e,r),!s.isEqual(t,e))}});r({"Tumblr.Prima.PostForms.Post":y}),t.exports=y},function(t,e,i){"use strict";var n=i(3),s=i(187),o=new s({delegateObject:function(t){var e={},i={};t&&(n.each(t,function(t,n){"undefined"!=typeof t&&("function"==typeof t?e[n]=t:i[n]=t)},this),s.onto(this,e),n.extend(this,i))}});t.exports=o},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"title",two:"body"},n.prototype.editorField="two",n.prototype.typeAttributes={title:"",body:""},n.prototype.allowAnswerFields=["title","body"],n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("body");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var s;return s=i&&n?o("%s - %s",i,n):i||n||"",r(s,e)},n.prototype.validate=function(t,e,i){var n=[],o=!s.isUndefined(e.reblog_tree)&&e.reblog_tree!==!1&&""!==e.reblog_tree;return(!e.body||e.body.length<1)&&(!e.title||e.title.length<1)&&(o||n.push("Post body empty.")),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";var n=i(3),s={normalizeSpace:function(t){return t.trim().replace(" "," ").replace(/\s\s+/," ")},stripScripts:function(t){return t.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>","img"),"")},stripTags:function(t){return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},truncateLongStrings:function(t,e,i){return n.isString(t)||(t=""),i||(i="…"),t.length<=e?t:n.trunc(t,e-i.length,i)},stripHtml:function(t,e,i){if(!t)return"";"undefined"==typeof e&&(e=!0);var s=t;"string"==typeof i&&(s=n.trim(s.replace(/(<br\s*\/?>)/gi,"$1"+i).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi,"$1"+i)));try{var o=document.implementation.createHTMLDocument("");o.body.innerHTML=this.stripScripts(s),s=o.body.textContent||o.body.innerText||"",s=s.trim()}catch(t){s=this.stripScripts(this.stripTags(s)).trim()}return e&&(s=this.normalizeSpace(s)),s}};t.exports=s},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(256),r=i(254).truncateLongStrings;n.prototype.genericFieldMap={two:"caption",three:"linkthrough"},n.prototype.editorField="two",n.prototype.typeAttributes={caption:"",layout:"",linkthrough:"",photos:[]},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,e)},n.prototype.MAX_IMAGES=10,n.prototype.resetPreserveFields=["caption","tags"],n.prototype.afterDelegate=function(t){t.apply(this,s.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(t,e){this.photos.reset(e,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this,this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},n.prototype.parseForType=function(t,e,i){return e.layout=i.photoset_layout,delete e.photoset_layout,e},n.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return s.forEach(this.photos.toJSON(),function(t){i["images["+t.id+"]"]=t.uploadUrl,i["caption["+t.id+"]"]=(t.caption||"").substr(0,200),i["photo_redirect_url_primary["+t.id+"]"]=t.primaryUrl||"",i["photo_redirect_url_ios["+t.id+"]"]=t.iosUrl||"",i["photo_redirect_url_android["+t.id+"]"]=t.androidUrl||"",t.photoRaw&&(i.photo_raw=t.photoRaw,i.is_selfie_gif=t.isSelfieGif,i.is_selfie=t.isSelfie)}),i["post[carousel_display]"]=e.get("carouselDisplay"),i["post[redirect_url_primary]"]=e.get("redirectUrlPrimary"),i["post[photoset_layout]"]=e.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},n.prototype.canAddPhotos=function(t){return this.photos.length<this.MAX_IMAGES},n.prototype.validate=function(t,e,i){var n=[];0===this.photos.length&&n.push("No photos specified.");var s=this.photos.all(function(t){return t.getUploadUrl()||!t.has("upload")});return s||n.push("Uploads in progress."),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(257),r=s.extend({model:o,add:function(t,e){return t&&!n.isArray(t)&&(t=[t]),n.forEach(t,function(t,e){t.id||(n.isFunction(t.set)?t.set("id",this.generateId(e)):t.id=this.generateId(e))},this),s.prototype.add.apply(this,arguments)},generateId:function(t){var e=1+(t||0),i=n.map(n.range(this.length+1),function(t){return"o"+(e+t)});return n.find(i,function(t){return!this.get(t)},this)},setIdOrder:function(t,e){e||(e={}),this.models=n.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(258),r=i(185),a=i(259),l=i(260),c=i(262),u=1080,h=r.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:"",livephotoUrl:"",livephotoStillImageTime:"",primaryUrl:"",iosUrl:"",androidUrl:""},initialize:function(){this.on("change:externalUrl",function(t,e){e&&this.readUrl(e),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(t,e){e&&this.readFile(e),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(t,e){e||(e="photo:readUrl"),a.load(t).then(n.bind(function(t){this.set({url:t.src,width:t.width,height:t.height}),this.trigger(e,!0,this)},this),n.bind(function(i){this.set({url:t,width:null,height:null}),this.trigger(e,!1,this)},this))},readFile:function(t){return l.canReadFiles()?void l.read(t).then(n.bind(function(t){if(!t.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(t.objectUrl||t.base64,"photo:readFile");var e=s("<img/>");e.attr("src",t.objectUrl||t.base64),a.load(t.objectUrl||t.base64).then(n.bind(function(i){var n=c.drawScaledAndRotated(e,i.width,i.height,t.rotation,t.mirrored,u);return this.readUrl(n.toDataURL(t.file.type),"photo:readFile")},this))},this),n.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):this.get("base64")?this.get("base64"):this.get("url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},parse:function(t){return o(t,0)},toJSON:function(){var t=r.prototype.toJSON.apply(this,arguments);return t.displayUrl=this.getDisplayUrl(),t.uploadUrl=this.getUploadUrl(),t}});t.exports=h},function(t,e,i){"use strict";var n=i(3),s=function t(e,i){return null==i?i=5:n.isNumber(i)||(i=0),n.transform(e,function(e,s,o){i&&n.isObject(s)&&(s=t(s,i-1)),e[n.camelCase(o)]=s})};t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(215),r=o.extend({constructor:function(t){null!=t&&this.load(t)},load:function(t,e){if(this.src=t,!t)return s.reject("No URL to load");var i=this,o=s.promise(function(s,o){var r=new Image;r.src=t,i._img=r;var a;if(r.onload=function(){s(r),r.onload=null,r.error=null,clearInterval(a)},r.onerror=function(){o(r),r.onload=null,r.error=null,clearInterval(a)},r.complete)r.naturalWidth||r.naturalHeight?"function"==typeof r.onload&&r.onload():"function"==typeof r.onerror&&r.onerror();else if(e){var l=function(){return!(!r.naturalWidth&&!r.naturalHeight)&&("function"==typeof r.onload&&r.onload(),!0)};l()||(n.isNumber(e)||(e=100),a=setInterval(l,e))}});return this.promise=o=o.then(n.bind(this._onLoad,this),n.bind(this._onError,this)),o},_onLoad:function(t){return this._img===t?(this.width=t.naturalWidth,this.height=t.naturalHeight,this.src=t.src,this.loaded=!0,s.resolve({width:this.width,height:this.height,src:this.src})):this.promise},_onError:function(t){return this._img===t?(this.width=null,this.height=null,this.src=t.src,this.loaded=!1,s.reject(this.src+" failed to load")):this.promise}},{load:function(t,e){var i=new r(t,e);return i.promise}});t.exports=r},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(3),r=i(192),a=i(261),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,c=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,u=[],h=function(){function t(e){n(this,t),null!=e&&this.read(e)}return s(t,[{key:"read",value:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.file=t,!t)return r.reject("No file to read");if(!l)return r.reject("FileReader is not supported");t.type.match(/image\/(jpg|jpeg)/i)||(i=!1);var n=void 0;return n=i&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(t).then(function(i){try{var n=new a.JpegFile(i.binary,t.name);i.rotation=function(t){switch(t){case 1:return 0;case 2:return 0;case 3:return 180;case 4:return 180;case 5:return 270;case 6:return 90;case 7:return 90;case 8:return 270;default:return 0}}(n.tiff.Orientation.value),i.mirrored=function(t){switch(t){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(n.tiff.Orientation.value)}catch(t){}return e.readDataUrl(t).then(function(t){return o.extend(i,t)})}):this.readDataUrl(t),this.promise=n,n}},{key:"readDataUrl",value:function(t){var e=new FileReader;return"readAsDataURL"in e?r.promise(function(i,n){e.onload=function(t){var n=t.target.result;i(n),e.onload=null,e.onerror=null},e.onerror=function(){n(),e.onload=null,e.onerror=null},e.readAsDataURL(t)}).then(o.bind(this._onLoadDataUrl,this),o.bind(this._onError,this)):r.reject("FileReader.readAsDataURL is not supported")}},{key:"_onLoadDataUrl",value:function(t){var e={base64:t,file:this.file};return c&&(e.objectUrl=c(this.file),u.push(e.objectUrl)),r.resolve(e)}},{key:"readBinaryString",value:function(t){var e=new FileReader;return"readAsBinaryString"in e?r.promise(function(i,n){e.onload=function(t){var n=t.target.result;i(n),e.onload=null,e.onerror=null},e.onerror=function(){n(),e.onload=null,e.onerror=null},e.readAsBinaryString(t)}).then(o.bind(this._onLoadBinaryString,this),o.bind(this._onError,this)):r.reject("FileReader.readAsBinaryString is not supported")}},{key:"_onLoadBinaryString",value:function(t){return r.resolve({binary:t,file:this.file})}},{key:"_onError",value:function(t){return r.reject("Failed to read file")}}],[{key:"read",value:function(e,i){var n=new t(e,i);return n.promise}},{key:"canReadFiles",value:function(){return l}}]),t}();t.exports=h},function(t,e,i){"use strict";var n=function(){},s=t.exports={};s.stringIsClean=function(t){for(var e=0;e<t.length;e++)if(t.charCodeAt(e)<32)return!1;return!0},s.parseNum=function(t,e,i,n){var s,o,r=">"===t;for(void 0===i&&(i=0),void 0===n&&(n=e.length-i),s=r?i:i+n-1;r?s<i+n:s>=i;r?s++:s--)o<<=8,o+=e.charCodeAt(s);return o},s.parseSnum=function(t,e,i,n){var s,o,r,a=">"===t;for(void 0===i&&(i=0),void 0===n&&(n=e.length-i),s=a?i:i+n-1;a?s<i+n:s>=i;a?s++:s--)void 0===r&&(r=128===(128&e.charCodeAt(s))),o<<=8,o+=r?255&~e.charCodeAt(s):e.charCodeAt(s);return r&&(o+=1,o*=-1),o},s.Rational=function(t,e){return this.num=t,this.den=e||1,this},s.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},s.Rational.prototype.asFloat=function(){return this.num/this.den},s.MetaGroup=function(t,e){return this.fieldName=t,this.description=e,this.metaProps={},this},s.MetaGroup.prototype._addProperty=function(t,e,i){var n=new s.MetaProp(t,e,i);this[n.fieldName]=n,this.metaProps[n.fieldName]=n},s.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},s.MetaProp=function(t,e,i){return this.fieldName=t,this.description=e,this.value=i,this},s.MetaProp.prototype.toString=function(){return""+this.value},s.JpegFile=function(t,e){var i=this._SOS;this.metaGroups={},this._binary_data=t,this.filename=e;var n,o,r,a,l,c,u,h=0,d=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(h+=2;h<this._binary_data.length&&(n=this._binary_data.charCodeAt(h++),o=this._binary_data.charCodeAt(h++),d=h,n==this._DELIM)&&o!==i;){for(l=s.parseNum(">",this._binary_data,h,2),h+=l;h<this._binary_data.length;)if(n=this._binary_data.charCodeAt(h++),n==this._DELIM&&(r=this._binary_data.charCodeAt(h++),0!==r)){h-=2;break}a=h-d,this._markers[o]?(c=this._markers[o][0],u=this._markers[o][1]):(c="UNKN",u=void 0),u&&this[u](o,d+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},s.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},s.JpegFile.prototype._SOI_MARKER="ÿØ",s.JpegFile.prototype._DELIM=255,s.JpegFile.prototype._EOI=217,s.JpegFile.prototype._SOS=218,s.JpegFile.prototype._sofHandler=function(t,e){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",s.parseNum(">",this._binary_data,e,1)),this.general._addProperty("pixelHeight","Pixel Height",s.parseNum(">",this._binary_data,e+1,2)),this.general._addProperty("pixelWidth","Pixel Width",s.parseNum(">",this._binary_data,e+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},s.JpegFile.prototype._JFIF_IDENT="JFIF\0",s.JpegFile.prototype._JFXX_IDENT="JFXX\0",s.JpegFile.prototype._EXIF_IDENT="Exif\0",s.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},s.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{
2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},s.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},s.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},s.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},s.JpegFile.prototype._addMetaGroup=function(t,e){var i=new s.MetaGroup(t,e);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},s.JpegFile.prototype._parseIfd=function(t,e,i,o,r,a,l){var c,u,h,d,p,_,g,f,m,v,b,y=s.parseNum(t,e,i+o,2);b=this._addMetaGroup(a,l);for(var w=0;w<y;w++)if(c=i+o+2+12*w,u=s.parseNum(t,e,c,2),d=s.parseNum(t,e,c+2,2),_=s.parseNum(t,e,c+4,4),g=s.parseNum(t,e,c+8,4),void 0!==this._types[d]){if(h=this._types[d][0],p=this._types[d][1],g=p*_<=4?c+8:i+g,"UNDEFINED"==h)f=void 0;else if("ASCII"==h)f=e.slice(g,g+_),f=f.split("\0")[0],s.stringIsClean(f)||(f="");else{f=[];for(var k=0;k<_;k++,g+=p)"BYTE"!=h&&"SHORT"!=h&&"LONG"!=h||f.push(s.parseNum(t,e,g,p)),"SBYTE"!=h&&"SSHORT"!=h&&"SLONG"!=h||f.push(s.parseSnum(t,e,g,p)),"RATIONAL"==h&&(m=s.parseNum(t,e,g,4),v=s.parseNum(t,e,g+4,4),f.push(new s.Rational(m,v))),"SRATIONAL"==h&&(m=s.parseSnum(t,e,g,4),v=s.parseSnum(t,e,g+4,4),f.push(new s.Rational(m,v))),f.push();1===_&&(f=f[0])}r.hasOwnProperty(u)?b._addProperty(r[u][1],r[u][0],f):n("WARNING(jpegmeta.js): Unknown tag: ",u)}},s.JpegFile.prototype._jfifHandler=function(t,e){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(e+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(e+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(e+7)),this.jfif._addProperty("Xdensity","X density",s.parseNum(">",this._binary_data,e+8,2)),this.jfif._addProperty("Ydensity","Y Density",s.parseNum(">",this._binary_data,e+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",s.parseNum(">",this._binary_data,e+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",s.parseNum(">",this._binary_data,e+13,1))},s.JpegFile.prototype._app0Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._JFIF_IDENT?this._jfifHandler(t,e):i==this._JFXX_IDENT},s.JpegFile.prototype._app1Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._EXIF_IDENT&&this._exifHandler(t,e+6)},s.JpegFile.prototype._exifHandler=function(t,e){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,n,o,r=this._binary_data.slice(e,e+2);if("II"===r)i="<";else{if("MM"!==r)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+r);i=">"}if(n=s.parseNum(i,this._binary_data,e+2,2),42!==n)throw new Error("Malformed TIFF meta-data. Bad magic: "+n);if(o=s.parseNum(i,this._binary_data,e+4,4),this._parseIfd(i,this._binary_data,e,o,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,e,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,e,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var a;a=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(a=-a),this.gps._addProperty("latitude","Dec. Latitude",a)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},function(t,e,i){"use strict";var n=i(8),s=i(3),o=function(t,e,i){if(0===i)return 0;var n=null==i?e:e/i;return 2===arguments.length?Math.round(t*n):void 0},r=function(t,e,i){if(0===i)return 0;var n=null==i?e:e/i;return Math.round(t/n)},a=function(t,e,i,n){var s=t,a=e,l=t/e,c=i/n;return(t>i||e>n)&&(l>c?(s=i,a=r(s,l)):(a=n,s=o(a,l))),{width:s,height:a}},l=function(t,e,i,n,s,a){null!=s||(s=.5),null!=a||(a=.5);var l=0,c=0,u=t,h=e,d=t/e,p=i/n;return d>p?(u=o(e,p),l=Math.round(s*(t-u))):d<p&&(h=r(t,p),l=Math.round(a*(e-h))),{left:l,top:c,width:u,height:h}},c=function(t){var e;t instanceof n?(e=t,t=e.get(0)):e=n(t);var i=document.createElement("canvas");return i.width=t.width||e.width(),i.height=t.height||e.height(),i},u=function(t){var e=t.$(".needs-drawing");s.each(e,function(t){var e=t.getContext("2d"),i=new Image,s=4;e.mozImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1;var o=function(){e.fillStyle="#FFF",e.fillRect(0,0,t.width,t.height),e.drawImage(i,0,0,s,s),e.drawImage(t,0,0,s,s,0,0,t.width,t.height)};i.onload=o,i.src=n(t).data("image-url")}),e.removeClass("needs-drawing")},h=function(t,e,i){var s;t instanceof n?(s=t,t=s.get(0)):s=n(t),e?e instanceof n&&(e=e.get(0)):e=c(t);var o=e.width,r=e.height,a=e.getContext("2d");return a.save(),i&&(a.translate(e.width,0),a.scale(-1,1)),a.drawImage(t,0,0,o,r),a.restore(),e},d=function(t,e,i,s,o,a){var l;t instanceof n?(l=t,t=l.get(0)):l=n(t);var c=90===s||270===s;c?a&&i>a&&(e=r(a,i,e),i=a):a&&e>a&&(i=r(a,e,i),e=a);var u=document.createElement("canvas");c?(u.width=i,u.height=e):(u.width=e,u.height=i);var h=u.getContext("2d");return h.save(),h.translate(.5*u.width,.5*u.height),h.rotate(s*Math.PI/180),o&&h.scale(-1,1),h.drawImage(t,-.5*e,-.5*i,e,i),h.restore(),u},p={widthForHeight:o,heightForWidth:r,maxSize:a,cropBox:l,createCanvasForEl:c,drawElToCanvas:h,drawScaledAndRotated:d,drawPixelatedImages:u};t.exports=p},function(t,e,i){"use strict";function n(){}var s=i(6).sprintf,o=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"quote",two:"source"},n.prototype.typeAttributes={quote:"",source:""},n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("quote"),n=this.getHtmlStripped("source");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var r;return r=n&&i.length+(n.length>1?7:6)<=e?r=s("“%s” - %s",i,n):i?s("“%s”",o(i,e-2)):n,o(r,e)},n.prototype.editorField="two",n.prototype.validate=function(t,e,i){var n=[];return(!e.quote||e.quote.length<1)&&n.push("No quote."),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(265),a=i(254).truncateLongStrings,l=i(266);n.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail",excerpt:"excerpt",author:"author"},n.prototype.typeAttributes={title:"",url:"",caption:"",excerpt:"",author:""},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("url"),s=this.getHtmlStripped("caption");s=s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var l;return l=i&&s?o("%s - %s",i,s):i||s||r.parseUrl(n).host||"",a(l,e)},n.prototype.editorField="three",n.prototype.typeAttributes={title:"",url:"",excerpt:"",author:""},n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["title","url","thumbnail","excerpt","author"],n.prototype.softReset=function(t){t.apply(this,s.rest(arguments)),s.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},n.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments));return this.get("remove_thumbnail")&&(e.remove_thumbnail=this.get("remove_thumbnail")),s.extend(e,{author:this.getAttributeFromGeneric("author"),excerpt:this.getAttributeFromGeneric("excerpt")}),e},n.prototype.validate=function(t,e,i){var n=[];return e.loading&&n.push("Loading OpenGraph data."),(!e.url||e.url.length<1)&&n.push("No url."),l.isUrl(e.url)||n.push("Not a valid URL"),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(3),o={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],_setUrl:function(t){return this.aElement.setAttribute("href",t),this.aElement.setAttribute("href",this.aElement.href),this.aElement.href},parseUrl:function(t){if(!s.startsWith(t,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this._setUrl(t),{url:t,href:this.aElement.href,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(t){try{t.indexOf("://")===-1&&(t="http://"+t);var e=this.parseUrl(t),i=!1;if(s.endsWith(e.host,"tumblr.com")?i=e.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):s.endsWith(e.host,"tumblr.net")?i=e.host.match(/(?:^|\/\/)(?:([\w\-\_]+)\.)(?:[\w\-\_]+\.)*tumblr\.net/i):s.endsWith(e.host,"t.dev")&&(i=e.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),i){var n=i[1];if("www"===n)return!1;var o={tumblelog_name:n},r=e.path.match(/post\/([0-9]+)/i);return r&&(o.post_id=r[1]),o}return!1}catch(t){return!1}},isTumblelogUrl:function(t){return this.parseTumblelogUrl(t)!==!1},parseTumblelogShortUrl:function(t){try{t.indexOf("://")===-1&&(t="http://"+t);var e=this.parseUrl(t);return"tmblr.co"===e.host&&(s.startsWith(e.path,"/m")?{mentionKey:e.path.match(/^\/m([^\/]+)/)[0]}:!!s.startsWith(e.path,"/Z")&&{postTinyUrlHash:e.path.match(/^\/Z([^\/]+)/)[0]})}catch(t){return!1}},isTumblelogShortUrl:function(t){return this.parseTumblelogShortUrl(t)!==!1},isTumblrMediaUrl:function(t){return!!t&&(t.indexOf("://")===-1&&(t="http://"+t),!!t.match(/^https?:\/\/(\d+\.)media\.tumblr\.com\//i))},hasAllowedProtocol:function(t){this._setUrl(t);var e=this.aElement.protocol;if(":"===e&&(e=location.protocol),this.acceptedProtocols.indexOf(e)===-1)throw new Error("Unsupported protocol detected in URL: "+t);return!0},isAbsoluteUrl:function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return!!e.test(t||"")},getParameter:function(t){var e=new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)"),i=e.exec(location.search)||[null,""],n=i[1].replace(/\+/g,"%20"),s=decodeURIComponent(n);return s||null},httpBuildQuery:function(t,e){var i=[];for(var s in t)if(t.hasOwnProperty(s)){var o=e?e+"["+s+"]":s,r=t[s];if(!r)continue;i.push("object"===("undefined"==typeof r?"undefined":n(r))?this.httpBuildQuery(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return i.join("&")},buildUrl:function(t,e){var i=this.httpBuildQuery(e);return t+(s.isEmpty(i)?"":"?"+i)},getQueryStringHash:function(t){var e={};return t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(t,i,n,s){e[i]=s}),e},isProtocolRelative:function(t){var e=new RegExp("^//[^/]","i");return e.test(t||"")},getExtension:function(t){var e,i;return this.isProtocolRelative(t)&&(t=this.addProtocolIfMissing(t,"http:")),s.startsWith(t,"http")&&(i=this.parseUrl(t),s.isEmpty(i.path)||(e=i.path)),e||(e=t),s.last(e.split("."))},addProtocolIfMissing:function(t,e){if(s.any(this.acceptedProtocols,function(e){return s.startsWith(t,e)}))return t;if(this.acceptedProtocols.indexOf(e)===-1)throw new Error("Attempting to add an unsupported protocol: "+e);return(this.isProtocolRelative(t)?e:e+"//")+t}};t.exports=o},function(t,e){"use strict";var i={isUrl:function(t){var e="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",n='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+e+")+@",s="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",o="("+s+"(\\."+s+"){3})",r="a-zA-Z0-9\\-\\_\\~",a="\\u00C0-\\u9FFF",l="(["+r+a+"]+\\.)+([a-zA-Z]{2,})",c="[0-9]+",u="("+o+"|localhost|"+l+")(:"+c+")?",h=r+a+".:\\[\\]@!$&'()*+,;=",d="(["+h+"]|"+e+")*",p=d+"(\\/"+d+")*",_="\\?(["+h+"/?]|"+e+")*",g="\\#(["+h+"/?]|"+e+")*",f=new RegExp("^"+i+"("+n+")?"+u+"(\\/?("+p+")?("+_+")?("+g+")?)?$");return f.test(t)===!0},isImageUrl:function(t){var e=i.isUrl(t),n=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t)===!0;return e&&n}};t.exports=i},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(6).sprintf,r=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"title",two:"chat"},n.prototype.typeAttributes={title:"",chat:""},n.prototype.generateTweetText=function(t,e){var i,n=this.getHtmlStripped("title"),s=this.getHtmlStripped("chat");return i=n&&s?o("%s - %s",n,s):n||s||"",r(i,e)},n.prototype.validate=function(t,e,i){var n=[];return(!e.chat||e.chat.length<1)&&n.push("No chat."),t.call(this,e,{errors:n})},n.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return i["post[two]"]=e.get("chat").replace(/\u00A0/gm," "),i},t.exports=n},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(130),r=i(254).truncateLongStrings;n.prototype.genericFieldMap={two:"caption",three:"url"},n.prototype.editorField="two",n.prototype.allowsTypeSwitch=function(){return"new"===this.get("mode")},n.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},n.prototype.allowAnswerFields=["caption"],n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,e)},n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt","copyrightFallback"],n.prototype.parseForType=function(t,e,i){i.service&&"direct"!==i.service||(e.url=i.audio_url),delete e.audio_url,e.albumArt=i.audio_artwork,delete e.audio_artwork;var n=i.id3_tags||{};return delete e.id3_tags,e.trackTitle=n.Title||"",e.trackArtist=n.Artist||"",e.trackAlbum=n.Album||"",e},n.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&s.isEmpty(this.get("albumArt")),copyright_fallback:this.get("copyrightFallback")};return s.extend(e,s.pick(i,function(t){return!s.isUndefined(t)})),s.isEmpty(e.preuploaded_url)||(e["post[three]"]=null),e},n.prototype.validate=function(t,e,i){var n=[];return s.isEmpty(e.url)?n.push(o("Please choose an audio source before continuing.")):e.preuploadUrl?e.confirmTos||n.push(o("You must agree that you have permission to share this file.")):s.isEmpty(e.url)&&n.push(o("Please choose an audio source before continuing.")),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(130),r=i(270),a=i(258),l=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"embedCode",two:"caption"},n.prototype.allowAnswerFields=["caption"],n.prototype.editorField="two",n.prototype.resetPreserveFields=["caption","tags"],n.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos","copyrightFallback"],n.prototype.typeAttributes={caption:"",confirmTos:!1},n.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),l(i,e)},n.prototype.validate=function(t,e,i){var n=[];return e.embedCode?0===e.embedCode.length&&n.push("No embed specified."):e.preuploadUrl?e.confirmTos||n.push(o("You must agree that you have permission to share this file.")):e.video?0===e.video.embed_code.length&&n.push("Direct embed missing."):n.push("No video specified."),t.call(this,e,{errors:n})},n.prototype.canPreview=function(){return!this.get("preuploadKey")&&this.isValid()},n.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i=s.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos"),copyright_fallback:this.get("copyrightFallback")},s.isUndefined);return s.extend(e,i),e=r(e,{embedCode:"embed_code"})},n.prototype.getEmbedData=function(t){var e=!1;return this.has("video")?(e=a(this.get("video")),e={isNativeVideo:!0,embedRenderContext:"inline",width:e.dimensions.width,height:e.dimensions.height,previewIframe:e.previewIframe,embedCode:e.embedCode}):this.has("video_embed")&&(e=a(this.get("video_embed"))),e},t.exports=n},function(t,e,i){"use strict";function n(t,e){return o.zipObject(t,o.map(t,e))}function s(t,e){return o.isFunction(e)&&(e=n(o.keys(t),e)),o.transform(t,function(t,i,n){t[o.result(e,n)||n]=i},{})}var o=i(3);s.createKeyMap=n,t.exports=s},function(t,e,i){"use strict";function n(){}var s=i(3),o=i(254).truncateLongStrings;n.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},n.prototype.editorField="three",n.prototype.typeAttributes={ask:"",answer:"",caption:""},n.prototype.generateTweetText=function(t,e){return o(this.getHtmlStripped("ask"),e)},n.prototype.parseForType=function(t,e,i){return e.ask=s.escape(e.ask),e},n.prototype.validate=function(t,e,i){var n=[];return e.ask||n.push("Post question empty."),t.call(this,e,{errors:n})},t.exports=n},function(t,e,i){"use strict";var n=i(3),s=function(t){if(n.isString(t)){if(t=t.toLowerCase(),"true"===t||"1"===t||"on"===t)return!0;if("false"===t||""===t||"off"===t)return!1;if(t=n.parseInt(t),n.isNaN(t))return!0}return!!t};t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(274),r=i(192),a=s.extend({model:o,_listenToUploadModel:function(t){this.listenTo(t,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(t){this.stopListening(t)},_onUploadModelChange:function(t){n.has(t.changed,"complete")&&this.trigger("complete",this,t),n.has(t.changed,"error")&&t.get("error")&&this.trigger("error",this,t),n.has(t.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(t){return n.isArray(t)?n.forEach(t,this._listenToUploadModel,this):this._listenToUploadModel(t),s.prototype.add.apply(this,arguments)},remove:function(t){return n.isArray(t)?n.forEach(t,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(t),s.prototype.remove.apply(this,arguments)},removeIncomplete:function(t){var e=this.where({uploading:!1,complete:!1});return this.remove(e,t)},removeFailed:function(t){var e=this.filter(function(t){return t.get("error")});return this.remove(e,t)},allComplete:function(){return!!this.length&&this.every(function(t){return t.get("complete")})},anyUploading:function(){return this.length>0&&this.any(function(t){return t.get("uploading")})},getProgress:function(){var t=0,e=0;return this.forEach(function(i){i.get("error")&&(t+=i.get("bytesLoaded")||0,e+=i.get("bytesTotal")||0)}),e?t/e:0},promise:function t(){if(this.allComplete())return r.resolve(this);var t=r.promise(n.bind(function(t,e){var i,s;i=n.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",s),t.apply(this,arguments)},this),s=n.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",s),e.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",i),this.listenToOnce(this,"uploads:error",s)},this));return t}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(185),o=s.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(t,e){this.options=n.extend({},e),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(t){return this.jqXHR=t,t.then(function(){}),t},_uploadDone:function(){this.set({error:!1,uploading:!1,complete:!0})},_uploadFail:function(){this.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var t;return this.jqXHR&&(t=this.jqXHR.abort(),this.jqXHR=null),t},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoaded")/this.get("bytesTotal"):0}});t.exports=o},,function(t,e,i){"use strict";var n=i(3),s=i(187),o=new s({defaults:{teardown:function(){return this},beforeTeardown:function(){},afterTeardown:function(){return this.teardownSubViews()},render:function(){return this},beforeRender:function(){},afterRender:function(){return this.renderSubViews()},attachSubView:function(t,e){if(1===arguments.length)if("string"==typeof t){if(e=t,t=this.subViews[e],!t)return this}else e=t.$el.data("subview")||"";var i=this.$('[data-subview="'+e+'"]');return i.length>1&&(i=i.first()),t&&i.length&&(i.replaceWith(t.$el),t.$el.attr("data-subview",e)),this},attachSubViews:function(t){return n.forEach(this.subViews,this.attachSubView,this),this},teardownSubViews:function(){return n.forEach(this.subViews,function(t,e){t&&n.isFunction(t.teardown)&&t.teardown(),this.subViews[e]=null},this),this.subViews={},this},renderSubViews:function(){return n.forEach(this.subViews,function(t){t&&n.isFunction(t.render)&&t.render()},this),this},isInitialized:function(){return this._initialized},isRendered:function(){return this._rendered},isRendering:function(){return this._rendering},isRemoved:function(){return this._removed}},around:{initialize:function(t){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=!1,this.subViews={};var e=t.apply(this,n.rest(arguments));return this._initialized=!0,e},teardown:function(t){var e=n.rest(arguments);n.isFunction(this.beforeTeardown)&&this.beforeTeardown.apply(this,e);var i=t.apply(this,e);return n.isFunction(this.afterTeardown)&&this.afterTeardown.apply(this,e),this._rendered=!1,i},render:function(t){var e=n.rest(arguments);this._rendering=!0,n.isFunction(this.beforeRender)&&this.beforeRender.apply(this,e);var i=t.apply(this,e);return n.isFunction(this.afterRender)&&this.afterRender.apply(this,e),this._rendering=!1,this._rendered=!0,this.trigger("rendered"),i}},after:{remove:function(){this._removed=!0,this.subViews=null}}});t.exports=o},function(t,e,i){"use strict";function n(t){return s.trim(t)}var s=i(3),o=i(187),r=function(t,e){return t=n(t),e&&s.isFunction(this.$$)&&this.$$.cache.delete(t),t},a=function(t){if(this.$$)return t=n(t),this.$(t)},l=function(t){this.$$&&(t=n(t),this.$$.cache.delete(t))},c=function(t){if(this.$$)return t=n(t),this.$$.cache.delete(t),this.$(t)},u=function(){this.$$&&(this.$$.cache=new s.memoize.Cache)},h=function(t){return"[data-js-"+t+"]"},d=function(t){return function(){var t=s.memoize(s.bind(a,this),s.bind(r,this));t.update=s.bind(c,this),t.remove=s.bind(l,this),t.empty=s.bind(u,this);var e=function(e,i){return t(h(e),i)};return e.update=function(e){t.update(h(e))},e.remove=function(e){t.remove(h(e))},this.$$=t,this.js$=e,this.$$initialize=s.noop,t}.call(t)},p=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(t){return"undefined"==typeof t&&(t=this.$$cacheKeys),s.forEach(t,function(t){this.$$.update(t)},this),this},$$initialize:function(){return d(this)},$$:function(){return d(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){s.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});t.exports=p},,,,,,function(t,e,i){"use strict";function n(t){return o.noop}var s=i(8),o=i(3),r=(i(6).sprintf,i(187)),a=i(136),l=!1,c=s("body"),u=s(window),h=i(284),d=new r({removeAutoTeardown:function(){this._popoverBase.clickOutside&&(this._popoverBase.clickOutside.remove(),this._popoverBase.clickOutside=null)},setupAutoTeardown:function(){this.isRendered()&&(this.removeAutoTeardown(),this._popoverBase.autoTeardown&&(this._popoverBase.clickOutside=new h(this.el,this.options),this._popoverBase.clickOutside.on("click:outside",this.onClickOutside,this)))},onClickOutside:function(){this._popoverBase.shouldTeardown?(this._popoverBase.lastAutoTeardown=o.now(),this.teardown()):this._popoverBase.shouldTeardown=!0},reposition:function(){if(!this.$pinned.closest("body").length)return void this.$el.css("visibility","hidden");var t=this.pinnedRect(),e={scrollTop:this.isContainerBody?0:this.$container.scrollTop(),scrollLeft:this.isContainerBody?0:this.$container.scrollLeft(),realTop:this.isContainerBody?0:this.$container.offset().top,realLeft:this.isContainerBody?0:this.$container.offset().left},i=this._popoverBase.shift,n=this._popoverBase.pinnedSide,s={visibility:"visible"
},r={},a=this.$el.width(),l=null,c=null,u=null,h=null;this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O",n,i,t),this._popoverBase.isFixedPosition&&(s.position="fixed"),"top"===n||"bottom"===n?(o.extend(s,{left:t.left+Math.floor(t.width/2)+i.x}),r={top:t.top+e.scrollTop-i.y,bottom:t.top+e.scrollTop+t.height+i.y,left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},r.center=(r.right-r.left)/2,l=e.realTop+r.top-this.$el.height(),c=e.realTop+r.bottom+this.$el.height(),"top"===n&&this._crossesViewportEdge("top",l)&&!this._crossesViewportEdge("bottom",c)&&(n="bottom"),"bottom"===n&&this._crossesViewportEdge("bottom",c)&&!this._crossesViewportEdge("top",l)&&(n="top"),"bottom"===n?o.extend(s,{top:r.bottom,transform:"translateX(-50%)"}):"top"===n&&o.extend(s,{top:r.top,right:"",transform:"translateX(-50%) translateY(-100%)"}),u=e.realLeft+(r.center+r.left)-a/2,h=e.realLeft+(r.center+r.left)+a/2,this._crossesViewportEdge("left",u)&&!this._crossesViewportEdge("right",h)&&o.extend(s,{left:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===n?"translateX(0) translateY(-100%)":"translateX(0)"}),!this._crossesViewportEdge("left",u)&&this._crossesViewportEdge("right",h)&&o.extend(s,{left:"auto",right:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===n?"translateX(0) translateY(-100%)":"translateX(0)"})):"left"===n||"right"===n?(o.extend(s,{top:t.top-i.y}),r={left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},u=e.realLeft+r.left-this.$el.width(),h=e.realLeft+r.right+this.$el.width(),"left"===n&&this._crossesViewportEdge("left",u)&&!this._crossesViewportEdge("right",h)&&(n="right"),"right"===n&&this._crossesViewportEdge("right",h)&&!this._crossesViewportEdge("left",u)&&(n="left"),"left"===n?o.extend(s,{left:r.left,transform:"translateX(-100%) translateY(-50%)"}):"right"===n&&o.extend(s,{left:r.right,transform:"translateY(-50%)"})):o.extend(s,{top:t.top-i.y,left:t.left+i.x,transform:""}),o.extend(s,{transform:s.transform}),this.$el.css(s),this.debug("reposition: ad-hoc css %O",s),this.$el.removeClass("top bottom left right").addClass(n)},_crossesViewportEdge:function(t,e){var i=s(window),n={top:i.scrollTop(),left:i.scrollLeft(),right:i.scrollLeft()+i.width(),bottom:i.scrollTop()+i.height()};return n=this._popoverBase.isFixedPosition?{top:0,left:0,right:i.width(),bottom:i.height()}:{top:i.scrollTop(),left:i.scrollLeft(),right:i.scrollLeft()+i.width(),bottom:i.scrollTop()+i.height()},this.debug("viewportCheck against %s side (%s) coordinate=[%s]",t,n[t],e),"top"===t?n.top>e:"bottom"===t?n.bottom<e:"left"===t?n.left>e:"right"===t?n.right<e:void 0},isRendered:function(){return this.rendered||this._rendered},isOrWasRecentlyRendered:function(t){o.isNumber(t)||(t=100);var e=this._popoverBase.lastAutoTeardown,i=o.now()-e;return i<t||this.isRendered()},setPinnedSide:function(t){return this._popoverBase.pinnedSide=t,this},setPinnedTarget:function(t){return this.$pinned=s(t).addClass("pinned-target"),this.debug("setPinnedTarget: %O",this.$pinned),this},setPopoverContainer:function(t){return this.$container=s(t),this.isContainerBody=this.$container.is(c),this.debug("setPopoverContainer: %O, isContainerBody=%s",this.$container,this.isContainerBody),this},setShift:function(t){if(!o.isObject(t)||!o.isNumber(t.x)||!o.isNumber(t.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");return this._popoverBase.shift.x=t.x,this._popoverBase.shift.y=t.y,this},getShift:function(){return this._popoverBase.shift},_initializeDebugger:function(){this.debug=l?n(this):o.noop},defaults:{pinnedRect:function(){var t,e,i=this.$container.offset();t=this.$pinned.offset(),e=t,this._popoverBase.isFixedPosition&&(this.isContainerBody?t.top-=u.scrollTop():t.top-=this.$container.scrollTop());var n={};return n.height=this.$pinned.outerHeight(),n.width=this.$pinned.outerWidth(),n.top=Math.round(t.top-i.top),n.left=Math.round(e.left-i.left),n.bottom=Math.round(n.top+n.height),n.right=Math.round(n.left+n.width),this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O",this.$container,this.$pinned,i,e),this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s",n.height,n.width,n.top,n.left,n.bottom,n.right),n},teardown:o.noop},after:{initialize:function(t){var e={identifier:"popover",pinnedSide:"bottom",className:"popover--base",autoTeardown:!0,teardownOnEscape:!0,minDistanceFromContainer:10,shift:{x:0,y:0},clickOutside:null,lastAutoTeardown:0,shouldTeardown:!0,isFixedPosition:!1};this._popoverBase=o.defaults(o.pick(t||{},o.keys(e)),e),this._initializeDebugger(),this.setPinnedTarget(t.pinnedTarget||null),this.setPopoverContainer(t.popoverContainer||c),this._popoverBase.autoTeardown&&this.listenTo(this,"rendered",this.setupAutoTeardown)},render:function(){this.$el.addClass(this._popoverBase.className),this.$el.appendTo(this.$container);var t=this.$el.children().first(),e=t.width();t.width(e-e%2),this.reposition(),this.isContainerBody&&(this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"),this.listenTo(a,"DOMEventor:flatresize",this.reposition),this._popoverBase.isFixedPosition||this.listenTo(a,"DOMEventor:flatscroll",this.reposition)),this._popoverBase.teardownOnEscape&&this.listenTo(a,"DOMEventor:keyup:escape",this.teardown),this.trigger("open",this),a.trigger(this._popoverBase.identifier+":open",this)},teardown:function(){this.$pinned.removeClass("pinned-target"),this._popoverBase.teardownOnEscape&&this.stopListening(a,"DOMEventor:keyup:escape"),this.removeAutoTeardown(),this.trigger("close",this),a.trigger(this._popoverBase.identifier+":close",this)}},before:{teardown:function(){this.$el.off("mousewheel DOMMouseScroll")}}});t.exports=d},function(t,e,i){"use strict";function n(t,e){this.options=s.extend({preventInteraction:!1,ignoreSelectors:[]},e),this._onClick=s.bind(this._onClick,this,t),document.addEventListener("click",this._onClick,!0)}var s=i(3),o=i(8),r=i(7);n.prototype._isForcedInsideTarget=function(t){return!s.isEmpty(this.options.ignoreSelectors)&&!s.isEmpty(t.closest(this.options.ignoreSelectors.join(",")))},n.prototype._onClick=function(t,e){var i=o(e.target);t===e.target||o.contains(t,e.target)||this._isForcedInsideTarget(i)?this.trigger("click:inside",e):(this.trigger("click:outside"),this.options.preventInteraction&&(e.preventDefault(),e.stopPropagation()))},n.prototype.remove=function(){return document.removeEventListener("click",this._onClick,!0),this.off(),this},s.extend(n.prototype,r.Events),t.exports=n},,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(136),a=i(293),l=i(276),c=i(277),u=i(230),h=i(312),d=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1,smartQuotesEnabled:!1},events:{},mixins:[u,l,c],template:h,initialize:function(t){this.set(t),this.onChange=t.onChange||n.noop,this.onClientEvent=t.onClientEvent||n.noop,this.pasteHook=t.pasteHook||n.noop,this.smartQuotesEnabled=t.smartQuotesEnabled,this.disableEdit=t.disableEdit||!1;var e=this.get("name");e&&this.get("syncWithModel")&&this.$el.attr("data-name",e)},_initializeEditor:function(t,e){var i={placeholder:e,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},smartQuotes:{enabled:this.smartQuotesEnabled}};this.editor=new a.PlainTextEditor(t,i),this.disableEdit&&this.disable()},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(i){n.each(t,function(t){t.call(e,i)})}},_composeOnClientEvent:function(){var t=this.onClientEvent,e=this;return function(i){r.trigger("plainTextEditor:onClientEvent",i,e.editor),t.call(this,i)}},render:function(){this.$el.html(this.template({ariaLabel:this.get("ariaLabel")}));var t=this.js$("plainTextEditor").get(0);if(this._initializeEditor(t,this.get("placeholder")),this.get("syncWithModel")){var e=this._modelValue().length>0;e&&this.set("placeholder",!1),this.updateEditorFromModel()}return this},teardown:function(){return this.$el.empty(),delete this.editor,this},serialize:function(){return this.toJSON()},getEditorValue:function(t){return"undefined"!=typeof t||(t=!0),this.editor?this.editor.getData(t):null},setEditorValue:function(t){this.editor&&this.editor.setData(t)},updateModelFromEditor:function(){if(!this.editor)return!1;var t=this.get("name"),e=this.getEditorValue();""!==e?s(this.editor.element).addClass("has-text"):s(this.editor.element).removeClass("has-text"),this.model.get(t)!==e&&this.model.set(t,e)},updateEditorFromModel:function(){var t=this.getEditorValue(),e=this._modelValue();e.trim()&&e.trim()!==t.trim()&&this.setEditorValue(e)},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(t){this.editor&&this.editor.focus(t)},blur:function(){this.editor&&this.editor.element.blur()},setCursorToEnd:function(){this.editor&&n.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()},enable:function(){s(this.editor.element).attr("contenteditable",!0)},disable:function(){s(this.editor.element).removeAttr("contenteditable")}});t.exports=d},function(t,e,i){var n=i(3),s=i(294);t.exports=n.extend(s,{RichTextEditor:i(295),PlainTextEditor:i(311),SelectionContext:i(305),SelectionPersistence:i(299),Utils:i(298),HumanKeys:i(310)})},function(t,e){var i={debugMode:!1};t.exports=i},function(t,e,i){var n=i(3),s=i(8),o=i(296).animate,r=i(297),a=i(302),l=i(303),c=i(299),u=i(305),h=i(306),d=i(298),p=i(307),_=i(308),g=i(309),f=i(310),m=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,v=i(301),b=function(){function t(t,e){return n.mapValues(t,function(t,e){return e.match(/^on[A-Z]/)&&n.isFunction(t)?n.bind(t,this):t},e)}function e(){U.call(this,dt);var t=s("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),e=s("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(e),e=s(this.element).parent(),this.wrapper=e.parent().get(0),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),this.placeholderElement.on("click",n.bind(function(t){this.focus()},this)),e.append(this.contextualControls.element),e.append(this.linkControl.element),e.append(this.placeholderElement),e.append(this.inlineControls.element),B.call(this),this.controlBar=s("<div />",{"data-js":"control-bar",class:"control-bar disabled"});var o=s("<div />",{class:"static-controls control"});this.controlBar.append(o),this.controlBar.append(this.staticControls.element);var r=this;o.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var e=u.getNodeList();r.staticControls.setActives(n.pluck(e,"nodeName"));var i=s(this).position();return r.staticControls.isShown?r.staticControls.hide():r.staticControls.open(i.left+s(this).width()/2,0),r.contextualControls.hide(),r.linkControl.close(),!1}),this.config.showStaticControls&&s(this.wrapper).append(this.controlBar),i.call(this),T.call(this)}function i(){var t=this,e=function(){var e=t.inlineControls.isTrayOpen||t.contextualControls.isShown||t.staticControls.isShown||t.linkControl.isShown;return e};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.controlBar.removeClass("disabled"),t.config.onClientEvent.call(t,e)});var i=function(){O.call(this),this.onChange()};s(this.element).on("keydown",function(i){if(i.keyCode===yt.shift)t.keyModifiers.shift=!0;else if(n.contains([yt.metaLeft,yt.metaRight],i.keyCode))t.keyModifiers.meta=!0;else{if(i.keyCode===yt.esc)return void(e()&&(t.contextualControls.hide(),t.staticControls.hide(),t.inlineControls.isTrayOpen&&t.inlineControls.toggleTrayWithIntent(!1),i.stopPropagation()));i.keyCode===yt.backspace?(S.call(t,i),K.call(t)):i.keyCode===yt.enter&&(k.call(t,i),w.call(t,i),d.browser.safari&&i.shiftKey&&(i.preventDefault(),y.call(t)))}var s=n.contains(n.values(n.omit(yt,"enter")),i.keyCode);!b.call(t)||s||t.keyModifiers.meta||(t.keyModifiers.meta=!1,i.preventDefault()),I.call(t,i),O.call(t,i)}),s(this.element).on("keyup",function(e){e.keyCode===yt.shift?t.keyModifiers.shift=!1:n.contains([yt.metaLeft,yt.metaRight],e.keyCode)?t.keyModifiers.meta=!1:e.keyCode===yt.enter?K.call(t):e.keyCode!==yt.backspace&&e.keyCode!==yt.delete||(N.call(t),n.defer(function(){x.call(t)}));var s=!1;e.keyCode===yt.right&&!e.shiftKey&&t.inlineControls&&(s=t.inlineControls.isShown),e.keyCode===yt.esc||s||i.call(t)}),s(this.element).on("input",function(){i.call(t)});var o=!1;s(this.element).on("mouseup",function(){o=!1,O.call(t)}),s(this.element).on("mousedown",function(t){o=!0}),document.addEventListener("mousedown",function(e){var i=function(){o=!1,C.call(t),t.controlBar.addClass("disabled")};t.wrapper===e.target||s.contains(t.wrapper,e.target)||t.config.documentMousedownHook(e,i)||i()},!0),document.addEventListener("mouseup",function(e){o&&(O.call(t),o=!1)},!0),s(this.element).on("focus",function(){if(t.controlBar.removeClass("disabled"),!W.call(t)){var e=s(t.element).children(_t.join());if(e.length){var i=e.first().get(0);c.setToStart(i)}}n.defer(function(){t.onChange()})}),s(this.element).on("blur",function(i){var s=function(i){if(!e()){var s=u.getSelection();s&&u.isInContext(s,t.element)&&s.removeAllRanges(),O.call(t,function(){t.onChange(),n.isFunction(i)&&i()})}};t.config.blurHook(i,s)||n.defer(s)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;i&&(t.config.pasteHook(i,t.keyModifiers.shift)||V.call(t,i),$.call(t),e.preventDefault())}),s(this.element).on("cut",function(e){t.contextualControls.hide(),t.staticControls.hide(),t.linkControl.close(),n.defer(function(){x.call(t),$.call(t),t.onChange()})})}function b(){return!!this.config.characterLimit&&this.element.innerText.length>this.config.characterLimit}function y(){for(var t=W.call(this),e=n.contains(ft,t.nodeName)?"\n":"<br>",i=u.isCursorAtEnd(t)&&!u.isCursorAtStart(t)?1:0,s=0;s<i;s++)e+=e;H.call(this,e)}function w(t){var e,i,o=u.getNodeByNames(ft);o&&!this.keyModifiers.shift&&u.isCursorAtEnd(o)&&(i=s(o),e=i.text(),t.preventDefault(),e.match(/\n\n$/)?(n.last(i.contents()).remove(),this.insertNewParagraphAfter(o)):(i.append("\n\n"),c.setToEnd(o)))}function k(t){var e=u.getNodeByNames(["BLOCKQUOTE"]);if(e&&!this.keyModifiers.shift&&u.isCursorAtEnd(e,!0)){var i="P"===e.lastElementChild.nodeName?e.lastChild:null;i&&i.previousSibling&&this.dataFilter.isEmptyElement(i,!0)&&(t.preventDefault(),s(i).remove(),this.insertNewParagraphAfter(e))}}function C(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function x(){if(!s(this.element).has(bt.join()).length){var t=s(this.element).find("ul:not(:has(li)),ol:not(:has(li))");t.remove();var e=n.some(s(this.element).children().toArray(),function(t){return t.textContent.length>0});e||(U.call(this,""),K.call(this),B.call(this))}}function S(t){var e=u.getSelection();if(e.isCollapsed){var i=W.call(this);if(i&&!(c.saveSelection(i).start>0)){var n=s(i).prev().get(0);n&&ct.call(this,n)&&(s(n).remove(),t.preventDefault())}}}function T(){var t=this,e=s(t.element).offset().top,i=null,o="dragstart dragenter dragleave dragover dragend drop",r=!1,a=function(t){var e=t.dataTransfer.types&&n.some(t.dataTransfer.types,function(t){return"Files"===t});return e},l=function(t){return"false"===s(t.target||t.srcElement).attr("contenteditable")},c=function(e,i,s){e.length&&(t.onChange(),n.each(e,function(e){t.config.onFileAdded.call(t,e,i,s)}),O.call(t))},u=function(t,e){return t<e.top+.66*e.height},h=function(t,i){var n=s(i).offset().top-e,o=s(i).get(0).getBoundingClientRect().height,r=t>n+.66*o;return{element:i,top:n,bottom:n+o,height:o,isAfter:r}},d=function(){s(t.element).find(".over-top, .over-bottom").each(function(){s(this).removeClass("over-top").removeClass("over-bottom"),""===s(this).attr("class").trim()&&s(this).removeAttr("class")})},p=function(n){var o=null,r=n.pageY-e,a=s(t.element).children();i&&r>i.top&&u(r,i)||(a.each(function(){var t=h(r,this);if(u(r,t)&&(n.target||n.srcElement)!==this)return o=t,!1}),o||(o=h(r,a.last().get(0)),o.isAfter=!0),o&&i&&i.element===o.element&&i.isAfter===o.isAfter||(d(),i=o))};s(t.element).unbind(o),s(t.element).on("dragleave",function(t){d()}),s(t.element).on("dragover",function(t){return r?(n.debounce(p,100)(t.originalEvent),i&&(s(i.element).addClass(i.isAfter?"over-bottom":"over-top"),a(t.originalEvent)&&t.stopPropagation()),void t.preventDefault()):(t.preventDefault(),void t.stopPropagation())}),s(t.element).on("dragenter",function(t){t.preventDefault(),a(t.originalEvent)&&(r="file")}),s(t.element).on("dragstart",function(e){if(C.call(t),l(e.originalEvent)){r="media";var i=e.originalEvent.target||e.originalEvent.srcElement,o=e.originalEvent.dataTransfer;if(o){o.effectAllowed="move",o.dropEffect="move";try{var a=s(i).find("img").attr("src")||"";a.match(/^\s*data:/)&&(a=""),o.setData("text/uri-list",a),o.setData("text/plain",a)}catch(t){}}n.defer(function(){s(i).addClass("dragging")})}}),s(t.element).on("drop",function(t){d(),a(t.originalEvent)&&c(t.originalEvent.dataTransfer.files,i.element,i.isAfter?1:-1),t.stopPropagation(),t.preventDefault()}),s(t.element).on("dragend",function(e){if(l(e.originalEvent)){d();var n=e.originalEvent.target||e.originalEvent.srcElement,o=s(n).data("origHeight"),a=n;if(i&&a!==i.element){var c=s(n).remove();i.isAfter?s(i.element).after(c):s(i.element).before(c),ot.call(t,c)}s(a).animate({height:o},200,function(){s(a).removeClass("dragging")}),t.onChange(),O.call(t)}r=!1})}function E(t,e,i){var n=s(this.element),o=c.saveSelection(this.element);n.find(i).wrap("<"+e+">"),n.find(i).contents().unwrap(),c.restoreSelection(o),window.document.execCommand(t),n.find(e).wrap("<"+i+">"),n.find(e).contents().unwrap(),c.restoreSelection(o)}function P(t,e,i){var o=this,r=function(){window.document.execCommand(t),o.config.flattenBlocks&&M.call(o)},a=function(){var t=c.saveSelection(o.element),e=200,n=240;!i||i.isAnimating||t.selection.isCollapsed||setTimeout(function(){s(o.linkControl.linkEditInput).focus();var r=function(i,n){var r=i-s(o.wrapper).offset().left,a=n-s(o.wrapper).offset().top;o.linkControl.size(e),o.linkControl.show(r,a),o.linkControl.createLink(t)};i.closeWithShim(i.element.find(".link").get(0),e,n,r),t.selection.removeAllRanges(),o.blur(!0)},30)},l=function(t){var e=c.saveSelection(o.element),i=u.getRootElements();switch(n.each(gt,function(t){var e=u.getNodesByNames(i,[t]);e.length&&F.call(o,"formatBlock",t)}),A.call(o),t.toLowerCase()){case"blockquote":i=u.getRootElements();var r=[],a=[];i=n.each(i,function(t){n.contains(vt,t.nodeName.toUpperCase())?a.push(t):(r.push(a),a=[])}),a.length&&r.push(a),n.each(r,function(e){s(e).wrapAll(document.createElement(t))});break;case"pre":window.document.execCommand("formatBlock",!1,"<"+t+">"),j.call(this);break;default:window.document.execCommand("formatBlock",!1,"<"+t+">")}c.restoreSelection(e)},h=function(){var t=o.contextualControls.controls,e=o.contextualControls.getActiveStates();n.each(e,function(e,i){var n=t[i];e&&F.call(o,n.command,n.el)}),window.document.execCommand("removeFormat")};switch(t){case"formatBlock":l(e);break;case"createLink":a();break;case"insertOrderedList":r();break;case"insertUnorderedList":r();break;case"removeFormat":h();break;case"insertHTML":E.call(this,"underline","U",e);break;default:window.document.execCommand(t)}O.call(this),N.call(this),o.onChange()}function F(t,e){var i=this;switch(t){case"formatBlock":var o=c.saveSelection(this.element);A.call(i),n.each(u.getRootElements(),function(t){i.dataFilter.unBlock(t),"pre"===t.nodeName.toLowerCase()&&(t.innerHTML=t.innerHTML.replace("\n","<br>"));var e=t.nodeName.toUpperCase();if(n.contains(gt,e)){var o=s(t).contents();s(o).wrapAll("<p>"),s(t.firstChild).unwrap()}}),c.restoreSelection(o);break;case"insertOrderedList":A.call(this);break;case"insertUnorderedList":A.call(this);break;case"createLink":window.document.execCommand("unlink");break;case"insertHTML":E.call(this,"underline","U",e);break;default:window.document.execCommand(t)}N.call(this),O.call(this),this.onChange()}function I(t){var e=function(){var t=u.getNodeByNames(["UL","OL"]);return!!t};t.keyCode===yt.tab&&e()&&(t.preventDefault(),t.stopPropagation(),t.shiftKey?(P.call(this,"outdent"),e()||P.call(this,"formatBlock","p")):P.call(this,"indent"))}function j(){var t=u.getNodeByNames(ft);t&&s(t).find("br").replaceWith("\n")}function A(){var t=u.getNodeByNames(mt);if(t){do window.document.execCommand("outdent");while(u.getNodeByNames(mt));u.getNodeByNames(["H2"])||window.document.execCommand("formatBlock",!1,"<p>"),this.dataFilter.blockifyInlineNodes(this.element)}}function M(){var t=c.saveSelection(this.element),e=u.getNodeList(null,!0);this.dataFilter.unwrapParentBlocks(e),c.restoreSelection(t)}function N(){var t=c.saveSelection(this.element),e=u.getNodeList(),i=this.dataFilter.scrubSpansAndBadAttrs(e);i&&t.end>t.start&&c.restoreSelection(t)}function O(t){var e=this;setTimeout(function(){var i=u.getSelection();return i?(i.isCollapsed?D.call(e,i):R.call(e,i),it.call(e),G.call(e),e.config.onSelection.call(e,i),u.isInContext(i,e.element)&&(e.lastSelection=c.saveSelection(e.element)),$.call(e),B.call(e),void(n.isFunction(t)&&t())):(it.call(e),void(n.isFunction(t)&&t()))},20)}function R(t){if(u.isInContext(t,this.element)){var e=u.getContextCoordinates(s(this.element).parent().parent()),i=u.getNodeList(t);this.contextualControls.setActives(n.pluck(i,"nodeName")),this.staticControls.setActives(n.pluck(i,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==t.toString().trim()&&e&&!this.staticControls.isShown&&this.contextualControls.open(e.x,e.y)}}function D(t){this.contextualControls.hide();var e=u.getNodeList(t),i=n.find(e,function(t){return"A"===t.nodeName});if(this.linkControl.isValidLink(i)){var o=u.getContextCoordinates(s(this.element).parent().parent(),i);this.linkControl.showOptions(i),this.linkControl.showOverTarget(o.x,o.y)}else this.linkControl.close();this.staticControls.setActives(n.pluck(e,"nodeName"))}function $(){var t=u.getSelection(),e=t&&t.isCollapsed;if(!e||!u.isInContext(t,this.element))return void this.inlineControls.close();var i=W.call(this);if(i&&"P"===i.nodeName&&this.dataFilter.isEmptyElement(i)&&!this.isEmpty())this.inlineControls.open(i);else if(this.isEmpty()){this.inlineControls.open(i);var n=d.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(i,n)}else this.inlineControls.close()}function B(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function L(t){var e=this.element.innerText.length,i=this.config.characterLimit;if(e+t.length>=i){var n=i-e,s=n>0?n:0;t=t.slice(0,s)}return t}function V(t){var e="";if(t.items&&t.items.length){var i=n.find(t.items,function(t){return/image\/\w+/.test(t.type)});if(i){var o=i.getAsFile();if(o)return void this.config.onFileAdded.call(this,o)}}n.contains(t.types,"text/html")?e=t.getData("text/html"):(e=t.getData("text/plain"),e=this.dataFilter.filterPlaintext(e,!0)),e=e.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),e=e.replace(/\u00a0/g," "),e=this.dataFilter.filterHTML(e),e=this.dataFilter.convertToBrowserSpaces(e),this.config.characterLimit&&(e=L.call(this,e));var r=document.createElement("div");r.innerHTML=e,this.dataFilter.flattenBlocksDown(r,!0),s(r).find(bt.join()).remove();var a=n.some(r.children,function(t){return n.contains(_t,t.nodeName)});if(a){var l=u.getSelection(),c=l.getRangeAt(0);c.deleteContents();var h=W.call(this);if(""===s(h).text().trim()){var d=s(h).index(),p=s(h).parent(),_=d+r.children.length-1;s(h).replaceWith(r.children);var g=s(p).children().eq(_).get(0);c.selectNodeContents(g),c.collapse(!1),l.removeAllRanges(),l.addRange(c)}else this.dataFilter.inlinify(r),H.call(this,r.innerHTML)}else H.call(this,r.innerHTML);this.onChange()}function U(t){s(this.element).html(t)}function z(){return s(this.element).html().trim()}function H(t){if(!t)return void v.warn("Cannot insert empty data");var e=u.getSelection();if(!e||!e.focusNode)return void v.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents(),t=this.dataFilter.convertToBrowserSpaces(t);var n=document.createElement("div");n.innerHTML=t;for(var s,o=n.lastChild,r=document.createDocumentFragment();s=n.firstChild;)r.appendChild(s);i.insertNode(r),i.setStartAfter(o),i.collapse(!1),e.removeAllRanges(),e.addRange(i)}function q(){var t=W.call(this);if(!t){var e=s(this.element).children(_t.join());if(!e.length)return null;t=e.last().get(0)}return t}function W(){var t=u.getSelection()||this.lastSelection;return u.getNodeByNames(_t,!0,t)}function K(){var t=q.call(this);if(t){if("div"===t.nodeName.toLowerCase())try{window.document.execCommand("formatBlock",!1,"<p>")}catch(t){}}else U.call(this,dt),this.setCursorToStart()}function G(){var t=s(this.element).children(vt.join()).last().get(0);t||s(this.element).append(dt)}function Q(t,e,i,o,r){var a=this,l=function(t){var l,c,u,h,d=n.uniqueId(),p=0===t.lastIndexOf("data:",0)?"file":t;a.mediaTracker[d]={originalSource:p,file:e},c=s("<img />",{src:t}),l=c.get(0),h=s("<figure />"),u=h.get(0),c.attr(a.config.imgKeyAttr,d),h.append(c),tt.call(a,u,i,o,r),Y.call(a,l,function(i){J.call(a,l,i),a.config.onAsyncImageAdded.call(a,d,t,e,i||{})}),a.onChange()};if(!t&&e)if(m)l(m(e));else{var c=new FileReader;c.onload=function(t){l(t.target.result)},c.readAsDataURL(e)}else{if("string"!=typeof t)return void a.config.onAsyncImageFailed.call(a);l(t)}}function J(t,e){var i,o={},r=this.config,a=s(t).parent("figure").get(0),l={toImg:t,toImgParent:a};r.addImgAttrs&&(i=n.reduce(l,function(t,e,i){return r.addImgAttrs!==!0&&r.addImgAttrs[i]!==!0||t.push(e),t},[])),n.isEmpty(i)||!r.imgSizeAttrs||n.isEmpty(e)||(r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.height]=e.height),r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.width]=e.width),s(i).attr(o))}function Y(t,e){var i=function(t){var i={width:t.naturalWidth,height:t.naturalHeight};n.isFunction(e)&&e.call(this,i)};t.complete?i.call(this,t):s(t).one({"load.getImageAttributes":n.bind(n.partial(i,t),this),error:n.bind(function(){s(t).off(".getImageAttributes"),e.call(this,null)},this)})}function X(t){return s(this.element).find("img["+this.config.imgKeyAttr+'="'+t+'"]').get(0)}function Z(t,e,i){var o=X.call(this,t);n.isEmpty(i)||o&&J.call(this,o,i),e&&(s(o).attr("src",e),this.mediaTracker[t].updatedSource=e)}function tt(t,e,i,n){var o;e=e||q.call(this),o=this.dataFilter.isEmptyElement(e.outerHTML,!0)?0:u.isCursorAtStart(e)?-1:1,i="number"==typeof i?i:o;var r=s(t).get(0),a=st.call(this,r);ot.call(this,a),i<0?s(e).before(a):i>0?s(e).after(a):0===i&&s(e).replaceWith(a),C.call(this);var l=s(a).nextAll(vt.join()).get(0);l||(l=s(dt).get(0),s(a).after(l)),n||(this.focus(!0),c.setToStart(l)),et.call(this,a,!1,O)}function et(t,e,i){var r=this;e=e||!1,i=i||n.noop;var a=s(t),l=a.find("figure"),c=a.find(".media-button"),u=200;return a.length&&l.length?(e&&c.length&&c.hide(),o(l,{opacity:e?0:[1,0],translateY:e?-25:[0,-25]},{duration:.9*u,easing:"easeOutQuad",complete:function(){l.removeAttr("style")}}),void o(t,e?"slideUp":"slideDown",{duration:u,easing:"easeOutQuart",begin:function(){a.css("pointer-events","none")},complete:function(){a.css("pointer-events",""),i.call(r,t)}})):void i.call(r)}function it(){var t=this,e=W.call(this);s(e).removeClass(t.config.fakeClass),s(t.element).children("p").each(function(i,n){e!==n&&t.dataFilter.isEmptyElement(n)&&(0===i&&ct.call(t,s(n).next().get(0))||s(n).is(":last-child")&&ct.call(t,s(n).prev().get(0))?nt.call(t,n):ct.call(t,s(n).prev().get(0))&&ct.call(t,s(n).next().get(0))?nt.call(t,n):s(n).hasClass(t.config.fakeClass)&&s(n).remove()),void 0!==s(n).attr("class")&&""===s(n).attr("class").trim()&&s(n).removeAttr("class")}),s(this.element).children("."+this.config.mediaHolderClass).each(function(e,i){var n=s(this).next().get(0);n&&!ct.call(t,n)||s(this).after(nt.call(t));var o=s(this).prev().get(0);o||s(this).before(nt.call(t))})}function nt(t){return t=t||s(dt).get(0),s(t).addClass(this.config.fakeClass),t}function st(t){var e=s(t),i=s("<div />",{class:this.config.mediaHolderClass,contentEditable:!1,draggable:!0});e.wrap(i),i=e.parent(),n.isFunction(this.config.mediaHolderCallback)&&this.config.mediaHolderCallback(this,t,e,i);var o=s(this.config.mediaKillerMarkup);o.addClass("media-killer"),i.append(o);var r=!i.hasClass("media-holder-draggable");if(r){var a=s(this.config.mediaMoverMarkup);a.addClass("media-mover"),i.append(a)}return i}function ot(t){var e=this,i=t?s(t):s(this.element).find('[contenteditable="false"]'),n=this.config.mediaHolderEvents;i.each(function(t,i){var o=s(i),r=null;o.off("keydown").on("keydown",function(t){n.keydown.call(null,t,o),t.isPropagationStopped()||(t.keyCode!==yt.delete&&t.keyCode!==yt.backspace||o.remove(),t.preventDefault(),t.stopPropagation())}),o.off("keyup").on("keyup",function(t){n.keyup.call(null,t,o)}),o.on("mousedown",function(t){r=t.originalEvent.target,n.mousedown.call(null,t,o,r)}),o.on("mouseup",function(t){n.mouseup.call(null,t,o,r);var i=s(r);i.hasClass("media-killer")&&r===t.target&&et.call(e,o,!0,function(){o.remove(),x.call(e),O.call(e),e.onChange()})}),o.on("mouseenter",function(t){s(t.currentTarget).addClass("show-controls"),n.mouseenter.call(null,t,o,r)}),o.on("mouseleave",function(t){s(t.currentTarget).removeClass("show-controls"),n.mouseleave.call(null,t,o,r)}),o.on("dragstart",function(t){var e=s(r);e.hasClass("media-killer")&&(t.preventDefault(),t.stopPropagation()),o.hasClass("media-holder-draggable")||e.hasClass("media-mover")||(t.preventDefault(),t.stopPropagation()),n.dragstart.call(null,t,o,r)})})}function rt(t){n.each(s(t).find("."+this.config.mediaHolderClass),function(t){s(t).find(".media-killer, .media-mover").remove();var e=s(t).children().first();e.length?s(e).unwrap():(s(t).contents().wrap("<div>"),s(t).children().first().unwrap().contents().unwrap())})}function at(t){var e=this,i=s(t).find("."+this.config.fakeClass+", ."+this.config.fakeClass+"-intent");n.each(i,function(t){e.dataFilter.isEmptyElement(t)&&s(t).remove()})}function lt(){var t=this;n.each(s(this.element).find(bt.join()),function(e){var i=u.getParentNodes(e),s=n.some(i,function(t){return n.contains(bt,t.nodeName)});ut.call(t,e)||s||st.call(t,e)})}function ct(t){return s(t).hasClass(this.config.mediaHolderClass)}function ut(t){var e=s(t).closest("[class="+this.config.mediaHolderClass+"]");return e.length?e.get(0):null}function ht(t,e,i){var o,r;return e=!!n.isBoolean(e)&&e,t=t||q.call(this),o=s(t)[e?"prev":"next"](),!i&&o.length>0&&this.dataFilter.isEmptyElement(o)?(c.setToStart(o.get(0)),o):(r=s(dt).get(0),s(t)[e?"before":"after"](r),c.setToStart(r),r)}var dt="<p><br></p>",pt="<p></p>",_t=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","DIV","PRE"],gt=["H2","BLOCKQUOTE","PRE"],ft=["PRE"],mt=["UL","OL"],vt=["P","H2","BLOCKQUOTE","UL","OL","PRE"],bt=["IMG","IFRAME","FIGURE","HR"],yt={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39,metaLeft:91,metaRight:93,leftArrow:37,rightArrow:38,upArrow:39,downArrow:40},wt=function(i,o){if(!i)throw new Error("A valid element parameter is required to initalize the editor");o=o||{},this.element=i,this.humanKeys=new f,this.keyComboEvents=o.keyComboEvents||new g({element:this.element,humanKeys:this.humanKeys});var d=n.template("<%= title %> (<%= shortcut %>)"),m=n.bind(function(t,e){return d({title:t,shortcut:this.humanKeys.pretty(e)})},this);this.config={labels:{},placeholder:!1,
characterLimit:null,onChange:n.noop,onSelection:function(t){},onAsyncImageAdded:function(t,e,i,n){},onAsyncImageFailed:function(){v.warn("Unknown source type for inserting an image.")},onFileAdded:function(t,e,i){},onClientEvent:function(t){},flattenBlocks:!0,smartQuotes:{enabled:!1,config:{}},runIFrameSanitization:!1,mediaHolderClass:"media-holder",mediaHolderCallback:function(t,e,i,s){i.is("hr, img, figure")&&n.isEmpty(i.find("iframe"))&&s.addClass("media-holder-draggable"),s.addClass("media-holder-"+i.prop("tagName").toLowerCase())},mediaHolderEvents:{keydown:n.noop,keyup:n.noop,mousedown:n.noop,mouseup:n.noop,mouseenter:n.noop,mouseleave:n.noop,click:n.noop,dragstart:n.noop},imgKeyAttr:"data-img-key",imgSizeAttrs:{width:"data-orig-width",height:"data-orig-height"},addImgAttrs:{toImg:!1,toImgParent:!1},fakeClass:"fake",mediaKillerMarkup:"<div>×</div>",mediaMoverMarkup:"<div>&#8597;</div>",pasteHook:function(t,e){return!1},blurHook:function(t){return!1},documentMousedownHook:function(t){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr","pre","sub","sup","small"],attributes:{a:["href","title"],img:["src","alt","data-orig-width","data-orig-height"],hr:["data-label"],iframe:["src","width","height","frameborder"],figure:["data-orig-width","data-orig-height"]},classnames:{hr:["read-more"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},animateShowControls:function(t){t.element.show()},animateHideControls:function(t){t.element.hide()},linkConfig:{bypassClasses:[],labels:o.labels,onChange:function(){this.onChange.call(this)},onDismiss:function(){this.lastSelection&&(c.restoreSelection(this.lastSelection),O.call(this))}},inlineControlsConfig:{openTray:h.prototype.openTray,closeTray:h.prototype.closeTray,onTrayOpened:function(t){},onTrayClosed:function(t){},keyboardEvents:this.keyComboEvents},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:m("Bold","meta+b"),keyboard:"meta+b"},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:m("Italic","meta+i"),keyboard:"meta+i"},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:m("Headline","meta+shift+2"),keyboard:"meta+shift+2"},link:{el:"a",className:"link",command:"createLink",type:"inline",title:m("Link","meta+k"),keyboard:"meta+k"},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:m("Strikethrough","meta+shift+6"),keyboard:"meta+shift+6"},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:m("Ordered List","meta+shift+7"),keyboard:"meta+shift+7"},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:m("Unordered List","meta+shift+8"),keyboard:"meta+shift+8"},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:m("Blockquote","meta+shift+9"),keyboard:"meta+shift+9"},clear:{el:"",command:"removeFormat",type:"inline",keyboard:"meta+shift+0"},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:"meta+alt+1"},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:"meta+dot"},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:"meta+comma"},small:{el:"small",command:"insertHTML",type:"inline",keyboard:"meta+shift+minus",keyboardInverse:"meta+shift+plus"}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"],onShow:function(t){n.isFunction(this.animateShowControls)?this.animateShowControls.call(this,t):t.element.show()},onHide:function(t){n.isFunction(this.animateHideControls)?this.animateHideControls.call(this,t):t.element.hide()},onAction:function(t){var e=u.getNodeList();t.setActives(e)}},showStaticControls:!0},n.merge(this.config,o||{}),this.applyCommand=n.bind(P,this),this.inverseCommand=n.bind(F,this),this.animateShowControls=n.bind(this.config.animateShowControls,this),this.animateHideControls=n.bind(this.config.animateHideControls,this),this.onChange=function(t){var e=z.call(this);this.previousRawData!==e&&(B.call(this),this.config.onChange.call(this),this.previousRawData=e)};var b=t(this.config.linkConfig,this);this.linkControl=new r(b);var y=t(this.config.inlineControlsConfig,this);this.inlineControls=new h(y);var w=t(n.defaults({keyboardEvents:this.keyComboEvents},this.config.formattingControlsConfig),this);this.contextualControls=new a(this.applyCommand,this.inverseCommand,w);var k=this.config.formattingControlsConfig.onShow,C=this.config.formattingControlsConfig.onHide,x=t(n.defaults({onShow:function(t){k.apply(this,arguments),t.listener=t.listener||function(e){var i=u.getNodeList();t.setActives(i),document.removeEventListener("mousedown",t.listener,!1)},document.addEventListener("mousedown",t.listener)},onHide:function(t){C.apply(this,arguments),document.removeEventListener("mousedown",t.listener,!1)}},this.config.formattingControlsConfig),this);this.staticControls=new a(this.applyCommand,this.inverseCommand,x),this.dataFilter=new l(this.config.filterRules),this.keyModifiers={shift:!1,meta:!1},this.undoManager=new p(this,n.bind(function(){for(var t in this.mediaTracker){var e=this.mediaTracker[t].updatedSource;if(e){var i=X.call(this,t);s(i).attr("src",e)}}$.call(this)},this)),this.config.smartQuotes.enabled&&(this.smartQuoter=new _(this,this.config.smartQuotes.config)),this.mediaTracker={},e.call(this)};return wt.prototype.getData=function(t,e){var i=this,o=z.call(this);o=this.config.filterForGetData.call(this,o),this.config.runIFrameSanitization&&(o=this.dataFilter.unSanitizeIFrames(o));var r=document.createElement("div");if(r.innerHTML=o,rt.call(this,r),at.call(this,r),e||s(r).find("["+i.config.imgKeyAttr+"]").removeAttr(i.config.imgKeyAttr),t)for(var a=function(t){var e=s(r).children(":"+t+"-child").get(0);return e&&i.dataFilter.isEmptyElement(e,!0)?e:null},l=function(){return n.compact([a("first"),a("last")])};l().length;)n.forEach(l(),function(t){s(t).remove()});return r.innerHTML},wt.prototype.setData=function(t,e,i){e&&(t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterHTML(t)),this.config.runIFrameSanitization&&(t=this.dataFilter.sanitizeIFrames(t)),U.call(this,t),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyInlineNodes(this.element),K.call(this),lt.call(this),ot.call(this),G.call(this),this.onChange()},wt.prototype.insertData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),H.call(this,t),i&&this.dataFilter.flattenBlocksDown(u.getNearestElement()),this.onChange()},wt.prototype.blur=function(t){return t||C.call(this),s(this.element).blur()},wt.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},wt.prototype.hasFocus=function(){return s(this.element).is(":focus")},wt.prototype.setPlaceholder=function(t){this.config.placeholder=t,B.call(this)},wt.prototype.insertMedia=function(t,e,i,n){e&&(t=this.dataFilter.filterHTML(t)),tt.call(this,t,i,n),this.onChange()},wt.prototype.addControl=function(t){var e=s(this.wrapper).find("[data-js=control-bar]");e.append(t)},wt.prototype.isEmpty=function(){var t=z.call(this);return""===t||"<br>"===t||t===dt||t===pt},wt.prototype.getCurrentElement=function(){return u.getNearestElement()},wt.prototype.getAsyncImage=function(t){return X.call(this,t)},wt.prototype.insertAsyncImage=function(t,e,i,n,s){Q.call(this,t,e,i,n,s),this.onChange()},wt.prototype.updateAsyncImage=function(t,e,i){Z.call(this,t,e,i),this.onChange("updateAsyncImage")},wt.prototype.setCursorToStart=function(t,e){var i=s(this.element);t=t&&i.find(t).first().get(0)||i.children().first().get(0),t&&c.setToStart(t),e||O.call(this)},wt.prototype.setCursorToEnd=function(t,e){var i=s(this.element);t=t&&i.find(t).last().get(0)||i.children().last().get(0),t&&c.setToEnd(t),e||O.call(this)},wt.prototype.insertNewParagraphAfter=function(t,e){return ht.call(this,t,!1,e)},wt.prototype.insertNewParagraphBefore=function(t,e){return ht.call(this,t,!0,e)},wt.prototype.isEmptyElement=function(t){return t=t||q.call(this),this.dataFilter.isEmptyElement(t)},wt.prototype.hasSelection=function(t){return t=t||q.call(this),u.hasSelection(t)},wt.prototype.isCursorAtEnd=function(t){return t=t||q.call(this),u.isCursorAtEnd(t)},wt.prototype.isCursorAtStart=function(t){return t=t||q.call(this),u.isCursorAtStart(t)},wt.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},wt}();t.exports=b},function(t,e){/*! VelocityJS.org (1.4.3). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */
/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */
!function(t){"use strict";function e(t){var e=t.length,n=i.type(t);return"function"!==n&&!i.isWindow(t)&&(!(1!==t.nodeType||!e)||("array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t))}if(!t.jQuery){var i=function(t,e){return new i.fn.init(t,e)};i.isWindow=function(t){return t&&t===t.window},i.type=function(t){return t?"object"==typeof t||"function"==typeof t?s[r.call(t)]||"object":typeof t:t+""},i.isArray=Array.isArray||function(t){return"array"===i.type(t)},i.isPlainObject=function(t){var e;if(!t||"object"!==i.type(t)||t.nodeType||i.isWindow(t))return!1;try{if(t.constructor&&!o.call(t,"constructor")&&!o.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}for(e in t);return void 0===e||o.call(t,e)},i.each=function(t,i,n){var s,o=0,r=t.length,a=e(t);if(n){if(a)for(;o<r&&(s=i.apply(t[o],n),s!==!1);o++);else for(o in t)if(t.hasOwnProperty(o)&&(s=i.apply(t[o],n),s===!1))break}else if(a)for(;o<r&&(s=i.call(t[o],o,t[o]),s!==!1);o++);else for(o in t)if(t.hasOwnProperty(o)&&(s=i.call(t[o],o,t[o]),s===!1))break;return t},i.data=function(t,e,s){if(void 0===s){var o=t[i.expando],r=o&&n[o];if(void 0===e)return r;if(r&&e in r)return r[e]}else if(void 0!==e){var a=t[i.expando]||(t[i.expando]=++i.uuid);return n[a]=n[a]||{},n[a][e]=s,s}},i.removeData=function(t,e){var s=t[i.expando],o=s&&n[s];o&&(e?i.each(e,function(t,e){delete o[e]}):delete n[s])},i.extend=function(){var t,e,n,s,o,r,a=arguments[0]||{},l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[l]||{},l++),"object"!=typeof a&&"function"!==i.type(a)&&(a={}),l===c&&(a=this,l--);l<c;l++)if(o=arguments[l])for(s in o)o.hasOwnProperty(s)&&(t=a[s],n=o[s],a!==n&&(u&&n&&(i.isPlainObject(n)||(e=i.isArray(n)))?(e?(e=!1,r=t&&i.isArray(t)?t:[]):r=t&&i.isPlainObject(t)?t:{},a[s]=i.extend(u,r,n)):void 0!==n&&(a[s]=n)));return a},i.queue=function(t,n,s){function o(t,i){var n=i||[];return t&&(e(Object(t))?!function(t,e){for(var i=+e.length,n=0,s=t.length;n<i;)t[s++]=e[n++];if(i!==i)for(;void 0!==e[n];)t[s++]=e[n++];return t.length=s,t}(n,"string"==typeof t?[t]:t):[].push.call(n,t)),n}if(t){n=(n||"fx")+"queue";var r=i.data(t,n);return s?(!r||i.isArray(s)?r=i.data(t,n,o(s)):r.push(s),r):r||[]}},i.dequeue=function(t,e){i.each(t.nodeType?[t]:t,function(t,n){e=e||"fx";var s=i.queue(n,e),o=s.shift();"inprogress"===o&&(o=s.shift()),o&&("fx"===e&&s.unshift("inprogress"),o.call(n,function(){i.dequeue(n,e)}))})},i.fn=i.prototype={init:function(t){if(t.nodeType)return this[0]=t,this;throw new Error("Not a DOM node.")},offset:function(){var e=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:e.top+(t.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:e.left+(t.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function t(t){for(var e=t.offsetParent;e&&"html"!==e.nodeName.toLowerCase()&&e.style&&"static"===e.style.position;)e=e.offsetParent;return e||document}var e=this[0],n=t(e),s=this.offset(),o=/^(?:body|html)$/i.test(n.nodeName)?{top:0,left:0}:i(n).offset();return s.top-=parseFloat(e.style.marginTop)||0,s.left-=parseFloat(e.style.marginLeft)||0,n.style&&(o.top+=parseFloat(n.style.borderTopWidth)||0,o.left+=parseFloat(n.style.borderLeftWidth)||0),{top:s.top-o.top,left:s.left-o.left}}};var n={};i.expando="velocity"+(new Date).getTime(),i.uuid=0;for(var s={},o=s.hasOwnProperty,r=s.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),l=0;l<a.length;l++)s["[object "+a[l]+"]"]=a[l].toLowerCase();i.fn.init.prototype=i.fn,t.Velocity={Utilities:i}}}(window),function(e){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=e():"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";return function(t,e,i,n){function s(t){for(var e=-1,i=t?t.length:0,n=[];++e<i;){var s=t[e];s&&n.push(s)}return n}function o(t){return b.isWrapped(t)?t=v.call(t):b.isNode(t)&&(t=[t]),t}function r(t){var e=_.data(t,"velocity");return null===e?n:e}function a(t,e){var i=r(t);i&&i.delayTimer&&!i.delayPaused&&(i.delayRemaining=i.delay-e+i.delayBegin,i.delayPaused=!0,clearTimeout(i.delayTimer.setTimeout))}function l(t,e){var i=r(t);i&&i.delayTimer&&i.delayPaused&&(i.delayPaused=!1,i.delayTimer.setTimeout=setTimeout(i.delayTimer.next,i.delayRemaining))}function c(t){return function(e){return Math.round(e*t)*(1/t)}}function u(t,i,n,s){function o(t,e){return 1-3*e+3*t}function r(t,e){return 3*e-6*t}function a(t){return 3*t}function l(t,e,i){return((o(e,i)*t+r(e,i))*t+a(e))*t}function c(t,e,i){return 3*o(e,i)*t*t+2*r(e,i)*t+a(e)}function u(e,i){for(var s=0;s<g;++s){var o=c(i,t,n);if(0===o)return i;var r=l(i,t,n)-e;i-=r/o}return i}function h(){for(var e=0;e<b;++e)C[e]=l(e*y,t,n)}function d(e,i,s){var o,r,a=0;do r=i+(s-i)/2,o=l(r,t,n)-e,o>0?s=r:i=r;while(Math.abs(o)>m&&++a<v);return r}function p(e){for(var i=0,s=1,o=b-1;s!==o&&C[s]<=e;++s)i+=y;--s;var r=(e-C[s])/(C[s+1]-C[s]),a=i+r*y,l=c(a,t,n);return l>=f?u(e,a):0===l?a:d(e,i,i+y)}function _(){x=!0,t===i&&n===s||h()}var g=4,f=.001,m=1e-7,v=10,b=11,y=1/(b-1),w="Float32Array"in e;if(4!==arguments.length)return!1;for(var k=0;k<4;++k)if("number"!=typeof arguments[k]||isNaN(arguments[k])||!isFinite(arguments[k]))return!1;t=Math.min(t,1),n=Math.min(n,1),t=Math.max(t,0),n=Math.max(n,0);var C=w?new Float32Array(b):new Array(b),x=!1,S=function(e){return x||_(),t===i&&n===s?e:0===e?0:1===e?1:l(p(e),i,s)};S.getControlPoints=function(){return[{x:t,y:i},{x:n,y:s}]};var T="generateBezier("+[t,i,n,s]+")";return S.toString=function(){return T},S}function h(t,e){var i=t;return b.isString(t)?C.Easings[t]||(i=!1):i=b.isArray(t)&&1===t.length?c.apply(null,t):b.isArray(t)&&2===t.length?x.apply(null,t.concat([e])):!(!b.isArray(t)||4!==t.length)&&u.apply(null,t),i===!1&&(i=C.Easings[C.defaults.easing]?C.defaults.easing:k),i}function d(t){if(t){var e=C.timestamp&&t!==!0?t:m.now(),i=C.State.calls.length;i>1e4&&(C.State.calls=s(C.State.calls),i=C.State.calls.length);for(var o=0;o<i;o++)if(C.State.calls[o]){var a=C.State.calls[o],l=a[0],c=a[2],u=a[3],h=!!u,f=null,v=a[5],y=a[6];if(u||(u=C.State.calls[o][3]=e-16),v){if(v.resume!==!0)continue;u=a[3]=Math.round(e-y-16),a[5]=null}y=a[6]=e-u;for(var w=Math.min(y/c.duration,1),k=0,x=l.length;k<x;k++){var T=l[k],P=T.element;if(r(P)){var F=!1;if(c.display!==n&&null!==c.display&&"none"!==c.display){if("flex"===c.display){var I=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];_.each(I,function(t,e){S.setPropertyValue(P,"display",e)})}S.setPropertyValue(P,"display",c.display)}c.visibility!==n&&"hidden"!==c.visibility&&S.setPropertyValue(P,"visibility",c.visibility);for(var j in T)if(T.hasOwnProperty(j)&&"element"!==j){var A,M=T[j],N=b.isString(M.easing)?C.Easings[M.easing]:M.easing;if(b.isString(M.pattern)){var O=1===w?function(t,e,i){var n=M.endValue[e];return i?Math.round(n):n}:function(t,e,i){var n=M.startValue[e],s=M.endValue[e]-n,o=n+s*N(w,c,s);return i?Math.round(o):o};A=M.pattern.replace(/{(\d+)(!)?}/g,O)}else if(1===w)A=M.endValue;else{var R=M.endValue-M.startValue;A=M.startValue+R*N(w,c,R)}if(!h&&A===M.currentValue)continue;if(M.currentValue=A,"tween"===j)f=A;else{var D;if(S.Hooks.registered[j]){D=S.Hooks.getRoot(j);var $=r(P).rootPropertyValueCache[D];$&&(M.rootPropertyValue=$)}var B=S.setPropertyValue(P,j,M.currentValue+(g<9&&0===parseFloat(A)?"":M.unitType),M.rootPropertyValue,M.scrollData);S.Hooks.registered[j]&&(S.Normalizations.registered[D]?r(P).rootPropertyValueCache[D]=S.Normalizations.registered[D]("extract",null,B[1]):r(P).rootPropertyValueCache[D]=B[1]),"transform"===B[0]&&(F=!0)}}c.mobileHA&&r(P).transformCache.translate3d===n&&(r(P).transformCache.translate3d="(0px, 0px, 0px)",F=!0),F&&S.flushTransformCache(P)}}c.display!==n&&"none"!==c.display&&(C.State.calls[o][2].display=!1),c.visibility!==n&&"hidden"!==c.visibility&&(C.State.calls[o][2].visibility=!1),c.progress&&c.progress.call(a[1],a[1],w,Math.max(0,u+c.duration-e),u,f),1===w&&p(o)}}C.State.isTicking&&E(d)}function p(t,e){if(!C.State.calls[t])return!1;for(var i=C.State.calls[t][0],s=C.State.calls[t][1],o=C.State.calls[t][2],a=C.State.calls[t][4],l=!1,c=0,u=i.length;c<u;c++){var h=i[c].element;e||o.loop||("none"===o.display&&S.setPropertyValue(h,"display",o.display),"hidden"===o.visibility&&S.setPropertyValue(h,"visibility",o.visibility));var d=r(h);if(o.loop!==!0&&(_.queue(h)[1]===n||!/\.velocityQueueEntryFlag/i.test(_.queue(h)[1]))&&d){d.isAnimating=!1,d.rootPropertyValueCache={};var p=!1;_.each(S.Lists.transforms3D,function(t,e){var i=/^scale/.test(e)?1:0,s=d.transformCache[e];d.transformCache[e]!==n&&new RegExp("^\\("+i+"[^.]").test(s)&&(p=!0,delete d.transformCache[e])}),o.mobileHA&&(p=!0,delete d.transformCache.translate3d),p&&S.flushTransformCache(h),S.Values.removeClass(h,"velocity-animating")}if(!e&&o.complete&&!o.loop&&c===u-1)try{o.complete.call(s,s)}catch(t){setTimeout(function(){throw t},1)}a&&o.loop!==!0&&a(s),d&&o.loop===!0&&!e&&(_.each(d.tweensContainer,function(t,e){if(/^rotate/.test(t)&&(parseFloat(e.startValue)-parseFloat(e.endValue))%360===0){var i=e.startValue;e.startValue=e.endValue,e.endValue=i}/^backgroundPosition/.test(t)&&100===parseFloat(e.endValue)&&"%"===e.unitType&&(e.endValue=0,e.startValue=100)}),C(h,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&_.dequeue(h,o.queue)}C.State.calls[t]=!1;for(var g=0,f=C.State.calls.length;g<f;g++)if(C.State.calls[g]!==!1){l=!0;break}l===!1&&(C.State.isTicking=!1,delete C.State.calls,C.State.calls=[])}var _,g=function(){if(i.documentMode)return i.documentMode;for(var t=7;t>4;t--){var e=i.createElement("div");if(e.innerHTML="<!--[if IE "+t+"]><span></span><![endif]-->",e.getElementsByTagName("span").length)return e=null,t}return n}(),f=function(){var t=0;return e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){var i,n=(new Date).getTime();return i=Math.max(0,16-(n-t)),t=n+i,setTimeout(function(){e(n+i)},i)}}(),m=function(){var t=e.performance||{};if(!Object.prototype.hasOwnProperty.call(t,"now")){var i=t.timing&&t.timing.domComplete?t.timing.domComplete:(new Date).getTime();t.now=function(){return(new Date).getTime()-i}}return t}(),v=function(){var t=Array.prototype.slice;try{t.call(i.documentElement)}catch(e){t=function(){for(var t=this.length,e=[];--t>0;)e[t]=this[t];return e}}return t}(),b={isNumber:function(t){return"number"==typeof t},isString:function(t){return"string"==typeof t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},isNode:function(t){return t&&t.nodeType},isWrapped:function(t){return t&&b.isNumber(t.length)&&!b.isString(t)&&!b.isFunction(t)&&!b.isNode(t)&&(0===t.length||b.isNode(t[0]))},isSVG:function(t){return e.SVGElement&&t instanceof e.SVGElement},isEmptyObject:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}},y=!1;if(t.fn&&t.fn.jquery?(_=t,y=!0):_=e.Velocity.Utilities,g<=8&&!y)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(g<=7)return void(jQuery.fn.velocity=jQuery.fn.animate);var w=400,k="swing",C={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:e.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:i.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[],delayedElements:{count:0}},CSS:{},Utilities:_,Redirects:{},Easings:{},Promise:e.Promise,defaults:{queue:"",duration:w,easing:k,begin:n,complete:n,progress:n,display:n,visibility:n,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0,promiseRejectEmpty:!0},init:function(t){_.data(t,"velocity",{isSVG:b.isSVG(t),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:4,patch:3},debug:!1,timestamp:!0,pauseAll:function(t){var e=(new Date).getTime();_.each(C.State.calls,function(e,i){if(i){if(t!==n&&(i[2].queue!==t||i[2].queue===!1))return!0;i[5]={resume:!1}}}),_.each(C.State.delayedElements,function(t,i){i&&a(i,e)})},resumeAll:function(t){var e=(new Date).getTime();_.each(C.State.calls,function(e,i){if(i){if(t!==n&&(i[2].queue!==t||i[2].queue===!1))return!0;i[5]&&(i[5].resume=!0)}}),_.each(C.State.delayedElements,function(t,i){i&&l(i,e)})}};e.pageYOffset!==n?(C.State.scrollAnchor=e,C.State.scrollPropertyLeft="pageXOffset",C.State.scrollPropertyTop="pageYOffset"):(C.State.scrollAnchor=i.documentElement||i.body.parentNode||i.body,C.State.scrollPropertyLeft="scrollLeft",C.State.scrollPropertyTop="scrollTop");var x=function(){function t(t){return-t.tension*t.x-t.friction*t.v}function e(e,i,n){var s={x:e.x+n.dx*i,v:e.v+n.dv*i,tension:e.tension,friction:e.friction};return{dx:s.v,dv:t(s)}}function i(i,n){var s={dx:i.v,dv:t(i)},o=e(i,.5*n,s),r=e(i,.5*n,o),a=e(i,n,r),l=1/6*(s.dx+2*(o.dx+r.dx)+a.dx),c=1/6*(s.dv+2*(o.dv+r.dv)+a.dv);return i.x=i.x+l*n,i.v=i.v+c*n,i}return function t(e,n,s){var o,r,a,l={x:-1,v:0,tension:null,friction:null},c=[0],u=0,h=1e-4,d=.016;for(e=parseFloat(e)||500,n=parseFloat(n)||20,s=s||null,l.tension=e,l.friction=n,o=null!==s,o?(u=t(e,n),r=u/s*d):r=d;;)if(a=i(a||l,r),c.push(1+a.x),u+=16,!(Math.abs(a.x)>h&&Math.abs(a.v)>h))break;return o?function(t){return c[t*(c.length-1)|0]}:u}}();C.Easings={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},spring:function(t){return 1-Math.cos(4.5*t*Math.PI)*Math.exp(6*-t)}},_.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(t,e){C.Easings[e[0]]=u.apply(null,e[1])});var S=C.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"],units:["%","em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","Q","in","pc","pt","px","deg","grad","rad","turn","s","ms"],colorNames:{aliceblue:"240,248,255",antiquewhite:"250,235,215",aquamarine:"127,255,212",aqua:"0,255,255",azure:"240,255,255",beige:"245,245,220",bisque:"255,228,196",black:"0,0,0",blanchedalmond:"255,235,205",blueviolet:"138,43,226",blue:"0,0,255",brown:"165,42,42",burlywood:"222,184,135",cadetblue:"95,158,160",chartreuse:"127,255,0",chocolate:"210,105,30",coral:"255,127,80",cornflowerblue:"100,149,237",cornsilk:"255,248,220",crimson:"220,20,60",cyan:"0,255,255",darkblue:"0,0,139",darkcyan:"0,139,139",darkgoldenrod:"184,134,11",darkgray:"169,169,169",darkgrey:"169,169,169",darkgreen:"0,100,0",darkkhaki:"189,183,107",darkmagenta:"139,0,139",darkolivegreen:"85,107,47",darkorange:"255,140,0",darkorchid:"153,50,204",darkred:"139,0,0",darksalmon:"233,150,122",darkseagreen:"143,188,143",darkslateblue:"72,61,139",darkslategray:"47,79,79",darkturquoise:"0,206,209",darkviolet:"148,0,211",deeppink:"255,20,147",deepskyblue:"0,191,255",dimgray:"105,105,105",dimgrey:"105,105,105",dodgerblue:"30,144,255",firebrick:"178,34,34",floralwhite:"255,250,240",forestgreen:"34,139,34",fuchsia:"255,0,255",gainsboro:"220,220,220",ghostwhite:"248,248,255",gold:"255,215,0",goldenrod:"218,165,32",gray:"128,128,128",grey:"128,128,128",greenyellow:"173,255,47",green:"0,128,0",honeydew:"240,255,240",hotpink:"255,105,180",indianred:"205,92,92",indigo:"75,0,130",ivory:"255,255,240",khaki:"240,230,140",lavenderblush:"255,240,245",lavender:"230,230,250",lawngreen:"124,252,0",lemonchiffon:"255,250,205",lightblue:"173,216,230",lightcoral:"240,128,128",lightcyan:"224,255,255",lightgoldenrodyellow:"250,250,210",lightgray:"211,211,211",lightgrey:"211,211,211",lightgreen:"144,238,144",lightpink:"255,182,193",lightsalmon:"255,160,122",lightseagreen:"32,178,170",lightskyblue:"135,206,250",lightslategray:"119,136,153",lightsteelblue:"176,196,222",lightyellow:"255,255,224",limegreen:"50,205,50",lime:"0,255,0",linen:"250,240,230",magenta:"255,0,255",maroon:"128,0,0",mediumaquamarine:"102,205,170",mediumblue:"0,0,205",mediumorchid:"186,85,211",mediumpurple:"147,112,219",mediumseagreen:"60,179,113",mediumslateblue:"123,104,238",mediumspringgreen:"0,250,154",mediumturquoise:"72,209,204",mediumvioletred:"199,21,133",midnightblue:"25,25,112",mintcream:"245,255,250",mistyrose:"255,228,225",moccasin:"255,228,181",navajowhite:"255,222,173",navy:"0,0,128",oldlace:"253,245,230",olivedrab:"107,142,35",olive:"128,128,0",orangered:"255,69,0",orange:"255,165,0",orchid:"218,112,214",palegoldenrod:"238,232,170",palegreen:"152,251,152",paleturquoise:"175,238,238",palevioletred:"219,112,147",papayawhip:"255,239,213",peachpuff:"255,218,185",peru:"205,133,63",pink:"255,192,203",plum:"221,160,221",powderblue:"176,224,230",purple:"128,0,128",red:"255,0,0",rosybrown:"188,143,143",royalblue:"65,105,225",saddlebrown:"139,69,19",salmon:"250,128,114",sandybrown:"244,164,96",seagreen:"46,139,87",seashell:"255,245,238",sienna:"160,82,45",silver:"192,192,192",skyblue:"135,206,235",slateblue:"106,90,205",slategray:"112,128,144",snow:"255,250,250",springgreen:"0,255,127",steelblue:"70,130,180",tan:"210,180,140",teal:"0,128,128",thistle:"216,191,216",tomato:"255,99,71",turquoise:"64,224,208",violet:"238,130,238",wheat:"245,222,179",whitesmoke:"245,245,245",white:"255,255,255",yellowgreen:"154,205,50",yellow:"255,255,0"}},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var t=0;t<S.Lists.colors.length;t++){var e="color"===S.Lists.colors[t]?"0 0 0 1":"255 255 255 1";S.Hooks.templates[S.Lists.colors[t]]=["Red Green Blue Alpha",e]}var i,n,s;if(g)for(i in S.Hooks.templates)if(S.Hooks.templates.hasOwnProperty(i)){n=S.Hooks.templates[i],s=n[0].split(" ");var o=n[1].match(S.RegEx.valueSplit);"Color"===s[0]&&(s.push(s.shift()),o.push(o.shift()),S.Hooks.templates[i]=[s.join(" "),o.join(" ")])}for(i in S.Hooks.templates)if(S.Hooks.templates.hasOwnProperty(i)){n=S.Hooks.templates[i],s=n[0].split(" ");for(var r in s)if(s.hasOwnProperty(r)){var a=i+s[r],l=r;S.Hooks.registered[a]=[i,l]}}},getRoot:function(t){var e=S.Hooks.registered[t];return e?e[0]:t},getUnit:function(t,e){var i=(t.substr(e||0,5).match(/^[a-z%]+/)||[])[0]||"";return i&&S.Lists.units.indexOf(i)>=0?i:""},fixColors:function(t){return t.replace(/(rgba?\(\s*)?(\b[a-z]+\b)/g,function(t,e,i){return S.Lists.colorNames.hasOwnProperty(i)?(e?e:"rgba(")+S.Lists.colorNames[i]+(e?"":",1)"):e+i})},cleanRootPropertyValue:function(t,e){return S.RegEx.valueUnwrap.test(e)&&(e=e.match(S.RegEx.valueUnwrap)[1]),S.Values.isCSSNullValue(e)&&(e=S.Hooks.templates[t][1]),e},extractValue:function(t,e){var i=S.Hooks.registered[t];if(i){var n=i[0],s=i[1];return e=S.Hooks.cleanRootPropertyValue(n,e),e.toString().match(S.RegEx.valueSplit)[s]}return e},injectValue:function(t,e,i){var n=S.Hooks.registered[t];if(n){var s,o,r=n[0],a=n[1];return i=S.Hooks.cleanRootPropertyValue(r,i),s=i.toString().match(S.RegEx.valueSplit),s[a]=e,o=s.join(" ")}return i}},Normalizations:{registered:{clip:function(t,e,i){switch(t){case"name":return"clip";case"extract":var n;return S.RegEx.wrappedValueAlreadyExtracted.test(i)?n=i:(n=i.toString().match(S.RegEx.valueUnwrap),n=n?n[1].replace(/,(\s+)?/g," "):i),n;case"inject":return"rect("+i+")"}},blur:function(t,e,i){switch(t){case"name":return C.State.isFirefox?"filter":"-webkit-filter";case"extract":var n=parseFloat(i);if(!n&&0!==n){var s=i.toString().match(/blur\(([0-9]+[A-z]+)\)/i);n=s?s[1]:0}return n;case"inject":return parseFloat(i)?"blur("+i+")":"none"}},opacity:function(t,e,i){if(g<=8)switch(t){case"name":return"filter";case"extract":var n=i.toString().match(/alpha\(opacity=(.*)\)/i);return i=n?n[1]/100:1;case"inject":return e.style.zoom=1,parseFloat(i)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(i),10)+")"}else switch(t){case"name":return"opacity";case"extract":return i;case"inject":return i}}},register:function(){function t(t,e,i){var n="border-box"===S.getPropertyValue(e,"boxSizing").toString().toLowerCase();if(n===(i||!1)){var s,o,r=0,a="width"===t?["Left","Right"]:["Top","Bottom"],l=["padding"+a[0],"padding"+a[1],"border"+a[0]+"Width","border"+a[1]+"Width"];for(s=0;s<l.length;s++)o=parseFloat(S.getPropertyValue(e,l[s])),isNaN(o)||(r+=o);return i?-r:r}return 0}function e(e,i){return function(n,s,o){switch(n){case"name":return e;case"extract":return parseFloat(o)+t(e,s,i);case"inject":return parseFloat(o)-t(e,s,i)+"px"}}}g&&!(g>9)||C.State.isGingerbread||(S.Lists.transformsBase=S.Lists.transformsBase.concat(S.Lists.transforms3D));for(var i=0;i<S.Lists.transformsBase.length;i++)!function(){var t=S.Lists.transformsBase[i];S.Normalizations.registered[t]=function(e,i,s){switch(e){case"name":return"transform";case"extract":return r(i)===n||r(i).transformCache[t]===n?/^scale/i.test(t)?1:0:r(i).transformCache[t].replace(/[()]/g,"");case"inject":var o=!1;switch(t.substr(0,t.length-1)){case"translate":o=!/(%|px|em|rem|vw|vh|\d)$/i.test(s);break;case"scal":case"scale":C.State.isAndroid&&r(i).transformCache[t]===n&&s<1&&(s=1),o=!/(\d)$/i.test(s);break;case"skew":o=!/(deg|\d)$/i.test(s);break;case"rotate":o=!/(deg|\d)$/i.test(s)}return o||(r(i).transformCache[t]="("+s+")"),r(i).transformCache[t]}}}();for(var s=0;s<S.Lists.colors.length;s++)!function(){var t=S.Lists.colors[s];S.Normalizations.registered[t]=function(e,i,s){switch(e){case"name":return t;case"extract":var o;if(S.RegEx.wrappedValueAlreadyExtracted.test(s))o=s;else{var r,a={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(s)?r=a[s]!==n?a[s]:a.black:S.RegEx.isHex.test(s)?r="rgb("+S.Values.hexToRgb(s).join(" ")+")":/^rgba?\(/i.test(s)||(r=a.black),o=(r||s).toString().match(S.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return(!g||g>8)&&3===o.split(" ").length&&(o+=" 1"),o;case"inject":return/^rgb/.test(s)?s:(g<=8?4===s.split(" ").length&&(s=s.split(/\s+/).slice(0,3).join(" ")):3===s.split(" ").length&&(s+=" 1"),(g<=8?"rgb":"rgba")+"("+s.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")")}}}();S.Normalizations.registered.innerWidth=e("width",!0),S.Normalizations.registered.innerHeight=e("height",!0),S.Normalizations.registered.outerWidth=e("width"),S.Normalizations.registered.outerHeight=e("height")}},Names:{camelCase:function(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})},SVGAttribute:function(t){var e="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(g||C.State.isAndroid&&!C.State.isChrome)&&(e+="|transform"),new RegExp("^("+e+")$","i").test(t)},prefixCheck:function(t){if(C.State.prefixMatches[t])return[C.State.prefixMatches[t],!0];for(var e=["","Webkit","Moz","ms","O"],i=0,n=e.length;i<n;i++){var s;if(s=0===i?t:e[i]+t.replace(/^\w/,function(t){return t.toUpperCase()}),b.isString(C.State.prefixElement.style[s]))return C.State.prefixMatches[t]=s,[s,!0]}return[t,!1]}},Values:{hexToRgb:function(t){var e,i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return t=t.replace(i,function(t,e,i,n){return e+e+i+i+n+n}),e=n.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[0,0,0]},isCSSNullValue:function(t){return!t||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(t)},getUnitType:function(t){return/^(rotate|skew)/i.test(t)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(t)?"":"px"},getDisplayType:function(t){var e=t&&t.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(e)?"inline":/^(li)$/i.test(e)?"list-item":/^(tr)$/i.test(e)?"table-row":/^(table)$/i.test(e)?"table":/^(tbody)$/i.test(e)?"table-row-group":"block"},addClass:function(t,e){if(t)if(t.classList)t.classList.add(e);else if(b.isString(t.className))t.className+=(t.className.length?" ":"")+e;else{var i=t.getAttribute(g<=7?"className":"class")||"";t.setAttribute("class",i+(i?" ":"")+e)}},removeClass:function(t,e){if(t)if(t.classList)t.classList.remove(e);else if(b.isString(t.className))t.className=t.className.toString().replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," ");else{var i=t.getAttribute(g<=7?"className":"class")||"";t.setAttribute("class",i.replace(new RegExp("(^|s)"+e.split(" ").join("|")+"(s|$)","gi")," "))}}},getPropertyValue:function(t,i,s,o){function a(t,i){var s=0;if(g<=8)s=_.css(t,i);else{var l=!1;/^(width|height)$/.test(i)&&0===S.getPropertyValue(t,"display")&&(l=!0,S.setPropertyValue(t,"display",S.Values.getDisplayType(t)));var c=function(){l&&S.setPropertyValue(t,"display","none")};if(!o){if("height"===i&&"border-box"!==S.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var u=t.offsetHeight-(parseFloat(S.getPropertyValue(t,"borderTopWidth"))||0)-(parseFloat(S.getPropertyValue(t,"borderBottomWidth"))||0)-(parseFloat(S.getPropertyValue(t,"paddingTop"))||0)-(parseFloat(S.getPropertyValue(t,"paddingBottom"))||0);return c(),u}if("width"===i&&"border-box"!==S.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var h=t.offsetWidth-(parseFloat(S.getPropertyValue(t,"borderLeftWidth"))||0)-(parseFloat(S.getPropertyValue(t,"borderRightWidth"))||0)-(parseFloat(S.getPropertyValue(t,"paddingLeft"))||0)-(parseFloat(S.getPropertyValue(t,"paddingRight"))||0);return c(),h}}var d;d=r(t)===n?e.getComputedStyle(t,null):r(t).computedStyle?r(t).computedStyle:r(t).computedStyle=e.getComputedStyle(t,null),"borderColor"===i&&(i="borderTopColor"),s=9===g&&"filter"===i?d.getPropertyValue(i):d[i],""!==s&&null!==s||(s=t.style[i]),c()}if("auto"===s&&/^(top|right|bottom|left)$/i.test(i)){var p=a(t,"position");("fixed"===p||"absolute"===p&&/top|left/i.test(i))&&(s=_(t).position()[i]+"px")}return s}var l;if(S.Hooks.registered[i]){var c=i,u=S.Hooks.getRoot(c);s===n&&(s=S.getPropertyValue(t,S.Names.prefixCheck(u)[0])),S.Normalizations.registered[u]&&(s=S.Normalizations.registered[u]("extract",t,s)),l=S.Hooks.extractValue(c,s)}else if(S.Normalizations.registered[i]){var h,d;h=S.Normalizations.registered[i]("name",t),"transform"!==h&&(d=a(t,S.Names.prefixCheck(h)[0]),S.Values.isCSSNullValue(d)&&S.Hooks.templates[i]&&(d=S.Hooks.templates[i][1])),l=S.Normalizations.registered[i]("extract",t,d)}if(!/^[\d-]/.test(l)){var p=r(t);if(p&&p.isSVG&&S.Names.SVGAttribute(i))if(/^(height|width)$/i.test(i))try{l=t.getBBox()[i]}catch(t){l=0}else l=t.getAttribute(i);else l=a(t,S.Names.prefixCheck(i)[0])}return S.Values.isCSSNullValue(l)&&(l=0),C.debug>=2&&console.log("Get "+i+": "+l),l},setPropertyValue:function(t,i,n,s,o){var a=i;if("scroll"===i)o.container?o.container["scroll"+o.direction]=n:"Left"===o.direction?e.scrollTo(n,o.alternateValue):e.scrollTo(o.alternateValue,n);else if(S.Normalizations.registered[i]&&"transform"===S.Normalizations.registered[i]("name",t))S.Normalizations.registered[i]("inject",t,n),a="transform",n=r(t).transformCache[i];else{if(S.Hooks.registered[i]){var l=i,c=S.Hooks.getRoot(i);s=s||S.getPropertyValue(t,c),n=S.Hooks.injectValue(l,n,s),i=c}if(S.Normalizations.registered[i]&&(n=S.Normalizations.registered[i]("inject",t,n),i=S.Normalizations.registered[i]("name",t)),a=S.Names.prefixCheck(i)[0],g<=8)try{t.style[a]=n}catch(t){C.debug&&console.log("Browser does not support ["+n+"] for ["+a+"]")}else{var u=r(t);u&&u.isSVG&&S.Names.SVGAttribute(i)?t.setAttribute(i,n):t.style[a]=n}C.debug>=2&&console.log("Set "+i+" ("+a+"): "+n)}return[a,n]},flushTransformCache:function(t){var e="",i=r(t);if((g||C.State.isAndroid&&!C.State.isChrome)&&i&&i.isSVG){var n=function(e){return parseFloat(S.getPropertyValue(t,e))},s={translate:[n("translateX"),n("translateY")],skewX:[n("skewX")],skewY:[n("skewY")],scale:1!==n("scale")?[n("scale"),n("scale")]:[n("scaleX"),n("scaleY")],rotate:[n("rotateZ"),0,0]};_.each(r(t).transformCache,function(t){/^translate/i.test(t)?t="translate":/^scale/i.test(t)?t="scale":/^rotate/i.test(t)&&(t="rotate"),s[t]&&(e+=t+"("+s[t].join(" ")+") ",delete s[t])})}else{var o,a;_.each(r(t).transformCache,function(i){return o=r(t).transformCache[i],"transformPerspective"===i?(a=o,!0):(9===g&&"rotateZ"===i&&(i="rotate"),void(e+=i+o+" "))}),a&&(e="perspective"+a+" "+e)}S.setPropertyValue(t,"transform",e)}};S.Hooks.register(),S.Normalizations.register(),C.hook=function(t,e,i){var s;return t=o(t),_.each(t,function(t,o){if(r(o)===n&&C.init(o),i===n)s===n&&(s=S.getPropertyValue(o,e));else{var a=S.setPropertyValue(o,e,i);"transform"===a[0]&&C.CSS.flushTransformCache(o),s=a}}),s};var T=function(){function t(){return u?x.promise||null:g}function s(t,s){function o(o){var u,p;if(l.begin&&0===P)try{l.begin.call(m,m)}catch(t){setTimeout(function(){throw t},1)}if("scroll"===j){var g,f,w,k=/^x$/i.test(l.axis)?"Left":"Top",T=parseFloat(l.offset)||0;l.container?b.isWrapped(l.container)||b.isNode(l.container)?(l.container=l.container[0]||l.container,g=l.container["scroll"+k],w=g+_(t).position()[k.toLowerCase()]+T):l.container=null:(g=C.State.scrollAnchor[C.State["scrollProperty"+k]],f=C.State.scrollAnchor[C.State["scrollProperty"+("Left"===k?"Top":"Left")]],w=_(t).offset()[k.toLowerCase()]+T),c={scroll:{rootPropertyValue:!1,startValue:g,currentValue:g,endValue:w,unitType:"",easing:l.easing,scrollData:{container:l.container,direction:k,alternateValue:f}},element:t},C.debug&&console.log("tweensContainer (scroll): ",c.scroll,t)}else if("reverse"===j){if(u=r(t),!u)return;if(!u.tweensContainer)return void _.dequeue(t,l.queue);"none"===u.opts.display&&(u.opts.display="auto"),"hidden"===u.opts.visibility&&(u.opts.visibility="visible"),u.opts.loop=!1,u.opts.begin=null,u.opts.complete=null,y.easing||delete l.easing,y.duration||delete l.duration,l=_.extend({},u.opts,l),p=_.extend(!0,{},u?u.tweensContainer:null);for(var F in p)if(p.hasOwnProperty(F)&&"element"!==F){var I=p[F].startValue;p[F].startValue=p[F].currentValue=p[F].endValue,p[F].endValue=I,b.isEmptyObject(y)||(p[F].easing=l.easing),C.debug&&console.log("reverse tweensContainer ("+F+"): "+JSON.stringify(p[F]),t)}c=p}else if("start"===j){u=r(t),u&&u.tweensContainer&&u.isAnimating===!0&&(p=u.tweensContainer);var A=function(e,i){var n,o,r;return b.isFunction(e)&&(e=e.call(t,s,E)),b.isArray(e)?(n=e[0],!b.isArray(e[1])&&/^[\d-]/.test(e[1])||b.isFunction(e[1])||S.RegEx.isHex.test(e[1])?r=e[1]:b.isString(e[1])&&!S.RegEx.isHex.test(e[1])&&C.Easings[e[1]]||b.isArray(e[1])?(o=i?e[1]:h(e[1],l.duration),r=e[2]):r=e[1]||e[2]):n=e,i||(o=o||l.easing),b.isFunction(n)&&(n=n.call(t,s,E)),b.isFunction(r)&&(r=r.call(t,s,E)),[n||0,o,r]},M=function(s,o){var r,h=S.Hooks.getRoot(s),d=!1,g=o[0],f=o[1],m=o[2];if(!(u&&u.isSVG||"tween"===h||S.Names.prefixCheck(h)[1]!==!1||S.Normalizations.registered[h]!==n))return void(C.debug&&console.log("Skipping ["+h+"] due to a lack of browser support."));
(l.display!==n&&null!==l.display&&"none"!==l.display||l.visibility!==n&&"hidden"!==l.visibility)&&/opacity|filter/.test(s)&&!m&&0!==g&&(m=0),l._cacheValues&&p&&p[s]?(m===n&&(m=p[s].endValue+p[s].unitType),d=u.rootPropertyValueCache[h]):S.Hooks.registered[s]?m===n?(d=S.getPropertyValue(t,h),m=S.getPropertyValue(t,s,d)):d=S.Hooks.templates[h][1]:m===n&&(m=S.getPropertyValue(t,s));var v,y,w,k=!1,x=function(t,e){var i,n;return n=(e||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(t){return i=t,""}),i||(i=S.Values.getUnitType(t)),[n,i]};if(m!==g&&b.isString(m)&&b.isString(g)){r="";var T=0,E=0,P=[],F=[],I=0,j=0,A=0;for(m=S.Hooks.fixColors(m),g=S.Hooks.fixColors(g);T<m.length&&E<g.length;){var M=m[T],N=g[E];if(/[\d\.-]/.test(M)&&/[\d\.-]/.test(N)){for(var O=M,R=N,$=".",B=".";++T<m.length;){if(M=m[T],M===$)$="..";else if(!/\d/.test(M))break;O+=M}for(;++E<g.length;){if(N=g[E],N===B)B="..";else if(!/\d/.test(N))break;R+=N}var L=S.Hooks.getUnit(m,T),V=S.Hooks.getUnit(g,E);if(T+=L.length,E+=V.length,L===V)O===R?r+=O+L:(r+="{"+P.length+(j?"!":"")+"}"+L,P.push(parseFloat(O)),F.push(parseFloat(R)));else{var U=parseFloat(O),z=parseFloat(R);r+=(I<5?"calc":"")+"("+(U?"{"+P.length+(j?"!":"")+"}":"0")+L+" + "+(z?"{"+(P.length+(U?1:0))+(j?"!":"")+"}":"0")+V+")",U&&(P.push(U),F.push(0)),z&&(P.push(0),F.push(z))}}else{if(M!==N){I=0;break}r+=M,T++,E++,0===I&&"c"===M||1===I&&"a"===M||2===I&&"l"===M||3===I&&"c"===M||I>=4&&"("===M?I++:(I&&I<5||I>=4&&")"===M&&--I<5)&&(I=0),0===j&&"r"===M||1===j&&"g"===M||2===j&&"b"===M||3===j&&"a"===M||j>=3&&"("===M?(3===j&&"a"===M&&(A=1),j++):A&&","===M?++A>3&&(j=A=0):(A&&j<(A?5:4)||j>=(A?4:3)&&")"===M&&--j<(A?5:4))&&(j=A=0)}}T===m.length&&E===g.length||(C.debug&&console.error('Trying to pattern match mis-matched strings ["'+g+'", "'+m+'"]'),r=n),r&&(P.length?(C.debug&&console.log('Pattern found "'+r+'" -> ',P,F,"["+m+","+g+"]"),m=P,g=F,y=w=""):r=n)}r||(v=x(s,m),m=v[0],w=v[1],v=x(s,g),g=v[0].replace(/^([+-\/*])=/,function(t,e){return k=e,""}),y=v[1],m=parseFloat(m)||0,g=parseFloat(g)||0,"%"===y&&(/^(fontSize|lineHeight)$/.test(s)?(g/=100,y="em"):/^scale/.test(s)?(g/=100,y=""):/(Red|Green|Blue)$/i.test(s)&&(g=g/100*255,y="")));var H=function(){var n={myParent:t.parentNode||i.body,position:S.getPropertyValue(t,"position"),fontSize:S.getPropertyValue(t,"fontSize")},s=n.position===D.lastPosition&&n.myParent===D.lastParent,o=n.fontSize===D.lastFontSize;D.lastParent=n.myParent,D.lastPosition=n.position,D.lastFontSize=n.fontSize;var r=100,a={};if(o&&s)a.emToPx=D.lastEmToPx,a.percentToPxWidth=D.lastPercentToPxWidth,a.percentToPxHeight=D.lastPercentToPxHeight;else{var l=u&&u.isSVG?i.createElementNS("http://www.w3.org/2000/svg","rect"):i.createElement("div");C.init(l),n.myParent.appendChild(l),_.each(["overflow","overflowX","overflowY"],function(t,e){C.CSS.setPropertyValue(l,e,"hidden")}),C.CSS.setPropertyValue(l,"position",n.position),C.CSS.setPropertyValue(l,"fontSize",n.fontSize),C.CSS.setPropertyValue(l,"boxSizing","content-box"),_.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(t,e){C.CSS.setPropertyValue(l,e,r+"%")}),C.CSS.setPropertyValue(l,"paddingLeft",r+"em"),a.percentToPxWidth=D.lastPercentToPxWidth=(parseFloat(S.getPropertyValue(l,"width",null,!0))||1)/r,a.percentToPxHeight=D.lastPercentToPxHeight=(parseFloat(S.getPropertyValue(l,"height",null,!0))||1)/r,a.emToPx=D.lastEmToPx=(parseFloat(S.getPropertyValue(l,"paddingLeft"))||1)/r,n.myParent.removeChild(l)}return null===D.remToPx&&(D.remToPx=parseFloat(S.getPropertyValue(i.body,"fontSize"))||16),null===D.vwToPx&&(D.vwToPx=parseFloat(e.innerWidth)/100,D.vhToPx=parseFloat(e.innerHeight)/100),a.remToPx=D.remToPx,a.vwToPx=D.vwToPx,a.vhToPx=D.vhToPx,C.debug>=1&&console.log("Unit ratios: "+JSON.stringify(a),t),a};if(/[\/*]/.test(k))y=w;else if(w!==y&&0!==m)if(0===g)y=w;else{a=a||H();var q=/margin|padding|left|right|width|text|word|letter/i.test(s)||/X$/.test(s)||"x"===s?"x":"y";switch(w){case"%":m*="x"===q?a.percentToPxWidth:a.percentToPxHeight;break;case"px":break;default:m*=a[w+"ToPx"]}switch(y){case"%":m*=1/("x"===q?a.percentToPxWidth:a.percentToPxHeight);break;case"px":break;default:m*=1/a[y+"ToPx"]}}switch(k){case"+":g=m+g;break;case"-":g=m-g;break;case"*":g*=m;break;case"/":g=m/g}c[s]={rootPropertyValue:d,startValue:m,currentValue:m,endValue:g,unitType:y,easing:f},r&&(c[s].pattern=r),C.debug&&console.log("tweensContainer ("+s+"): "+JSON.stringify(c[s]),t)};for(var N in v)if(v.hasOwnProperty(N)){var O=S.Names.camelCase(N),R=A(v[N]);if(S.Lists.colors.indexOf(O)>=0){var B=R[0],L=R[1],V=R[2];if(S.RegEx.isHex.test(B)){for(var U=["Red","Green","Blue"],z=S.Values.hexToRgb(B),H=V?S.Values.hexToRgb(V):n,q=0;q<U.length;q++){var W=[z[q]];L&&W.push(L),H!==n&&W.push(H[q]),M(O+U[q],W)}continue}}M(O,R)}c.element=t}c.element&&(S.Values.addClass(t,"velocity-animating"),$.push(c),u=r(t),u&&(""===l.queue&&(u.tweensContainer=c,u.opts=l),u.isAnimating=!0),P===E-1?(C.State.calls.push([$,m,l,null,x.resolver,null,0]),C.State.isTicking===!1&&(C.State.isTicking=!0,d())):P++)}var a,l=_.extend({},C.defaults,y),c={};switch(r(t)===n&&C.init(t),parseFloat(l.delay)&&l.queue!==!1&&_.queue(t,l.queue,function(e){C.velocityQueueEntryFlag=!0;var i=C.State.delayedElements.count++;C.State.delayedElements[i]=t;var n=function(t){return function(){C.State.delayedElements[t]=!1,e()}}(i);r(t).delayBegin=(new Date).getTime(),r(t).delay=parseFloat(l.delay),r(t).delayTimer={setTimeout:setTimeout(e,parseFloat(l.delay)),next:n}}),l.duration.toString().toLowerCase()){case"fast":l.duration=200;break;case"normal":l.duration=w;break;case"slow":l.duration=600;break;default:l.duration=parseFloat(l.duration)||1}if(C.mock!==!1&&(C.mock===!0?l.duration=l.delay=1:(l.duration*=parseFloat(C.mock)||1,l.delay*=parseFloat(C.mock)||1)),l.easing=h(l.easing,l.duration),l.begin&&!b.isFunction(l.begin)&&(l.begin=null),l.progress&&!b.isFunction(l.progress)&&(l.progress=null),l.complete&&!b.isFunction(l.complete)&&(l.complete=null),l.display!==n&&null!==l.display&&(l.display=l.display.toString().toLowerCase(),"auto"===l.display&&(l.display=C.CSS.Values.getDisplayType(t))),l.visibility!==n&&null!==l.visibility&&(l.visibility=l.visibility.toString().toLowerCase()),l.mobileHA=l.mobileHA&&C.State.isMobile&&!C.State.isGingerbread,l.queue===!1)if(l.delay){var u=C.State.delayedElements.count++;C.State.delayedElements[u]=t;var p=function(t){return function(){C.State.delayedElements[t]=!1,o()}}(u);r(t).delayBegin=(new Date).getTime(),r(t).delay=parseFloat(l.delay),r(t).delayTimer={setTimeout:setTimeout(o,parseFloat(l.delay)),next:p}}else o();else _.queue(t,l.queue,function(t,e){return e===!0?(x.promise&&x.resolver(m),!0):(C.velocityQueueEntryFlag=!0,void o(t))});""!==l.queue&&"fx"!==l.queue||"inprogress"===_.queue(t)[0]||_.dequeue(t)}var c,u,g,f,m,v,y,k=arguments[0]&&(arguments[0].p||_.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||b.isString(arguments[0].properties));b.isWrapped(this)?(u=!1,f=0,m=this,g=this):(u=!0,f=1,m=k?arguments[0].elements||arguments[0].e:arguments[0]);var x={promise:null,resolver:null,rejecter:null};if(u&&C.Promise&&(x.promise=new C.Promise(function(t,e){x.resolver=t,x.rejecter=e})),k?(v=arguments[0].properties||arguments[0].p,y=arguments[0].options||arguments[0].o):(v=arguments[f],y=arguments[f+1]),m=o(m),!m)return void(x.promise&&(v&&y&&y.promiseRejectEmpty===!1?x.resolver():x.rejecter()));var E=m.length,P=0;if(!/^(stop|finish|finishAll|pause|resume)$/i.test(v)&&!_.isPlainObject(y)){var F=f+1;y={};for(var I=F;I<arguments.length;I++)b.isArray(arguments[I])||!/^(fast|normal|slow)$/i.test(arguments[I])&&!/^\d/.test(arguments[I])?b.isString(arguments[I])||b.isArray(arguments[I])?y.easing=arguments[I]:b.isFunction(arguments[I])&&(y.complete=arguments[I]):y.duration=arguments[I]}var j;switch(v){case"scroll":j="scroll";break;case"reverse":j="reverse";break;case"pause":var A=(new Date).getTime();return _.each(m,function(t,e){a(e,A)}),_.each(C.State.calls,function(t,e){var i=!1;e&&_.each(e[1],function(t,s){var o=y===n?"":y;return o!==!0&&e[2].queue!==o&&(y!==n||e[2].queue!==!1)||(_.each(m,function(t,n){if(n===s)return e[5]={resume:!1},i=!0,!1}),!i&&void 0)})}),t();case"resume":return _.each(m,function(t,e){l(e,A)}),_.each(C.State.calls,function(t,e){var i=!1;e&&_.each(e[1],function(t,s){var o=y===n?"":y;return o!==!0&&e[2].queue!==o&&(y!==n||e[2].queue!==!1)||(!e[5]||(_.each(m,function(t,n){if(n===s)return e[5].resume=!0,i=!0,!1}),!i&&void 0))})}),t();case"finish":case"finishAll":case"stop":_.each(m,function(t,e){r(e)&&r(e).delayTimer&&(clearTimeout(r(e).delayTimer.setTimeout),r(e).delayTimer.next&&r(e).delayTimer.next(),delete r(e).delayTimer),"finishAll"!==v||y!==!0&&!b.isString(y)||(_.each(_.queue(e,b.isString(y)?y:""),function(t,e){b.isFunction(e)&&e()}),_.queue(e,b.isString(y)?y:"",[]))});var M=[];return _.each(C.State.calls,function(t,e){e&&_.each(e[1],function(i,s){var o=y===n?"":y;return o!==!0&&e[2].queue!==o&&(y!==n||e[2].queue!==!1)||void _.each(m,function(i,n){if(n===s)if((y===!0||b.isString(y))&&(_.each(_.queue(n,b.isString(y)?y:""),function(t,e){b.isFunction(e)&&e(null,!0)}),_.queue(n,b.isString(y)?y:"",[])),"stop"===v){var a=r(n);a&&a.tweensContainer&&o!==!1&&_.each(a.tweensContainer,function(t,e){e.endValue=e.currentValue}),M.push(t)}else"finish"!==v&&"finishAll"!==v||(e[2].duration=1)})})}),"stop"===v&&(_.each(M,function(t,e){p(e,!0)}),x.promise&&x.resolver(m)),t();default:if(!_.isPlainObject(v)||b.isEmptyObject(v)){if(b.isString(v)&&C.Redirects[v]){c=_.extend({},y);var N=c.duration,O=c.delay||0;return c.backwards===!0&&(m=_.extend(!0,[],m).reverse()),_.each(m,function(t,e){parseFloat(c.stagger)?c.delay=O+parseFloat(c.stagger)*t:b.isFunction(c.stagger)&&(c.delay=O+c.stagger.call(e,t,E)),c.drag&&(c.duration=parseFloat(N)||(/^(callout|transition)/.test(v)?1e3:w),c.duration=Math.max(c.duration*(c.backwards?1-t/E:(t+1)/E),.75*c.duration,200)),C.Redirects[v].call(e,e,c||{},t,E,m,x.promise?x:n)}),t()}var R="Velocity: First argument ("+v+") was not a property map, a known action, or a registered redirect. Aborting.";return x.promise?x.rejecter(new Error(R)):console.log(R),t()}j="start"}var D={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},$=[];_.each(m,function(t,e){b.isNode(e)&&s(e,t)}),c=_.extend({},C.defaults,y),c.loop=parseInt(c.loop,10);var B=2*c.loop-1;if(c.loop)for(var L=0;L<B;L++){var V={delay:c.delay,progress:c.progress};L===B-1&&(V.display=c.display,V.visibility=c.visibility,V.complete=c.complete),T(m,"reverse",V)}return t()};C=_.extend(T,C),C.animate=T;var E=e.requestAnimationFrame||f;if(!C.State.isMobile&&i.hidden!==n){var P=function(){i.hidden?(E=function(t){return setTimeout(function(){t(!0)},16)},d()):E=e.requestAnimationFrame||f};P(),i.addEventListener("visibilitychange",P)}return t.Velocity=C,t!==e&&(t.fn.velocity=T,t.fn.velocity.defaults=C.defaults),_.each(["Down","Up"],function(t,e){C.Redirects["slide"+e]=function(t,i,s,o,r,a){var l=_.extend({},i),c=l.begin,u=l.complete,h={},d={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""};l.display===n&&(l.display="Down"===e?"inline"===C.CSS.Values.getDisplayType(t)?"inline-block":"block":"none"),l.begin=function(){0===s&&c&&c.call(r,r);for(var i in d)if(d.hasOwnProperty(i)){h[i]=t.style[i];var n=S.getPropertyValue(t,i);d[i]="Down"===e?[n,0]:[0,n]}h.overflow=t.style.overflow,t.style.overflow="hidden"},l.complete=function(){for(var e in h)h.hasOwnProperty(e)&&(t.style[e]=h[e]);s===o-1&&(u&&u.call(r,r),a&&a.resolver(r))},C(t,d,l)}}),_.each(["In","Out"],function(t,e){C.Redirects["fade"+e]=function(t,i,s,o,r,a){var l=_.extend({},i),c=l.complete,u={opacity:"In"===e?1:0};0!==s&&(l.begin=null),s!==o-1?l.complete=null:l.complete=function(){c&&c.call(r,r),a&&a.resolver(r)},l.display===n&&(l.display="In"===e?"auto":"none"),C(this,u,l)}}),C}(window.jQuery||window.Zepto||window,window,window?window.document:void 0)})},function(t,e,i){var n=i(3),s=i(8),o=i(296),r=i(298),a=i(299),l=i(300),c=i(301),u=function(){function t(){this.element=s("<div />",{class:"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=s("<div />",{class:"url"}),this.linkEditInput=s("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=s("<div />",{class:"done"}).text(this.actionNames.done),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),e.call(this),this.element.append(this.linkUrl),this.hide()}function e(){var t=this,e=s("<div />",{class:"options"}),n={edit:function(){i.call(this)},remove:function(){var t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.linkElement),t.removeAllRanges(),t.addRange(e),window.document.execCommand("unlink",!1,null),t.removeAllRanges(),this.onChange(),this.hide()},open:function(){var t=s(this.linkElement).attr("href");t.indexOf("://")===-1&&(t="http://"+t),window.open(t,"_blank")}};for(var o in n){var r=s("<div />",{class:o}).text(this.actionNames[o]);s(r).on("click",function(e){return function(){e.call(t)}}(n[o])),e.append(r)}e.hide(),s(this.element).append(e)}function i(){this.linkElement||c.error("Cannot edit link without a valid linkElement");var t=this.linkElement;u.call(this,function(e){s(t).attr("href",e)},s(t).attr("href"))}function u(t,e){e&&(this.linkEditInput.val(e),this.linkUrl.addClass("modified"));var i=this,n=function(){var e=s(i.linkEditInput).val().trim();t(e),i.onChange(),i.close()};s(this.linkEditInput).on("keydown",function(t){i.linkUrl.addClass("modified"),t.keyCode===d.enter?(t.preventDefault(),n()):t.keyCode===d.esc&&(i.close(),i.onDismiss(),t.stopPropagation())}),s(this.linkEditInput).on("keyup",function(t){t.keyCode!==d.esc&&t.keyCode!==d.enter&&h.call(i)}),s(this.linkEditInput).on("paste",function(t){i.linkUrl.addClass("modified"),h.call(i)}),this.linkEditDone.on("click",function(t){t.preventDefault(),n()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),h.call(this),s(this.linkEditInput).focus()}function h(){var t=s(this.linkEditInput).val(),e=s(this.linkEditDone).outerWidth(),i=s(this.linkUrl).outerWidth()-s(this.linkUrl).width(),n=r.calcTextWidth(s(this.linkEditInput).get(0),t),a=r.calcTextWidth(s(this.linkEditInput).get(0),"A"),l=n+e+i+a,c=l<this.minWidth?this.minWidth:l;c=c>this.maxWidth?this.maxWidth:c;var u=s(this.element),h=c-u.width();if(0!==h){var d=Math.floor(h/2);o(u,{width:c,left:"-="+d},{duration:40,easing:"ease"})}}var d={shift:16,enter:13,esc:27,delete:8,tab:9},p=function(e){this.onChange="onChange"in e&&n.isFunction(e.onChange)?e.onChange:n.noop,this.onDismiss=e.onDismiss||n.noop,this.bypassClasses="bypassClasses"in e&&n.isArray(e.bypassClasses)?e.bypassClasses:[],this.maxWidth="maxWidth"in e&&n.isNumber(e.maxWidth)?e.maxWidth:600,this.minWidth="minWidth"in e&&n.isNumber(e.minWidth)?e.minWidth:200,this.linkElement=null,this.labels=n.extend({},{Edit:"Edit",Remove:"Remove",Open:"Open",Done:"Done"},e.labels),this.actionNames={edit:this.labels.Edit,remove:this.labels.Remove,open:this.labels.Open,done:this.labels.Done},t.call(this),l.call(this)};return n.assign(p.prototype,l.prototype),p.prototype.createLink=function(t){u.call(this,function(e){a.restoreSelection(t),window.document.execCommand("createLink",!1,e);var i=window.getSelection(),n=i.getRangeAt(0);n.collapse(!1),i.removeAllRanges(),i.addRange(n)})},p.prototype.showOptions=function(t){this.linkElement=t,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},p.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},p.prototype.isValidLink=function(t){return!!t&&!n.some(this.bypassClasses,function(e){return s(t).hasClass(e)})},p}();t.exports=u},function(t,e,i){var n=i(3),s=i(8),o=function(){var t=function(){};return t.calcTextWidth=function(t,e){var i=["font-style","font-weight","font-size","font-family"],o=n.reduce(i,function(e,i){return e+" "+s(t).css(i)},"").trim(),r=document.createElement("canvas"),a=r.getContext("2d");a.font=o;var l=a.measureText(e);return Math.round(l.width)},t.browser=function(){var t=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(trident)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},e=t(navigator.userAgent),i={};return e.browser&&(i[e.browser]=!0,i.version=e.version),i.trident&&(i.msie=!0),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i}(),t}();t.exports=o},function(t,e){var i=function(){return{saveSelection:function(t,e){if(e=e||window.getSelection(),!e||!e.rangeCount)return null;for(var i,n,s,o=e.getRangeAt(0),r=0,a=[t];!s&&(i=a.pop());){if(i.nodeType===i.TEXT_NODE)i===o.startContainer?(r+=o.startOffset,s=!0):r+=i.length;else{var l=i.childNodes.length;if("false"!==i.getAttribute("contenteditable"))for(;l--;)a.push(i.childNodes[l])}n=i}return{container:t,endContainer:o.endContainer,start:r,end:r+o.toString().length,selection:e,anchorNode:e.anchorNode}},restoreSelection:function(t){if(t){var e=0,i=document.createRange();i.setStart(t.container,0),i.collapse(!0);for(var n,s,o=[t.container],r=!1,a=!1;!a&&(n=o.pop());){if(n.nodeType===n.TEXT_NODE){var l=e+n.length;!r&&t.start>=e&&t.start<l&&(i.setStart(n,t.start-e),r=!0),r||l!==t.end||(i.setStart(n,t.end-e),r=!0),r&&t.end>=e&&t.end<=l&&(i.setEnd(n,t.end-e),a=!0),e=l}else{var c=n.childNodes.length;if("false"!==n.getAttribute("contenteditable"))for(;c--;)o.push(n.childNodes[c])}s=n}if(!a){var u=t.end-e;try{i.setEnd(t.endContainer,u)}catch(t){}}var h=window.getSelection();h.removeAllRanges();try{h.addRange(i)}catch(t){}}},setToStart:function(t){if(t){var e=document.createRange();e.setStart(t,0),e.setEnd(t,0),e.collapse(!0);var i=window.getSelection();i.removeAllRanges();try{i.addRange(e)}catch(t){}}},setToEnd:function(t){for(var e=[t],i=null,n=t,s=0;i=e.pop();)if(3===i.nodeType)n=i,s=i.length;else for(var o=i.childNodes.length;o--;)e.push(i.childNodes[o]);var r=document.createRange();r.setStart(n,s),r.setEnd(n,s),r.collapse(!0);var a=window.getSelection();a.removeAllRanges();try{a.addRange(r)}catch(t){}}}}();t.exports=i},function(t,e,i){var n=i(301),s=function(){function t(t,e){"number"==typeof t&&"number"==typeof e&&this.element.css({left:t+"px",top:e+"px"})}function e(){var t=this.element.get(0).getBoundingClientRect().left;t<0&&this.element.css("left","+="+-1*t+"px");var e=this.element.get(0).getBoundingClientRect().top;e<0&&this.element.css("top","+="+-1*e+"px")}var i=function(t){return this.element?(t=t||{},this.onShow=t.onShow||function(t){t.element.show()},this.onHide=t.onHide||function(t){t.element.hide()},this.isShown=!1,void this.element.hide()):(n.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.isShown&&(this.isShown=!1,this.onHide(this))},i.prototype.showOverTarget=function(t,i){var n=t-this.element.width()/2,s=i-this.element.height()-10;this.show(n,s),e.call(this)},i.prototype.show=function(e,i){t.call(this,e,i),this.isShown||(this.isShown=!0,this.onShow(this))},i.prototype.size=function(t,e){t&&"number"==typeof t&&this.element.width(t),e&&"number"==typeof e&&this.element.width(e)},i}();t.exports=s},function(t,e,i){var n=i(3),s=i(294),o=["assert","clear","constructor","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],r=function(t){return function(){return s.debugMode?window.console[t].bind(window.console).apply(this,arguments):n.noop}},a={};n.each(o,function(t){a[t]=r(t)}),t.exports=a},function(t,e,i){var n=i(3),s=i(8),o=i(296),r=o.animate,a=i(300),l=function(){function t(){var t=this,e=n.reduce(this.controlsOrder,function(t,e){return n.has(this.controls,e)&&t.push(this.template(n.extend({name:e},this.controls[e]))),t},[],this);this.element=s("<div />",{class:"bubbles"}).css({position:"absolute",top:0,left:0}).html(e),this.buttons=s(this.element).find("[data-command]"),this.hide(),this.buttons.on("mousedown",function(t){t.preventDefault()}),this.buttons.on("mouseup",function(e){e.preventDefault(),l.call(t,this)})}function e(){n.each(this.controls,function(t,e){n.has(t,"keyboard")&&this.keyboardEvents.on(t.keyboard,n.partial(o.bind(this),e)),n.has(t,"keyboardInverse")&&this.keyboardEvents.on(t.keyboardInverse,n.partial(i.bind(this),e))},this)}function i(t){n.has(this.controls,t)&&d[t]&&o.call(this,t)}function o(t){var e,i,s,o;n.has(this.controls,t)&&(e=d[t],i=this.controls[t],s=i.command,o=i.el,e&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(s,o,this):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(s,o,this),this.onAction(this))}function l(t){o.call(this,s(t).attr("data-name"))}function c(){this.buttons.removeClass("active"),this.buttons.filter(function(){return d[s(this).attr("data-name")]}).addClass("active")}function u(t,e){var i=!1;return s.each(t,function(t,n){if(n===e||"undefined"!=typeof n.nodeName&&n.nodeName===e)return i=!0,!1}),i}var h='<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>',d={},p=function(i,s,o){o=o||{},this.applyCommand=i,this.inverseCommand=s,this.template=n.template(o.template||h),this.controls=o.controls||{},this.controlsOrder=o.controlsOrder||n.keys(this.controls),this.onAction=o.onAction||n.noop,this.keyboardEvents=o.keyboardEvents,t.call(this),this.keyboardEvents&&e.call(this),a.call(this,o)};return n.assign(p.prototype,a.prototype),p.prototype.setActives=function(t){d=n.reduce(this.controls,function(e,i,n){var s=i.command,o=(i.el||"").toUpperCase(),r=u(t,o),a=!1;try{a=document.queryCommandEnabled(s)&&document.queryCommandState(s)}catch(t){a=!1}return e[n]=a||r,e},{},this),c.call(this)},p.prototype.open=function(t,e){if(!this.isShown){var i=s(this.element).children("[data-command]"),n=s(this.element).find(".shim");s(this.element).css({width:"auto"}),n.remove(),i.removeAttr("style")}this.showOverTarget(t,e)},p.prototype.closeWithShim=function(t,e,i,o){var a=s(this.element),l=s(t),c=s('<div class="shim">&nbsp;</div>').get(0),u=n.has(r,"Promise");i=u?i:200;var h=a.width();a.css("width",h+e);var d=l.position().left,p=h/2-(d+e/2);l.before(c).hide();var _=s(c).offset().left+p,g=s(c).offset().top;this.isAnimating=!0,n.forEach(this.buttons,function(t,e){r(t,"stop"),r(t,{opacity:0},{duration:.5*i})}),r(a,{left:"+="+p},{easing:"ease",duration:i});var f=r(c,{width:e},{easing:"ease",duration:i}),m=n.bind(function(){n.isFunction(o)&&o.call(this,_,g),this.isAnimating=!1,this.hide()},this);u?f.then(m):n.delay(m,i)},p.prototype.getActiveStates=function(){return d},p}();t.exports=l},function(t,e,i){var n=i(3),s=i(8),o=i(304),r=function(){function t(t){t.normalize();for(var e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);e.nextNode();){var i=e.currentNode,n=s(i).parent().is(t);n&&""!==i.nodeValue.trim()&&s(i).wrap("<p>")}}function e(e){t(e),s(e).children().each(function(){var t=s(this).get(0),e=t.nodeName===f,i=t.nodeName===m;v(t)||b(t)||e||i||s(this).wrap("<p>")})}function i(t){return n.filter(s(t).find("*").toArray(),function(t){return v(t)||w(t)})}function r(t,o){t.normalize(),o||e(t);var r=i(t);!r.length&&o||(o&&(e(t),r=i(t)),s(t).empty(),n.each(r,function(e){var i=n.some(s(e).children().toArray(),function(t){return v(t)});(w(e)||!h(e)&&!i)&&s(t).append(e)}))}function a(t){if(!w(t)){var e=s(t).children(_.join()).toArray(),i=!1;n.each(e,function(t){i||(s(t).unwrap(),i=!0),a(t)})}}function l(t,e){var o=i(t);n.each(o,function(t){s(t).find("li").contents().unwrap(),e&&(s(t).find("br:last-child").remove(),s(t).append("<br>")),s(t).contents().unwrap()})}function c(t){var i=k(t);i.shift();for(var n=i.shift();n&&!s(n).is("[contentEditable]");){var o=n.parentNode;s(n).contents().unwrap(),e(o),n=i.shift()}}function u(t){if(t&&t.length){for(var e=t.shift(),i=!1,o=["style","dir"];e;){var r=s(e).find("span").toArray();"SPAN"===e.nodeName&&r.push(e),r.length&&(i=!0),s(r).contents().unwrap(),n.each(o,function(t){s(e).removeAttr(t),s(e).find("["+t+"]").removeAttr(t)}),e=t.shift()}return i}}function h(t,e){var i=s(t).text();e&&(i=i.replace(/\n|\r/gm,"").trim());var n=t&&t.nodeName===m;return""===i&&!b(t)&&!y(t)&&!n}function d(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body}function p(t){var e=document.implementation.createHTMLDocument("");return e.body.appendChild(t.cloneNode(!0)),e.body}var _=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","PRE"],g=["FIGURE","IFRAME","IMG","HR"],f="DIV",m="HR",v=function(t){return n.contains(_,t.nodeName)},b=function(t){return t&&n.contains(g,t.nodeName)},y=function(t){return s(t).find(g.join()).length},w=function(t){return"false"===s(t).attr("contenteditable")},k=function(t){return n.filter(t,function(t){return n.contains(_,t.nodeName)})},C=function(t){this.sanitizeConfig=t};return C.prototype.flattenBlocksDown=function(t,e){r(t,e)},C.prototype.unBlock=function(t){a(t)},C.prototype.unwrapParentBlocks=function(t){c(t)},C.prototype.scrubSpansAndBadAttrs=function(t,e){return u(t,e)},C.prototype.blockifyInlineNodes=function(t){e(t)},C.prototype.inlinify=function(t,e){l(t,e)},C.prototype.getBlockNodes=function(t){return i(t)},C.prototype.isEmptyElement=function(t,e){return h(t,e)},C.prototype.filterHTML=function(t){var e=d(t),i=new o(this.sanitizeConfig),n=i.clean_node(e),s=p(n),r=s.innerHTML,a=r.replace(/[<]p[>][ ]*[<]\/p[>]/g,"");return a},C.prototype.filterPlaintext=function(t,e){var i=n.escape(t);return i=i.replace(/\r\n/g,"\n"),i=i.replace(/\r/g,"\n"),e&&(i=i.replace(/\n([ ]*\n)+/g,"</p><p>")),i=i.replace(/\n/g,"<br>"),e&&(i="<p>"+i+"</p>"),i},C.prototype.convertToBrowserSpaces=function(t){return t.replace(/[ ]{2}/g,"  ").replace(/[ ]$/," ")},C.prototype.sanitizeIFrames=function(t){var e=d(t);return s(e).find("iframe").each(function(){s(this).attr("data-original-src",s(this).attr("src")),s(this).attr("src","javascript:''")}),e.innerHTML},C.prototype.unSanitizeIFrames=function(t){var e=d(t);return s(e).find("iframe[data-original-src]").each(function(){s(this).attr("src",s(this).attr("data-original-src")),s(this).removeAttr("data-original-src")}),e.innerHTML},C}();t.exports=r},function(t,e){function i(){var t,e;for(e=arguments[0]||{},this.config={},this.config.elements=e.elements?e.elements:[],this.config.attributes=e.attributes?e.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=!!e.allow_comments&&e.allow_comments,this.allowed_elements={},this.config.protocols=e.protocols?e.protocols:{},this.config.classnames=e.classnames?e.classnames:{},this.config.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document,t=0;t<this.config.elements.length;t++)this.allowed_elements[this.config.elements[t]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(t=0;t<e.remove_contents.length;t++)this.config.remove_element_contents[e.remove_contents[t]]=!0;else this.config.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(t){function e(t,e){var i;for(i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function n(){var t,e,i=[],n={};for(t=0;t<arguments.length;t++)if(arguments[t]&&arguments[t].length)for(e=0;e<arguments[t].length;e++)n[arguments[t][e]]||(n[arguments[t][e]]=!0,i.push(arguments[t][e]));return i}function s(t){var e;switch(t.nodeType){case 1:r.call(this,t);break;case 3:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.config.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console&&console.log&&console.log("unknown node type",t.nodeType)}}function o(t,i){for(var n=[],s=0;s<t.length;s++)e(t[s],i)!==-1&&n.push(t[s]);return n}function r(t){var r,l,c,u,h,d,p,_,g,f,m=a.call(this,t);if(t=m.node,c=t.nodeName.toLowerCase(),l=this.current_element,this.allowed_elements[c]||m.whitelist){this.current_element=this.dom.createElement(t.nodeName),l.appendChild(this.current_element);var v=this.config.attributes;for(u=n(v[c],v[i.ALL],m.attr_whitelist),this.config.classnames[c]&&this.config.classnames[c].length&&u.push("class"),r=0;r<u.length;r++){d=u[r];var b="object"==typeof u[r]||u[r]instanceof Object;if(d=b?u[r].name:u[r],h=t.attributes[d]){_=h.value;var y=_.toLowerCase();if(f=!0,this.config.protocols[c]&&this.config.protocols[c][d]){f=!1,g=this.config.protocols[c][d],g.push(i.RELATIVE);for(var r in g)if(0===y.indexOf(g[r].toLowerCase())){f=!0;break}}"class"===d&&this.config.classnames[c]&&(_=o(_.split(" "),this.config.classnames[c]).join(" "),f=!!_),b&&(f=y.match(u[r].value)),f&&(p=document.createAttribute(d),p.value=_,this.current_element.setAttributeNode(p))}}if(this.config.add_attributes[c])for(d in this.config.add_attributes[c])p=document.createAttribute(d),p.value=this.config.add_attributes[c][d],this.current_element.setAttributeNode(p)}else if(e(t,this.whitelist_nodes)!==-1){for(this.current_element=t.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);l.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[c])for(r=0;r<t.childNodes.length;r++)s.call(this,t.childNodes[r]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=l}function a(t){var i,s,o,r={attr_whitelist:[],node:t,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==o){if("object"!=typeof o)throw new Error("transformer output must be an object or null");if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array)for(s=0;s<o.whitelist_nodes.length;s++)e(o.whitelist_nodes[s],this.whitelist_nodes)===-1&&this.whitelist_nodes.push(o.whitelist_nodes[s]);r.whitelist=!!o.whitelist,o.attr_whitelist&&(r.attr_whitelist=n(r.attr_whitelist,o.attr_whitelist)),r.node=o.node?o.node:r.node}return r}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var c=0;c<t.childNodes.length;c++)s.call(this,t.childNodes[c]);return l.normalize&&l.normalize(),l},t.exports=i},function(t,e,i){var n=i(3),s=i(8),o=function(){var t=function(t){return Array.prototype.indexOf.call(t.parentNode.childNodes,t)},e=function(t){return t instanceof HTMLElement},i={getParentNodes:function(t,e){if(e=e||[],!t||i.isEditorNode(t))return e;var n=t.parentNode;return i.isEditorNode(n)?e:n?(e.push(n),i.getParentNodes(n,e)):e},getRootElements:function(n){n=n||i.getSelection();var s=n&&n.anchorNode?n.anchorNode:null;if(!s||i.isEditorNode(s))return[];var o=i.getParentNodes(s),r=n.focusNode,a=i.getParentNodes(r),l=o.length?o.pop():s,c=a.length?a.pop():r,u=t(l),h=t(c);if(h<u){var d=u;u=h,h=d}for(var p=[],_=l.parentNode,g=u;g<=h;g++){var f=_.childNodes[g];e(f)&&p.push(f)}return p},getNodeList:function(t,e){t=t||i.getSelection();var s=t&&t.anchorNode?t.anchorNode:null;if(!s||i.isEditorNode(s))return[];var o=t.focusNode,r=[s];o&&!i.isEditorNode(o)&&(r=r.concat([o]));var a=i.getParentNodes(s);if(r=r.concat(a),!e){var l=i.getParentNodes(o);r=r.concat(l)}var c=n.union(r);return c},getNodeByNames:function(t,e,n){var s=i.getNodeList(n);
return s=e?s.reverse():s,this.getNodesByNames(s,t)[0]},getNodesByNames:function(t,e){return n.filter(t,function(t){return n.indexOf(e,t.nodeName)!==-1})},getNearestElement:function(t){t=t||i.getSelection();var e=i.getNodeList();return n.find(e,function(t){return 1===t.nodeType})},getContextCoordinates:function(t,e){var n=i.getSelection(),o=n.getRangeAt(0).cloneRange(),r=s(t).offset();if(e||!n.isCollapsed){var a=(e||o).getBoundingClientRect();return{x:a.left+a.width/2-r.left,y:a.top-r.top+s(window).scrollTop()}}if(o.getClientRects){o.collapse(!0);var l=o.getClientRects()[0];if(l)return{x:l.left-r.left,y:l.top-r.top+s(window).scrollTop()}}},getSelection:function(){var t=window.getSelection();if(t.anchorNode){var e=s(t.anchorNode).closest("[contenteditable]").length;return e?t:null}return null},collapseToEnd:function(){var t=i.getSelection();t&&t.collapseToEnd()},collapseToStart:function(){var t=i.getSelection();t&&t.collapseToStart()},isInContext:function(t,e){return s(t.anchorNode).closest(e).length>0},isEditorNode:function(t){return s(t).is('[contentEditable="true"]')},hasSelection:function(){var t=i.getSelection();return t&&!t.isCollapsed},rangeFromElement:function(t){var e,n,s=i.getSelection();return!(!s||!s.isCollapsed)&&(n=s.getRangeAt(0),e=n.cloneRange(),e.selectNodeContents(t),e.setEnd(n.startContainer,n.startOffset),e)},isCursorAtEnd:function(t,e){var i=this.rangeFromElement(t);if(!i)return!1;var n=i.toString(),s=t.textContent;return e&&(n=n.trim(),s=s.trim()),n.length===s.length},isCursorAtStart:function(t){var e=this.rangeFromElement(t);return!!e&&(0===e.startOffset&&0===e.endOffset)}};return i}();t.exports=o},function(t,e,i){var n=i(3),s=i(8),o=i(300),r=function(){function t(){this.element=s("<div />",{class:"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=s("<div />",{class:"opener"}),this.isTrayOpen=!1;var t=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),e.call(t,null,!0),!1}),this.tray=s("<div />",{class:"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function e(t,e){"boolean"!=typeof t&&(t=!this.isTrayOpen),t?(this.openTray.call(this,this.tray),this.isTrayOpen=!0,this.onTrayOpened.call(this,e)):(this.closeTray.call(this,this.tray),this.isTrayOpen=!1,this.onTrayClosed.call(this,e)),s(this.opener).toggleClass("open",this.isTrayOpen),e?s(this.opener).toggleClass("closed",!this.isTrayOpen):s(this.opener).removeClass("closed")}var i=function(e){e=e||{},this.openTray=e.openTray||this.openTray,this.closeTray=e.closeTray||this.closeTray,this.onTrayOpened=e.onTrayOpened||function(t){},this.onTrayClosed=e.onTrayClosed||function(t){},this.customOffset=e.customOffset||n.noop,this.keyboardEvents=e.keyboardEvents,t.call(this),o.call(this,e)};n.assign(i.prototype,o.prototype);var r=n.memoize(function(t,e){var i;return n.isFunction(e)?i=e.call():n.isObject(e)&&(i=e),n.pick(n.defaults(n.isObject(i)?i:{},{x:t.x||t,y:t.y||0}),["x","y"])});return i.prototype.addToTray=function(t,e){var i;e=e||{},this.tray.append(t),i=e.keyboard,this.keyboardEvents&&i&&this.keyboardEvents.on(i.shortcut,i.callback,i.context)},i.prototype.openTray=function(t){t.show()},i.prototype.closeTray=function(t){t.hide()},i.prototype.open=function(t,i){if(t){i=r(i||0,this.customOffset||0);var n=s(t).position(),o=parseInt(s(t).css("margin-top"),10)||0;e.call(this,!1),this.show(n.left+i.x,n.top+i.y+o)}},i.prototype.close=function(){e.call(this,!1),this.hide()},i.prototype.toggleTrayWithIntent=function(t){e.call(this,t,!0)},i}();t.exports=r},function(t,e,i){var n=i(3),s=i(8),o=i(299),r=function(){function t(){var t=this,n=function(t){return/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey};s(this.editor.element).on("keydown.undoManager",function(s){if(s.keyCode===u.z&&n(s)&&!s.altKey)return s.shiftKey?i.call(t):e.call(t),s.preventDefault(),!1})}function e(){if(l.call(this),this.undoStates.length){var t=this.undoStates.pop();c.call(this,t),this.redoStates.push(this.currState),r.call(this)}}function i(){if(this.redoStates.length){var t=this.redoStates.pop();c.call(this,t),this.undoStates.push(this.currState),r.call(this)}}function r(){this.currState=a.call(this)}function a(){var t={data:this.editor.getData(!0,!0),selection:o.saveSelection(this.editor.element)};return t}function l(){var t=a.call(this);return this.currState?void(t.data!==this.currState.data&&(this.undoStates.push(this.currState),this.currState=t)):void(this.currState=t)}function c(t){if(this.isRestoring=!0,this.editor.setData(t.data,!0),t.selection)o.restoreSelection(t.selection);else{var e=window.getSelection();e.removeAllRanges()}this.afterRestore()}var u={command:91,control:17,shift:16,z:90},h=500,d=function(e,i){this.editor=e,this.modifierKeyCode=!1,this.isShift=!1,this.currState=null,this.undoStates=[],this.redoStates=[],this.afterRestore=i||function(){},this.isRestoring=!1;var s=this,o=n.debounce(function(){s.isTorndown||l.call(s)},h);this.defaultOnChange=e.onChange,e.onChange=function(t){if(s.isRestoring)s.isRestoring=!1;else{if("updateAsyncImage"===t)return;s.currState?o():l.call(s)}s.defaultOnChange.call(this)},t.call(this)};return d.prototype.undo=function(){e.call(this)},d.prototype.redo=function(){i.call(this)},d.prototype.teardown=function(){this.isTorndown=!0,this.editor.onChange=this.defaultOnChange,this.undoStates.length=0,this.redoStates.length=0,this.currState=null,s(this.editor.element).off(".undoManager")},d}();t.exports=r},function(t,e,i){var n=i(3),s=i(8),o=i(305),r=i(299),a=i(298),l=function(){function t(){var t=this;s(this.editor.element).on("keypress",function(n){var s=!1;if(34===n.charCode)s=i.call(t);else{if(39!==n.charCode)return;s=e.call(t)}s&&n.preventDefault()})}function e(){var t=this.config.singleQuotes;return l.call(this,t.open,t.close,t.prime)}function i(){var t=this.config.doubleQuotes;return l.call(this,t.open,t.close,t.prime)}function l(t,e,i){var a=o.getSelection();if(!a.isCollapsed)return!1;var l=a.anchorNode;l.normalize();var c=r.saveSelection(l),u=l.textContent,h=u.slice(0,c.start),d=h.charAt(h.length-1),p=l.lastChild&&"BR"===l.lastChild.nodeName?l.lastChild:null,_=n.any(this.config.openingMatches,function(t){return t.test(d)})||p,g="";g=!d||_?t:/\d/.test(d)?i:e;var f=document.createTextNode(g),m=a.getRangeAt(0);return m.deleteContents(),m.insertNode(f),p&&p.previousSibling&&"BR"===p.previousSibling.nodeName&&s(p).remove(),m.setEndAfter(f),m.collapse(!1),a.removeAllRanges(),a.addRange(m),!0}var c=function(e,i){return a.browser.msie?null:(this.editor=e,this.config={openingMatches:[/\s/,/\u200B/,/[=]/],singleQuotes:{open:"‘",close:"’",prime:"′"},doubleQuotes:{open:"“",close:"”",prime:"″"}},n.extend(this.config,i||{}),void t.call(this))};return c}();t.exports=l},function(t,e,i){var n=i(3),s=i(8),o=i(310),r=function(){function t(){s(this.element).on("keydown.keycombos",i.bind(this)),this.listening=!0}function e(){s(this.element).off("keydown.keycombos"),this.listening=!1}function i(t){var e=this.humanKeys.translate(t);e&&a.call(this,e)&&(r.call(this,e,t),t.preventDefault(),t.stopImmediatePropagation())}function r(t,e){n.each(c.call(this,t),function(i){n.has(i,"callback")&&n.has(i,"context")&&i.callback.call(i.context,e,t)})}function a(t){return c.call(this,t).length>0}function l(t,e){var i=c.call(this,t);return n.filter(i,{callback:e}).length>0}function c(t){return n.has(this.subscribers,t)?this.subscribers[t]:[]}function u(e,i,s){if(!l.call(this,e,i))return n.has(this.subscribers,e)||(this.subscribers[e]=[]),this.subscribers[e].push({callback:i,context:s}),this.listening||t.call(this),this}function h(){this.subscribers={},e.call(this)}function d(t,i){return t?n.has(this.subscribers,t)?(i&&(this.subscribers[t]=n.reject(this.subscribers[t],{callback:i})),i&&0!==this.subscribers[t].length||delete this.subscribers[t],0===n.values(this.subscribers).length&&e.call(this),this):this:(h.call(this),this)}var p=function(t){t=t||{},this.debounceRate=t.debounceRate||100,this.element=t.element||document,this.humanKeys=t.humanKeys||new o,this.subscribers={},this.listening=!1};return p.prototype.on=function(t,e,i){n.each((t||"").split(" "),function(t){u.call(this,this.humanKeys.normalize(t),e,i)},this)},p.prototype.off=function(t,e){t?n.each(t.split(" "),function(t){d.call(this,this.humanKeys.normalize(t),e)},this):d.call(this,null,e)},p}();t.exports=r},function(t,e,i){var n=i(3),s=function(){function t(){return navigator.platform.match(/^Win/i)?"Win":navigator.platform.match(/^Mac/i)?"Mac":navigator.platform.match(/^Linux/i)?"Linux":navigator.platform}function e(){return n.extend({},this.prettyMapping,this.platformPrettyMapping[t.call(this)])}function i(){return this.platformModifiers[t.call(this)]||{}}function s(){var e=t.call(this);return n.has(this.platformPrettySeperators,e)?this.platformPrettySeperators[e]:this.seperator}function o(t){return this.specialKeys[t.keyCode]||String.fromCharCode(t.keyCode)}function r(t){return n.filter(this.modifiers,function(e){return t[e+"Key"]})}function a(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}var l=["ctrl","meta","alt","shift"],c="+",u={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",187:"PLUS",61:"PLUS",188:"COMMA",189:"MINUS",173:"MINUS",190:"DOT",32:"SPACE"},h={LEFT:"←",RIGHT:"→",DOWN:"↓",UP:"↑",PLUS:"+",COMMA:",",MINUS:"-",DOT:".",SPACE:"Space"},d={Win:{meta:"ctrl"},Linux:{meta:"ctrl"}},p={Mac:{meta:"⌘",shift:"⇧",alt:"⌥"}},_={Win:"-",Linux:"-",Mac:""},g=function(t){t=t||{},this.modifiers=t.modifiers||l,this.separator=t.separator||c,this.specialKeys=t.specialKeys||u,this.prettyMapping=t.prettyMapping||h,this.platformModifiers=t.platformsModififiers||d,this.platformPrettyMapping=t.platformPrettyModifiers||p,this.platformPrettySeperators=t.platformPrettySeperators||_};return g.prototype.translate=function(t){var e=r.call(this,t);return 0===e.length?null:e.concat(o.call(this,t)).join(this.separator)},g.prototype.normalize=function(t){var e=t.split(this.separator),s=i.call(this),o="";return n.each(this.modifiers,function(t){var i=n.indexOf(e,t.toLowerCase()),r=s[t]||t;i>=0&&(o+=r+this.separator,e.splice(i,1))},this),o+e.join(this.separator).toUpperCase()},g.prototype.pretty=function(t){var i=this.normalize(t),o=e.call(this),r=s.call(this);return n.map(i.split(this.separator),function(t){return o[t]||a(t)},this).join(r)},g}();t.exports=s},function(t,e,i){var n=i(3),s=i(8),o=i(303),r=i(299),a=i(305),l=i(307),c=i(308),u=i(309),h=i(301),d=function(){function t(){g.call(this,x);var t=s("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),i=s("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(i),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),i=s(this.element).parent(),i.append(this.placeholderElement),d.call(this),e.call(this)}function e(){var t=this,e=function(){y.call(this),i.call(this),this.onChange()};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(e){if(e.keyCode===E.shift)t.keyModifiers.shift=!0;else if(e.keyCode===E.backspace)C.call(t);else if(e.keyCode===E.enter)return t.config.forceSingleLine||e.metaKey||v.call(t,this,!1),void e.preventDefault();n.defer(function(){t.onChange(e)})}),s(this.element).on("keyup",function(i){i.keyCode===E.shift?t.keyModifiers.shift=!1:i.keyCode===E.enter?C.call(t):i.keyCode!==E.backspace&&i.keyCode!==E.delete||n.defer(function(){C.call(t)}),e.call(t)}),s(this.element).on("input",function(i){e.call(t)}),s(this.element).on("blur",function(e){t.onChange()});var o=!1;s(this.element).on("mouseup",function(){o=!1,i.call(t)}),s(this.element).on("mousedown",function(t){o=!0}),s(this.element).on("mouseleave",function(){o&&i.call(t)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;t.config.pasteHook(i,t.keyModifiers.shift)||p.call(t,i,e),e.preventDefault()}),s(this.element).on("drop",function(t){t.stopPropagation(),t.preventDefault()}),this.placeholderElement.on("click",function(){t.isEmpty()&&s(t.element).focus()}),s(this.element).on("focus",function(){n.defer(function(){t.onChange()})})}function i(){var t=this;setTimeout(function(){var e=a.getSelection();t.config.onSelection.call(t,e)},200)}function d(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function p(t,e){var i="";if(n.contains(t.types,"text/plain"))i=t.getData("text/plain"),i=this.dataFilter.filterPlaintext(i),m.call(this,i);else{if(!n.contains(t.types,"text/html"))return;i=t.getData("text/html"),i=this.dataFilter.filterHTML(i);var s=i.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),o=document.implementation.createHTMLDocument("");o.body.innerHTML=s;var r=o.body,a=r.textContent||r.innerText||"",l=a.split("\n").join("<br>");m.call(this,l)}if(this.config.forceSingleLine){var c=f.call(this).replace(/<br\s*\/*>/g," ");g.call(this,c)}this.onChange(e)}function _(){s(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function g(t){s(this.element).html(t)}function f(){return s(this.element).html().trim()}function m(t){if(t=t.replace(/[<]br\s?\/?[>]$/,""),t=this.dataFilter.convertToBrowserSpaces(t),!t)return void h.warn("Cannot insert empty data");var e=a.getSelection();if(!e||!e.focusNode)return void h.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents();var n=i.createContextualFragment(t);i.insertNode(n),e.removeAllRanges(),i.collapse(!1),e.addRange(i)}function v(t,e){e||t.lastChild&&"br"===t.lastChild.nodeName.toLowerCase()||t.appendChild(document.createElement("br"));var i=a.getSelection();if(i){var n=i.getRangeAt(0),s=document.createElement("br");n.deleteContents(),n.insertNode(s),n.setStartAfter(s),n.setEndAfter(s),n.collapse(!1),i.removeAllRanges(),i.addRange(n)}}function b(t){s(t).contents().each(function(t,e){e.nodeType===Node.TEXT_NODE?e.textContent=e.textContent.replace(T,""):e.nodeType===Node.ELEMENT_NODE&&b(e)})}function y(){if(!this.isEmpty()){var t=w.call(this);if(t&&t.nodeType===Node.ELEMENT_NODE){var e=t.textContent||t.innerText||"",i=e.match(T);if(i){var n=r.saveSelection(t);n.start-=(e.substr(0,n.start).match(T)||"").length||0,n.end-=(e.substr(0,n.end).match(T)||"").length||0,b(t),r.restoreSelection(n)}}}}function w(){var t=k.call(this);if(!t){var e=s(this.element).children();if(!e.length)return null;t=e.last().get(0)}return t}function k(t){return t||(t=!a.getSelection()&&this.lastSelection?a.getParentNodes(this.lastSelection.anchorNode):a.getNodeList()),n.find(t.reverse(),function(t){return t.nodeType===Node.ELEMENT_NODE})}function C(){this.isEmpty()&&(g.call(this,x),this.setCursorToEnd())}var x="<span>&#8203;</span>",S="<span>​</span>",T=/\u200B/g,E={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39},P=function(e,i){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.keyComboEvents=i.keyComboEvents||new u({element:this.element}),this.keyComboEvents.on("meta+b meta+i meta+k meta+u",n.noop),this.config={placeholder:!1,onChange:function(){},onSelection:function(t){},onClientEvent:function(t){},pasteHook:function(t,e){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1,smartQuotes:{enabled:!1,config:{}}},n.extend(this.config,i||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){this.previousRawData!==f.call(this)&&(_.call(this),d.call(this),this.config.onChange.apply(this,arguments),this.previousRawData=f.call(this))},this.keyModifiers={shift:!1},this.undoManager=new l(this),this.config.smartQuotes.enabled&&(this.smartQuoter=new c(this)),t.call(this)};return P.prototype.getData=function(t){var e=f.call(this);e=this.config.filterForGetData.call(this,e);var i=e.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(T,""),n=document.createElement("div");n.innerHTML=i;var s=n.textContent||n.innerText||"",o=t?s.trim():s;return o},P.prototype.setData=function(t){t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterPlaintext(t),g.call(this,t),C.call(this),this.onChange()},P.prototype.setHTML=function(t){g.call(this,t),this.onChange()},P.prototype.getHTML=function(){return f.call(this)},P.prototype.insertData=function(t,e){e&&(t=this.dataFilter.filterHTML(t)),m.call(this,t),this.onChange()},P.prototype.blur=function(){return s(this.element).blur()},P.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},P.prototype.hasFocus=function(){return s(this.element).is(":focus")},P.prototype.setPlaceholder=function(t){this.config.placeholder=t,d.call(this)},P.prototype.isEmpty=function(){var t=this.getData(!1);if(""===t||"\n"===t||"\r\n"===t)return!0;var e=f.call(this);return e===x||e===S||""===e},P.prototype.getCurrentElement=function(){return a.getNearestElement()},P.prototype.setCursorToStart=function(t){var e=s(this.element);t=t&&e.find(t).first().get(0)||e.children().first().get(0),t&&r.setToStart(t)},P.prototype.setCursorToEnd=function(t){var e=s(this.element);t=t&&e.find(t).last().get(0)||e.children().last().get(0),t&&r.setToEnd(t)},P.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},P}();t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="editor editor-plaintext" aria-label="'+__e(ariaLabel)+'" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_values(_imports))},,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(235),a=o.extend({initialize:function(t){this.el=t.el||null,this.itemSelector=t.itemSelector||".item",this.dropInParent=t.dropInParent||!1,this.transparentPlaceholder=t.transparentPlaceholder,this.beforeDragStart=t.beforeDragStart||n.noop,this.afterDragEnd=t.afterDragEnd||n.noop,this.scrollable=t.scrollable||!1,this.$items=this.$(this.itemSelector),this.isAnimating=!1,this.disableAnimation=t.disableAnimation||!1,this.disableAnimation&&(this.calculateDropTarget=n.throttle(this.calculateDropTarget,500)),this.$currentlyDraggedItem=null,this.$placeholder=null,this.placeholderElement=null,this.renderedPlaceholder=!1,this.reloadItems()},itemEvents:function(t){t||(t=this.itemSelector);var e={};return e["dragstart "+t]="setPlaceholder",e["dragenter "+t]="calculateDropTarget",e["dragend "+t]="resetPlaceholder",this.dropInParent?(e.dragover="cancelEvent",e.drop="dropItemAndResetPlaceholder"):(e["dragover "+t]="cancelEvent",e["drop "+t]="dropItem"),e},setPlaceholder:function(t){this.renderedPlaceholder=!1,t.originalEvent.dataTransfer.effectAllowed="move";try{t.originalEvent.dataTransfer.setData("text/html","")}catch(t){}if(this.$currentlyDraggedItem=s(t.currentTarget),this.$currentlyDraggedItem){if(this.$placeholder=this.$currentlyDraggedItem.clone().addClass("sortable-placeholder"),this.transparentPlaceholder&&this.$placeholder.addClass("transparent-placeholder"),!this.disableAnimation){var e=this.$currentlyDraggedItem.outerWidth();this.$placeholder.data("item-width",e).data("need-animation",!1)}this.placeholderElement=this.$placeholder.get(0),this.$currentlyDraggedItem.addClass("sortable-dragging"),this.beforeDragStart(),this.trigger("dragstart",this),this.scrollable&&(this.$el.on("dragover."+this.cid,n.throttle(function(t){var e=.2,i=window.innerHeight,n=t.originalEvent.clientY/i,s=this.getBoundingClientRect();n<e&&s.top<0?window.scrollBy(0,-(200*(e-n))):n>1-e&&window.scrollBy(0,200*(e+n-1)),t.preventDefault()},50)),this.$currentlyDraggedItem.one("dragend",n.bind(function(){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))},this)))}},calculateDropTarget:function(t){if(this.$currentlyDraggedItem&&!this.isAnimating){t.preventDefault(),this.renderedPlaceholder=!0;var e=t.currentTarget,i=s(e);if(e===this.placeholderElement)return!1;this.$currentlyDraggedItem.hide();var n,o=i.index(this.itemSelector),r=this.$placeholder.index(this.itemSelector),a=this.$placeholder.data("need-animation")||!1,l=this.$placeholder.data("item-width");return this.disableAnimation||(n=s("<span>").css({width:l,display:"inline-block"}),this.$placeholder.after(n),a&&this.$placeholder.css({width:0,padding:0})),r<o?i.after(this.placeholderElement):i.before(this.placeholderElement),this.disableAnimation||(a?this.animatePlaceholderWidth(n,this.$placeholder,l,200):this.$placeholder.data("need-animation",!0)),this.lastDroppable=e,!1}},animatePlaceholderWidth:function(t,e,i,s){this.isAnimating=!0,r.animate(t,"stop"),r.animate(e,"stop"),r.animate(t,{width:0},s,"easeInOutQuart",n.bind(function(){t.remove(),this.isAnimating=!1},this)),r.animate(e,{width:i},s,"easeInOutQuart")},cancelEvent:function(t){this.$currentlyDraggedItem&&t.preventDefault()},dropItem:function(t){return this.$currentlyDraggedItem&&this.renderedPlaceholder&&this.placeholderElement&&(t.stopPropagation(),this.$currentlyDraggedItem.insertAfter(this.placeholderElement)),!1},resetPlaceholder:function(t){this.renderedPlaceholder=!1,this.placeholderElement=null,this.$currentlyDraggedItem&&(this.$currentlyDraggedItem.removeClass("sortable-dragging").show(),this.$currentlyDraggedItem=null,this.$placeholder.detach(),t.stopPropagation(),this.afterDragEnd(),this.trigger("dragend",this),this.lastDroppable=null)},dropItemAndResetPlaceholder:function(t){return this.dropItem(t),this.resetPlaceholder(t)},sequence:function(){var t=this.$(this.itemSelector).toArray();return n.uniq(n.pluck(t,"id"))},reloadItems:function(){return this.$items=this.$(this.itemSelector),n.each(this.$items,function(t){t.draggable=!0,s(t).find("a").attr("draggable",!1),s(t).find("img").attr("draggable",!1)}),this.delegateEvents(this.itemEvents(this.itemSelector)),this},disableItems:function(){return n.each(this.$items,function(t){t.draggable=!1}),this.undelegateEvents(),this},teardown:function(){return this.undelegateEvents(),this.scrollable&&this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" ")),n.each(this.$items,function(t){s(t).add("a, img",t).removeAttr("draggable")}),this.$items=null,this.$placeholder=null,this.beforeDragStart=null,this.afterDragEnd=null,this.calculateDropTarget=null,this}});t.exports=a},,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(332);t.exports=n},function(t,e,i){"use strict";var n=i(226),s=i(333),o=n.extend({className:"knight-rider-container",template:s,defaults:{variation:"",loading:!1},_onChangeLoading:function(t,e){this.$el.toggleClass("loading",e),this.$el.find("[data-js-knightRider]").toggleClass("animate",e),this.$el.toggle(e)},afterRender:function(){this._onChangeLoading(this,this.get("loading")),this.listenTo(this,"change:loading",this._onChangeLoading)}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="knight-rider-loader '+__e(variation)+'" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(136),a=i(342),l=i(276),c=i(283),u=i(343),h=i(344),d=i(347),p=i(348),_=o.extend({className:"popover--post-share-popover",mixins:[l,c,p],template:u,defaults:{popoverData:{},forceSocialFallback:!1,forceEmailFallback:!1,tumblelogShare:!1},events:{"click .embed_post":"__embedPostClick","click .share_email":"__emailTriggerClick","click .share_facebook":"__shareFacebookClick","click .share_pinterest":"__sharePinterestClick","click .share_twitter":"__shareTwitterClick","click .share_reddit":"__shareRedditClick","click .share_permalink":"__sharePermalinkClick","click .flag_post":"__flagPostClick","click .cancel":"__cancelClick","click .popover_menu_item_anchor":"__checkIfPremiumPost","input .email_address":"__emailFormInput","input .twitter .share_message":"__shareTwitterInput","change .reply_to_input":"__replyToChange","keydown .share_form":"__submitKeydown","submit .share_form":"__submit","focus input":"__suspendKeyCommands","focus textarea":"__suspendKeyCommands","blur textarea":"__resumeKeyCommands","blur input":"__resumeKeyCommands"},__embedPostClick:function(t){t.preventDefault(),r.trigger("dashboard-share:embed"),this._showEmbedCode()},__emailTriggerClick:function(t){t.preventDefault(),r.trigger("dashboard-share:email"),this._toggleEmailForm()},__shareFacebookClick:function(t){t.preventDefault(),r.trigger("dashboard-share:facebook"),this._shareFacebook()},__sharePinterestClick:function(t){t.preventDefault(),r.trigger("dashboard-share:pinterest"),this._sharePinterest()},__shareRedditClick:function(t){t.preventDefault(),r.trigger("dashboard-share:reddit"),this._shareReddit()},__shareTwitterClick:function(t){t.preventDefault(),r.trigger("dashboard-share:twitter"),this._shareTwitter()},__sharePermalinkClick:function(){this.resetAndHide()},__flagPostClick:function(t){t.preventDefault(),this.onClickOutside(),r.trigger("abuseform:open",{mode:"post",post:this.model}),r.trigger("Kraken:abuseform:open",{mode:"post"})},__cancelClick:function(t){t.preventDefault(),this._cancelOrClose()},__emailFormInput:function(){var t=_.validateEmail(this.$emailAddress.val());this.$submitButton.attr("disabled",!t)},__shareTwitterInput:function(t){t.preventDefault();var e=_.validateTwitter(this.$shareMessage.val(),this.$characterCount);this.$submitButton.attr("disabled",!e)},__replyToChange:function(t){var e=n(t.currentTarget).is(":checked");a.set("share_popover_reply_to",e,31536e3)},__submitKeydown:function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey||t.altKey)&&(t.preventDefault(),t.stopPropagation(),this.submitForm())},__submit:function(){return this.submitForm(),!1},__submitSuccess:function(){this.$status.show(),this._fadeoutPopover()},__submitError:function(){this.$errorStatus.html(this.errorText),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!1),this.$errorStatus.addClass("active")},__suspendKeyCommands:function(){r.trigger("keycommands:suspend indashblog:keycommands:suspend")},__resumeKeyCommands:function(){r.trigger("keycommands:resume indashblog:keycommands:resume")},__checkIfPremiumPost:function(){var t=n("[data-id="+this.options.popoverData.post_id+"]").data("json");if(t&&t.pt){var e=new d(t),i=this.loggingData({userAction:"share"});i&&i.modelData&&(i.modelData=e.toJSON()),r.trigger("useraction:explore_click:share",{model:e,loggingData:i})}},_shareTwitter:function(){!this.options.forceSocialFallback&&this.twitterUsername?(this.$serviceCancel.show(),this.$submitButton.html("Tweet"),this.$shareForm.data("type","twitter"),this.$shareLabel.text("@"+this.twitterUsername),this.$shareMessage.val(" [URL]"),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.get(0).setSelectionRange(0,0),this.$shareMessage.attr("placeholder",""),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("twitter"),_.validateTwitter(this.$shareMessage.val(),this.$characterCount),this.$shareForm.hasClass("active")&&(this.$shareMessage.focus(),this.$shareMessage.get(0).setSelectionRange(0,0))):this._shareTwitterFallback()},_shareTwitterFallback:function(){var t=this.tinyUrl||this.url||this.model.get("url");window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(t),"twitter-share-dialog","width=626,height=258");var e=this._getGenericShareData();this.model.shareTwitter(e),this.resetAndHide()},_shareFacebook:function(){!this.options.forceSocialFallback&&this.hasFacebook?this.model.facebookStatus().done(s.bind(this._shareFacebookSuccess,this)).fail(s.bind(this._shareFacebookFallback,this)):this._shareFacebookFallback()},_shareFacebookSuccess:function(t){t?(this.$serviceCancel.show(),this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","facebook"),this.$shareLabel.text(t),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("facebook"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$shareForm.hasClass("active")&&this.$shareMessage.focus()):this._shareFacebookFallback()},_shareFacebookFallback:function(){var t=this.url||this.model.get("url");window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t),"facebook-share-dialog","width=626,height=436");var e=this._getGenericShareData();this.model.shareFacebook(e),this.resetAndHide()},_sharePinterest:function(){var t=this.model.get("pinterest_share_window");window.open(t.url,t.name,t.dimensions);var e=this._getGenericShareData();this.model.sharePinterest(e),this.resetAndHide()},_shareReddit:function(){window.open("https://reddit.com/submit?url="+this.model.get("post_url"),"reddit-share-dialog","scrollbars=1,width=860,height=600");var t=this._getGenericShareData();this.model.shareReddit(t),this.resetAndHide()},_toggleEmailForm:function(){return this.options.forceEmailFallback||!this.model.get("tumblelog_share")&&!this.model.get("has_user")?void this._emailFormFallback():(this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","email"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$replyTo.addClass("active"),void(this.$shareForm.hasClass("active")&&this.$emailAddress.length&&this.$emailAddress.focus()))},_emailFormFallback:function(){var t=this._getGenericShareData();this.model.shareEmail(t);var e="mailto:?body="+this.url;if(this.model.get("embed_key")){var i=window.open();i.document.write('<html><script>location.href = "'+e+'";setTimeout(function(){window.close();},500);</script></html>'),i.document.close()}else window.location.href=e;this.resetAndHide()},_showEmbedCode:function(){this.$serviceCancel.show(),this.$shareForm.data("type","embed"),this.$shareLabel.text(this.$shareLabel.data("embed-label")),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.attr("placeholder",""),this.$shareForm.addClass("embed");var t=this.$shareForm.find(".embed_code_text");t.length&&(t.click(function(){t.select()}),setTimeout(function(){t.trigger("click")},100))},_fadeoutPopover:function(){setTimeout(s.bind(function(){this.$el.fadeOut(150,s.bind(this.resetAndHide,this))},this),1250)},_cancelOrClose:function(){var t=this.$emailAddress.val()||"";"email"===this.$shareForm.data("type")&&t.length?(this.$emailAddress.val(""),this.$submitButton.attr("disabled",!0)):this.resetForm()},_getGenericShareData:function(){return[{name:"post_id",value:this.model.get("post_id")},{name:"tumblelog_name",value:this.model.get("tumblelog_name")},{name:"share_fallback",value:!0}]},initialize:function(t){this.options=s.extend({},this.defaults,t),this.model=new h(this.options.popoverData),this.listenTo(this.model,"error",this.__submitError),this.listenTo(this.model,"success",this.__submitSuccess)},cacheSelectors:function(){this.$shareForm=this.$(".share_form"),this.$shareLabel=this.$(".share_label"),this.$replyTo=this.$(".reply_to"),this.$shareOptions=this.$(".share_options"),this.$submitButton=this.$("button.email_submit"),this.$emailAddress=this.$(".email_address"),this.$shareMessage=this.$(".share_message"),this.$embedCode=this.$(".embed_code_text"),this.$characterCount=this.$(".character_count"),
this.$serviceCancel=this.$(".cancel.service"),this.$status=this.$(".status"),this.$errorStatus=this.$(".error_status"),this.$statusMessage=this.$(".status_message"),this.$replyToInput=this.$(".reply_to_input"),this.sentText=this.$status.data("sent")||"",this.errorText=this.$status.data("error")||"",this.$(".share_twitter").length&&(this.twitterUsername=this.$(".share_twitter").data("twitter-username")),this.$(".share_facebook").length&&(this.hasFacebook=this.$(".share_facebook").data("has-facebook")),this.url=this.$shareOptions.data("post-url"),this.tinyUrl=this.$shareOptions.data("post-tiny-url"),this.tumblelogName=this.$shareOptions.data("tumblelog-name"),this.embedKey=this.$shareOptions.data("embed-key"),this.postId=this.$shareOptions.data("post-id"),this.rootId=this.$shareOptions.data("root-id")},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.model.toJSON())),this.cacheSelectors(),this.$replyToInput.prop("checked","true"===a.get("share_popover_reply_to")),this},resetForm:function(){this.$serviceCancel.hide(),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!0),this.$emailAddress.val(""),this.$shareMessage.val(""),this.$shareMessage.attr("placeholder",this.$shareMessage.attr("title")),this.$shareOptions.addClass("active"),this.$shareForm.removeClass("active"),this.$shareForm.removeClass("facebook"),this.$shareForm.removeClass("twitter"),this.$shareForm.removeClass("embed"),this.$status.hide(),this.$statusMessage.html(this.sentText),this.$replyTo.removeClass("active"),this.$errorStatus.removeClass("active"),this.$el.show()},resetAndHide:function(){this.resetForm(),this.teardown()},submitForm:function(){var t=this.$shareForm.serializeArray();switch(this.$shareForm.data("type")){case"facebook":this.model.shareFacebook(t);break;case"twitter":this.model.shareTwitter(t);break;default:this.model.shareEmail(t)}this.$submitButton.attr("disabled",!0),this.$submitButton.html(this.$submitButton.data("label-sending"))},teardown:function(){return this.__resumeKeyCommands(),this.$el.remove(),this}},{placeholderSupport:function(){var t=document.createElement("input");return"placeholder"in t},validateEmail:function(t){var e=/\S+@\S+\.\S+/;return e.test(t)},validateTwitter:function(t,e){var i=t.match(/\[URL\]/gi),n=i?24*i.length:0,s=140-t.length-n,o=!(!e||!e.length)&&e;return o&&(o.removeClass("character-limit").html(s),s<10&&o.addClass("character-limit")),!(s<0||140===s)}});t.exports=_},function(t,e,i){"use strict";function n(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))}function s(t){var e=decodeURIComponent(document.cookie).match(new RegExp(t+"=([^;]+)"));return e&&e.length>1?e[1]:null}function o(t,e,i,n){"object"===("undefined"==typeof e?"undefined":c(e))&&(e=JSON.stringify(e));var s=encodeURIComponent(t)+"="+encodeURIComponent(e);if(u.isPlainObject(i)&&(n=i,i=!!n&&n.expires),n=u.extend({expires:i},h,n),n.expires instanceof Date)s+=";expires="+n.expires.toGMTString();else if("number"==typeof n.expires){var o=new Date;o.setTime(o.getTime()+1e3*n.expires),s+=";expires="+o.toGMTString()}n.path&&(s+=";path="+encodeURI(n.path)),n.secure&&(s+=";secure"),n.domain&&(s+=";domain="+encodeURI(n.domain)),document.cookie=s}function r(t){o(t,"",-1)}function a(t,e){var i=s(t);try{i=JSON.parse(i)}catch(t){return i}return e?u.get(i,e):i}function l(t,e,i,n){var s;u.isPlainObject(e)?(n=i,s=e):(s=a(t)||{},u.isPlainObject(s)||(s={}),u.set(s,e,i)),o(t,JSON.stringify(s),n)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=i(3),h={path:"/",secure:!1,domain:""},d={has:n,get:s,set:o,unset:r,getHash:a,setHash:l};t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="'+__e(tumblelog_name)+'" data-post-id="'+__e(post_id)+'" data-root-id="'+__e(root_id)+'" data-post-url="'+__e(post_url)+'" data-post-tiny-url="'+__e(post_tiny_url)+'" data-embed-key="'+__e(embed_key)+'" data-embed-did="'+__e(embed_did)+'"> ',is_private||(__p+=" ",show_permalink&&(__p+=' <li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="permalink" href="'+__e(post_url)+'" target="_blank" class="external" title="'+__e(permalink_label)+'" rel="noopener"> '+__e(permalink_label)+' <i class="icon icon_arrow_carrot_right"></i></a></li> '),__p+=" ",show_embed&&(__p+=' <li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="embed" href="#">'+__e(__("Embed"))+"</a></li> "),__p+=" ",show_email&&(__p+=' <li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="email" href="#">'+__e(__("Email"))+"</a></li> "),__p+=" ",show_twitter&&(__p+=' <li class="share_twitter popover_menu_item" data-twitter-username="'+__e(twitter_username)+'"><a class="popover_menu_item_anchor" data-share-type="twitter" href="#">'+__e(__("Twitter"))+"</a></li> "),__p+=" ",show_facebook&&(__p+=' <li class="share_facebook popover_menu_item" data-has-facebook=""><a class="popover_menu_item_anchor" data-share-type="facebook" href="#">'+__e(__("Facebook"))+"</a></li> "),__p+=" ",show_pinterest&&(__p+=' <li class="share_pinterest popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="pinterest" href="#">'+__e(__("Pinterest"))+"</a></li> "),__p+=" ",show_reddit&&(__p+=' <li class="share_reddit popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="reddit" href="#">'+__e(__("Reddit"))+"</a></li> "),__p+=" ",show_flagging&&(__p+=' <li class="flag_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+__e(__("Report this post"))+"</a></li> "),__p+=" ",show_reporting_links&&(__p+=' <li class="popover_menu_item"><a class="popover_menu_item_anchor" target="_blank" href="'+__e(abuse_url)+'">'+__e(__("Report Abuse"))+"</a></li> "),__p+=" "),__p+=" </ul> ",is_private||(__p+=' <form method="post" class="share_form email_form" id="share_email_'+__e(post_id)+'" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="'+__e(__("Embed"))+'"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="'+__e(__("Email"))+'" title="'+__e(__("Email"))+'"> <input type="hidden" name="post_id" value="'+__e(post_id)+'"> <input type="hidden" name="tumblelog_name" value="'+__e(tumblelog_name)+'"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="'+__e(__("Message (Optional)"))+'" title="'+__e(__("Message (Optional)"))+'"></textarea><div class="character_count">140</div></li></ul></div> ',show_embed&&(__p+=' <div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">'+__e(embed_code)+"</textarea></div> "),__p+=" ",has_user&&(__p+=' <div class="reply_to" title="'+__e(__("Let them reply to"))+'"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_'+__e(post_id)+'" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_'+__e(post_id)+'"> '+(null==(__t=__("Let them reply to <span>"))?"":__t)+" </label></div> "),__p+=' <div class="error_status"></div><button type="submit" class="tx-button blue email_submit" data-label-sending="'+__e(__("Sending..."))+'" data-label="'+__e(__("Send"))+'" disabled="disabled">'+__e(__("Send"))+'</button></div></form><div class="status" data-sent="'+__e(__("Sent!"))+'" data-error="'+__e(__("Error!"))+'"><span class="status_message">'+__e(__("Sent!"))+"</span></div> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(185),r=i(129),a=i(180),l=i(345),c=o.extend({url:function(){return"/svc/post/share/"+this.get("tumblelog_name")+"/"+this.get("post_id")},parse:function(t){return!s.isUndefined(t)&&s.has(t,"response")?s.result(t.response,"share_popover_data")||{}:{}},hostname:function(){var t=r.get("Context/hosts");return s.isEmpty(t)?"http://www.tumblr.com":t.www_host},defaults:{abuse_url:"",embed_code:"",embed_did:"",form_key:n("#tumblr_form_key").attr("content"),has_facebook:!1,has_user:!1,is_private:!1,permalink_label:"",post_id:"",post_tiny_url:"",post_url:"",root_id:"",show_email:!0,show_embed:!0,show_facebook:!0,show_permalink:!0,show_pinterest:!0,show_reporting_links:!0,show_twitter:!0,show_reddit:!0,show_flagging:!0,tumblelog_name:"",twitter_username:"",embed_key:"",pinterest_share_window:{},tumblelog_share:!1},initialize:function(t){this.get("embed_code")||this.set("embed_code",new l(this.toJSON()).getCode()),a.bool("enable_share_embed_code")||this.set("show_embed",!1),a.bool("reddit_sharing")||this.set("show_reddit",!1)},shareEmail:function(t){return this.get("tumblelog_share")?this.share("/svc/email_tumblelog",t):this.share("/svc/share/email",t)},shareTwitter:function(t){if(!this.get("tumblelog_share"))return this.share("/svc/share/twitter",t)},shareFacebook:function(t){if(!this.get("tumblelog_share"))return this.share("/svc/share/facebook",t)},sharePinterest:function(t){return this.share("/svc/share/pinterest",t)},shareReddit:function(t){return this.share("/svc/share/reddit",t)},facebookStatus:function(){return n.ajax({url:this.hostname()+"/svc/facebook_status",type:"post",data:{form_key:this.get("form_key")}})},share:function(t,e){return e=e||[],e.push({name:"form_key",value:this.get("form_key")}),n.ajax({url:this.hostname()+t,type:"post",data:e,success:s.bind(function(){this.trigger("success")},this),error:s.bind(function(){this.trigger("error")},this)}),this}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(346),r=i(129),a=s.extend({name:"PostEmbedCodeGenerator",defaults:{embed_host:"//embed.tumblr.com",secure_assets_host:"https://assets.tumblr.com",tumblelog_mention_key:"",post_id:"",post_url:"",embed_key:"",embed_did:""},initialize:function(t){this.options=n.extend({},this.defaults,t);var e=r.get("Context/hosts");e&&(e.embed_host&&(this.options.embed_host=e.embed_host),e.secure_assets_host&&(this.options.secure_assets_host=e.secure_assets_host)),this.template=o},getCode:function(){return this.template(this.options)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="undefined"!=typeof language&&"undefined"!=typeof width?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-language="'+__e(language)+'" data-width="'+__e(width)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":"undefined"!=typeof language?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-language="'+__e(language)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":"undefined"!=typeof width?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-width="'+__e(width)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ",__p+=' <script async src="'+__e(secure_assets_host)+'/post.js"></script>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(185),r=i(136),a=i(191),l=i(213),c=i(345),u=i(130),h=i(182),d=o.extend({defaults:{},endpoints:{like:"/svc/like",unlike:"/svc/unlike",reblog:"/fast_reblog",reply:"/svc/reply",publish:"/publish",queue:"/publish",destroy:"/svc/post/delete",promote:"/svc/promote",unpromote:"/svc/unpromote",answer:"/answer",deny:"/deny_submission",approve:"/approve_submission",remove_source:"remove_app_attribution",subscription:"/svc/blog/:tumblelog/posts/:post_id/subscription"},initialize:function(t){this._createPostTumblelogModel("tumblelog",this.get("tumblelog-data")),this._createPostTumblelogModel("parentTumblelog",this.get("tumblelog-parent-data")),this._createPostTumblelogModel("rootTumblelog",this.get("tumblelog-root-data")),this.listenTo(this,"like:success",this.logClientLike)},logClientLike:function(){r.trigger("ads:client_like",{loggingData:{userAction:"client_like",postData:this.attributes}})},_createPostTumblelogModel:function(t,e){t=t||"tumblelog",e=e||!1;var i=!1;e&&e.name&&(i=new a(n(e).omit(n.isUndefined).omit(n.isNull).value())),this[t]=i},_setTumblelog:function(){this.tumblelog=new a(n({name:this.get("tumblelog"),ignoring:!1,sponsor:this.get("sponsored"),following:this.get("following"),mention_key:this.get("tumblelog_mention_key")}).omit(n.isUndefined).omit(n.isNull).value())},_setReblogTumblelog:function(){var t=this.get("reblog_source");t&&t.name&&(this.reblogTumblelog=new a(n({name:t.name,ignoring:!1,following:t.following}).omit(n.isUndefined).omit(n.isNull).value()))},getRootTumblelogUuid:function(){return this.get("tumblelog-root-data")?this.get("tumblelog-root-data").uuid:this.get("tumblelog-data")?this.get("tumblelog-data").uuid:this.get("reblogged_root_uuid")||this.get("tumblelog_uuid")},_xhrRequest:function(t,e,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POST";i.init&&i.init();var r=s.ajax({data:e,type:o,url:t,withFormKey:!0});return r.done(n.bind(function(t){i[200]&&i[200].call(this,t)},this)),r.fail(n.bind(function(t){i[t.status]&&i[t.status].call(this,t.status)},this)),r.always(n.bind(function(){i.always&&i.always()},this)),r},_xhrSuccess:function(t){this.trigger(t+":success")},_xhrFailure:function(t){l.alert(u("Sorry, we seem to be having technical trouble.  Please try again later.")),this.trigger(t+":failure")},_xhrForbidden:function(t){this.trigger(t+":forbidden")},_setCarouselIndex:function(t){return this.get("is_carousel")?n.extend(t,{offset:this.get("carousel_index")}):t},save:function(t,e,i,s){if(i||(i={}),this.endpoints[t]){var o={200:n.bind(this._xhrSuccess,this,t),401:n.bind(this._xhrFailure,this,t),404:n.bind(this._xhrFailure,this,t),403:n.bind(this._xhrForbidden,this,t),500:n.bind(this._xhrFailure,this,t)},r=this.endpoints[t];return r.indexOf(":")>-1&&(r=this.replaceEndPointVariables(r)),this._xhrRequest(r,e,n.defaults(i,o),s)}throw new Error("Missing endpoint url for "+t)},replaceEndPointVariables:function(t){return t.replace(":tumblelog",this.get("tumblelog")).replace(":post_id",this.get("id"))},like:function(t){if(!this.get("is_mine")){if(this.get("liked")===!1){this.set("liked",!0);var e=this.likePayload(t,this.getLikeSource("like"));this.save("like",{data:e})}this.trigger("like:set",this),r.trigger("post:like:set",this.get("id"),this,t)}},unlike:function(){if(this.get("liked")===!0){this.set("liked",!1);var t=this.likePayload("mouse",this.getLikeSource("unlike"));this.save("unlike",{data:t})}this.trigger("unlike:set",this),r.trigger("post:unlike:set",this.get("id"))},toggleLike:function(){this.get("liked")?this.unlike():this.like()},getLikeSource:function(t){t=t||"like";var e="LIKE_";switch(t){case"unlike":e="UNLIKE_";break;case"reply":e="REPLY_";break;case"ignore":e="IGNORE_"}var i=location.pathname;return i.match(/^\/dashboard\/iframe/)?e+"SOURCE_IFRAME":i.match(/^\/dashboard/)?e+"SOURCE_DASHBOARD":i.match(/^\/tagged/)?e+"SOURCE_TAG_PAGE":i.match(/^\/likes/)?e+"SOURCE_LIKES_PAGE":i.match(/^\/inbox/)?e+"SOURCE_INBOX":i.match(/^\/search/)?e+"SOURCE_SEARCH_RESULTS_PAGE":i.match(/^\/explore/)?e+"SOURCE_DISCOVER":i.match(/^\/tv/)?e+"SOURCE_TV":i.match(/^\/indash_blog\/peepr/)?e+this.getPeeprSource():e+"SOURCE_UNKNOWN"},getPeeprSource:function(){if(window.parent&&window.parent.location){var t=window.parent.location.pathname;if(t.match(/search/))return"SOURCE_SEARCH_PEEPR"}return"SOURCE_PEEPR"},getEmbedCode:function(t,e){var i={embed_key:this.get("embed_key"),embed_did:this.get("embed_did"),post_id:this.get("id"),post_url:this.get("post_url")};t&&(i.language=t),e&&(i.width=e);var n=new c(i);return n.getCode()},likePayload:function(t,e){t=t||"mouse",e=e||"LIKE_SOURCE_UNKNOWN";var i={id:this.get("id"),root_id:this.get("root_id"),key:this.get("reblog_key"),placement_id:this.get("placement_id")||!1,is_recommended:this.get("is_recommended")||"",pt:this.get("pt"),tumblelog_name:this.get("tumblelog-name"),method:t,source:e};return this._setCarouselIndex(i)},reblog:function(t){t=n.extend({},t,{reblogId:this.get("id"),reblogKey:this.get("reblog_key"),pt:this.get("pt")}),r.trigger("postForms:reblog",t)},fastReblog:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h().attributes.fastqueue_web_lab;this.trigger("fastreblog:success",t),r.trigger("post:fastreblog:set",{model:this});var e={reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),queue:t,pt:this.get("pt")};e=this._setCarouselIndex(e);var i={200:n.bind(function(e){this.set("reblogged",!0),this.trigger("fastreblog:ajax:success",e.response);var i={model:this.clone(),toastOptions:{type:t?"queue":"selfReblog",avatar:e.response.post_tumblelog.avatar,fromTumblelogName:e.response.post_tumblelog.name_or_id}};r.trigger("post:fastReblog:showtoast",i)},this)};this.save("reblog",e,i)},reply:function(t){var e=this,i={reply_text:t,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog-key")||this.get("tumblelog_key"),source:this.getLikeSource("reply")},n={200:function(){e.trigger("replied"),e._setSubscriptionStatus(!0)}};return this.save("reply",{data:i},n)},destroy:function(){var t={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.save("destroy",t)},publish:function(){var t=this.save("publish",{id:this.get("id")});t.fail(n.bind(function(t){this.trigger("publish:failure",s.parseJSON(t.responseText))},this))},promote:function(t){var e={tag:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("promote",e)},unpromote:function(t){var e={tag_id:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("unpromote",e)},queue:function(){var t={id:this.get("id"),queue:"queue"};this.save("queue",t)},removeSource:function(){var t={post_id:this.get("id"),tumblelog_id:this.get("tumblelog")};return this.save("remove_source",t)},approve:function(t){var e={id:this.get("id"),queue:t};return this.save("approve",e)},deny:function(){return this.save("deny",{pid:this.get("id")})},answer:function(t){var e={post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog-key"),answer_text:t};return this.save("answer",e)},embedFocus:function(){this.trigger("embed:focus",this)},updateReblogControl:function(t){this.trigger("reblog:success",t)},dismiss:function(){this.trigger("dismiss",this)},_setSubscriptionStatus:function(t){"boolean"!=typeof t&&(t=!this.get("isSubscribed")),this.set("isSubscribed",t)},_toggleSubscription:function(t){var e=this,i=this.get("isSubscribed")?"DELETE":"POST";return this.save("subscription",{},{200:function(){e._setSubscriptionStatus(!e.get("isSubscribed"))}},i)}});t.exports=d},function(t,e,i){"use strict";var n=i(3),s=i(187),o=new s({loggingData:function t(e){var t={};return!n.isEmpty(this.model)&&n.isFunction(this.model.toJSON)&&(t.modelData=this.model.toJSON()),n.isObject(e)&&(t=n.extend(t,e)),t}});t.exports=o},,,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(192),r=i(354),a=2e3,l=i(215),a=2e3,c=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack};c.prototype=new Error;var u=l.extend({constructor:function(t){this.setEmbedRegexes(t||[])},setEmbedRegexes:function(t){this.regexes=t,this.services=n.unique(n.values(t))},isValidEmbedService:function(t){return n.any(this.regexes,function(e,i){return new RegExp(i,"mi").test(t)})},isValidEmbedServiceName:function(t){return n.contains(this.services,t)},getUrlFromEmbedCode:function(t){var e=s(r.nodeFromString(t)),i=e.find("iframe[src], embed[src], script[src]").first(),n=e.find("object[data]").first();return i.attr("src")||n.attr("data")||!1},fetchEmbedData:function(t,e,i){var r=s.ajax({url:"/svc/post/get_video_data",type:"POST",withFormKey:!0,data:JSON.stringify({embed_url:t,embed_width:e})});return o(r).then(n.bind(function(s){if(n.isEmpty(s)||"false"===s||!n.isPlainObject(s))throw new c("Invalid embed response",t,s);if(s.thumbnail||i)return s;var r=n.bind(this.fetchEmbedData,this,t,e,!0);return o.promise(function(t,e){n.delay(function(){r().then(function(t){return t},function(){return s})},a)})},this)).catch(function(t){return o.reject(t)})},parseEmbedData:function(t,e){if(!n.isString(t))throw"The input is invalid. Expected a string";var i=n.trim(t);if(this.isValidEmbedService(i))return this.fetchEmbedData(i,e);var s=this.getUrlFromEmbedCode(i);return n.isEmpty(s)?o.reject(new c("Invalid embed code",t)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:s,preview_iframe:"",embed_code:t})}});t.exports=new u},function(t,e,i){"use strict";function n(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body}function s(t){var e=document.implementation.createHTMLDocument("");return e.body.appendChild(t.cloneNode(!0)),e.body}function o(t){return s(t).innerHTML}function r(t){var e,i=document.implementation.createHTMLDocument("");return i.body.innerHTML=t,e=i.body.textContent||i.body.innerText||"",e=e.trim()}t.exports={nodeFromString:n,wrapNode:s,outerHTML:o,stripTags:r}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(430),r=i(214),a=i(129),l=i(136),c=i(435),u=i(180),h=[],d=r.extend({name:"CrtControl",maxLoopTime:10,playerSelector:"[data-crt-video]",peeprOpen:!1,initialize:function(t){t=t||{},this.listenTo(l,"CrtControl:newPlayer",this.playerFactory,this),this.listenTo(l,"DOMEventor:flatscroll",n.throttle(this.onScroll,500),this),this.listenTo(l,"peepr:close",this.onPeeprClose,this),this.listenTo(l,"peepr:open",this.onPeeprOpen,this)},onPeeprOpen:function(){this.peeprOpen=!0},onPeeprClose:function(){this.peeprOpen=!1},findPlayers:function(t){var e=s(this.playerSelector);e.length&&this.playerFactory(e,t)},playerFactory:function(t,e){n.defer(n.bind(function(){n.each(t,function(t){this.newPlayer(t,e)},this)},this))},newPlayer:function(t,e){var i=this;if(t.player)return t.player;var n=new c(t,e);return h.push(n),n.render(),this.bindPlayerEvents(n),l.trigger("CrtControl:playerCreated",n),this.isThirdPartyTrackingEligible(e)&&o(function(t){var e={videoPlayer:n};i.beaconTracking=new t(e)}),n},isThirdPartyTrackingEligible:function(t){return u.bool("moat_viewability_beacons")&&n.get(t,"attributes.isAd",!1)&&!n.isEmpty(a.get("Components/BeaconTracking"))},bindPlayerEvents:function(t){this.listenTo(t,"ready",this.onPlayerReady),this.listenTo(t,"teardown",this.onPlayerTeardown)},onPlayerReady:function(){this.playInViewport()},onPlayerTeardown:function(t){if(t=n.where(h,{_id:t._id}),t.length){var e=n.indexOf(h,t[0]);e>-1&&(t=h.splice(e,1))}},onScroll:function(){this.playInViewport()},pauseAutoplaying:function(){n.each(h,function(t){t.get("autoplay")&&t.get("loaded")&&t.pause()})},getInViewport:function(){var t=this;return n.filter(h,function(e){return!(!e.watcher||t.peeprOpen&&!e.get("isInPeepr"))&&(e.watcher.isFullyInViewport&&e.$el.is(":visible"))})},playInViewport:function(){var t=this.getInViewport();if(t.length){var e=t[0];e.get("paused")&&e.get("autoplay")&&(this.pauseAutoplaying(),e.play())}}});t.exports=new d},function(t,e,i){"use strict";var n=i(248),s=function(t){i.e(2,function(e){try{t(i(431))}catch(t){n(t,"beacon-tracking")}})};t.exports=s},,,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(138),r=i(436),a=i(215),l=i(230),c=i(180),u=i(136),h=i(437),d=i(438),p=a.extend({mixins:[l],defaults:{loaded:!1,paused:!0,muted:!0,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:1,isAd:!1,isInPeepr:!1,isFullscreen:!1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(t,e){this._id=n.uniqueId("crtplayer"),this.initialize(t,e)},initialize:function(t,e){e||(e={}),n.isObject(e.attributes)&&this.set(e.attributes),this.video=t,this.$video=s(this.video);var i=this.$video.data("crt-options")||{};this.$video.removeAttr("data-crt-options"),this.vjsOptions=n.defaults({crt:this,crtOptions:i},e.vjsOptions||{}),i&&i.duration&&this.set("duration",i.duration),this.vjsOptions.crtOptions.livestream&&(this.set("autoplay",!0),this.set("minLoopDuration",60)),r.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return r.write(function(){d(this.video,this.vjsOptions).then(n.bind(this.ready,this))},this),this},ready:function(t){this.player=t,this.player.muted(this.get("muted")),this.el=t.player_.el(),this.$el=s(this.el),this.$post=this.$el.closest(".post, .video-ad"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setLoopState(!0),this.setAutoheightState(n.get(this.vjsOptions,"crtOptions.autoheight")),this.setFullscreenControl(!h.prop("requestFullscreen")),this.shouldForceHD()&&this.player.src({src:this.vjsOptions.crtOptions.hdUrl,type:"video/mp4"}),this.get("watch")&&this.setupWatcher()},_bindEvents:function(){this.listenTo(u,"peepr:open",this.pause),this.listenTo(u,"post:form:show",this.pause),this.listenTo(u,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.one("loadedmetadata",n.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",n.bind(this.onUpdateDuration,this)),this.player.on("play",n.bind(this.onPlay,this)),this.player.on("pause",n.bind(this.onPause,this)),this.player.on("ended",n.bind(this.onEnded,this)),this.player.on("fullscreenchange",n.bind(this.onFullscreenChange,this)),this.player.on("error",n.bind(this.onError,this))},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(n.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(n.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(n.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()},this))},onClickPlayer:function(t){s(t.target).closest(".vjs-mute-control").length||s(t.target).closest(".vjs-fullscreen-control").length||this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||"undefined"==typeof this.player||null==this.player||(this.onTimeUpdate(),setTimeout(n.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return!(!this.get("autoplay")||c.bool("is_mobile")||!this.$el.is(":visible")||!(this.get("duration")>this.get("minLoopDuration")||0===this.get("duration")||this.vjsOptions.crtOptions.livestream))},shouldForceHD:function(){return!(!this.vjsOptions.forceHD||!this.vjsOptions.crtOptions.hdUrl)},play:function(t){t||(t={}),this.player.paused()&&(this.player.play(),t.skipLog||(t.type="userPlay",this.player.trigger(t)))},pause:function(t){t||(t={}),this.player.paused()||(this.player.pause(),t.skipLog||this.player.trigger("pause"))},onPlay:function(){this.set("paused",!1),this.pollTimeUpdate()},onPause:function(){this.set("paused",!0)},onUpdateDuration:function(t){this.set("duration",this.player.duration())},onLoadedMetadata:function(t){var e=this.shouldAutoplay();this.setMutedState(e),this.setAutoplayState(e),e&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",n.bind(this.onClickPlayer,this)),u.trigger("CrtPlayer:ready",this),this.trigger("playerReady",this),this.trigger("ready",this),this.set("loaded",!0)},onEnded:function(t){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("loop"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("end"))},onError:function(t){this.set("paused",!0),this.set("loop",!1),this.set("autoplay",!1),this.trigger("error",t)},onChangeAutoplay:function(t,e,i){this.setAutoplayState(e,i)},onChangeAutoheight:function(t,e){this.setAutoheightState(e)},onChangeDuration:function(t,e){this.setLoopState(!0)},onChangeLoop:function(t,e){this.setLoopState(e)},onChangeMuted:function(t,e){this.player.muted(e)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(t){n.isEmpty(t.embedID)||this.playerID===t.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(t){n.isUndefined(t)&&(t=this.get("loop")),this.set("loop",t),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(t){n.isUndefined(t)&&(t=this.get("muted")),this.set("muted",t)},setAutoplayState:function(t){n.isUndefined(t)&&(t=this.get("autoplay")),this.set("autoplay",t),this.toggleAttrClass("autoplay",t),!t&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(t){(n.isUndefined(t)||n.isNull(t))&&(t=this.get("autoheight")),this.set("autoheight",t),this.toggleAttrClass("autoheight",t)},setFullscreenControl:function(t){n.isUndefined(t)&&(t=this.get("hideFullscreen")),this.set("hideFullscreen",t),this.toggleAttrClass("hideFullscreen",t)},onTimeUpdate:function(){var t=.3,e=this.get("_position"),i=this.player.currentTime(),n=Math.abs(e-i);n<t&&this.set("_elapsed",this.get("_elapsed")+n),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},getPosition:function(){return Math.floor(this.get("_position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(t,e){this.classNames[t]&&r.write(function(){this.$el.toggleClass(this.classNames[t],e)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(),this.player=null)}});t.exports=p},function(t,e){!function(e){"use strict";function i(){this.frames=[],this.lastId=0,this.raf=n,this.batch={hash:{},read:[],write:[],mode:null}}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){
return window.setTimeout(t,1e3/60)};i.prototype.read=function(t,e){var i=this.add("read",t,e),n=i.id;this.batch.read.push(i.id);var s="reading"===this.batch.mode||this.batch.scheduled;return s?n:(this.scheduleBatch(),n)},i.prototype.write=function(t,e){var i=this.add("write",t,e),n=this.batch.mode,s=i.id;this.batch.write.push(i.id);var o="writing"===n||"reading"===n||this.batch.scheduled;return o?s:(this.scheduleBatch(),s)},i.prototype.defer=function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);var n=this,s=t-1;return this.schedule(s,function(){n.run({fn:e,ctx:i})})},i.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var i=this.batch[e.type],n=i.indexOf(t);delete this.batch.hash[t],~n&&i.splice(n,1)}},i.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},i.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},i.prototype.uniqueId=function(){return++this.lastId},i.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},i.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},i.prototype.add=function(t,e,i){var n=this.uniqueId();return this.batch.hash[n]={id:n,fn:e,ctx:i,type:t}},i.prototype.run=function(t){var e=t.ctx||this,i=t.fn;if(delete this.batch.hash[t.id],!this.onError)return i.call(e);try{i.call(e)}catch(t){this.onError(t)}},i.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function i(){var n=t.frames.shift();t.frames.length?e(i):t.looping=!1,n&&n()}),this.looping=!0)},i.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},e=e||new i,"undefined"!=typeof t&&t.exports?t.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.fastdom=e}(window.fastdom)},function(t,e,i){"use strict";var n=i(3),s=i(215),o={requestFullscreen:["requestFullScreen"]},r=s.extend({vendors:["moz","webkit","ms","o","khtml"],cssPrefixes:["-moz-","-webkit-","-ms-","-o-","",""],el:document.body||document.documentElement,get:n.memoize(function(t){var e=this._getProp(t);return!e&&o[t]&&n.each(o[t],function(t){var i=this._getProp(t);i&&(e=i)},this),e}),prop:function(t){return!!this.get(t)},cssFilters:n.memoize(function(){var t=document.createElement("div");return t.style.cssText=this.cssPrefixes.join("filter:blur(5px); "),!!t.style.length}),_getProp:function(t){var e=!1;return"string"==typeof this.el[t]?t:"string"==typeof this._styles()[t]?t:(t=t.charAt(0).toUpperCase()+t.substr(1),n.forEach(this.vendors,function(i){var n=i+t;n in this.el&&(e=n),n in this._styles()&&(e=n)},this),e)},_styles:n.memoize(function(){return this.el.style})});t.exports=new r},function(t,e,i){"use strict";function n(t,e){var i=s.merge({},p(),e);e.crtOptions.techOrder&&(i.techOrder=e.crtOptions.techOrder);var n=r.defer(),l=function(){var t;e.src&&e.type?(this.src(e),n.resolve(this)):e.file?(t=e.file.type||"video/mp4",this.src({src:a(e.file),type:t}),n.resolve(this),delete e.file):n.resolve(this)},c=o(t,i,l);return"function"==typeof c.skippy&&c.skippy(),n.promise}var s=i(3),o=i(439);window.videojs=o;var r=i(192),a=i(440),l=i(441),c=i(446),u=i(447);o.registerComponent("BigPlayToggle",i(448)),o.registerComponent("AnimatingMuteToggle",i(449)),o.registerComponent("CrtSeekBar",i(451)),o.registerComponent("LoadingSpinner",i(452)),o.registerComponent("HDToggle",i(453)),o.registerComponent("CrtDurationDisplay",i(454)),o.log=s.noop,o.log.error=s.noop,o.log.warn=s.noop,o.log.history=[];var h=function(t){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new l(this,t),this.detectBuffering=new c(this,t),this.eventDispatcher=new u(this,t)};o.plugin("crt",h);var d,p=function(){return d||(d={children:["mediaLoader","posterImage","bigPlayToggle","loadingSpinner",{name:"controlBar",children:["playToggle","timeDivider","crtDurationDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle"]},"errorDisplay"],hls:{withCredentials:!1},plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null,livestream:!1},controls:!0,autoplay:!1,volume:.8,muted:!0,techOrder:["html5"]}),d};t.exports=n},,function(t,e){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;t.exports=i},function(t,e,i){"use strict";var n=i(3),s=i(439),o=i(442),r=i(443),a=i(444),l=i(445),c=s.extend(o,{elSelector:".vjs-progress-holder",initialize:function(t,e){this.children={},this.$el=this.$$(this.elSelector),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,n.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,n.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,n.bind(this.onMouseOut,this)),this.player.on("dispose",n.bind(this.dispose,this))},createChildren:function(){this.children.hoverSliderHandle=new r(this.player),this.children.hoverSliderTime=new a(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new l(this.player)),this.appendChildren()},appendChildren:function(){n.each(this.children,n.bind(function(t){this.$el.append(t.render().$el)},this))},updateChildren:function(t){n.each(this.children,function(e){e.update(t)})},onMouseMove:function(t){this.$el.removeClass("auto-hide");var e=this.$el.offset(),i=this.$el.width(),n=t.pageX-e.left,s=Math.max(0,Math.min(1,(t.pageX-e.left)/i)),o=s*this.player.player().duration(),r=o/this.player.player().duration();n<0?n=0:n>i&&(n=i),this.updateChildren({hoverX:n,hoverTime:o,hoverPercent:r})},onMouseOut:function(t){this.$el.addClass("auto-hide")},onMouseEnter:function(t){this.$el.removeClass("auto-hide")},dispose:function(){n.each(this.children,function(t){n.result(t,"dispose")}),o.prototype.dispose.apply(this,arguments)}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(439),r=o.getComponent("Component"),a=o.extend(r,{constructor:function(t,e){this.options=e||{},this.player=t,this.$player=s(this.player.el()),this._selectorCache(),this.player.on("dispose",n.bind(this.dispose,this)),this.player.ready(n.bind(function(){this.initialize.apply(this,arguments)},this))},_selectorCache:function(){this.$$=n.memoize(function(t){return this.$player.find(t)},n.identity),this.$$.remove=n.bind(function(t){this.$$.cache.delete(t)},this),this.$$.clear=n.bind(function(){this.$$.cache=new n.memoize.Cache},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});t.exports=a},function(t,e,i){"use strict";var n=i(8),s=i(439),o=i(442),r=s.extend(o,{seeking:!1,render:function(){return this.$el=n('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},update:function(t){t||(t={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var e=t.hoverX||0,i=t.hoverTime||"0:00",n=s.formatTime(i);this.$time_el.html(n),this.$el.css("left",e+"px")}});t.exports=r},function(t,e,i){"use strict";var n=i(8),s=i(439),o=i(442),r=s.extend(o,{render:function(){return this.$el=n('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(t){t||(t={});var e=t.hoverX||0,i=t.hoverTime||"0:00",n=s.formatTime(i);this.$el.html(n),this.$el.css("left",e+"px")}});t.exports=r},function(t,e,i){"use strict";var n=i(8),s=i(439),o=i(442),r=s.extend(o,{filmstrip_thumbnail_count:10,render:function(){var t=this.player.options_.crtOptions.filmstrip,e=t.url,i=.5*t.width,s=.5*t.height,o=6;return this.$el=n('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=n('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:i+o+"px",height:s+o+"px"}),this.$thumbnail.css({width:i+"px",height:s+"px","background-image":"url("+e+")","background-size":i*this.filmstrip_thumbnail_count+"px "+s+"px"}),this.$el.append(this.$thumbnail),this},update:function(t){t||(t={});var e=t.hoverX||0;this.$el.css("left",e+"px");var i=isNaN(t.hoverPercent)?0:100*t.hoverPercent,n=100/(this.filmstrip_thumbnail_count-1),s=Math.floor(i/this.filmstrip_thumbnail_count)*n;this.$thumbnail.css("background-position",s+"% 0%")}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(439),o=i(442),r=s.extend(o,{elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(t,e){this.player.on("play",n.bind(this.startPolling,this)),this.player.on("ended",n.bind(this.stopPolling,this)),this.player.on("pause",n.bind(this.stopPolling,this)),this.player.one("dispose",n.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var t=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+t&&!this.player.paused()&&(this.lastWaitedTime=n.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+t&&!this.player.paused()){var e=n.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:e}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.checkBuffering(),n.delay(n.bind(this.tick,this),this.interval))},startPolling:function(t){this.polling||(this.polling=!0,this.tick())},stopPolling:function(t){this.polling=!1}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(439),r=i(136),a=i(180),l=i(442),c=o.extend(l,{videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,loadStartTime:0,triggerElement:s(),initialize:function(t,e){this.player.crt.on("playerReady",n.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData(),this.playerData.duration=this.player.duration(),this.player.options_.crtOptions["hls-service"]&&(n.isFinite(this.playerData.duration)?this.playerData.type="replay":this.playerData.type="live")},this)),this.$doc=s(document)},setPlayerData:function(){var t=this.player.crt.$post.data("json");if(this.playerData={postData:t,platform:"web",app_version:null,type:"video",post_id:null,root_post_id:null,blog_uuid:null,vendor:null,duration:this.player.crt.get("duration"),time_elapsed:null},"undefined"!=typeof t)this.playerData.post_id=t["post-id"],this.playerData.root_post_id=t.root_id,this.playerData.blog_uuid=t.tumblelog;else{var e=this.player.options_.crtOptions;"undefined"!=typeof e["iframe-post-data"]&&(this.playerData.post_id=e["iframe-post-data"].post_id,this.playerData.blog_uuid=e["iframe-post-data"].blog);var i=e["hls-service"];i&&(this.playerData.type="live",this.playerData.vendor=i)}},bindEvents:function(){this.$player.on("mousedown touchstart",n.bind(this.setTriggerElement,this)),this.player.on("userPlay",n.bind(this.onUserPlay,this)),this.player.on("play",n.bind(this.onVJSPlay,this)),this.player.on("pause",n.bind(this.onVJSPause,this)),this.player.on("loop",n.bind(this.onLooped,this)),this.player.on("end",n.bind(this.onVideoEnded,this)),this.player.on("restart",n.bind(this.onRestart,this)),this.player.on("muteClicked",n.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",n.bind(this.onFullscreenChange,this)),this.player.on("error",n.bind(this.onError,this)),this.player.on("seeking",n.bind(this.onSeeking,this)),this.player.on("resolutionchange",n.bind(this.onResolutionChange,this)),this.player.on("timeupdate",n.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",n.bind(this.onStopWaiting,this)),this.player.on("firstplay",n.bind(this.onLoadStart,this)),this.player.on("loadeddata",n.bind(this.onLoadedData,this))},triggerEvent:function(t,e){e=this._buildLoggingData(e),r.trigger("VideoPlayer:"+t,{loggingData:e})},_buildLoggingData:function(t){return t=n.extend({},this.playerData,t),t.time_elapsed=this.player.crt.getElapsed(),t.position=this.player.crt.getPosition(),t},setTriggerElement:function(t){this.triggerElement=s(t.target)},onLogComplete:function(){this.triggerElement=s()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(t){var e=this.player.error(),i="MEDIA_ERR_CUSTOM";if(e){switch(e.code){case 1:i="MEDIA_ERR_ABORTED";break;case 2:i="MEDIA_ERR_NETWORK";break;case 3:i="MEDIA_ERR_DECODE";break;case 4:i="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:i="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("failed",{code:e.code,name:i})}},onUserPlay:function(t){this.onPlay(!0,t)},onVJSPlay:function(t){this.onPlay(!1,t)},onPlay:function(t,e){if(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),n={};e.onDock&&(n.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"auto_play":"play",n),this.onLogComplete()}},onVJSPause:function(){this.onPause(!1)},onPause:function(t){(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("loop")},onVideoEnded:function(){this.triggerEvent("end")},onRestart:function(t){var e=n.pick(t,["start","end"]);this.triggerEvent("restart",e)},onFullscreenChange:function(){var t=this.player.isFullscreen();this.triggerEvent("fullscreen",{fullscreen:t}),this.player.crt.set("isFullscreen",t),this.onLogComplete()},onMuteClicked:function(){var t=this.player.muted()?"mute":"unmute";this.triggerEvent(t),this.player.crt.set("muted","mute"===t),this.onLogComplete()},onSeeking:function(){if(0!==this.triggerElement.closest(".vjs-progress-control").length){this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition());var t={start:this.startSeekTime};this.triggerEvent("scrub_start",t),this.$doc.one("mouseup.crtEvents touchend.crtEvents",n.bind(this.onSeeked,this))}},onSeeked:function(){if(this.startSeekTime){var t={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("scrub_stop",t),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(t){var e=n.pick(t,"resolution");this.triggerEvent("resolutionchange",e)},onStopWaiting:function(t,e){!e.timeWaited||e.timeWaited<2e3||this.triggerEvent("waiting",e)},onLoadStart:function(){this.loadStartTime=n.now()},onLoadedData:function(){var t=n.now()-this.loadStartTime;this.triggerEvent("initialLoad",{loadTime:t})},logConversion:function(t){if(!this.videoConversionLogged&&a.bool("is_logged_in")&&!this.loggingInProgress){this.loggingInProgress=!0;var e=s.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",withFormKey:!0,data:"log="+JSON.stringify(t)});e.done(n.bind(this.onConversionSuccess,this)),e.fail(n.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});t.exports=c},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(439),r=i(220).animation,a=o.getComponent("ClickableComponent"),l=o.extend(a,{constructor:function(){a.prototype.constructor.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return a.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>'},{"aria-label":"play video"})},handleClick:function(){this.$el=this.$el||n(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.player().controls(!0)):this.togglePlay()},togglePlay:function(){r(this.$el,s.bind(function(t){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player().pause(),this.$el.removeClass("poof-play").addClass("poof-pause"))},ready:function(){"Flash"===this.player().techName_&&this.hide()}});t.exports=l},function(t,e,i){"use strict";var n=i(439),s=i(450),o=n.getComponent("MuteToggle"),r=n.getComponent("ClickableComponent"),a=n.extend(o,{constructor:function(t,e){o.prototype.constructor.call(this,t,e),this.addListeners(t)},addListeners:function(t){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var t="vjs-mute-control vjs-control";return this.player_.options_.muted&&(t+=" vjs-vol-0"),r.prototype.createEl.call(this,"div",{className:t,innerHTML:s()},{})},update:function(){var t=this.player_.volume(),e=3;0===t||this.player_.muted()?e=0:t<.33?e=1:t<.67&&(e=2),this.controlText(this.player_.muted()?"Unmute":"Mute");for(var i=0;i<4;i++)n.removeClass(this.el_,"vjs-vol-"+i);n.addClass(this.el_,"vjs-vol-"+e)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(439),s=i(3),o=n.getComponent("SeekBar"),r=n.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.handle=document.createElement("div"),this.handle.className="vjs-seek-handle vjs-slider-handle",this.handle.setAttribute("aria-live","off"),this.el_.appendChild(this.handle),this.boundDetectDuration=s.bind(this.detectDuration,this),this.player().on("loadedmetadata",this.boundDetectDuration)},handleMouseMove:function(t){o.prototype.handleMouseMove.apply(this,arguments),this.update()},detectDuration:function(){s.isFinite(this.player().duration())||null==this.el_||this.dispose()},update:function(){if(this.el_){var t=this.getPercent();isNaN(t)&&(t=0);var e=(100*t).toFixed(2)+"%";this.handle.style.left=e,this.bar.el().style.width=e}},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});t.exports=r},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(439),r=o.getComponent("Component"),a=o.extend(r,{isHidden:!0,constructor:function(t,e){r.call(this,t,e),t.ready(s.bind(this.onReady,this))},onReady:function(){this.$player=n(this.player().el_),this.$el=n(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var t=s.bind(this.hideLoader,this),e=s.bind(this.showLoader,this);this.player().on("waiting",e),this.player().on("canplay",t),this.player().on("canplaythrough",t),this.player().on("playing",t),this.player().on("seeking",e),this.player().on("seeked",t),this.player().on("ended",t),this.player().on("resolutionchange",e)},createEl:function(){return r.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>'},{"aria-label":"loading"})},hideLoader:function(t){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(t){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){r.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(439),o=s.getComponent("Component"),r=s.extend(o,{sdURL:null,hdURL:null,forceHD:null,isUsingSD:!0,timeIntervalBinding:null,constructor:function(t,e){o.prototype.constructor.call(this,t,e),this.addListeners(t)},addListeners:function(t){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,this.forceHD=this.player_.options_.forceHD,!this.hdURL||this.forceHD)return o.prototype.createEl.call(this,"div",{},{});this.player_.addClass("vjs-has-hd-toggle");var t=o.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"},{});return t},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var t;this.isUsingSD?(this.sdURL=this.currentSource(),t=this.hdURL,s.removeClass(this.el_,"vjs-sd"),s.addClass(this.el_,"vjs-hd")):(t=this.sdURL,s.removeClass(this.el_,"vjs-hd"),s.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src({src:t,type:"video/mp4"})},toggleHDState:function(){var t=this.player_.currentTime(),e=this.player_.paused(),i=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"}),n.delay(n.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",n.bind(function(){this.player_.currentTime(t)},this)),this.timeIntervalBinding=n.bind(function(){this.player_.currentTime()-t>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),e&&(this.player_.pause(),this.player_.muted(i)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),n.defer(n.bind(function(){this.player_.load(),i===!1&&e===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});t.exports=r},function(t,e,i){"use strict";var n=i(439),s=i(3),o=n.getComponent("DurationDisplay"),r=n.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.boundDetectDuration=s.bind(this.detectDuration,this),this.player().on("loadedmetadata",this.boundDetectDuration)},detectDuration:function(){s.isFinite(this.player().duration())||null==this.el_||this.dispose()},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});t.exports=r},,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(283),r=i(469),a=s.extend({className:"popover--gif-search",mixins:[o],defaults:{query:null},initialize:function(t){this.gifSearch=new r(n.pick(t,"collection","query","imageWidth","loadFullImageBeforeSelect","selectedImageUrl","resultLimit","loggingContext")),this.listenTo(this,"change:query",function(t,e){this.gifSearch.setQuery(e)}),this.listenTo(this.gifSearch,"all",this.trigger)},render:function(){this.gifSearch.render().$el.appendTo(this.$el)},teardown:function(){return n.result(this.gifSearch,"remove"),this.$el.remove(),this}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(136),r=i(214),a=i(470),l=i(502),c=function(){};c.extend=s.Model.extend,n.extend(c.prototype,s.Events);var u=new c,h=r.extend({name:"ImageSearch",selector:"body",defaults:{resultLimit:200,imageWidth:250,loadFullImageBeforeSelect:!1,query:null,selectedImageUrl:null,loggingContext:null},initialize:function(t){t=t||{},n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"collection")),n.isEmpty(this.collection)&&(this.collection=new l),this.view=new a(n.extend({eventBus:u,collection:this.collection,query:this.get("query"),imageWidth:this.get("imageWidth"),loadFullImageBeforeSelect:this.get("loadFullImageBeforeSelect"),resultLimit:this.get("resultLimit"),selectedImageUrl:this.get("selectedImageUrl"),loggingContext:this.get("loggingContext")},this.viewOptions)),this.listenTo(u,"image:select",function(t,e){this.logGifSearchEvent("select",e),this.trigger("selectImage",t.toJSON(),this.getQuery())}),this.listenTo(u,"image:impression",function(t){this.logGifSearchEvent("impression",t)}),this.listenTo(u,"gifsearch:resultChange",function(t){this.logGifSearchResultChange("search",t)}),this.listenTo(this.view,"dismiss",function(){this.trigger("dismiss")})},render:function(){return this.view.render(),this.trigger("append"),this.view},setQuery:function(t){this.view.setQuery(t)},getQuery:function(){return this.view.getQuery()},getCurrentResults:function(){return this.view.get("currentResults")},logGifSearchEvent:function(t,e){var i={popularSearch:e.model.get("popularSearchTag")?e.model.get("popularSearchTag"):null,query:this.getQuery()?this.getQuery():null,resultsIndex:this.getCurrentResults().indexOf(e.model),top:Math.round(e.$el.position().top),left:Math.round(e.$el.position().left),postBlog:e.model.get("postBlog"),postId:e.model.get("postId"),context:this.get("loggingContext")};o.trigger("gifsearch:"+t,{loggingData:i})},logGifSearchResultChange:function(t,e){var i=this.getQuery();if(i){var n={query:i,context:this.get("loggingContext")};o.trigger("gifsearch:"+t,{loggingData:n})}}});t.exports=h},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(471),a=i(232),l=i(475),c=i(477),u=i(493),h=i(496),d=i(501),p=o.extend({className:"gif-search-container",template:d,mixins:[a],keycommands:{"keydown:tab":"_onKeyPressTab","keydown:shift+tab":"_onKeyPressShiftTab"},subviews:{searchInput:{constructor:l,options:function(t){return{eventBus:t.eventBus,keyboardManager:t.keyboardManager,keyboardNamespace:"gifsearch:input"}}},searchResults:{constructor:c,options:function(t){return{imageWidth:t.get("imageWidth"),selectedImageUrl:t.get("selectedImageUrl"),loadFullImageBeforeSelect:t.get("loadFullImageBeforeSelect"),eventBus:t.eventBus,keyboardManager:t.keyboardManager,keyboardNamespace:"gifsearch:results"}}},searchMessage:{constructor:u,options:function(t){return{eventBus:t.eventBus}}}},defaults:{imageWidth:null,loadFullImageBeforeSelect:!0,resultLimit:200,selectedImageUrl:"",query:null,loggingContext:null,focusIndex:0,tabbingView:null},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection")),this.keyboardManager=new r({allowMultipleActiveViews:!0}),this.noResults=[s("Nothing turned up. Bummer."),s("Looked around but didn't see anything about that."),s("Sadly, nothing."),s("Tragically, nothing."),s("Welcome to the void. There is nothing here."),s("We found nothing. Here it isn't."),s("Couldn't find that. Please, don't be upset. Please."),s("Sincerely, we found nothing."),s("Maybe try a similar search but use different words? Dunno.")],this.listenTo(this,"change:query",this._onChangeQuery),this.listenTo(this.eventBus,"image:tag",function(t,e){this.set("query",t),this.searchInput.setValue(this.get("query"))}),this.listenTo(this.eventBus,"showHiddenResults",function(){this.searchResults.setCollection(this.get("currentResults")),this.hasResults()&&this.searchMessage.hide()})},afterRenderSubviews:function(){this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.searchInput,"focus",this._onChangeFocusView),this.listenTo(this.searchResults,"focus",this._onChangeFocusView),this.listenTo(this.searchInput,"userQueryChanged",function(t){this.setQuery(t)}),this.loader=new h({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),n.isString(this.get("query"))&&(this._onChangeQuery(this,this.get("query")),this.searchInput.setValue(this.get("query"))),n.defer(n.bind(function(){this.rendered&&this.searchInput.focus()},this)),this._focusViews=[this.searchInput,this.searchResults],this._tabbableViews=[this.searchResults],this.keyboardManager.add("gifsearch:main",this),this.focusKeys()},beforeRemove:function(){this.keyboardManager.remove("gifsearch"),this.currentQuery&&this.currentQuery.reject()},hasResults:function(){return!(n.isEmpty(this.get("currentResults"))||n.isEmpty(this.get("currentResults").models))},dismiss:function(){this.trigger("dismiss")},_onKeyPressTab:function(t){t.preventDefault(),this._moveFocusDown()},_onKeyPressShiftTab:function(t){t.preventDefault(),this._moveFocusUp()},_moveFocusUp:function(){var t=this.get("tabbingView");t&&t.set("isFocused",!1),this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var t=this._focusViews||[];this.set("focusIndex",Math.min(t.length-1,this.get("focusIndex")+1))},_onChangeFocusView:function(t){var e=this._focusViews,i=n.indexOf(e,t);this.set("tabbingView",n.contains(this._tabbableViews,t)?t:null),this.set("focusIndex",i)},_onChangeFocusIndex:function(t,e){var i=n.get(this._focusViews,e);this.set("tabbingView",n.contains(this._tabbableViews,i)?i:null),n.result(i,"focus")},_onChangeQuery:function(t,e){n.isString(e)&&(this.rendered&&this.loader.set("loading",!0),this.currentQuery&&this.currentQuery.reject(),this.searchResults.cancelPreloads(),this.searchResults.cancelFullImageLoads(),this.currentQuery=this.collection.fetchGifs(e,this.get("resultLimit"),this.get("loggingContext")),this.currentQuery.promise.then(n.bind(function(t){if(this.set("currentResults",t.media),this.rendered){this.loader.set("loading",!1);var e=t.get("message");e&&(e.header||e.body)?this.searchMessage.setMessage(e.header,e.body,this.hasResults()):(this.searchResults.setCollection(this.get("currentResults")),this.hasResults()?this.searchMessage.hide():this.searchMessage.setMessage("",n.sample(this.noResults),!1))}this.currentQuery=null},this)))},setQuery:function(t){this.set("query",t)},getQuery:function(){return this.get("query")}});t.exports=p},function(t,e,i){"use strict";var n=i(3),s=i(472),o=s.extend({name:"MessagingKeyboardManager",addKeyboardAccess:function(t){return!!n.isFunction(n.get(t,"soloKeys"))&&(t.enableKeys(),t.soloKeys(!0),!0)},removeKeyboardAccess:function(t){return!!n.isFunction(n.get(t,"unSoloKeys"))&&(t.disableKeys(),t.unSoloKeys(),!0)}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(473),r=s.extend({name:"BaseKeyboardManager",defaults:{isDebugEnabled:!1,keepInactiveItems:!0,allowMultipleActiveViews:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),this.collection=new o,this.listenTo(this.collection,"add",this._onAddItem),this.listenTo(this.collection,"remove",this._onRemoveItem),this.listenTo(this.collection,"change:isActive",this._onItemActiveChange)},addKeyboardAccess:n.noop,removeKeyboardAccess:n.noop,add:function(t,e){return!(!t||!e)&&(!this.collection.get(t)&&(this.get("keepInactiveItems")||this.get("allowMultipleActiveViews")||this.collection.remove(this.collection.models),this.collection.unshift({namespace:t,view:e}),this._adjustActiveStates(),!0))},remove:function(t){var e=this.collection.getByNamespace(t);return!n.isEmpty(e)&&(this.collection.remove(e),this._adjustActiveStates(),!0)},toggle:function(t,e,i){return i?this.add(t,e):this.remove(t)},_onAddItem:function(t){return this.addKeyboardAccess(t.get("view"))},_onRemoveItem:function(t){return this.removeKeyboardAccess(t.get("view"))},_adjustActiveStates:function(){var t,e;0!==this.collection.length&&(t=this.collection.first(),e=this.collection.rest(),t&&t.set("isActive",!0),this.get("allowMultipleActiveViews")||n.each(e,function(t){t.set("isActive",!1)},this))},_onItemActiveChange:function(t,e){return e?this.addKeyboardAccess(t.get("view")):this.removeKeyboardAccess(t.get("view"))}});t.exports=r},function(t,e,i){"use strict";var n=i(190),s=i(474),o=n.extend({model:s,getByNamespace:function(t){return this.filter(function(e){return this._isNamespaceMatch(t,e.get("namespace"))},this)},_isNamespaceMatch:function(t,e){return t===e||0===e.indexOf(t+":")}});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({idAttribute:"namespace",defaults:{namespace:null,view:null,isActive:!0}});t.exports=s},function(t,e,i){"use strict";var n=i(226),s=i(232),o=i(277),r=i(476),a=i(130),l=i(3),c=i(292),u=n.extend({className:"gif-search-input",template:r,mixins:[s,o],defaults:{isFocused:!1},events:{"focus [data-js-plainTextEditor]":"_onFocus",
"blur [data-js-plainTextEditor]":"_onBlur"},subviews:{textEditor:{constructor:c,options:function(t){return{forceSingleLine:!0,placeholder:a("Find a GIF"),syncWithModel:!1,onChange:l.debounce(l.bind(t._onUserChangeInput,t),250)}}}},initialize:function(t){t=l.extend({},t),l.extend(this,l.pick(t,"eventBus","keyboardManager","keyboardNamespace"))},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused)},_onChangeIsFocused:function(t,e){e?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onUserChangeInput:function(){this.trigger("userQueryChanged",this.textEditor.getEditorValue())},focus:function(){this.textEditor.focus()},_onFocus:function(){this.set("isFocused",!0)},_onBlur:function(){this.set("isFocused",!1)},setValue:function(t){this.textEditor.setEditorValue(t)}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="textEditor"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.prototype,r=i(478),a=i(232),l=i(479),c=i(480),u=i(482),h=i(235),d=h.animate,p=h.hook,_=i(192),g=i(492),f=function(t){var e=Math.round(t.position().top),i=Math.round(e+t.height());return{top:e,bottom:i}},m=function(t,e){return!(e.bottom<t.top||e.top>t.bottom)},v=function(t,e){return e.bottom>=t.bottom&&e.top<=t.top},b=function(t){return{top:Math.round(t.scrollTop()),bottom:Math.round(t.scrollTop()+t.height())}},y=function(t,e){return Math.floor(e.position().top/t.height())},w=function(t){return Math.floor(t.scrollTop()/t.outerHeight(!0))},k=function(t){return Math.ceil(t.get(0).scrollHeight/t.height())},C=s.extend({className:"gif-search-results",template:l,mixins:[a,r],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},subviews:{searchResults:{constructor:c,options:function(t){return{eventBus:t.eventBus,imageWidth:t.get("imageWidth"),onSelect:n.bind(t._onSubviewSelect,t),onClear:n.bind(t._onSubviewClear,t),loadFullImageBeforeSelect:t.get("loadFullImageBeforeSelect")}},collection:function(t){return t.collection}}},defaults:{renderBatchSize:50,renderBatchDelay:5,selectedImageUrl:"",imageWidth:null,loadFullImageBeforeSelect:!0,enablePreloading:!0,isPreloading:!1,preloadPollInterval:1e3,selectedView:null,isFocused:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection","keyboardManager","keyboardNamespace")),this.keyboardViewName="searchResults"},setCollection:function(t){this.collection&&this.stopListening(this.collection),this.collection=t,this.eventBus.trigger("gifsearch:resultChange",this.collection),this.rendered&&this.render()},populatePreloadQueue:function(){this._preloadQueue=n.range(k(this.$el)),this.sortPreloadQueue()},sortPreloadQueue:function(){var t;n.isEmpty(this._preloadQueue)||(t=w(this.$el),this._preloadQueue=n.sortBy(this._preloadQueue,function(e){return Math.abs(t-e)+(e<t?.1:0)}))},clearPreloadQueue:function(){this._preloadQueue&&(this._preloadQueue.length=0)},processPreloadQueue:function(){var t,e;if(!this.get("isPreloading")){if(!this.rendered||n.isEmpty(this._preloadQueue))return void this.stopPreloadPoller();t=this._preloadQueue.shift(),e=this.getViewsAtPageIndex(t),this.set("isPreloading",!0),this.preloadSubviews(e).finally(n.bind(function(){this.set("isPreloading",!1)},this)).catch(n.noop)}},startPreloadPoller:function(){this.stopPreloadPoller(),this._preloadTimer=setInterval(n.bind(this.processPreloadQueue,this),this.get("preloadPollInterval"))},stopPreloadPoller:function(){this._preloadTimer&&(clearInterval(this._preloadTimer),this._preloadTimer=null)},renderCollectionSubviews:function(t){if("searchResults"!==t)return o.renderCollectionSubviews.apply(this,arguments);var e=this.subviews[t],i=e.container||n.bind(function(){return this.$('[data-subview="'+t+'[]"]')},this),s=e.prepareView||function(i,n){var s=new e.constructor(n);return s.$el.attr("data-subview",t),i.append(s.$el),s},r=e.options||{},a=e.collection;if(n.isFunction(a)&&(a=a(this)),!a)return null;var l=this.get("renderBatchSize"),c=this.get("renderBatchDelay");this._deferredRenders=n(a.models).groupBy(function(t,e){return Math.floor(e/l)}).toArray().map(function(e,o){return n.delay(this.createCollectionSubviewRenderer(e,i,s,r,t,!!o),o*c)},this).value()},hideViews:function(t){n.each(t,function(t){t.rendered&&(t.set("isSelectable",!1),t.$el.css("opacity",0))})},animateShowViews:function(t){var e=0;n.each(t,function(t){this.animateShowView(t,100*e++)},this)},animateShowView:function(t,e,i,s){var o,r=!1;s=n.isNumber(s)?s:250,e=n.isNumber(e)?e:0,i=n.isNumber(i)?i:1e3,p(t.$el,"translateY","40px");var a=function(){r=!0,d(t.$el,"stop"),d(t.$el,{translateY:0,opacity:1},{duration:s,delay:e,complete:n.bind(function(){t.rendered&&(t.set("isSelectable",!0),t.$el.css({transform:"",opacity:""}))},this)})};i>0&&(o=setTimeout(a,i)),t.getLoadPromise().then(function(){o&&clearTimeout(o),r||a()})},beforeRender:function(){this.$el.css("visibility","hidden"),this.removeSubviews()},afterRender:function(){this.collection&&0!==this.collection.length&&(this.listenTo(this.eventBus,"image:full:loading",this.cancelPreloads),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),n.defer(n.bind(function(){if(this.rendered){this._deferredRenders||(this._deferredRenders=[]);var t=n.delay(n.bind(this.resetMasonry,this),this.get("renderBatchDelay")*this._deferredRenders.length);this._deferredRenders.push(t),this.scrollbar?this.scrollbar.update():this.scrollbar=new g(this.$el)}},this)))},removeSubviews:function(){return n.forEach(this._deferredRenders,clearTimeout),this._deferredRenders=[],delete this.masonry,o.removeSubviews.apply(this,arguments)},resetMasonry:function(){this.setupMasonary(),this.setupElementCaches(),this.get("enablePreloading")&&(this.populatePreloadQueue(),this.startPreloadPoller()),this.setSelectedImage(),this.setupVirtualization();var t=this.getSubviewsInBounds();this.hideViews(t),this.$el.css("visibility",""),this.animateShowViews(t)},getViewBounds:function(t){return n.result(this._elementPositionCache,t.cid)?this._elementPositionCache[t.cid]:f(t.$el)},getSubviewsInBounds:function(t){return t=t||b(this.$el),n.filter(this.searchResults,function(e){return m(this.getViewBounds(e),t)},this)},setupMasonary:function(){this.masonry?this.masonry.reload():this.masonry=new u(this.$(".results-scroller").get(0),{transitionDuration:0,isFitWidth:!0,gutter:10},this)},setupElementCaches:function(){var t=this.$el;this._pageIndexCache={},this._elementPositionCache={},n.each(this.searchResults,function(e){var i=y(t,e.$el);n.isArray(this._pageIndexCache[i])||(this._pageIndexCache[i]=[]),this._pageIndexCache[i].push(e),this._elementPositionCache[e.cid]=f(e.$el)},this)},getViewsAtPageIndex:function(t){return this._pageIndexCache[t]||[]},setupVirtualization:function(){var t=n.bind(function(){this.rendered&&(this.sortPreloadQueue(),this.virtualizeSubviews())},this),e=n.debounce(t,250);this.$el.off(".image-search-virtualization").on("scroll.image-search-virtualization",e),this.virtualizeSubviews()},setSelectedImage:function(){var t,e;if(this.get("selectedImageUrl")&&(e=n.find(this.searchResults,function(t,e){return t.model.get("mediaUrl")===this.get("selectedImageUrl")},this))){if(e.set("isPreselected",!0),t=e.$el.offset().top-this.$el.offset().top,0===t)return;t-=(this.$el.height()-e.$el.height())/2,this.$el.scrollTop(t)}},cancelPreloads:function(){this.stopPreloadPoller(),this.clearPreloadQueue()},cancelFullImageLoads:function(){this.eventBus.trigger("image:full:cancelLoad")},preloadSubviews:function(t,e){return _.all(n.map(t,function(t){return t.loadImage()}))},_virtualizeSubviews:function(t,e,i){n.forEach(this.searchResults,function(s,o){if(s&&s.$el){var r=this.getViewBounds(s);m(r,t)?n.isFunction(e)&&e.call(this,s,v(r,t)):n.isFunction(i)&&i.call(this,s)}},this)},virtualizeSubviews:function(){var t=this.$el,e={top:t.scrollTop(),bottom:t.scrollTop()+t.height()};this._virtualizeSubviews(e,function(t,e){t.set({isVirtualized:!1}),e&&t.get("isImpressionLogged")===!1&&(this.eventBus.trigger("image:impression",t),t.set("isImpressionLogged",!0))},function(t){t.set({isVirtualized:!0})})},beforeRemove:function(){this.$el.off(),this.cancelPreloads(),this.cancelFullImageLoads(),this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_setIsFocused:function(t){this.rendered&&this.set("isFocused",t)},_onChangeSelectedView:function(t,e){var i=this.previous("selectedView");i&&i.setSelected(!1),e&&e.setSelected(!0)},_onChangeIsFocused:function(t,e){e?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("selectedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onSubviewSelect:function(t){this.get("isFocused")||this._setIsFocused(!0),this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.searchResults,t)),this.set("selectedView",this.getSelectedView(this.keyboardViewName))},_onSubviewClear:function(){this.set("selectedView",null),this.deselect(this.keyboardViewName)},focus:function(){var t=this.get("selectedView"),e=!n.isEmpty(t);this._setIsFocused(!0),e?this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.searchResults,t)):this.set("selectedView",this.selectFirst(this.keyboardViewName))},isLastViewSelected:function(){return this.isLastSelected(this.keyboardViewName)},isFirstViewSelected:function(){return this.isFirstSelected(this.keyboardViewName)},_onKeyPressDown:function(t){var e;t.preventDefault(),e=this.isLastViewSelected()?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",e)},_onKeyPressUp:function(t){var e;t.preventDefault(),e=this.isFirstViewSelected()?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",e)},_onKeyPressEnter:function(t){var e=this.get("selectedView");t.preventDefault(),e&&e.select(t)}});t.exports=C},function(t,e,i){"use strict";var n=i(3),s=i(187),o=new s({defaults:{hasSelection:function(t){return this._validateParams(t)?n.has(this._selectedIndexes,t):null},getSelectedIndex:function(t){return this._validateParams(t)?n.get(this._selectedIndexes,t,0):null},deselect:function(t){this._validateParams(t)&&this.hasSelection(t)&&delete this._selectedIndexes[t]},resetSelected:function(t){this._validateParams(t)&&this.setSelectedIndex(t,0)},setSelectedIndex:function(t,e){var i;return this._validateParams(t)?(i=n.get(this,t,[]),e=Math.max(0,Math.min(e,i.length-1)),n.set(this._selectedIndexes,t,e),e):null},getSelectedView:function(t){var e;return this._validateParams(t)?(e=n.get(this,t,[]),n.get(e,this.getSelectedIndex(t))):null},isFirstSelected:function(t){return this._validateParams(t)?0===this.getSelectedIndex(t):null},isLastSelected:function(t){var e;return this._validateParams(t)?(e=n.get(this,t,[]),this.getSelectedIndex(t)===e.length-1):null},selectFirst:function(t){var e;if(!this._validateParams(t))return null;e=n.get(this,t,[]);var i=this.setSelectedIndex(t,0);return n.get(e,i)},selectLast:function(t){var e;if(!this._validateParams(t))return null;e=n.get(this,t,[]);var i=this.setSelectedIndex(t,e.length-1);return n.get(e,i)},selectNext:function(t){var e,i;return this._validateParams(t)?this.hasSelection(t)?(e=n.get(this,t,[]),i=this._increaseSelectedIndex(t),n.get(e,i)):this.selectFirst(t):null},selectPrevious:function(t){var e,i;return this._validateParams(t)?(e=n.get(this,t,[]),i=this._decreaseSelectedIndex(t),n.get(e,i)):null},_validateParams:function(t){return!!t},_increaseSelectedIndex:function(t){return this._validateParams(t)?this.setSelectedIndex(t,this.getSelectedIndex(t)+1):null},_decreaseSelectedIndex:function(t){return this._validateParams(t)?this.setSelectedIndex(t,this.getSelectedIndex(t)-1):null}},before:{initialize:function(){this._selectedIndexes={}}}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="results-scroller" data-subview="searchResults[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(481),a=i(259),l=i(277),c=i(331),u=i(192),h=o.extend({className:"gif-search-result",tagName:"a",attributes:{href:"#",tabIndex:1},template:r,events:{"click [data-js-select]":"_onClickSelect","click [data-js-tag]":"_onClickTag",mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[l],defaults:{skipTags:["gif","gifs"],imageWidth:null,isVirtualized:!0,hasStillImage:!0,isPreselected:!1,unloadImageOnVirtualize:!1,isLoaded:!1,isSelectable:!0,loadFullImageBeforeSelect:!0,loadingFullImage:!1,containerWidth:150,isImpressionLogged:!1,isSelected:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","onSelect","onClear")),this._loadDefer=u.defer()},afterRender:function(){this.listenTo(this,"change:isPreselected",this._onChangeIsPreselected),this.listenTo(this,"change:isVirtualized",this._onChangeIsVirtualized),this.listenTo(this,"change:hasStillImage",this._onChangeHasStillImage),this.listenTo(this,"change:isSelectable",this._onChangeIsSelectable),this.listenTo(this,"change:isLoaded",this._onChangeIsLoaded),this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this.eventBus,"image:full:cancelLoad",this._onCancelAllFullImageLoads),this._onChangeIsVirtualized(this,this.get("isVirtualized")),this._onChangeHasStillImage(this,this.get("hasStillImage")),this._onChangeIsPreselected(this,this.get("isPreselected")),this._onChangeIsSelectable(this,this.get("isSelectable")),this._onChangeIsLoaded(this,this.get("isLoaded"))},getTemplateData:function(){var t=this.model.toJSON(),e=t.popularSearchTag?[t.popularSearchTag]:t.postTags,i=this.get("skipTags"),s=this.get("containerWidth"),o=Math.round(this.model.get("height")*(s/this.model.get("width")));return e=n.reject(e,function(t){return n.contains(i,t.toLowerCase())}),n.extend(t,{tags:e.slice(0,3),width:s,height:o}),this.get("imageWidth")&&n.extend(t,{mediaUrl:t.mediaUrl.replace(/_\d+\./,"_"+this.get("imageWidth")+".")}),t},loadImage:function(){var t=this.js$("img"),e=t.attr("data-img-src");return this.get("isLoaded")||(t.attr("src",e),a.load(e,100).then(n.bind(function(){this.rendered&&this.set("isLoaded",!0),this._loadDefer.resolve()},this))),this._loadDefer.promise},unloadImage:function(){this.js$("img").removeAttr("src")},refreshStillImage:function(){this._onChangeHasStillImage(this,this.get("hasStillImage"))},getLoadPromise:function(){return this._loadDefer.promise},_onCancelAllFullImageLoads:function(){this._cancelLoadFullImage()},_onClickSelect:function(t){t.preventDefault(),n.isFunction(this.onSelect)&&this.onSelect(this,this.model);var e=this.model.get("mediaUrl"),i=this.js$("img").attr("src"),s=function(){this.$el.addClass("gif-search-result--selected"),this.eventBus.trigger("image:select",this.model,this)};this.get("loadFullImageBeforeSelect")&&e!==i?this._loadFullImage(e,s):s.call(this)},select:function(t){this._onClickSelect(t)},_loadFullImage:function(t,e){this.eventBus.trigger("image:full:cancelLoad"),this.set("loadingFullImage",!0),this.eventBus.trigger("image:full:loading"),this.loader=new c({variation:"centered small",loading:!0}),this.$el.addClass("loading-full").append(this.loader.render().$el),a.load(t).then(n.bind(function(){this.get("loadingFullImage")&&n.isFunction(e)&&e.call(this)},this)).finally(n.bind(this._cancelLoadFullImage,this))},_cancelLoadFullImage:function(){this.rendered&&this.get("loadingFullImage")&&(this.loader&&(this.loader.remove(),this.loader=null),this.$el.removeClass("loading-full"),this.set("loadingFullImage",!1))},_onClickTag:function(t){var e=s(t.target).attr("data-js-tag");this.eventBus.trigger("image:tag",e,this.model),t.preventDefault(),t.stopPropagation()},_onChangeIsPreselected:function(t,e){this.$el.toggleClass("gif-search-result--preselected",e)},_onChangeIsVirtualized:function(t,e){this.$el.toggleClass("off",e),e&&this.get("unloadImageOnVirtualize")?this.unloadImage():e||this.loadImage()},_onChangeHasStillImage:function(t,e){this._removeStillCanvas(),e&&this._prepareCreateStillCanvas()},_onChangeIsSelectable:function(t,e){this.$el.toggleClass("gif-search-result--selectable",e)},_onChangeIsLoaded:function(t,e){this.$el.toggleClass("loaded",e)},_createStillCanvas:function(){if(this.rendered){var t,e=this.js$("img"),i=e.parent(),n=parseInt(e.width(),10),o=parseInt(e.height(),10),r=s("<canvas />").attr({width:n,height:o});this.$("canvas").remove(),i.append(r),t=r.get(0).getContext("2d"),t.drawImage(e.get(0),0,0,n,o),this.$el.addClass("show-still")}},_prepareCreateStillCanvas:function(){this.getLoadPromise().then(n.bind(this._createStillCanvas,this)).catch(n.noop)},_removeStillCanvas:function(){this.$("canvas").remove(),this.$el.removeClass("show-still")},setSelected:function(t){this.rendered&&this.set("isSelected",t)},_onChangeIsSelected:function(t,e){this.$el.toggleClass("selected",e),this.$el.focus()},_onMouseEnter:function(t){n.isFunction(this.onSelect)&&this.onSelect(this)},_onMouseLeave:function(t){n.isFunction(this.onClear)&&this.onClear(this)}});t.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<figure data-js-select style="width: '+__e(width)+"px; height: "+__e(height)+'px"><img data-js-img data-img-src="'+__e(mediaUrl)+'" width="'+__e(width)+'" height="'+__e(height)+'"></figure><footer><nav class="tags"> ',_.each(tags,function(t){__p+=" ",_.isEmpty(t)||(__p+=' <a href="#" data-js-tag="'+__e(t)+'">#'+__e(t)+"</a> "),__p+=" "}),__p+=' </nav><a class="attribution" href="http://tmblr.co/'+__e(rootPostUrlHash)+'" target="_blank">'+__e(__("Originally posted by %1$s",rootBlog))+"</a></footer>";return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(436),r=i(136),a=i(219),l=i(230),c=a.extend({mixins:[l],tplScrollbarWrapper:'<div class="tx-scroll"></div>',tplScrollbarTrackVertical:'<div data-js-track-vertical class="tx-scrollbar-track tx-scrollbar-track--vertical"><div data-js-thumb-vertical class="tx-scrollbar-thumb"></div></div>',tplScrollbarTrackHorizontal:'<div data-js-track-horizontal class="tx-scrollbar-track tx-scrollbar-track--horizontal"><div data-js-thumb-horizontal class="tx-scrollbar-thumb"></div></div>',defaults:{trackActiveClass:"tx-scrollbar-track--active",scrollingClass:"tx-scroll--scrolling",containerClass:"tx-scroll-container",containerClassVertical:"tx-scroll-container--vertical",containerClassHorizontal:"tx-scroll-container--horizontal",infiniteScrollPercent:.9,isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1,isScrolling:!1,nativeScrollbarSize:20},events:{"mousedown [data-js-thumb-vertical]":"_onVerticalThumbMousedown","mousedown [data-js-thumb-horizontal]":"_onHorizontalThumbMousedown"},destroyed:!1,constructor:function(t){var e=this._getElementFromOptions(t);return null===e?null:(this.container=e,this.$container=s(e),n.extend(t,{el:this._getWrappedElement(e)}),a.prototype.constructor.call(this,t))},initialize:function(t){this.$window=s(window),this._onScrollStopDebounced=n.debounce(n.bind(this._onScrollStop,this),150),this._onResizeDebounced=n.debounce(n.bind(this._onResize,this),150),this.render()},render:function(){return this.rendered&&!this.destroyed?this:(this.listenTo(r,"DOMEventor:flatresize",this._onResizeDebounced),this.listenTo(this,"change:isScrollableVertical",this._onChangeIsScrollableVertical),this.listenTo(this,"change:isScrollableHorizontal",this._onChangeIsScrollableHorizontal),this.listenTo(this,"change:isScrollable",this._onChangeIsScrollable),this.update(),this.destroyed=!1,a.prototype.render.apply(this,arguments))},getVerticalTrack:function(){return this.$verticalTrack},getHorizontalTrack:function(){return this.$horizontalTrack},getVerticalThumb:function(){return this.$verticalThumb},getHorizontalThumb:function(){return this.$horizontalThumb},getScrollContainer:function(){return this.container},isScrollable:function(){return this.get("isScrollable")},isScrollableVertical:function(){return this.get("isScrollableVertical")},isScrollableHorizontal:function(){return this.get("isScrollableHorizontal")},update:function(){var t,e,i;this.destroyed||(t=this._isScrollableVertical(),e=this._isScrollableHorizontal(),i=t||e,this.set({isScrollableVertical:t,isScrollableHorizontal:e,isScrollable:i}),this._updateScrollConstants(),t&&(this._updateVerticalThumbHeight(),this._positionVerticalThumb()),e&&(this._updateHorizontalThumbWidth(),this._positionHorizontalThumb()))},remove:function(){return this.destroy()},destroy:function(){this.$container.off(".txScroll"),this.$window.off(".txScroll"),this.set({isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1}),this.undelegateEvents(),this.stopListening(),this._unwrapContainer(),this.destroyed=!0},_getElementFromOptions:function(t){var e;return e=t instanceof s?t.get(0):t instanceof window.Element?t:n.get(t,"el",null)},_getWrappedElement:function(t){var e=t instanceof s?t:s(t),i=s(this.tplScrollbarWrapper);return e.wrap(i),i=e.parent(),i.get(0)},_unwrapContainer:function(){this.$container.unwrap()},_appendVerticalTrack:function(){var t=s(this.tplScrollbarTrackVertical);this.$verticalTrack=t,this.$verticalThumb=t.find("[data-js-thumb-vertical]"),this.$el.append(t)},_removeVerticalTrack:function(){var t=this.getVerticalTrack();t&&(t.remove(),delete this.$verticalTrack,delete this.$verticalThumb)},_appendHorizontalTrack:function(){var t=s(this.tplScrollbarTrackHorizontal);this.$horizontalTrack=t,this.$horizontalThumb=t.find("[data-js-thumb-horizontal]"),this.$el.append(t)},_removeHorizontalTrack:function(){var t=this.getHorizontalTrack(!0);t&&(t.remove(),delete this.$horizontalTrack,delete this.$horizontalThumb)},_onChangeIsScrollable:function(t,e){var i;this.destroyed||(i="ontouchstart"in document.documentElement,i||this.$container.off("wheel.txScroll"),this.$container.off("scroll.txScroll"),this.$container.toggleClass(this.get("containerClass"),e),e&&(this.$container.on("scroll",n.bind(this._onScroll,this)),i||this.$container.on("wheel.txScroll",n.bind(this._stealScroll,this))))},_onChangeIsScrollableVertical:function(t,e){this.destroyed||(this.$container.toggleClass(this.get("containerClassVertical"),e),e?this._appendVerticalTrack():this._removeVerticalTrack())},_onChangeIsScrollableHorizontal:function(t,e){this.destroyed||(this.$container.toggleClass(this.get("containerClassHorizontal"),e),e?this._appendHorizontalTrack():this._removeHorizontalTrack())},_updateScrollConstants:function(){var t=this.getVerticalTrack(),e=this.getHorizontalTrack(),i=this.getVerticalThumb(),n=this.getHorizontalThumb();this.currentScrollTop=this.$container.scrollTop(),this.currentScrollLeft=this.$container.scrollLeft(),this.get("isScrollableVertical")&&t&&i&&(this.percentageDifferenceVertical=(this.container.scrollHeight-this.$container.height())/(t.height()-i.height())),this.get("isScrollableHorizontal")&&e&&n&&(this.percentageDifferenceHorizontal=(this.container.scrollWidth-this.$container.width())/(e.width()-n.width()))},_onResize:function(){this.trigger("resize"),this.update()},_getAddedScrollbarHeight:function(){return this.get("isScrollableHorizontal")?this.get("nativeScrollbarSize"):0},_getAddedScrollbarWidth:function(){return this.get("isScrollableVertical")?this.get("nativeScrollbarSize"):0},_isScrollableVertical:function(){return this.container&&this.container.scrollHeight>this.$container.height()+this._getAddedScrollbarHeight()},_isScrollableHorizontal:function(){return this.container&&this.container.scrollWidth>this.$container.width()+this._getAddedScrollbarWidth()},_getScrollTop:function(t,e){return t.pageY-e.offset().top},_getScrollLeft:function(t,e){return t.pageX-e.offset().left},_onVerticalThumbMousedown:function(t){var e=this.getVerticalTrack();t.preventDefault(),e&&(e.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",n.bind(this._onVerticalThumbMousemove,this)),this.$window.on("mouseup.txScroll",n.bind(this._onVerticalThumbMouseup,this)),this.mouseDownOriginalOffsetY=this._getScrollTop(t,e),this._updateScrollConstants())},_onHorizontalThumbMousedown:function(t){var e=this.getHorizontalTrack();t.preventDefault(),e&&(e.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",n.bind(this._onHorizontalThumbMousemove,this)),this.$window.on("mouseup.txScroll",n.bind(this._onHorizontalThumbMouseup,this)),this.mouseDownOriginalOffsetX=this._getScrollLeft(t,e),this._updateScrollConstants())},_onVerticalThumbMousemove:function(t){var e,i=this.getVerticalTrack();i&&o.read(function(){this.destroyed||(e=this._getScrollTop(t,i)-this.mouseDownOriginalOffsetY,o.write(function(){this.destroyed||this.$container.scrollTop(this.currentScrollTop+e*this.percentageDifferenceVertical)},this))},this)},_onVerticalThumbMouseup:function(t){var e=this.getVerticalTrack();t.preventDefault(),e&&e.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_onHorizontalThumbMousemove:function(t){var e,i=this.getHorizontalTrack();i&&o.read(function(){this.destroyed||(e=this._getScrollLeft(t,i)-this.mouseDownOriginalOffsetX,o.write(function(){this.destroyed||this.$container.scrollLeft(this.currentScrollLeft+e*this.percentageDifferenceHorizontal)},this))},this)},_onHorizontalThumbMouseup:function(t){var e=this.getHorizontalTrack();t.preventDefault(),e&&e.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_updateVerticalThumbHeight:function(){var t,e=this.getVerticalThumb(),i=this.getVerticalTrack();i&&e&&(t=this.$container.height()/this.container.scrollHeight,e.height(i.height()*t))},_updateHorizontalThumbWidth:function(){var t,e=this.getHorizontalThumb(),i=this.getHorizontalTrack();i&&e&&(t=this.$container.width()/this.container.scrollWidth,e.width(i.width()*t))},_positionVerticalThumb:function(){var t,e,i,n=this.getVerticalTrack(),s=this.getVerticalThumb();!this.destroyed&&n&&s&&(i=this.container.scrollTop,t=i/(this.container.scrollHeight-this.$container.height()),e=n.height()-s.height(),o.write(function(){this.destroyed||(s.css("transform","translate3d(0, "+e*t+"px, 0)"),this.trigger("scroll:vertical",i,t),this.trigger("scroll",i,t),t>this.get("infiniteScrollPercent")&&this.trigger("infinitescroll",i,t))},this))},_positionHorizontalThumb:function(){var t,e,i,n=this.getHorizontalTrack(),s=this.getHorizontalThumb();!this.destroyed&&n&&s&&(i=this.container.scrollLeft,t=i/(this.container.scrollWidth-this.$container.width()),e=n.width()-s.width(),o.write(function(){this.destroyed||(s.css("transform","translate3d("+e*t+"px, 0, 0)"),this.trigger("scroll:horizontal",i,t))},this))},_onScroll:function(){this.get("isScrolling")||(this.trigger("scrollstart"),this.$el.addClass(this.get("scrollingClass"))),this.set("isScrolling",!0),this._onScrollStopDebounced(),this.get("isScrollableVertical")&&o.read(n.bind(this._positionVerticalThumb,this)),this.get("isScrollableHorizontal")&&o.read(n.bind(this._positionHorizontalThumb,this))},_onScrollStop:function(){this.destroyed||(this.trigger("scrollstop"),this.set("isScrolling",!1),this.$el.removeClass(this.get("scrollingClass")))},_stealScroll:function(t){var e=t.currentTarget,i=t.originalEvent.deltaX,n=t.originalEvent.deltaY,o=Math.abs(i)>0,r=Math.abs(n)>0;this.get("isScrollableHorizontal")&&o&&(i<0&&e.scrollLeft<=0&&t.preventDefault(),i>0&&e.scrollLeft>=e.scrollWidth-s(e).width()-this._getAddedScrollbarWidth()&&t.preventDefault()),this.get("isScrollableVertical")&&r&&(n<0&&e.scrollTop<=0&&t.preventDefault(),n>0&&e.scrollTop>=e.scrollHeight-s(e).height()-this._getAddedScrollbarHeight()&&t.preventDefault())}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(494),o=i(226),r=i(495),a=o.extend({className:"gif-search-message",template:r,defaults:{header:"",body:"",hasResults:!1},events:{"click [data-js-showResults]":"_onClickShowResults"},initialize:function(t){n.extend(this,n.pick(t,"eventBus"))},_onClickShowResults:function(){this.eventBus.trigger("showHiddenResults")},_filterMessageHtml:function(t,e){e.find("script, link").remove(),e.find("a[onerror]").removeAttr("onerror")},getTemplateData:function(){var t=o.prototype.getTemplateData.apply(this,arguments);return t.body=s(t.body||"",this._filterMessageHtml),t},afterRender:function(){this.rendered||this.listenTo(this,"change",this.render),this.$el.toggleClass("gif-search-message--hidden",!(this.get("header")||this.get("message")))},setMessage:function(t,e,i){n.isString(e)||(e=t,t=""),n.isBoolean(i)||(i=this.get("hasResults")),this.set({header:t,body:e,hasResults:i}),e||t?this.show():this.hide()},show:function(){this.$el.removeClass("gif-search-message--hidden")},hide:function(){this.$el.addClass("gif-search-message--hidden")}});t.exports=a},function(t,e,i){"use strict";function n(t,e){var i=r.nodeFromString(t),n=o(i);return s.isFunction(e)&&(e=s.rest(arguments)),s.each(e,function(t){t(i,n)}),n.html()}var s=i(3),o=i(8),r=i(354);t.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="gif-search-message-container"> ',header&&(__p+=' <h2 class="gif-search-message-header">'+(null==(__t=header)?"":__t)+"</h2> "),__p+=' <div class="gif-search-message-body">'+(null==(__t=body)?"":__t)+"</div> ",hasResults&&(__p+=' <p><span class="gif-search-show-results" data-js-showresults>'+__e(__("View results anyway"))+"</span></p> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(497);t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(498),r=i(500),a=s.extend({className:"loader-container",template:r,defaults:{type:"",classModifiers:"",loading:!1},initialize:function(t){this.options=n.extend({},this.defaults,t),this.$container=t.$container,"bar"===this.get("type")&&this.createBarLoader(),this.listenTo(this,"change:loading",this._onChangeLoading),this.attach()},createBarLoader:function(){this.subviews.loaderType=new o(this.options)},_onChangeLoading:function(t,e){this.subviews.loaderType.toggleLoading(e)},attach:function(){this.render(),this.$el.attr("data-subview=loader"),this.$container.find("[data-subview=loader]").replaceWith(this.$el)}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(499),r=s.extend({className:"loader-bar",template:o,defaults:{classModifiers:"",loading:!1},initialize:function(t){this.options=n.extend({},this.defaults,t),this.$el.addClass(this.get("classModifiers")),this.interval=null,this.timeout=null},afterRender:function(){this.$bars=this.$el.find(".bar"),this.get("loading")===!0&&this.toggleLoading(this.get("loading"))},toggleLoading:function(t){
this.currentBar=0,this.counter=0,t===!0?(clearTimeout(this.timeout),this.$el.addClass("loading"),this.$bars.addClass("animating"),this.startAnimating()):(this.$el.removeClass("loading"),this.stopAnimating(),this.timeout=setTimeout(n.bind(function(){this.$bars.removeClass("animating")},this),300))},showBar:function(t){this.$bars.eq(t).addClass("active")},hideBar:function(t){this.$bars.eq(t).removeClass("active")},loop:function(){var t=this.$bars.eq(this.currentBar);t.remove(),this.$el.append(t),this.currentBar+=1,this.currentBar>=this.$bars.length&&(this.currentBar=0),this.counter++},startAnimating:function(){this.stopAnimating(),this.loop(),this.interval=setInterval(n.bind(function(){this.loop()},this),300)},stopAnimating:function(){clearInterval(this.interval)},beforeRemove:function(){clearInterval(this.interval),clearTimeout(this.timeout)}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="bar white"></div><div class="bar red"></div><div class="bar orange"></div><div class="bar green"></div><div class="bar purple"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="loader-type" data-subview="loaderType"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchInput"></div><div data-subview="loader"></div><div data-subview="searchResults"></div><div data-subview="searchMessage"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(190),r=i(503),a=3e5,l=o.extend({model:r,resultCountForQuery:function(t){t=(t||"").toLowerCase().trim();var e=this.get(t);return e?e.media.length:0},fetchGifs:function(t,e,i,o){var l,c=s.defer();t=(t||"").toLowerCase().trim();var u=this.get(t);return u||(u=new r({query:t,limit:e,loggingContext:i}),this.add(u)),!o&&n.now()-u.get("ts")<a?(this.trigger("search",t,!0),c.resolve(u)):(this.trigger("search",t,!1),l=u.fetch({success:function(){l=null,c.resolve(u)},error:function(t){l=null,c.reject(t)}})),c.promise.catch(function(){l&&l.abort()}),c},clearCache:function(t){this.remove(t)}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(185),o=s.prototype,r=i(504),a=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack},l=s.extend({idAttribute:"query",url:"/svc/search/inline_gif",defaults:{query:"",limit:200,loggingContext:null},initialize:function(t,e){this.media=new r},fetch:function(t){var e=this.get("loggingContext"),i={q:this.get("query"),limit:this.get("limit")};return n.isEmpty(e)||n.extend(i,{context:e}),t=n.extend({type:"POST",withFormKey:!0,data:i},t),o.fetch.call(this,t)},parse:function(t,e){if(e&&e.xhr&&(t=(t||{}).response),n.isEmpty(t))throw new a("Invalid GIF search response",this.get("query"),t);return this.media.reset(t.media),delete t.media,t.ts=n.now(),t},toJSON:function(){var t=o.toJSON.apply(this,arguments);return t.media=this.media?this.media.toJSON():[],t}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(505),r=s.extend({model:o,previousFrom:function(t){return this.rotateFrom(t,-1)},nextFrom:function(t){return this.rotateFrom(t,1)},rotateFrom:function(t,e){for(var i=(n.isNumber(t)?this.at(t):this.findWhere({mediaUrl:t}))||this.sample(),s=this.indexOf(i)+e;s<0;)s+=this.length;return this.at(s%this.length)}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(185),o=i(258),r=s.extend({defaults:{mediaUrl:"",postUrl:"",rootPostUrl:"",rootPostUrlHash:"",rootBlog:"",rootBlogUrl:"",rootBlogKey:"",postTags:[],popularSearchTag:"",width:0,height:0},initialize:function(t,e){this.attributes={},this.set(n.defaults(o(t||{}),this.defaults))}});t.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(531),r=i(273),a=(i(274),s.extend({name:"Upload",initialize:function(t){t=n.extend({},t),this.collection=t.collection||(t.collection=new r),this.indexView=new o(t),this.listenTo(this.collection,"all",this._relayCollectionEvent)},_relayCollectionEvent:function(){this.trigger.apply(this,arguments)},addFiles:function(t){return this.indexView.add({files:t})},promise:function(){return this.indexView.promise()},teardown:function(){return this.remove()},remove:function(){return this.indexView.remove(),this.stopListening(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el},getCurrentRequest:function(){return this.indexView.jqXHR}}));t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(6).sprintf,o=i(219),r=i(187),a=i(192),l=i(136),c=i(130),u=i(273),h=i(274),d=i(532),p=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],_=["add","send","progress","active","enable","disable"],g=o.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",message:{cancel:"Canceled upload",error:"Upload error",filesize:"The file is too big. Squish it down, and try again!",filetype:"This is not valid %1$s file."},fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(t,e){var i=new h(t);return this.collection.add(i,e||{}),i},_createUploadModelForFile:function(t,e,i){e=n.extend({file:t},e);var s=this._createUploadModel(e,i);return t._uploadModel=s,s},initialize:function(t){if(this.options=n.merge({},this.defaults,t),this.options.url&&(this.options.fileUpload.url=this.options.url),this.options.collection?this.collection=this.options.collection:this.collection=new u,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var e=n.merge({},this._fileUploadWrap);n.forEach(p,function(t){n.isFunction(e.defaults[t])||(e.defaults[t]=n.noop)},this);var i=new r(e);i.applyTo(this.options.fileUpload),n.forEach(p,function(t){this.options.fileUpload[t]=d(this.options.fileUpload[t],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),n.forEach(_,function(t){this[t]=function(){var e=n.toArray(arguments);e.unshift(t),this._fileUploadInvoke.apply(this,e)}},this)},_fileUploadInvoke:function(t){return this._fileUpload[t].apply(this._fileUpload,n.rest(arguments))},validateFile:function(t,e){e||(e=this.options);var i=[];return e.maxUploadSize&&t.size>e.maxUploadSize&&(l.trigger("postform-interaction:upload-limit-hit",{loggingData:{fileSize:t.size,fileType:t.type,maxSize:e.maxUploadSize}}),i.push({type:"filesize",message:s(e.message.filesize,e.maxUploadSize)})),e.uploadPattern&&t.type&&!e.uploadPattern.test(t.type)&&i.push({type:"filetype",message:s(e.message.filetype,e.mediaType)}),i},upload:function(t){this.add({files:[t]})},cancel:function(){var t;return this.jqXHR?(t=this.jqXHR.abort(),this.jqXHR=null):t=a.reject(this.options.message.cancel),t},_forMatchingFiles:function(t,e){var i=n.rest(arguments);this.collection.forEach(function(s){if(n.contains(t,s.get("file"))){var o=n.clone(i);o[0]=s,e.apply(this,o)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(t,e,i){this._fileUpload.options.replaceFileInput&&this.setElement(t)},add:function(t,e,i){var s=i.files[0],o=this.validateFile(s),r={},a={};if(!n.isEmpty(o)){r.error=n.pluck(o,"message"),r.file=s;var l={errorType:"validation",messages:o,file:s};this.collection.trigger("invalid",this.collection,new this.collection.model(r)),this.trigger("error",l),a.silent=!0}return this._createUploadModelForFile(s,r,a),n.isEmpty(o)},send:function(t,e,i){return!0}},before:{},after:{done:function(t,e,i){var s,o=n.get(i,"result.meta.status"),r=n.get(i,"result.response"),a=n.get(i,"result.errors");if(200!==o||n.isEmpty(r)){var l=function(){return r&&r.msg?r.msg:n.isArray(a)?n.isEmpty(a)?c("Woops :("):a:a.join(" ")}();s={error:l,uploading:!1}}else n.isArray(r)&&(r=r[0]),s=n.extend({complete:!0,uploading:!1},r);this._forMatchingFiles(i.files,function(t,e){t.set(e)},s)},fail:function(t,e,i){var s;s="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},s.responseJSON=n.get(i,"jqXHR.responseJSON"),this._forMatchingFiles(i.files,function(t,e){t.set(e)},s)},progress:function(t,e,i){this._forMatchingFiles(i.files,function(t,e){t.set(e)},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(t,e,i,s){var o=t.apply(this,n.rest(arguments));return o!==!1&&!i.isDefaultPrevented()&&((s.autoUpload||s.autoUpload!==!1&&this._fileUpload.options.autoUpload)&&s.process().done(n.bind(function(){this.jqXHR=s.submit()},this)),o)},send:function(t,e,i,s){s.withFormKey=!0;var o=t.apply(this,n.rest(arguments));if(o){this._forMatchingFiles(s.files,function(t,e){t.set(e)},{uploading:!0});var r={files:s.files};this.collection.trigger("send",this.collection,r),this.trigger("send",r)}return o}}}});t.exports=g},function(t,e,i){"use strict";var n=function(t,e){return e||(e=this),function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(e,i)}};t.exports=n},,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";function n(){return o||(o=new r),o}function s(){return!!o}var o,r=i(552);t.exports={getInstance:n,hasInstance:s}},function(t,e,i){"use strict";function n(t,e){t instanceof o&&(t=t.get(0)),e instanceof o&&(e=e.get(0)),t&&e&&s.forEach(u,function(i){t.hasAttribute(i)&&e.setAttribute(i,t.getAttribute(i))})}var s=i(3),o=i(8),r=i(214),a=r.prototype,l=i(553),c=i(553).LivePhoto,u=["width","height","data-pin-url","data-pin-description"],h=r.extend({name:"LivePhotos",autoAppend:!0,initialize:function(){this.instances=[]},create:function(t){var e=t instanceof o?t:o(t);if(e.length){var i=e.closest("a, [data-lightbox]");if(i.length){var s,r;i.on("mousedown.livephoto touchstart.livephoto",function(){s=!1,i.prop("livePhotoSneezeguard",!0),r=setTimeout(function(){i.prop("livePhotoSneezeguard",!1),s=!0},750)}),i.on("click.livephoto",function(t){clearTimeout(r),s&&t.preventDefault()})}var a=new c(e.get(0));return this.instances.push(a),n(e,a.img),a}return null},remove:function(){return l.cleanup(),a.remove.call(this)},append:function(){return l.addStyles(),a.append.call(this)}});t.exports=h},function(t,e,i){!function(e,i){t.exports=i()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function n(t,e){if(u){d&&s(),"object"==typeof t&&"[object Object]"===t.toString()&&(e=t,t=e.elements,delete e.elements),t||(t="img[data-live-photo]"),"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof HTMLElement&&(t=[t]);var i=[];return Array.prototype.forEach.call(t,function(t){if("string"==typeof t&&(t=document.querySelector(t)),t){var n=new l(t,e);i.push(n)}}),i}}function s(){c.use(),h++}function o(){d=!1}function r(){for(;h>0;)c.unuse(),h--}function a(t,e){return n(t,e)}var l=i(1),c=i(4),u=!0,h=0,d=!0;a.initialize=n,a.addStyles=s,a.noStyles=o,a.cleanup=r,a.LivePhoto=l,t.exports=a},function(t,e,i){function n(t,e,i,n){var s=document.createElement("video");return s.src=t+(i?"#"+i:""),s.controls=!1,s.muted=n||!1,s.preload="auto",e&&(s.className=e),c(s,!n),s}function s(t,e){if(t.paused){var i=t.muted,n=t.currentTime,s=function(){t.removeEventListener("loadedmetadata",s),t.currentTime=n,e&&e(t)};t.muted=!0,t.play(),t.pause(),t.muted=i,t.duration>=0?s():t.addEventListener("loadedmetadata",s)}}function o(t,e,i){var s=document.createElement("div");s.className="live-photo",s.setAttribute("data-live-photo","");var o=document.createElement("img");o.className="live-photo-keyframe",o.src=t;var r=n(e,"live-photo-postroll",i,!0),a=n(e,"live-photo-video"),l=document.createElement("i");return l.className="live-photo-icon",s.appendChild(o),s.appendChild(r),s.appendChild(a),s.appendChild(l),{container:s,img:o,postroll:r,video:a,icon:l}}function r(){var t=["mousedown"];return u&&t.push("touchstart"),t}function a(){var t=["mouseup","mouseout"];return u&&t.push("touchend"),t}function l(t,e,i,n){if(!(this instanceof l))return new l(t,e,i,n);var s,r;if(t instanceof HTMLElement&&(n=e,r=t,e=r.getAttribute("data-live-photo"),i=parseFloat(r.getAttribute("data-live-photo-still-image-time")),t=r.src),n||(n={}),this.postrollMs=n.postrollMs||375,this.deactivateMs=n.deactivateMs||500,this.previewMs=n.previewMs||500,this.stillImageTime=i||NaN,!t&&!n.noErrors)throw new Error("LivePhoto Error: Missing keyframeUrl");if(!e&&!n.noErrors)throw new Error("LivePhoto Error: Missing videoUrl");s=o(t,e,i),r&&(r.parentNode.insertBefore(s.container,r),r.parentNode.removeChild(r)),this.container=s.container,this.img=s.img,this.video=s.video,this.postroll=s.postroll,this.icon=s.icon,this.__onVideoCanPlayThrough=this._onVideoCanPlayThrough.bind(this),this.__onVideoLoadededMetadata=this._onVideoLoadededMetadata.bind(this),this.__onPostrollTimeUpdate=this._onPostrollTimeUpdate.bind(this),this.__startVideoPlayback=this._startVideoPlayback.bind(this),this.__startPostrollPlayback=this._startPostrollPlayback.bind(this),this.__resetPlayback=this._resetPlayback.bind(this),this.__resetPreview=this._resetPreview.bind(this),this.video.addEventListener("canplaythrough",this.__onVideoCanPlayThrough),this.video.duration?(this._setDuration(this.video.duration),this._resetPostroll()):(this._setDuration(0),this.video.addEventListener("loadedmetadata",this.__onVideoLoadededMetadata)),this._playing=!1,this._canPlayThrough=!1,this._playWhenReady=!1,n.useEventHandlers!==!1&&this._addEventHandlers(n.playEvents,n.stopEvents)}var c=i(2),u="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints;l.prototype={_addEventHandlers:function(t,e){var i=this.container,n=!1,o=this.play.bind(this),l=this.video,c=this.postroll,u=function(t){if(t.preventDefault(),n)o();else{var e=!1,i=!1;s(l,function(){e=!0,i&&o()}),s(c,function(){i=!0,e&&o()}),n=!0}};t&&t!==!1||(t=r),"function"==typeof t&&(t=t(this)),"string"==typeof t&&(t=t.split(/[,\s]+/)),t.forEach(function(t){t&&i.addEventListener(t,u)});var h=this.stop.bind(this),d=function(t){t.preventDefault(),h()};e&&e!==!1||(e=a),"function"==typeof e&&(e=e(this)),"string"==typeof e&&(e=e.split(/[,\s]+/)),e.forEach(function(t){t&&i.addEventListener(t,d)})},_onVideoCanPlayThrough:function(){this._canPlayThrough=!0,this._playWhenReady&&(this._playWhenReady=!1,this.play()),this.container.classList.remove("loading"),this.video.removeEventListener("canplaythrough",this.__onVideoCanPlayThrough)},_onVideoLoadededMetadata:function(){this._setDuration(this.video.duration||0),this._resetPostroll(),this.video.removeEventListener("loadedmetadata",this.__onVideoLoadededMetadata)},_onPostrollTimeUpdate:function(t){this.postroll.currentTime>=this.stillImageTime-.1&&this._resetPreview()},_clearTimeouts:function(){clearTimeout(this._resetVideoTimeout),clearTimeout(this._resetPostrollTimeout),clearTimeout(this._resetPreviewTimeout),this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate)},_setDuration:function(t){this.duration=t,("number"!=typeof this.stillImageTime||isNaN(this.stillImageTime))&&(this.stillImageTime=.5*t),this.previewStart=Math.max(0,this.stillImageTime-this.previewMs/1e3)},_resetPostroll:function(){this.postroll.pause(),this.postroll.currentTime=this.stillImageTime},_resetVideo:function(){this.video.pause(),this.video.currentTime=0,this.video.muted=!1},_startVideoPlayback:function(){this.video.play(),this._resetPostroll()},_startPostrollPlayback:function(){this._resetPostroll(),this.postroll.play()},_resetPlayback:function(){this._playing=!1,this._resetVideo(),this._resetPostroll()},_resetPreview:function(){this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate),this._resetPostroll(),this.container.classList.remove("preview")},load:function(){this.video.load(),this.postroll.load()},play:function(){if(!this._playing){if(!this._canPlayThrough)return this._playWhenReady=!0,this._clearTimeouts(),this.load(),void this.container.classList.add("loading");this._playing=!0,this._clearTimeouts(),this._startPostrollPlayback(),this.video.currentTime=0,this._resetPostrollTimeout=setTimeout(this.__startVideoPlayback,this.postrollMs),this.container.classList.add("active")}},stop:function(){this._playing&&(this.video.muted=!0,this._clearTimeouts(),this.container.classList.remove("active"),this._resetVideoTimeout=setTimeout(this.__resetPlayback,this.deactivateMs))},preview:function(){this._playing||(this._clearTimeouts(),this.postroll.currentTime=this.previewStart,this.postroll.play(),this.container.classList.add("preview"),this._previewCompleteTimeout=setTimeout(this.__resetPreview,1e3*(this.stillImageTime-this.previewStart)),this.postroll.addEventListener("timeupdate",this.__onPostrollTimeUpdate))}},t.exports=l},function(t,e,i){/*! npm.im/iphone-inline-video */
"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function s(t){function e(s){i=requestAnimationFrame(e),t(s-(n||s)),n=s}var i,n;this.start=function(){i||e(0)},this.stop=function(){cancelAnimationFrame(i),i=null,n=0}}function o(t,e,i,n){function s(e){Boolean(t[i])===Boolean(n)&&e.stopImmediatePropagation(),delete t[i]}return t.addEventListener(e,s,!1),s}function r(t,e,i,n){function s(){return i[e]}function o(t){i[e]=t}n&&o(t[e]),Object.defineProperty(t,e,{get:s,set:o})}function a(t,e,i){i.addEventListener(e,function(){return t.dispatchEvent(new Event(e))})}function l(t,e){Promise.resolve().then(function(){t.dispatchEvent(new Event(e))})}function c(t){var e=new Audio;return a(t,"play",e),a(t,"playing",e),a(t,"pause",e),e.crossOrigin=t.crossOrigin,e.src=t.src||t.currentSrc||"data:",e}function u(t,e,i){(v||0)+200<Date.now()&&(t[k]=!0,v=Date.now()),i||(t.currentTime=e),S[++T%3]=100*e|0}function h(t){return t.driver.currentTime>=t.video.duration}function d(t){var e=this;e.video.readyState>=e.video.HAVE_FUTURE_DATA?(e.hasAudio||(e.driver.currentTime=e.video.currentTime+t*e.video.playbackRate/1e3,e.video.loop&&h(e)&&(e.driver.currentTime=0)),u(e.video,e.driver.currentTime)):e.video.networkState!==e.video.NETWORK_IDLE||e.video.buffered.length||e.video.load(),e.video.ended&&(delete e.video[k],e.video.pause(!0))}function p(){var t=this,e=t[w];return t.webkitDisplayingFullscreen?void t[C]():("data:"!==e.driver.src&&e.driver.src!==t.src&&(u(t,0,!0),e.driver.src=t.src),void(t.paused&&(e.paused=!1,t.buffered.length||t.load(),e.driver.play(),e.updater.start(),e.hasAudio||(l(t,"play"),e.video.readyState>=e.video.HAVE_ENOUGH_DATA&&l(t,"playing")))))}function _(t){var e=this,i=e[w];i.driver.pause(),i.updater.stop(),e.webkitDisplayingFullscreen&&e[x](),i.paused&&!t||(i.paused=!0,i.hasAudio||l(e,"pause"),e.ended&&(e[k]=!0,l(e,"ended")))}function g(t,e){var i=t[w]={};i.paused=!0,i.hasAudio=e,i.video=t,i.updater=new s(d.bind(i)),e?i.driver=c(t):(t.addEventListener("canplay",function(){t.paused||l(t,"playing")}),i.driver={src:t.src||t.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,h(i)&&u(t,0)},get ended(){return h(i)}}),t.addEventListener("emptied",function(){var e=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==t.src&&(u(t,0,!0),i.driver.src=t.src,e?i.driver.play():i.updater.stop())},!1),t.addEventListener("webkitbeginfullscreen",function(){t.paused?e&&!i.driver.buffered.length&&i.driver.load():(t.pause(),t[C]())}),e&&(t.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=t.currentTime}),t.addEventListener("seeking",function(){S.indexOf(100*t.currentTime|0)<0&&(i.driver.currentTime=t.currentTime)}))}function f(t){var e=t[w];t[C]=t.play,t[x]=t.pause,t.play=p,t.pause=_,r(t,"paused",e.driver),r(t,"muted",e.driver,!0),r(t,"playbackRate",e.driver,!0),r(t,"ended",e.driver),r(t,"loop",e.driver,!0),o(t,"seeking"),o(t,"seeked"),o(t,"timeupdate",k,!1),o(t,"ended",k,!1)}function m(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),i&&!y||t[w]||(g(t,e),f(t),t.classList.add("IIV"),!e&&t.autoplay&&t.play(),"MacIntel"!==navigator.platform&&"Windows"!==navigator.platform||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}var v,b=n(i(3)),y=/iPhone|iPod/i.test(navigator.userAgent)&&void 0===document.head.style.grid,w=b(),k=b(),C=b("nativeplay"),x=b("nativepause"),S=[],T=0;m.isWhitelisted=y,t.exports=m},function(t,e){"use strict";var i="undefined"==typeof Symbol?function(t){return"@"+(t||"@")+Math.random()}:Symbol;t.exports=i},function(t,e,i){var n,s=0,o=i(5);"string"==typeof o&&(o=[[t.id,o,""]]),e.use=e.ref=function(){return s++||(e.locals=o.locals,n=i(7)(o,{})),e},e.unuse=e.unref=function(){--s||(n(),n=null)}},function(t,e,i){e=t.exports=i(6)(),e.push([t.id,".live-photo {\n  position: relative;\n  overflow: hidden;\n  cursor: pointer; }\n  .live-photo video,\n  .live-photo img {\n    display: block;\n    max-width: 100%;\n    pointer-events: none;\n    -ms-touch-action: none;\n        touch-action: none; }\n  .live-photo video {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 100%; }\n    .live-photo video::-webkit-media-controls-start-playback-button {\n      display: none; }\n  .live-photo .live-photo-icon {\n    display: block;\n    position: absolute;\n    top: 12px;\n    left: 12px;\n    width: 24px;\n    height: 24px;\n    background: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='48' height='48' viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Ctitle%3ELive Photo%3C/title%3E%3Cg fill-rule='evenodd'%3E%3Cpath d='M24 36c6.627 0 12-5.373 12-12s-5.373-12-12-12-12 5.373-12 12 5.373 12 12 12zm0-2c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z'/%3E%3Cpath d='M24 29a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-3a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.788.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462 1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.849 4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-1.85 4.461a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462 1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM24 44a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.788-.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462-1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM6.13 30.288a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 25.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63-4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.85-4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462-1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z'/%3E%3C/g%3E%3C/svg%3E\") center center;\n    background-size: contain;\n    -webkit-filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.5));\n            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.5));\n    pointer-events: none; }\n  .live-photo .live-photo-postroll,\n  .live-photo .live-photo-video {\n    opacity: 0; }\n  .live-photo .live-photo-video {\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  .live-photo .live-photo-keyframe,\n  .live-photo .live-photo-postroll,\n  .live-photo .live-photo-video {\n    will-change: transform, filter, opacity;\n    transition: opacity 0.5s linear, -webkit-transform 0.5s ease-out, -webkit-filter 0.5s linear;\n    transition: transform 0.5s ease-out, filter 0.5s linear, opacity 0.5s linear;\n    transition: transform 0.5s ease-out, filter 0.5s linear, opacity 0.5s linear, -webkit-transform 0.5s ease-out, -webkit-filter 0.5s linear; }\n  .live-photo.loading .live-photo-icon {\n    -webkit-animation: live-photo-icon-loading 0.5s linear alternate infinite both;\n            animation: live-photo-icon-loading 0.5s linear alternate infinite both; }\n  .live-photo.preview .live-photo-postroll {\n    opacity: 1;\n    transition-duration: 0s; }\n  .live-photo.active video,\n  .live-photo.active img {\n    -webkit-transform: scale(1.075, 1.075);\n        -ms-transform: scale(1.075, 1.075);\n            transform: scale(1.075, 1.075); }\n  .live-photo.active .live-photo-postroll {\n    -webkit-animation: live-photo-post-roll 1s both;\n            animation: live-photo-post-roll 1s both; }\n  .live-photo.active .live-photo-video {\n    opacity: 1;\n    -webkit-filter: none;\n            filter: none;\n    transition-delay: 0.375s;\n    transition-duration: 0.625s; }\n\n@-webkit-keyframes live-photo-icon-loading {\n  0% {\n    opacity: 1; }\n  100% {\n    opacity: 0.75; } }\n\n@keyframes live-photo-icon-loading {\n  0% {\n    opacity: 1; }\n  100% {\n    opacity: 0.75; } }\n\n@-webkit-keyframes live-photo-post-roll {\n  0% {\n    opacity: 0;\n    -webkit-filter: blur(0);\n            filter: blur(0); }\n  2% {\n    opacity: 1; }\n  37.5% {\n    opacity: 1;\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  100% {\n    opacity: 0; } }\n\n@keyframes live-photo-post-roll {\n  0% {\n    opacity: 0;\n    -webkit-filter: blur(0);\n            filter: blur(0); }\n  2% {\n    opacity: 1; }\n  37.5% {\n    opacity: 1;\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  100% {\n    opacity: 0; } }\n",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var i=this[e];i[2]?t.push("@media "+i[2]+"{"+i[1]+"}"):t.push(i[1])}return t.join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(n[o]=!0)}for(s=0;s<e.length;s++){var r=e[s];"number"==typeof r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),t.push(r))}},t}},function(t,e,i){function n(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=p[n.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(c(n.parts[o],e))}else{for(var r=[],o=0;o<n.parts.length;o++)r.push(c(n.parts[o],e));p[n.id]={id:n.id,refs:1,parts:r}}}}function s(t){for(var e=[],i={},n=0;n<t.length;n++){var s=t[n],o=s[0],r=s[1],a=s[2],l=s[3],c={css:r,media:a,sourceMap:l};i[o]?i[o].parts.push(c):e.push(i[o]={id:o,parts:[c]})}return e}function o(t,e){var i=f(),n=b[b.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),b.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=b.indexOf(t);e>=0&&b.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function l(t){var e=document.createElement("link");return e.rel="stylesheet",o(t,e),e}function c(t,e){var i,n,s;if(e.singleton){var o=v++;i=m||(m=a(e)),n=u.bind(null,i,o,!1),s=u.bind(null,i,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(e),n=d.bind(null,i),s=function(){r(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(e),n=h.bind(null,i),s=function(){r(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}function u(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=y(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function h(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function d(t,e){var i=e.css,n=e.sourceMap;n&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var s=new Blob([i],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(s),o&&URL.revokeObjectURL(o)}var p={},_=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},g=_(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),f=_(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,v=0,b=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=g()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var i=s(t);return n(i,e),function(t){for(var o=[],r=0;r<i.length;r++){var a=i[r],l=p[a.id];l.refs--,o.push(l)}if(t){var c=s(t);n(c,e)}for(var r=0;r<o.length;r++){var l=o[r];if(0===l.refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete p[l.id]}}}};var y=function(){var t=[];return function(e,i){return t[e]=i,t.filter(Boolean).join("\n")}}()}])})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(604);t.exports=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=i(226),o=n(s),r=i(3),a=n(r),l=i(605),c=n(l),u=i(8),h=n(u),d=i(136),p=n(d),_=o.default.extend({className:"native-audio-container",template:c.default,events:{"click .play-pause":"playPause","mousedown .audio-player":"onMouseDown","mousemove .audio-player":"onMouseMove","mouseup .audio-player":"onMouseUp","mouseleave .audio-player":"onMouseLeave"},initialize:function(t){t=t||{},this.streamUrl=t.streamUrl+"?plead=please-dont-download-this-or-our-lawyers-wont-let-us-host-audio",this.playing=!1,this.track=t.track,this.artist=t.artist,this.albumArt=t.albumArt,this.preview=t.preview,this.noId3=t.noId3,this.model=t.model,this.dragging=!1,this.mousedown=!1},render:function(){this.$el.html(this.template({post:this.model,streamUrl:this.streamUrl,track:this.track,artist:this.artist,albumArt:this.albumArt,noId3:this.noId3}));var t=this.$("audio"),e=this.$(".audio-source");return this.player=t[0],this.icon=this.$(".icon"),this.progress=this.$(".progress"),this.$player=this.$(".audio-player"),this.artist||this.track||this.$(".track-no-id3").css("display","block"),t.on("playing",a.default.bind(this.onPlay,this)),t.on("pause",a.default.bind(this.onPause,this)),t.on("timeupdate",a.default.bind(this.onTimeUpdate,this)),t.on("error",a.default.bind(this.onError,this)),e.on("error",a.default.bind(this.onError,this)),this.listenTo(p.default,"NativeAudio:play",this.stopOtherAudio),this},onPlay:function(){this.model&&p.default.trigger("NativeAudio:play",this.model.get("id")),this.icon.removeClass("icon_play").addClass("icon_pause"),this.playing=!0},stopOtherAudio:function(t){this.model&&this.model.get("id")!==t&&(this.pause(),this.setPlayerTime(0))},onMouseDown:function(t){(0,h.default)(t.target).hasClass("play-pause")||(this.mousedown=!0),this.dragging=!1},onError:function(){this.icon.removeClass("icon_pause icon_play").addClass("icon_close"),this.$el.addClass("error"),this.undelegateEvents()},onMouseMove:function(t){if(this.mousedown){this.dragging=!0,this.playing&&this.pause();var e=(0,h.default)(t.target),i=void 0;if(e.hasClass("audio-player"))i=t.offsetX/this.$player.outerWidth()*this.player.duration;else{var n=e.closest(".audio-player").offset();i=(t.pageX-n.left)/this.$player.outerWidth()*this.player.duration}this.setPlayerTime(i)}},onMouseUp:function(t){var e=(0,h.default)(t.target);if(this.playing){if(this.mousedown&&!this.dragging&&e.hasClass("audio-player")){var i=t.offsetX/this.$player.outerWidth()*this.player.duration;this.setPlayerTime(i)}}else this.play();this.mousedown=!1,this.dragging=!1},onMouseLeave:function(t){this.mousedown=!1,this.dragging=!1},onPause:function(){this.icon.removeClass("icon_pause").addClass("icon_play"),this.playing=!1},afterRender:function(){this.$el.toggleClass("audio-player--preview-player",this.preview)},playPause:function(t){t.stopPropagation(),this.playing?this.pause():this.play()},play:function(){this.player.play()},pause:function(){this.player.pause()},setPlayerTime:function(t){isNaN(t)||(this.player.currentTime=t)},teardown:function(){(0,h.default)(this.player).off()},onTimeUpdate:function(){this.player.currentTime===this.player.duration?this.progress.css("width",0):this.progress.css("width",this.player.currentTime/this.player.duration*100+"%")}});t.exports=_},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="audio-player',albumArt&&(__p+=" has-art "),__p+='"><div class="progress"></div><div class="play-pause"><i class="icon icon_play"></i></div><div class="audio-info"><div class="track-name">'+__e(track)+'</div><div class="track-artist">'+__e(artist)+'</div><div class="track-no-id3">'+__e(noId3)+'</div></div><audio preload="none"><source class="audio-source" src="'+__e(streamUrl)+'"></audio></div> ',albumArt&&(__p+=' <div class="audio-image"><img src="'+__e(albumArt)+'" alt="'+__e(track)+'"></div> ');return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(235).animate,o=i(219),r=i(241),a=i(276),l=i(277),c=i(230),u=o.extend({className:"post-forms-glass",mixins:[a,l,c],initialize:function(t){this.options=t=n.extend({active:!1,visible:!1},t),this.set({active:!!t.active,visible:!!t.visible}),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(t){return this.set("active",!(null!=t&&!t)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(t){return this.set("active",!(null==t&&!t)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var t=this._showing=s(this.$el,{opacity:1},{duration:r(150),display:"block"});return t},_hide:function(){var t=this._hiding=s(this.$el,{opacity:0},{duration:r(150),display:this.get("active")?"block":"none"});return t},_changeActive:function(t,e){e?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||n.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});t.exports=u},function(t,e,i){"use strict";var n=i(8),s=i(235).animate,o=i(219),r=i(241),a=i(276),l=i(277),c=i(230),u=i(627),h=o.extend({className:"post-forms-modal",mixins:[a,l,c],template:u,initialize:function(t){this.set("visible",t&&t.visible),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:"none"}),this.$body=n("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(t){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=t,this.listenTo(t,"prepared",this._onSubViewPrepare),this.listenTo(t,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onSubViewPrepare:function(t){this.show()},_onSubViewTeardown:function(t){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var t=s(this.$el,{opacity:1},{duration:r(100),display:"block"});return t},_hide:function(){this._enableBodyScroll();var t=s(this.$el,{opacity:0},{duration:r(100),display:"none"});return t},_toggleVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});t.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(235).animate,r=i(238),a=i(241),l=i(240),c=i(219),u=(i(132),i(276)),h=i(277),d=i(230),p=i(629),_=i(630),g=i(632),f=c.extend({mixins:[u,h,d,l],template:g,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(t){t instanceof c&&(t={postForm:t}),this.options=t=n.extend({},this.defaultOptions,t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),t.postForm&&this.setPostForm(t.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(t,e){o(this.$el,"stop"),e||n.isNumber(e)?o(this.$el,{"min-height":e},{duration:a(Math.min(Math.max(250,e),750))}):(e=n.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,e]},{duration:a(Math.min(Math.max(250,e),750))}).then(n.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(t,e){e?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(t,e){e?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(t){if(this._postFormComponent!==t)return this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=t,this.postForm=t.postForm,this},prepare:function(t){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=n.delay(n.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(t).then(n.bind(function(){return this._hideOriginalContent=!1,this},this))),s.resolve(this)},attach:function(t){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),s.resolve(this)},hideOriginalContent:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),r([function(){null!=e&&this.$el.css("height",e),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return s.join(t(),this.originalContent.animateHide(a(100)))}],this)},showPostForm:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),r([function(){if(!this.options.animateHeightWithContent&&!this.originalContent.get("hidden"))return this._hideOriginalContent||this.hideOriginalContent(t)},function(){var n=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&n.push(this._hideOriginalContent||this.hideOriginalContent(t)),null==i||null==e||(i===e?this.$el.height(i):n.push(o(this.$el,{height:[i,e]},{duration:a(150),easing:[.4,1.3,.7,1]}))),s.all(n)},function(){return this.set("placeholder",!1),this.postForm.animateShow(a(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height","")}],this)},hidePostForm:function(t){var e=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent||(i=e),r([function(){this.$el.css("height",e),this.set("midtransition",!0)},function(){return this.postForm.animateHide(a(100))},function(){if(this.set("pretransition",!0),null==i||null==e);else{if(i!==e)return o(this.$el,{height:[i,e]},{duration:a(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return s.join(t(),this.originalContent.animateShow(a(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new _),this.originalContent||(this.options.originalContent instanceof p?this.originalContent=this.options.originalContent:this.originalContent=new p({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,this.subViews.postForm=this.postForm,this.attachSubViews(),this},afterRender:function(){return this.$el.addClass("post-forms-above-glass is_persistent"),this.renderSubViews()},beforeTeardown:function(){return this.subViews.loader=null,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition is_persistent"),this.loader&&(this.loader.remove(),this.loader=null),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});t.exports=f},function(t,e,i){"use strict";var n=i(3),s=i(235).animate,o=i(219),r=i(276),a=i(230),l=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[r,a],initialize:function(t){this.set("hasContent",t&&t.el),this.originalCSS=this._getCSS(["opacity"]),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:hidden",this._onChangeHidden)},_getCSS:function(t){var e={};return n.forEach(t,function(t){e[t]=this.$el.css(t)},this),e},_onChangeEnabled:function(t,e){this.$el.toggleClass("no-pointer-events",!e)},_onChangeHidden:function(t,e){this.$el.toggleClass("collapse",e)},measureHeight:function(){if(!this.get("hasContent"))return null;var t=this.get("hidden");this.set("hidden",!1);var e=this.$el.outerHeight();return this.set("hidden",t),e},animateShow:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:1},{duration:t,delay:e,begin:n.bind(function(){this.set("hidden",!1)},this)})},animateHide:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:0},{duration:t,delay:e}).then(n.bind(function(){this.set("hidden",!0)},this))},render:function(){return this},teardown:function(){return this.$el.css(this.originalCSS),this}});t.exports=l},function(t,e,i){"use strict";var n=i(219),s=i(276),o=i(277),r=i(230),a=i(631),l=n.extend({className:"post-forms-loader",mixins:[s,o,r],template:a,initialize:function(t){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",t&&t.loading)},_onChangeLoading:function(t,e){this.isRendered()&&(e?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))},render:function(){return this.$el.html(this.template(this.attributes)),this}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)transitionBackground&&(__p+=' <div class="post-transition-background"></div> '),__p+=" ",originalContent&&(__p+=' <div data-subview="originalContent"></div> '),__p+=' <div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(235).animate,r=i(629),a=i(277),l=i(230),c=i(136),u=i(246),h=r.extend({mixins:[a,l],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(t){this.postType=t},animateShow:function(t,e){return t||(t=0),e||(e=0),this.$el.css({display:"block",opacity:1}),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:1,translateY:[0,10],opacity:1},{duration:t,delay:e}),o(u,{translateY:[0,10],opacity:1},{duration:t,delay:e})];return n.length&&r.length&&h.push(o(r,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:t,delay:e}),o(a,{translateY:[0,0],opacity:1},{duration:t,delay:e})),s.all(h)}.call(this,this.postType)},animateHide:function(t,e){t||(t=0),e||(e=0),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:[1,1],translateY:[10,0],opacity:0},{duration:t,delay:e}),o(u,{translateY:[10,0],opacity:0},{duration:t,delay:e})];return n.length&&r.length&&h.push(o(r,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:t,delay:.5*t+e}),o(a,{translateY:[0,0],opacity:0},{duration:t,delay:e})),s.all(h)}.call(this,this.postType).then(n.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(t){if(t.stopPropagation(),t.preventDefault(),this.get("enabled")){var e=t.currentTarget.getAttribute("data-post-endpoint")||t.currentTarget.getAttribute("data-post-type");c.trigger("postForms:open",{postType:e,postFormType:u.inline})}}});t.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+__e(icons.length)+'"> ',_.forEach(icons,function(t,e){__p+=' <div class="tab-post-type item" data-index="'+__e(e)+'" data-post-type="'+__e(t.name)+'"><div class="post-type-icon icon-'+__e(t.name)+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+__e(t.label)+"</span></div></div> "}),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(226),s=i(129),o=i(3),r=i(8),a=n.extend({events:{mouseleave:"onMouseLeave",mouseenter:"onMouseEnter"},defaults:{totalImages:1,changeOnHover:!0,image:!1,shouldAnimate:!1},initialize:function(t){this.assetsHost=s.get("Context/hosts/assets_host"),this.isRetina=window.devicePixelRatio&&window.devicePixelRatio>1,this.$imageContainer=this.$(".preload-container"),this.animations=o.get(t,"data.animations",[]);var e=Array.isArray(this.animations)&&this.animations.length>0;this.set("shouldAnimate",e),e&&(this.set("totalImages",this.animations.length),this.generateImageIds(),this.get("image")||(this.applyRandomImage(),this.addImageToContainer()),this.setBackgroundImage(this.get("image")),this.listenTo(this,"change:image",function(t,e){this.addImageToContainer(),this.setBackgroundImage(e)}))},generateImageIds:function(){
this.imageIds=o.shuffle(o.range(1,this.get("totalImages")+1))},onMouseEnter:function(t){var e=this;if(this.get("shouldAnimate")){var i=this.getCurrentImageObject();i.get(0)&&i.get(0).complete?this.$el.addClass("opacity-switch"):i.on("load",function(){e.$el.is(":hover")&&e.get("image")===i.data("imgId")&&e.onMouseEnter()})}},onMouseLeave:function(t){var e=this;this.get("shouldAnimate")&&(this.$el.removeClass("opacity-switch"),this.get("changeOnHover")&&setTimeout(function(){e.applyRandomImage()},200))},addImageToContainer:function(){if(!this.getCurrentImageObject().get(0)){var t=this.get("image");if(t>this.animations.length)return;var e=this.animations[t-1],i=this.isRetina?1:0;if(!Array.isArray(e)||i>e.length)return;var n=e[i];n&&r('<img data-img-id="'+t+'">').attr("src",n).appendTo(this.$imageContainer)}},applyRandomImage:function(){0===this.imageIds.length&&this.generateImageIds(),this.set("image",this.imageIds[0]),this.imageIds.shift()},getCurrentImageObject:function(){return this.$imageContainer.find('[data-img-id="'+this.get("image")+'"]')},setBackgroundImage:function(t){this.$imageContainer.css("background-image","url("+this.getCurrentImageObject().attr("src")+")")}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(182),r=i(637),a=s.extend({events:{click:"openPopover"},updateBadge:function(t){t>0&&this.$(".tab_notice_value").text(t>99?"99+":t),this.$(".tab_notice").toggleClass("tab-notice--active",t>0)},initialize:function(){this.popover=null,this.user=o(),this.updateBadge(this.user.getUnreadCount()),this.popoverOptions={container:this.$el,viewOptions:{}}},openPopover:function(t){if(t.preventDefault(),this.popover)this.popover.show();else{var e=this.$el.closest(".l-header-container");e.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"===e.css("position")),r(n.bind(function(t){this.popover=new t(this.popoverOptions).render()},this))}}});t.exports=a},function(t,e,i){"use strict";var n=i(248),s=i(638),o=new s("account-popover"),r=function(t){o.start(),i.e(3,function(e){try{t(i(639))}catch(t){n(t,"account-popover")}finally{o.end()}})};t.exports=r},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(3),r=i(136),a=function(){function t(e){if(n(this,t),o.isString(e)?e={chunkName:e}:e||(e={}),!e.chunkName,!1)throw new Error("Async latency logger requires a chunkName");this.chunkName=e.chunkName||""}return s(t,[{key:"start",value:function(){this.startTime=Date.now()}},{key:"end",value:function(){this.startTime&&r.trigger("async-loading:complete:"+this.chunkName,{loggingData:{chunkName:this.chunkName,latency:Date.now()-this.startTime,userAgent:o.get(window,"navigator.userAgent",""),path:o.get(document,"location.pathname")}})}}]),t}();t.exports=a},,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(180),a=i(647),l=i(182),c=s.extend({events:{click:"openPopover"},initialize:function(t){this.popover=null,this.user=l(),this.channels=this.user.channels,this.popoverOptions={container:this.$el,viewOptions:{}},r.bool("activity_badging")&&(this.mentionKeys=this.channels.reduce(function(t,e){return t[e.get("mention_key")]=e.id,t},{}),this.listenTo(o,"activity:updateActivityUnreadCounts",this.getUnreadActivityBadgeCount),this.listenTo(this.channels,"change:unread_activity_count_sum",this.updateBadge),this.listenTo(o,"refresh_activities_count",this.user.getUnreadActivityBadgeCount))},getUnreadActivityBadgeCount:function(t){this.popover&&this.popover._container.classList.contains("active")||n.each(t,function(t,e){var i=this.mentionKeys[e],n=this.channels.get(i);n&&n.set("unread_activity_count_sum",t)},this)},updateBadge:function(){var t=n.sum(this.channels.pluck("unread_activity_count_sum"));t>0&&this.$(".tab_notice_value").text(t>99?"99+":t),this.$(".tab_notice").toggleClass("tab-notice--active",t>0)},openPopover:function(t){if(t.preventDefault(),this.popover)this.popover.show();else{var e=this.$el.closest(".l-header-container");e.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"===e.css("position")),this.popover=new a(this.popoverOptions).render()}var i={loggingData:{source:"app-header"}};o.trigger("Kraken:ActivityClick",i)}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(648),r=i(182),a=s.extend({name:"ActivityPopover",view:function(t){return t=n.extend({},{model:r(),pinnedTarget:this.container,isFixedPosition:!0,autoTeardown:!1,teardownOnEscape:!1},t),new o(t)},show:function(){this.view.show()},render:function(){return this.view.render(),this.trigger("append"),this}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(130),r=i(226),a=i(649),l=i(136),c=i(265),u=i(180),h=i(283),d=i(284),p=i(220).transition,_=i(192),g=i(650),f=i(654),m=i(656),v=i(213),b=i(496),y=r.extend({defaults:{popoverData:{},preventInteraction:!0,currentTumblelog:!1,isActivityBadging:u.bool("activity_badging")},className:"popover--activity-popover",mixins:[h],template:a,initialize:function(t){if(this.options=n.extend({},this.defaults,t),!this.get("currentTumblelog")){var e=this.model.channels.findWhere({is_current:!0});this.set("currentTumblelog",e)}},render:function(){return this.$el.html(this.template()),this.$pinned.addClass("active"),this.$activityNotifications=this.$(".activity-popover-notifications"),this.$activityHeader=this.$(".activity-popover-header"),this.$activityPopoverMenu=this.$(".popover_menu"),n.delay(n.bind(function(){this.$activityPopoverMenu.addClass("popover--active"),this.bindClickOutside(),this.addTumblelogPopoverZIndex()},this),1),this.subviews.tumblelogSelect=new g({className:"activity-popover-tumblelog-select-container",collection:this.model.channels,dropdownClass:"popover--activity-popover-tumblelog-select-dropdown",popoverOptions:{popoverContainer:".popover--activity-popover"},badgeCountField:"unread_activity_count_sum"}),this.prepareActivityNotifications(),this.listenTo(this.subviews.tumblelogSelect,"change:currentTumblelog",this.updateSubviews),this},addTumblelogPopoverZIndex:function(){this.$el.attr("data-tumblelog-popover-zindex",this.$el.css("z-index"))},bindClickOutside:function(){var t={preventInteraction:!0,ignoreSelectors:[".popover_content_wrapper",".tumblelog_popover",".ui_peepr_glass",".drawer",".ui_dialog_pos"]};this.clickOutside=new d(this.el,t),this.clickOutside.on("click:outside",this.hide,this),this.clickOutside.on("click:inside",this.hideActivityPopover,this),this.listenTo(l,"DOMEventor:keyup:escape",this.hide)},unbindClickOutside:function(){this.clickOutside.remove(),this.clickOutside=null,this.stopListening(l,"DOMEventor:keyup:escape")},markActivitiesRead:function(){this.get("currentTumblelog").set("unread_activity_count_sum",0)},createSubviews:function(){this.removeSubviews(),this.toggleLoader(!1),this.subviews.sparkline=new f({model:this.get("currentTumblelog")}),this.subviews.activityNotifications=new m({model:this.get("currentTumblelog")}),this.get("isActivityBadging")&&this.markActivitiesRead(),this.rendered&&(this.appendSubview(this.subviews.sparkline,this.$activityHeader),this.appendSubview(this.subviews.activityNotifications,this.$activityNotifications))},loadData:function(){return this.get("currentTumblelog").fetch_activity_notifications()},hasNecessaryData:function(){return this.get("currentTumblelog").has("activity_notifications")},prepareActivityNotifications:function(){return _.promise(n.bind(function(t,e){!this.hasNecessaryData()||this.get("isActivityBadging")?(this.toggleLoader(!0),this.loadData().then(n.bind(function(){t(this.createSubviews())},this)).catch(function(t){e(t)})):t(this.createSubviews())},this)).catch(n.bind(function(t){this.toggleLoader(!1),v.alert(o("Woops :("))},this))},updateSubviews:function(t,e){this.set("currentTumblelog",e),l.trigger("Kraken:NotificationBlogSwitch",{loggingData:{position:this.model.channels.findIndex({name:e.get("name")}),total:this.model.channels.length}}),this.prepareActivityNotifications()},removeSubviews:function(){this.subviews&&n.each(this.subviews,function(t){t.get("removable")&&t.remove()})},toggleLoader:function(t){t===!0?this.loader?this.loader.set("loading",!0):this.loader=new b({$container:this.$el,type:"bar",classModifiers:"bottom",loading:!0}):this.loader&&this.loader.set("loading",!1)},beforeTeardown:function(){return this.remove(),this.$pinned.removeClass("active"),this},hideActivityPopover:function(t){var e=s(t.target),i=e.closest(".tumblelog_popover"),o=e.closest("[href]");n.isEmpty(i)||n.isEmpty(o)||!c.isTumblelogUrl(o.attr("href"))||this.hide()},hide:function(){this.unbindClickOutside(),this.$pinned.removeClass("active"),this.$activityPopoverMenu.removeClass("popover--active"),p(this.$el,n.bind(function(){this.afterHide()},this))},afterHide:function(){this.$el.css({display:"none"}),this.get("isActivityBadging")&&(this.subviews.activityNotifications.remove(),delete this.subviews.activityNotifications,l.trigger("refresh_activities_count"))},show:function(){this.bindClickOutside(),this.$pinned.addClass("active"),this.$el.css({display:"block"}),this.$activityPopoverMenu.addClass("popover--active"),this.prepareActivityNotifications()}});t.exports=y},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"><div class="activity-popover-header"> '+(null==(__t=_subview("tumblelogSelect"))?"":__t)+" "+(null==(__t=_subview("sparkline"))?"":__t)+" "+(null==(__t=_subview("loader"))?"":__t)+' </div><div class="activity-popover-notifications"> '+(null==(__t=_subview("activityNotifications"))?"":__t)+" </div></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(651),r=i(652),a=i(277),l=i(250),c=s.extend({template:o,mixins:[a],defaults:{currentTumblelog:!1,isOpen:!1,requiresDropdown:!1,showCaret:!0,showName:!0,dropdownClass:null,popoverOptions:null,avatarSize:96,badgeCountField:null,showTotalBadge:!0,showNumberInBadge:!1,includeCurrentBlogInTotalBadge:!1,maxBadgeCount:99,badgeActiveClass:"has-badge"},events:{"click [data-js-button]":"toggleDropdown"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"collection")),this.get("currentTumblelog")||this.set("currentTumblelog",this.collection.findWhere({is_current:!0})),this.set("requiresDropdown",this.collection.length>1),!n.isEmpty(this.get("badgeCountField"))&&this.get("requiresDropdown")||this.set("showTotalBadge",!1)},getTemplateData:function(){var t=this.get("showTotalBadge"),e=t&&this.get("showNumberInBadge"),i=t?this.getBadgeCount():null;return{avatarUrl:l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),displayName:this.getCurrentTumblelogProperty("name"),requiresDropdown:this.get("requiresDropdown"),hasBadge:t&&i>0,badgeCountString:e?this.getBadgeCountString(i):null}},createDropdown:function(){var t=n.extend({},this.get("popoverOptions"),{identifier:"blogSelector:dropdown",pinnedTarget:this.js$("avatar"),shift:{x:86,y:10},collection:this.collection,currentTumblelog:this.getCurrentTumblelog(),badgeCountField:this.get("badgeCountField"),maxBadgeCount:this.get("maxBadgeCount")});this.dropdown=new r(t),this.get("dropdownClass")&&this.dropdown.$el.addClass(this.get("dropdownClass")),this.listenTo(this.dropdown,"change:currentTumblelog",this.adjustCurrentTumblelog),this.listenTo(this.dropdown,"open",this._onDropdownOpen),this.listenTo(this.dropdown,"close",this._onDropdownClose)},_onDropdownOpen:function(){this.set("isOpen",!0)},_onDropdownClose:function(){this.set("isOpen",!1)},_onChangeIsOpen:function(t,e){this.js$("caret").toggleClass("is-open",e)},toggleDropdown:function(){this.get("requiresDropdown")&&(this.dropdown.isOrWasRecentlyRendered()||(this.createDropdown(),this.dropdown.render()))},afterRender:function(){return this.get("showTotalBadge")&&(this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this._onBadgeCountChange()),this.get("requiresDropdown")&&(this.createDropdown(),this.js$("button").addClass("has-dropdown"),this.listenTo(this,"change:isOpen",this._onChangeIsOpen),this.listenTo(this,"change:showCaret",this._onChangeShowCaret),this._onChangeIsOpen(this,this.get("isOpen")),this._onChangeShowCaret(this,this.get("showCaret"))),this.listenTo(this,"change:showName",this._onChangeShowName),this._onChangeShowName(this,this.get("showName")),this},getCurrentTumblelog:function(){return this.get("currentTumblelog")},getCurrentTumblelogProperty:function(t){var e=this.getCurrentTumblelog();if(e&&e.has(t)&&n.isString(t))return e.get(t)},adjustCurrentTumblelog:function(){var t;this.set("currentTumblelog",this.dropdown.get("currentTumblelog")),this.rendered&&(t=l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),this.js$("avatar").attr("src",t),this.js$("label").text(this.getCurrentTumblelogProperty("name")),this.get("showTotalBadge")&&!this.get("includeCurrentBlogInTotalBadge")&&this._onBadgeCountChange())},teardown:function(){return this.remove(),this},getBadgeCount:function(){var t,e=this.get("currentTumblelog");return this.get("badgeCountField")?(t=n.sum(this.collection.pluck(this.get("badgeCountField"))),e&&!this.get("includeCurrentBlogInTotalBadge")&&(t-=e.get(this.get("badgeCountField"))),Math.max(0,t)):null},getBadgeCountString:function(t){var e=this.get("maxBadgeCount");return t>e?e+"+":t>0?t:""},updateBadge:function(t){var e=this.js$("badge");e.toggleClass(this.get("badgeActiveClass"),t>0),this.get("showNumberInBadge")&&e.text(this.getBadgeCountString(t))},_onBadgeCountChange:function(){this.updateBadge(this.getBadgeCount())},_onChangeShowCaret:function(t,e){this.js$("caret").toggle(e)},_onChangeShowName:function(t,e){this.js$("label").toggle(e)}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="blog-selector-container"><div class="selected-blog" data-js-button><img class="avatar" src="'+__e(avatarUrl)+'" alt="'+(null==(__t=displayName)?"":__t)+'" data-js-avatar> <span class="name" data-js-label>'+(null==(__t=displayName)?"":__t)+"</span> ",requiresDropdown&&(__p+=' <span class="caret '+__e(hasBadge?"has-badge":"")+'" data-js-caret data-js-badge>',badgeCountString&&(__p+=__e(badgeCountString)),__p+="</span> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(653),r=i(283),a=i(277),l=i(250),c=i(492),u=s.extend({className:"popover--blog-selector-dropdown",events:{"click [data-js-tumblelog]":"selectBlog"},mixins:[a,r],template:o,defaults:{currentTumblelog:!1,avatarSize:96,badgeCountField:null,maxBadgeCount:99,badgeActiveClass:"tab-notice--active"},initialize:function(t){if(t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"collection")),!this.get("currentTumblelog")){var e=this.collection.findWhere({is_current:!0});this.set("currentTumblelog",e)}},selectBlog:function(t){var e=this.$(t.currentTarget).index();this.set("currentTumblelog",this.collection.at(e)),this.teardown()},createScrollbar:function(){this.scrollbar||(this.scrollbar=new c(this.js$("scrollbar")))},afterRender:function(){return this.js$("scrollbar").addClass("popover-sublist popover-sublist--scrollable"),n.defer(n.bind(this.createScrollbar,this)),this.delegateEvents(),this.isShowBadges()&&this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this},isShowBadges:function(){return!n.isEmpty(this.get("badgeCountField"))},getBadgeCount:function(t){return this.get("badgeCountField")&&t?t.get(this.get("badgeCountField")):null},getBadgeCountString:function(t){var e=this.get("maxBadgeCount");return t<=0?"":t>e?e+"+":t},getTemplateData:function(){var t,e=this.toJSON(),i=this.get("currentTumblelog");return i&&n.extend(e,{currentTumblelog:i.get("name")}),t=this.collection.map(function(t){return n.extend({avatarUrl:l(t.get("avatar_url"),this.get("avatarSize")),displayName:t.getDisplayName(),badgeCountString:this.getBadgeCountString(this.getBadgeCount(t))},t.toJSON())},this),n.extend(e,{channels:t,isShowBadges:this.isShowBadges()}),e},beforeTeardown:function(){this.scrollbar&&(this.scrollbar.destroy(),this.scrollbar=null),this.stopListening()},teardown:function(){return this.remove()},updateBadge:function(t){var e,i=this.$$("[data-js-channel-badge="+t.get("name")+"]");0!==i.length&&(e=this.getBadgeCount(t),i.toggleClass(this.get("badgeActiveClass"),e>0),e>0&&i.find("[data-js-channel-badge-text]").text(this.getBadgeCountString(e)))},_onBadgeCountChange:function(t){return this.updateBadge(t)}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="pop-menu"><ul class="inner select-right" data-js-scrollbar> ',_.forEach(channels,function(t){__p+=' <li class="item-option '+__e(t.name===currentTumblelog?"selected":"")+'" data-js-tumblelog><div class="avatar"><img src="'+__e(t.avatarUrl)+'" alt="'+__e(t.name)+'"> ',isShowBadges&&(__p+=' <span class="unread-indicator tab_notice tab-notice--outlined on-light ',t.badgeCountString&&(__p+="tab-notice--active "),__p+='" data-js-channel-badge="'+__e(t.name)+'"><span class="tab_notice_value" data-js-channel-badge-text>'+__e(t.badgeCountString)+"</span></span> "),__p+=' </div><div class="info-container"><p class="name">'+__e(t.displayName)+'</p><p class="title">'+(null==(__t=t.directory_safe_title)?"":__t)+"</p></div></li> "}),__p+=" </ul></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(655),r=s.extend({template:o,className:"activity-popover-sparkline-container",defaults:{removable:!0,sparklineFormatting:{type:"line",lineColor:"#7f7f7f",fillColor:!1,lineWidth:4,spotColor:!1,minSpotColor:!1,maxSpotColor:!1,disableInteraction:!0,width:"72px",height:"30px"}},getTemplateData:function(){return{activityPageUrl:"/blog/"+this.model.get("name")+"/activity"}},addSparkline:function(){var t=this.$el.find(".sparkline"),e=JSON.parse(this.model.get("activity_data").sparkline);e&&0!==n.max(e)&&n.isFunction(t.sparkline)&&(t.sparkline(e,this.get("sparklineFormatting")),t.find("canvas").css({height:"15px",width:"36px"}))},afterRender:function(){n.defer(n.bind(this.addSparkline,this))},teardown:function(){return this.remove(),this}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<a class="activity-popover-sparkline-link" href="'+(null==(__t=activityPageUrl)?"":__t)+'" title="Activity"><div class="sparkline"></div></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(657),r=i(277),a=i(492),l=i(658),c=i(690),u=i(692),h=i(9),d=s.extend({className:"blog-activity",template:o,mixins:[r],defaults:{removable:!0,notificationWhiteList:["answer","ask","ask_answer","fanmail","follower","like","note_mention","post_attribution","reblog","reply","user_mention","like_rollup","reblog_naked_rollup","follower_rollup","reblog_naked","conversational","conversational_rollup"]},addChannelScrollbar:function(){this.notificationScrollBar=new a(this.js$("blog-activity-notification-list"))},afterRender:function(){this.model.get("activity_notifications").length&&(n.defer(n.bind(this.addChannelScrollbar,this)),this.js$("blog-activity-notification-list").addClass("popover_sublist popover_sublist--scrollable"),this.createSubviews())},beforeTeardown:function(){this.notificationScrollBar&&this.notificationScrollBar.destroy()},createSubviews:function(){for(var t=this.model.get("activity_notifications"),e=void 0,i=0;i<t.length;i++){var s=t[i];if(n.contains(this.defaults.notificationWhiteList,s.type)){var o=!1,r=h.unix(s.timestamp).startOf("day");if(e&&r.fromNow()===e.fromNow()||(o=r),o){s.dateHeader=o;var a=new c({model:new u(s)});this.appendSubview(a,"ul[data-js-blog-activity-notification-list]")}s.currentTumblelogName=this.model.get("name");var d=new l({model:new u(s)});this.appendSubview(d,"ul[data-js-blog-activity-notification-list]"),e=h.unix(s.timestamp).startOf("day")}}},teardown:function(){return this.remove(),this}});t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=model.activity_notifications.length?' <div class="blog-activity-content"><ul data-js-blog-activity-notification-list class="ui_notes"></ul></div><a href="/blog/'+__e(model.name)+'/activity" class="blog-activity-more">'+__e(__("See everything"))+"</a> ":' <div class="blog-activity--empty"><i class="icon_activity"></i><p class="blog-activity--empty-text">'+__e(__("Check out this tab when you make a post to see Likes, Reblogs, and new followers."))+"</p></div> ";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(136),a=i(191),l=i(659),c=i(262),u=i(180),h=i(182),d=i(671),p={answer:i(673),ask:i(674),ask_answer:i(675),fanmail:i(676),follower:i(677),like:i(678),note_mention:i(679),post_attribution:i(680),reblog:i(681),reblog_naked:i(682),reply:i(683),user_mention:i(684),follower_rollup:i(685),like_rollup:i(686),reblog_naked_rollup:i(687),conversational:i(688),conversational_rollup:i(689)},_=o.extend({tagName:"li",className:"activity-notification",events:{"click .note_follow":"onClickFollow","click .ui_post_badge":"logPostBadgeClick","click .notification-tumblelog-link":"logRebloggersNameClick","click .activity-notification__glass":"logNotificationClick","click .activity-notification__activity_reply_link":"logReplyClick"},defaults:{tumblelogToFollow:!1,followSource:"FOLLOW_SOURCE_ACTIVITY_POPOVER",following:!1,followText:s("Follow"),rollupParentType:{follower_rollup:"follower",like_rollup:"like",reblog_naked_rollup:"reblog",conversational_rollup:"conversational"},showReplyLink:u.bool("notification_reply_link_to_notes")},initialize:function(t){if(this.options=n.defaults(t,this.defaults),this.isRollup=n.includes(n.keys(this.options.rollupParentType),this.model.get("type")),this.isRollup?(this.template=p[this.model.get("type")],this.notificationType=this.options.rollupParentType[this.model.get("type")],this.$el.addClass("rollup")):(this.template=p[this.model.get("type")],this.notificationType=this.model.get("type")),this.$el.addClass(this.notificationType),this.$el.attr("data-timestamp",this.model.get("timestamp")),this.replyString=s("Reply"),!this.get("tumblelogToFollow")){var e=this.model.get("from_tumblelog");e&&(this.isCurrentUser(),this.$el.attr("data-tumblelog-name",e.name),this.subviews.avatarView=new d({model:this.model,notificationType:this.notificationType}),e.is_friend&&this.$el.addClass("is_friend"),this.set("tumblelogToFollow",new a({name:e.name,following:e.is_friend})),this.listenTo(this.get("tumblelogToFollow"),"change:following",this.onFollowChange),this.setSafeModeData())}},getTemplateData:function(){return{model:this.model.attributes,followString:this.get("followText"),isFollowing:this.options.following,replyString:this.replyString}},beforeRender:function(){var t="",e={},i={};this.get("tumblelogToFollow")&&(this.options.following=this.get("tumblelogToFollow").get("following")),"note_mention"===this.notificationType?(t=this.model.get("new_post").url,e={tumblelog:this.model.get("new_post").tumblelog,postId:this.model.get("new_post").id},i={tumblelog:this.model.get("new_post").tumblelog,postId:this.model.get("new_post").id,replyNoteToTumblelogName:this.model.get("from_tumblelog").name}):n.includes(["user_mention","reblog","reblog_naked"],this.notificationType)?(this.model.get("new_post")&&!this.model.get("new_post").diff&&"reblog"===this.notificationType&&this.$el.addClass("naked"),"reblog_naked"===this.notificationType&&this.$el.addClass("reblog"),t=this.model.get("new_post").url,e={tumblelog:this.model.get("from_tumblelog").name,postId:this.model.get("new_post").id}):n.includes(["reply","answer","like","post_attribution","ask","conversational"],this.notificationType)&&this.model.get("from_tumblelog")?(t=this.model.get("post").url,e={tumblelog:this.model.get("post").tumblelog,postId:this.model.get("post").id},i={tumblelog:this.model.get("post").tumblelog,postId:this.model.get("post").id,replyNoteToTumblelogName:this.model.get("from_tumblelog").name}):"ask_answer"===this.notificationType?(t=this.model.get("post").url,e={tumblelog:this.model.get("from_tumblelog").name,postId:this.model.get("post").id}):"follower"===this.notificationType?(t=this.model.get("from_tumblelog").tumblr_url,e={tumblelog:this.model.get("from_tumblelog").name}):"fanmail"===this.notificationType?(t=this.model.get("post").url,e={}):(t=this.model.get("post").url,e={tumblelog:this.model.get("post").tumblelog}),this.model.set("peepr_json",JSON.stringify(e)),this.model.set("clickthrough_url",t),this.get("showReplyLink")&&this.model.set("peepr_notes_json",JSON.stringify(i))},isCurrentUser:function t(){var e=h().get("channels").map(function(t){var e=t.name;return e}),t=n.includes(e,this.model.get("from_tumblelog").name);this.model.set({isCurrentUser:t})},setSafeModeData:function(){var t=u.bool("safe_mode")&&h().get("safe_mode");this.model.set("isSafeModeEnabled",t)},afterRender:function(){this.$tumblelogLink=this.$(".notification-tumblelog-link"),this.$uiPostBadge=this.$(".ui_post_badge");var t=this.model.get("post")||this.model.get("new_post"),e={},i="",s=t?t.type:"regular";switch(s){case"photo":case"photoset":e.backgroundImage="url('"+t.media_url+"')";break;case"video":t.video_thumbnail_url&&(e.backgroundImage="url('"+t.video_thumbnail_url+"')",i="has_video_thumbnail");break;case"note":t.is_ask?i="ask":t.is_answer&&(i="ask_answer");break;case"postcard":i="fanmail"}this.get("tumblelogToFollow")&&(this.toggleFollowLink(this.get("tumblelogToFollow").get("following")),this.$tumblelogLink.addClass("js-hover-trigger-TumblelogPopover"),this.$(".notification-tumblelog-link, .avatar").hoverIntent({over:n.bind(this.showBlogCardPopover,this),out:n.noop,sensitivity:3})),this.$uiPostBadge.css(e).addClass(i),this.isRollup&&this.createAvatarSubviews()},afterRenderSubviews:function(){c.drawPixelatedImages(this),this.$(".pixelated-avatar").removeClass("hide").addClass("show")},createAvatarSubviews:function(){for(var t=this.model.get("from_tumblelogs"),e=0;e<t.length;e++){var i=this.model.clone();i.set("from_tumblelog",t[e]);var n=new d({model:i,notificationType:this.notificationType});this.appendSubview(n,".activity-notification__activity_rollup")}},onClickFollow:function(t){var e=this;t.preventDefault(),this.get("tumblelogToFollow").follow().then(function(t){e.logFollowClick()})},log:function(t,e){var i=n.extend({source:"activity-popover",platform:"web"},e);r.trigger("Kraken:"+t,{loggingData:i})},logFollowClick:function(){this.log("NotificationFollowClick",{tumblelog:this.get("tumblelogToFollow").get("name"),notificationType:this.model.get("type")})},logNotificationClick:function(){this.log("NotificationClick",{notificationType:this.model.get("type")})},logReplyClick:function(){this.log("NotificationReplyClick",{tumblelog:this.model.get("from_tumblelog").name,notificationType:this.model.get("type")})},logRebloggersNameClick:function(){this.log("NotificationRebloggerClick",{tumblelog:this.model.get("from_tumblelog").name,notificationType:this.model.get("type")})},logPostBadgeClick:function(){var t=JSON.parse(this.model.get("peepr_json"));this.log("NotificationPostPreviewClick",{tumblelog:t.tumblelog,postId:t.postId,notificationType:this.model.get("type")})},onFollowChange:function(t,e){this.options.isFollowing=e,this.toggleFollowLink(e),this.$el.toggleClass("is_friend",e)},toggleFollowLink:function(t){this.$el.find(".follow-action-text").toggle(!t)},showBlogCardPopover:function(){this.popover&&(this.popover.teardown(),this.popover=null),this.popover=new l({model:this.get("tumblelogToFollow"),pinnedTarget:this.$el}),this.popover.$el.css("z-index",this.$el.closest(".popover").css("z-index")),this.popover.openPopover()},teardown:function(){return this.remove(),this}});t.exports=_},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(136),a=i(276),l=i(283),c=i(660),u=o.extend({mixins:[a,l],className:"tumblelog_popover popover popover--blog-card",blogCardView:null,initialize:function(t){t||(t={}),t.identifier="TumblelogPopover",this.$targetPost=s(t.pinnedTarget).closest(".post"),o.prototype.initialize.call(this,t)},openPopover:function(){return this.blogCardView?(this.render(),this):(this.blogCardView=new c({model:this.model,targetPost:this.$targetPost}),void this.listenToOnce(this.blogCardView,"ready",this.render))},closePopover:function(){this.animateOut(),n.delay(n.bind(this.teardown,this),250)},onMouseMove:function(t){this.overElement(t,this.$el)||this.overElement(t,this.$pinned)?this.teardownTimer&&(clearTimeout(this.teardownTimer),this.teardownTimer=null):this.teardownTimer||(this.teardownTimer=n.delay(n.bind(this.closePopover,this),300))},overElement:function(t,e){var i=e.offset();return t.pageX>i.left&&t.pageY>i.top&&t.pageX<i.left+e.outerWidth()&&t.pageY<i.top+e.outerHeight()},render:function(){return this.blogCardView.render(),this.$el.html(this.blogCardView.el),n.defer(n.bind(this.animateIn,this)),this.boundMouseMove=n.bind(this.onMouseMove,this),s("body").on("mousemove",this.boundMouseMove),this._logOpen(),this},animateIn:function(){return this.$el.css("opacity",1),this},animateOut:function(){return this.$el.css("opacity",0),this},_logOpen:function(){r.trigger("popover:blogcard:open",{loggingData:{blog:this.model.get("name")}})},teardown:function(){return s("body").off("mousemove",this.boundMouseMove),this.$el.remove(),this}});t.exports=u},function(t,e,i){"use strict";t.exports=i(661)},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(662),r=i(669),a=s.extend({defaults:{include_info_popover:!0,disableUnfollowConfirm:!1},className:"poptica_header",initialize:function(t){this.options=n.extend({},this.defaults,t);var e=n.extend({model:this.model},n.pick(this.options,"targetPost","include_info_popover","disableUnfollowConfirm"));this.header=new o(e),this.posts=new r({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.$el.append(this.header.render().el,this.posts.render().el),this}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(180),r=i(129),a=i(219),l=i(136),c=i(663),u=i(265),h=i(130),d=i(664),p=i(665),_=i(666),g=a.extend({className:"indash_tumblelog_compact",
template:d,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(t){if(this.options=n.extend({},this.defaults,t||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=r.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!n.isEmpty(this.current_data)){var e=n.extend({},this.current_data,this.model.toJSON());this.model.set(e,{silent:!0})}this.model.get("global_theme_params")&&n.delay(n.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},render:function(){var t=this.model.toJSON();if(t.following||(t.following=!1),this.is_rendered||!t.global_theme_params)return this;var e=n.result(p,t.global_theme_params.title_font),i=c.hexToRgb(t.global_theme_params.title_color);return this.$el.html(this.template(n.merge({},t,{hide_headers_flag:o.bool("hide_default_headers_blog_cards"),blog_card_compact:!0,show_navigation:!0,show_share_controls:!1,show_user_controls:this.options.include_info_popover,show_follow_button:!0,show_dismiss_controls:!1,title_font_family:!!e&&e.family,title_color_rgb:String(n.values(i).join(",")),followText:h("Follow"),unfollowText:h("Unfollow")},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.__addSnowMan(),this.is_rendered=!0,this.$description.length&&(n.delay(n.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var t=this.$description_inner.html(),e=t.replace(/[\n\r]/g," ");this.$description_inner.html(e)},truncateDescription:function(){var t=this.$description_inner.get(0);if(!(t.scrollHeight<=t.clientHeight)){var e=this.model.get("global_theme_params"),i=e.background_color,s=c.hexToRgb(i);this.$description.append(this.description_gradient_template({background_color:String(n.values(s).join(","))}))}},__addSnowMan:function(){var t={el:this.$("[data-snowman-container]"),tumblelogName:this.model.get("name")};this.options.include_info_popover&&(t.infoPopover={el:this.$el,auto_show:!1,trigger:this.$el.find(".info_popover_button"),useRecipient:!0,showAsks:!0,showAnonymousAsks:!0,skip_glass:!0,targetPost:this.options.targetPost}),this.snowman=new _(t)},_onFollowClick:function(t){if(t.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var e={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(e):(l.trigger("tumblelog:log_follow"),this.model.follow(e))},_confirm_unfollow:function(t){var e={tumblelog:this.model.get("name")},i=this.model.requestUnfollow();if(this.options.disableUnfollowConfirm)i.resolve(),l.trigger("tumblelog:log_unfollow",{loggingData:e});else{var n=h("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),s={text:n,text_ok:h("Ok"),text_cancel:h("Nevermind")};i.promise.then(function(){l.trigger("tumblelog:log_unfollow",{loggingData:e})}),l.trigger("dialog:confirm:promise",i,s)}},_infoPopoverButtonClicked:function(t){t.preventDefault(),t.stopPropagation(),l.trigger("popticainfopopover:show")},_descriptionLinkClicked:function(t){t.preventDefault();var e=s(t.currentTarget).attr("href");try{if(u&&u.hasAllowedProtocol(e)){if(!u.isAbsoluteUrl(e)){var i="http://"+this.model.get("name")+".tumblr.com/";e="/"===e.charAt(0)?e.substr(1):e,e=i+e}window.open(e,"_blank")}}catch(t){}},_renderFollowButton:function(){var t=this.model.get("following");this.$el.find(".follow").toggle(!t),this.$el.find(".unfollow").toggle(t)},_hidePosts:function(){},_open_dialog:function(t,e){function i(t,e){t.is_disabled=t.is_menu_open,e&&e()}this.is_disabled=!0,t.fail(n.bind(i,null,this)),t.done(n.bind(i,null,this,e))},_renderInlineStyles:function(){var t=this.model.get("global_theme_params"),e=this.model.get("has_default_header")&&o.bool("hide_default_headers_blog_cards"),i=!(!(t.header_image_focused&&t.header_stretch&&t.show_header_image)||e),n=c.hexToHsv(t.background_color),s=c.hexToHsv(t.link_color),r=t.link_color;return c.compare(s,n)&&(r=c.readable(n)),i||(this.$(".navigation .nav_icon").css("color",r),this.$(".navigation .blog_name").css("color",r),this.$(".navigation button").css({color:t.background_color,"background-color":r})),this.$(".description a").css("color",t.link_color),this},_renderFontStyles:function(){if(p){var t=this.model.get("global_theme_params");if(n.has(p,t.title_font)){var e=n.result(p,t.title_font),i="webfont_"+e.path;if(e.path&&!s("head #"+i).length){var o=this.assets_host+"/fonts/"+e.path+"/stylesheet.css";o+=n.has(e,"_v")?"?v="+e._v:"",s("<link>",{id:i,rel:"stylesheet",type:"text/css",href:o}).appendTo(s("head"))}}}},description_gradient_template:n.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom, rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});t.exports=g},function(t,e,i){"use strict";function n(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}function s(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function o(t,e,i){var n=Math.min(Math.min(t,e),i),s=Math.max(Math.max(t,e),i),o=s-n,r={h:6,s:s?(s-n)/s:0,v:s/255};return o?s===t?r.h+=(e-i)/o:s===e?r.h+=2+(i-t)/o:r.h+=4+(t-e)/o:r.h=0,r.h=60*r.h%360,r}function r(t,e,i){var n,s,o;if(e){n=s=o=0;var r=(t+360)%360/60,a=i*e,l=i-a,c=a*(1-Math.abs(r%2-1));r<1?(n=a,s=c):r<2?(n=c,s=a):r<3?(s=a,o=c):r<4?(s=c,o=a):r<5?(o=a,n=c):(o=c,n=a),n+=l,s+=l,o+=l}else n=s=o=i;return{r:Math.round(255*n),g:Math.round(255*s),b:Math.round(255*o)}}function a(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=s(t),i=o(e.r,e.g,e.b);return i}function l(t,e,i){var s=r(t,e,i),o=n(s.r,s.g,s.b);return o}function c(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,n,s,o=parseInt(t,16),r=e<0?0:255,a=e<0?-e:e,l=o>>16,c=o>>8&255,u=255&o;return i=Math.round((r-l)*a)+l,n=Math.round((r-c)*a)+c,s=Math.round((r-u)*a)+u,"#"+(16777216+65536*i+256*n+s).toString(16).slice(1)}function u(t,e,i){return"string"==typeof t&&(t=a(t)),e||(e=.2),i||(i=.8),t.s<e&&t.v>i}function h(t){return"string"==typeof t&&(t=a(t)),u(t)?"#444":"#FFF"}function d(t,e,i){var n={upperBound:.8,lowerBound:.2,diffBound:.1,hueBound:15};p.extend(n,i),"string"==typeof t&&(t=a(t)),"string"==typeof e&&(e=a(e));var s=n.upperBound,o=n.lowerBound,r=n.diffBound,l=n.hueBound,c=Math.abs(t.h-e.h),u=Math.abs(t.s-e.s),h=Math.abs(t.v-e.v);return c<=r&&u<=r&&h<=r||u<=r&&h<=r&&(u>=s||u<=o&&h>=s||h<=o&&c<=l)}var p=i(3);t.exports={rgbToHex:n,hexToRgb:s,rgbToHsv:o,hsvToRgb:r,hexToHsv:a,hsvToHex:l,brighten:c,readable:h,compare:d,isLight:u}},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var is_blog_card_compact="boolean"==typeof blog_card_compact&&blog_card_compact,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,hide_default_header=!!is_blog_card_compact&&(has_default_header&&hide_headers_flag),expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img&&!hide_default_header?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||hide_default_header||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+=' <div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+__e(name)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'"> ',show_navigation&&(__p+=' <div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner"> ',"undefined"!==name&&(__p+=' <h3><a href="'+__e(url)+'" target="_blank" class="blog_name" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\'><span class="name"> '+__e(name)+' </span><span class="full_url">'+__e(expanded_name)+"</span></a></h3> "),__p+=" ",show_share_controls&&(__p+=' <a class="open_blog_button nav_icon icon_export"></a> '),__p+=" ",!customizable&&show_user_controls&&(__p+=' <a data-snowman-container class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> </a> '),__p+=" ",!customizable&&show_follow_button&&(__p+=" ",__p+=following?' <button class="chrome unfollow" type="button">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button" style="display:none">'+__e(followText)+"</button> ":' <button class="chrome unfollow" type="button" style="display:none">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button">'+__e(followText)+"</button> ",__p+=" "),__p+=" </div></div> "),__p+=" ",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&!hide_default_header&&(__p+=' <div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+__e(global_theme_params.header_image_focused)+')"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+__e(global_theme_params.header_image_focused)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"> </a> ':' <img src="'+__e(global_theme_params.header_image_focused)+'" alt=""> ',__p+=" </div></div> "),__p+=" ",avatar_url&&global_theme_params.show_avatar&&(__p+=' <div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"></a> ':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt=""> ',__p+=" </div> "),__p+=" ",(has_title||has_description)&&(__p+=' <div class="info_wrapper"><div class="info"> ',has_title&&(__p+=' <h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+__e(title)+"</h1> "),__p+=" ",has_description&&(__p+=' <div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div> "),__p+=" </div></div> "),__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(t,e){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},FangSong:{display_name:"Fang Song",family:"'FangSong', 'STFangsong', sans-serif"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},Kaiti:{display_name:"Kaiti",family:"'Kaiti TC', 'KaiTi', sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},SimHei:{display_name:"Sim Hei",family:"'SimHei', 'STHeiti', sans-serif"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};t.exports=i},function(t,e,i){"use strict";var n=i(214),s=i(667),o=n.extend({name:"Snowman",autoAppend:!0,initialize:function(t){this.view=new s(t)}});t.exports=o},function(t,e,i){"use strict";var n=i(226),s=i(668),o=i(191),r=n.extend({template:s,defaults:{canSubscribe:!1},events:{click:"__toggleInfoPopover"},initialize:function(t){return this.options=t,this.model||(this.model=new o({name:this.options.tumblelogName})),this.set({canSubscribe:this.model.get("can_subscribe"),isSubscribed:this.model.get("is_subscribed"),isBlocking:this.model.get("is_blocking")}),this.listenTo(this.model,"change:is_subscribed",this.__subscribeActionSuccess),t.infoPopoverOnDemand||this.__createInfoPopover(),this},__subscribeActionSuccess:function(t){if(t.id===this.model.get("name")){var e=this.model.get("is_subscribed");this.$("[data-subscription-indicator]").toggleClass("is-subscribed",e)}},__toggleInfoPopover:function(t){t.preventDefault(),t.stopPropagation(),this.options.infoPopoverOnDemand&&!this.infoPopover&&this.__createInfoPopover(),this.infoPopover.toggle()},__createInfoPopover:function(){this.options.infoPopover&&(this.options.infoPopover.model=this.model,this.options.infoPopover.url=this.model.get("url"),this.options.infoPopover.useRecipient&&(this.options.infoPopover.recipient=this.model.get("name")),this.options.infoPopover.showAsks&&(this.options.infoPopover.asks=this.model.get("asks")),this.options.infoPopover.showAnonymousAsks&&(this.options.infoPopover.anonymous_asks=this.model.get("anonymous_asks")),this.infoPopover=new Tumblr.TumblelogPopover.PopticaInfoPopover(this.options.infoPopover))}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="snowman-container"><i data-subscription-indicator class="subscribe-activity '+(null==(__t=canSubscribe&&isSubscribed?"is-subscribed":"")?"":__t)+'"></i> <i class="snowman-icon"></i></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(136),a=i(670),l=o.extend({className:"recent_posts",template:a,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,blog_bg_color:!0,$popover:s(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(t){n.extend(this,this.defaults,t),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),n.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(this.model,"change:global_theme_params",this.renderInlineStyles)},fetchPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(t){this.model=t,this.posts=this.model.get("highlighted_posts"),n.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var t=this.model.toJSON();this.$el.html(this.template({loader_color:t.global_theme_params?t.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var t=this.model.get("global_theme_params");t&&this.blog_bg_color&&this.$el.css("background-color",t.background_color)},render:function(t){var e=this.posts||this.model.get("highlighted_posts");if(!n.isArray(e))return this;var i=e.join("");return e.length<2?(setTimeout(n.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time),this):(this.$el.addClass("has_"+e.length+"_posts"),t===!0?this.$el.addClass("is_cached").html(i):setTimeout(n.bind(function(){this.$el.addClass("is_loaded").html(i)},this),this.min_load_time),this)},onPostClick:function(t){},onMouseEnter:function(t){r.trigger("TumblelogPopover:mouseenter_posts")}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj){var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+=' <div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(226),s=i(672),o=n.extend({template:s,className:"ui_avatar",initialize:function(t){this.model.set("notificationType",t.notificationType||""),this.options=t},afterRender:function(){"reblog_naked"===this.model.get("type")&&this.$(".ui_avatar_link").addClass("reblog")}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-avatar-url="'+__e(model.from_tumblelog.avatar_url_128)+'" class="ui_avatar_link frame '+__e(model.notificationType)+'" title="'+__e(model.from_tumblelog.name)+'"> ',__p+=model.from_tumblelog.is_adult&&model.isSafeModeEnabled&&!model.isCurrentUser?' <canvas class="avatar pixelated-avatar needs-drawing hide" data-image-url="'+__e(model.from_tumblelog.avatar_url_48)+'" width="23" height="23" alt="'+__e(model.from_tumblelog.name)+'"> ':' <a data-peepr=\'{"tumblelog":"'+__e(model.from_tumblelog.name)+'"}\' target="_blank" href="'+__e(model.from_tumblelog.tumblr_url)+'" class="avatar" style="background-image: url(\''+__e(model.from_tumblelog.avatar_url_48)+'\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name">'+__e(model.from_tumblelog.name)+"</span></a> ",__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_answer"><blockquote> '+__e(model.note_meta.answer_text)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=model.from_tumblelog?' <div class="activity-notification__avatar"><div data-subview="avatarView"></div></div> ':' <div class="activity-notification__avatar"><div class="ui_avatar"><div data-avatar-url="/images/anonymous_avatar_64.gif" target="_blank" class="ui_avatar_link frame '+__e(model.type)+'" title="Anonymous"><div class="avatar" style="background-image: url(\'/images/anonymous_avatar_64.gif\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name"></span></div></div></div></div> ',__p+=' <div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity">'+(null==(__t=model.message)?"":__t)+"</span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'"></a><div class="activity-notification__icon"><a href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_answer"><blockquote> '+__e(model.note_meta.answer_text)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'"></a><div class="activity-notification__icon"><a href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"> ',!model.isCurrentUser&&model.from_tumblelog.can_be_followed&&(__p+=' <a class="follow-action-text note_follow" href="/follow/'+__e(model.from_tumblelog.name)+'" data-tumblelog-name="'+__e(model.from_tumblelog.name)+'" title="'+__e(followString)+'"> '+__e(followString)+" </a> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_reply"><blockquote> '+__e(model.note_meta.reply_text||"")+" </blockquote></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" data-peepr="'+__e(model.peepr_notes_json)+'" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';
return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message '+__e(model.new_post.diff?"conversational":"")+'"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=" </div> ",model.new_post&&model.new_post.diff&&(__p+=' <div class="activity-notification__activity_response is_part_reblog"><blockquote> '+__e(model.new_post.diff)+" </blockquote></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span><span class="summary" title="'+__e(model.post.summary)+'">&#8220;'+__e(model.post.summary)+'&#8221;</span></div><div class="activity-notification__activity_response is_part_reply"><blockquote> '+__e(model.note_meta.reply_text)+" </blockquote></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" data-peepr="'+__e(model.peepr_notes_json)+'" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon" title="'+__e(model.post.summary)+'"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_user_mention"><blockquote> '+(null==(__t=model.new_post.quote)?"":__t)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.new_post.url)+'" target="_blank" class="ui_post_badge '+__e(model.new_post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_rollup"></div><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="/blog/'+__e(model.currentTumblelogName)+'/followers"></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_rollup"></div><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span><span class="summary">&#8220;'+__e(model.post.summary)+'&#8221;</span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_rollup"></div><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span><span class="summary">&#8220;'+__e(model.post.summary)+'&#8221;</span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span><span class="summary" title="'+__e(model.post.summary)+'">&#8220;'+__e(model.post.summary)+'&#8221;</span></div><div class="activity-notification__activity_response is_part_reply"><blockquote> '+__e(model.note_meta.reply_text)+" </blockquote></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" data-peepr="'+__e(model.peepr_notes_json)+'" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon" title="'+__e(model.post.summary)+'"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="activity-notification__avatar"><div data-subview="avatarView"></div></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_rollup"></div><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span><span class="summary">&#8220;'+__e(model.post.summary)+'&#8221;</span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(226),s=i(691),o=i(9),r=i(130),a=n.extend({tagName:"li",className:"date_header date_activity clearfix",template:s,events:{},defaults:{},beforeRender:function(){var t=o();this.model.set("relativeDate",this.getRelativeDate(t))},getRelativeDate:function(t){var e=t.diff(this.model.attributes.dateHeader),i=o.duration(e).asHours(),n=Math.floor(i/24);return n<=0?r("Today"):n<=1?r("Yesterday"):r("%d days ago",n)},teardown:function(){return this.remove(),this}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="part_relative_date">'+__e(model.relativeDate)+'</div><div class="part_full_date">'+__e(model.dateHeader.format("dddd, MMMM D"))+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(185),s=n.extend({});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(180),r=i(214),a=i(136),l=i(182),c=i(212),u=i(213),h=i(191),d=i(694),p=i(695),_=i(696),g=i(699),f=i(700),m=i(703),v=i(710),b=i(471),y=i(725),w=i(726),k=i(731),C=i(732),x=i(761),S=i(829),T=i(723),E=i(711),P=i(830),F=i(831),I=i(753),j=i(502),A=new g,M={CONVERSATION_OPEN_TUMBLELOGS:"messaging:conversation:open:tumblelogs",CONVERSATION_OPEN_MODEL:"messaging:conversation:open:model",CONVERSATION_OPEN_ID:"messaging:conversation:open:id",CONVERSATION_OPEN_NAME:"messaging:conversation:open:name",INBOX_OPEN:"messaging:inbox:open"},N=r.extend({name:"Messaging",defaults:{resetPollingTypingDebounceRate:3e4},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"inboxAnchorEl","inboxPopoverOptions")),this.eventBus=A,this.user=l(),this.channels=this._getChannelsEnabledForMessagingAsCollection(),this.activeWindow=new d,this.inboxCollection=new P,this.currentBlogModel=new S({channel:this._getInitiallySelectedChannel()}),this.favoritesCollection=new I,this.emptyInboxCollection=new I,this.unreadManager=new f({channels:this.channels}),this.inboxBadge=new k({el:this.inboxAnchorEl,channels:this.channels}).render(),this.messagingLogger=new p,this.messagingNotifier=new y({isEnabled:this.isDesktopNotificationEnabled(),notificationIcon:this.getMessagingNotificationIcon()}),this.keyboardManager=new b,this.windowPersistenceManager=new v({user:this.user,isSyncEnabled:!1}),this.notificationSoundManager=new w,this.searchImageQueries=new j,this.windowManager=new m({eventBus:this.eventBus,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,persistenceManager:this.windowPersistenceManager,inboxConfig:{constructor:C,options:{favoritesCollection:this.favoritesCollection,emptyInboxCollection:this.emptyInboxCollection,appendFavoritesToInboxLimit:this.getAppendFavoritesToInboxLimit(),isAutoFetch:!1,isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled()},popoverOptions:n.extend({autoTeardown:!0,pinnedSide:"bottom",isFixedPosition:!0,pinnedTarget:this.inboxAnchorEl},this.inboxPopoverOptions)},conversationConfig:{constructor:x,options:{isAutoFetch:!1,collection:this.searchImageQueries,imageUploadMaxBytes:this.getImageUploadMaxBytes(),canModifySafeMode:this.getCanModifySafeMode(),isSafeModeEnabled:o.bool("safe_mode")&&this.user.get("safe_mode")}}}),this._onConversationMessageInputThrottled=n.throttle(this._onConversationMessageInput,this.get("resetPollingTypingDebounceRate"),{leading:!0,trailing:!1}),this.listenTo(a,M.CONVERSATION_OPEN_TUMBLELOGS,this._onEventBusOpenConversationUsingTumblelogModels),this.listenTo(a,M.CONVERSATION_OPEN_MODEL,this._onEventBusOpenConversationUsingModel),this.listenTo(a,M.CONVERSATION_OPEN_ID,this._onEventBusOpenConversationUsingIdAndParticipant),this.listenTo(a,M.CONVERSATION_OPEN_NAME,this._onEventBusOpenConversationUsingBlogName),this.listenTo(a,M.INBOX_OPEN,this._onEventBusOpenInboxFromRoute),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this._onOpenConversationUsingConversationModel),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,this._onOpenConversationUsingParticipantModels),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,this._onConversationClickBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,this._onConversationClickMessagingBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_DELETE_MODEL,this._onConversationDelete),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_FETCHING,this._onConversationFetching),this.listenTo(this.eventBus,this.eventBus.BLOCK,this._onBlock),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,this._onConversationMessagesSendRequested),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_SENT,this._onConversationMessageSent),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_FAILED,this._onConversationMessageFailed),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_INPUT,this._onConversationMessageInputThrottled),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED,this._playConversationSounds),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MARK_AS_SPAM,this._onConversationMarkAsSpam),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this._onConversationImagePreviewAdd),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this._onConversationImagePreviewDismiss),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_EDIT,this._onConversationImagePreviewEdit),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,this._onConversationImageLightbox),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this._onConversationComposePluginClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(a,"toaster:updateMessagingUnreadCounts",this._onPollUpdate),this.listenTo(a,"logout",this._onEventBusLogout),this.listenTo(this.currentBlogModel,"change",this._onCurrentBlogModelChange),this.listenTo(this.windowManager,"change",this._onWindowManagerChange),this.listenTo(this.unreadManager,"change:channel",this._onUnreadManagerChannelChange),this.listenTo(this.unreadManager,"change:conversation",this._onUnreadManagerConversationChange),this.listenTo(this.windowManager,"inbox:added",this._onWindowManagerInboxAdded),this.listenTo(this.windowManager,"inbox:removed",this._onWindowManagerInboxRemoved),this.listenTo(this.windowManager,"conversation:added",this._onWindowManagerConversationAdded),this.listenTo(this.windowManager,"conversation:removed",this._onWindowManagerConversationRemoved),this.listenTo(this.windowManager,"conversations:loaded",this._onWindowManagerConversationsLoaded),this.listenTo(this.windowManager,"conversation:minimized",this._onWindowManagerConversationMinimized),this.listenTo(this.windowManager,"conversation:unminimized",this._onWindowManagerConversationUnminimized),this.listenTo(this.messagingNotifier,"notification:display",this._onDesktopNotificationDisplayed),this.listenTo(this.messagingNotifier,"notification:permission:change",this._onDesktopNotificationPermissionChange),this.listenTo(this.channels,"change:unread_messages_count_sum",n.debounce(n.bind(this._onChannelsUnreadMessageCountChange,this),0)),this.messagingPoller=new _({channels:this.channels,user:this.user,callback:n.bind(this._onPollUpdate,this),frequency:this.getPollingFrequencyInbox()}),this._onWindowManagerChange(this.windowManager)},render:function(){return this.inboxAnchorEl&&this.inboxAnchorEl.on("click.messaging",n.bind(this._onClickInboxAnchor,this)),this.windowManager.loadConversationsState(),this},openInboxPopover:function(){this.inboxPopover||(this.inboxPopover=this.windowManager.addInbox(this.inboxCollection))},openConversationPopover:function t(e,i){var t;return n.isEmpty(e.get("participantUuid"))&&e.set("participantUuid",this.getCurrentBlogId()),t=this.windowManager.getConversationPopover(e),this.windowManager.removeInbox(this.inboxCollection),t?void t.refresh(e):void this.windowManager.addConversation(e,{context:i})},fetchInbox:function(){var t=this.getCurrentBlogId();if(this._pendingInboxRequest&&this._pendingInboxBlog){if(t===this._pendingInboxBlog)return;this._pendingInboxRequest.abort()}this._pendingInboxBlog=t,this._pendingInboxRequest=this.inboxCollection.fetchInbox(t).always(n.bind(function(){this._pendingInboxRequest=null,this._pendingInboxBlog=null},this)).done(n.bind(function(){this.messagingLogger.logInboxOpened(this.inboxCollection.size())},this))},getCurrentChannel:function(){return this.currentBlogModel.getChannel()},getCurrentBlogId:function(){return this.currentBlogModel.getId()},getPollingFrequencyInbox:function(){return n.get(this.data,"polling_frequency_inbox")},getCanModifySafeMode:function(){return n.get(this.data,"can_modify_safe_mode")},getPollingFrequencyConversation:function(){return n.get(this.data,"polling_frequency_conversation")},getAppendFavoritesToInboxLimit:function(){return n.get(this.data,"append_favorites_to_inbox_limit")},isDesktopNotificationEnabled:function(){return n.get(this.data,"is_desktop_notifications_enabled",!1)},isNewEmptyInboxEnabled:function(){return n.get(this.data,"is_new_empty_inbox_enabled",!1)},getBackoffRatesInbox:function(){return[1,1,2,2,4]},getBackoffRatesConversation:function(){return[1,1,1,1,2,2,2,2,4,4,4,4,8,8,8,8,16]},getMessagingNotificationIcon:function(){return n.get(this.data,"messaging_notification_icon","")},getImageUploadMaxBytes:function(){return n.get(this.data,"image_upload_max_bytes",10485760)},_onWindowManagerInboxAdded:function(t,e){this.fetchInbox()},_onWindowManagerInboxRemoved:function(t,e){delete this.inboxPopover,this.messagingLogger.logInboxClosed()},_onWindowManagerConversationAdded:function(t,e,i){var s=n.get(i,"isFromPersistence",!1);e.isMinimized()||(e.fetch().always(n.bind(function(){s||this.messagingLogger.logConversationOpened(t,n.get(i,"context"))},this)),e.focus())},_onWindowManagerConversationRemoved:function(t,e,i){this.messagingLogger.logConversationClosed(t,n.get(i,"context"))},_onWindowManagerConversationsLoaded:function(t,e){0===t.length&&0===e.length||this.messagingLogger.logConversationWindowsLoaded(t,e)},_onWindowManagerConversationMinimized:function(t,e){this.messagingLogger.logConversationMinimized(t)},_onWindowManagerConversationUnminimized:function(t,e){this.messagingLogger.logConversationUnminimized(t)},_getChannelsEnabledForMessagingAsCollection:function(){return new F(n.invoke(this.user.getChannelsEnabledForMessaging(),"toJSON"))},_getInitiallySelectedChannel:function(){return this.channels.get(this.user.getCurrentMessagingChannelUuid())||n.first(this.channels.models)},_onClickInboxAnchor:function(t){t.preventDefault(),this.openInboxPopover()},_onEventBusOpenConversationUsingIdAndParticipant:function(t,e,i){this._openConversationUsingIdAndParticipant(t,e,i)},_onEventBusOpenConversationUsingTumblelogModels:function(t,e){this._openConversationUsingTumblelogModels(t,e)},_onEventBusOpenConversationUsingModel:function(t,e){this.openConversationPopover(t,e)},_onEventBusOpenConversationUsingBlogName:function(t,e){this._openConversationFromBlogName(t,e)},_onEventBusOpenInboxFromRoute:function(){this.openInboxPopover()},_onOpenConversationUsingConversationModel:function(t,e){this.openConversationPopover(t,e)},_openConversationUsingIdAndParticipant:function(t,e,i){var s=new E({id:t,participantUuid:e});s.fetchConversation().then(n.bind(function(){this.openConversationPopover(s,i)},this))},_openConversationUsingTumblelogModels:function(t,e){var i=n.map(t,function(t){return new T(t.toJSON(),{parse:!0})});this._onOpenConversationUsingParticipantModels(i,e)},_onOpenConversationUsingParticipantModels:function(t,e){var i=new T(this.getCurrentChannel().toJSON()),s=n.find(t,function(t){return t.get("name")===i.get("name")});if(n.isEmpty(s)){var o=new E({participants:[i].concat(t),participantUuid:this.getCurrentBlogId()});this.openConversationPopover(o,e)}},_onPollUpdate:function(t){t=n.get(t,"unread_messages"),n.get(t,"error")!==!0&&this.unreadManager.setData(t)},_onConversationClickBlog:function(t){var e=n.get(t,"url"),i=n.get(t,"blogName"),s=n.get(t,"postId"),o=n.get(t,"searchTagTerm"),r=n.get(t,"originalEvent"),l=n.get(t,"otherParticipant"),c=!!l&&l.get("seconds_since_last_activity")!==-1;r&&r.preventDefault(),a.trigger("peepr-open-request",{url:e,tumblelog_name:i,post_id:s,searchTagTerm:o}),this.messagingLogger.logPeeprOpen(e,i,s,o,c)},_onConversationClickMessagingBlog:function(t){var e=n.get(t,"blogName"),i=n.get(t,"originalEvent");i&&i.preventDefault(),this._openConversationFromBlogName(e,"conversation-permalink"),this.messagingLogger.logMessagingPermalinkOpen(e)},_onDesktopNotificationDisplayed:function(t){this.messagingLogger.logNotification(t)},_onDesktopNotificationPermissionChange:function(t){t?this.messagingLogger.logNotificationPermissionGranted():this.messagingLogger.logNotificationPermissionDenied()},_onConversationMarkAsSpam:function(t,e){var i;t&&e&&(i=s("%1$s will be blocked and reported. And any trace of this conversation will disappear from your inbox.",e.get("name")),u.confirm(i,n.bind(function(){this.messagingLogger.logConversationSpamIntent(t),this._removeConversation(t),t.markAsSpam().then(n.bind(function(){this.messagingLogger.logConversationSpamSuccess(t)},this)).fail(n.bind(function(){this.messagingLogger.logConversationSpamFail(t)},this))},this),null,s("Mark it spam"),s("Nevermind")))},_onConversationImagePreviewAdd:function(t,e){this.messagingLogger.logImagePreviewAdd(t,e)},_onConversationImagePreviewDismiss:function(t,e){this.messagingLogger.logImagePreviewDismiss(t,e)},_onConversationImagePreviewEdit:function(t,e){this.messagingLogger.logImagePreviewEdit(t,e)},_onConversationImageLightbox:function(t){var e=n.get(t,"lightBoxImageData"),i=n.get(t,"lightBoxIndex",0);a.trigger("lightbox-open-request",e,i)},_onConversationComposePluginClick:function(t,e){this.messagingLogger.logComposePluginClick(t,e)},_onBlock:function(t,e){n.isEmpty(t)||c.confirmBlock(t).then(n.bind(function(){c.block(t).then(n.bind(function(){this._onBlockSuccess(t,e)},this))},this))},_onBlockSuccess:function(t,e){n.isEmpty(t)||(e&&this._removeConversation(e),a.trigger("blocks:block_added",{loggingData:{from:"messaging"}}),this.messagingLogger.logBlock(t))},_removeConversation:function(t){this.windowManager.removeConversation(t),this.inboxCollection.remove(t)},_copyCollectionData:function(t,e){e.reset(t.models),e.setNextLink(t.getNextLink())},_onCurrentBlogModelChange:function(){var t=this.currentBlogModel.getPrevChannel(),e=this.currentBlogModel.getChannel();t&&this._copyCollectionData(this.inboxCollection,t.get("conversations")),e&&(this._copyCollectionData(e.get("conversations"),this.inboxCollection),this.user.setCurrentMessagingChannelUuid(e.get("uuid"))),this.fetchInbox()},_onConversationDelete:function(t){u.confirm(s("Permanently delete this conversation?"),n.bind(function(){this.messagingLogger.logConversationDeleted(t),t.destroy(),this.windowManager.removeConversation(t),this.inboxCollection.remove(t.get("id"))},this),null,s("Delete"),s("Nevermind"))},_onConversationFetching:function(t){this.unreadManager.setConversationModelCount(t,0)},_onUnreadManagerChannelChange:function(t,e){var i=this.getCurrentChannel(),s=n.sum(e);this.windowManager.isInboxOpen()&&i===t&&this.fetchInbox(),t.set("unread_messages_count_sum",s)},_onUnreadManagerConversationChange:function(t,e,i){this._generateBrowserNotification(t,e,i),this._setConversationUnreadCount(t,e,i)},_onChannelsUnreadMessageCountChange:function(t,e){var i=t.previous("unread_messages_count_sum");e>i&&this._playSoundName("notification-sound")},_playConversationSounds:function(){this._playSoundName("receive-sound")},_playSoundName:function(t){this.user.isSoundsEnabled()&&this.notificationSoundManager.playSoundName(t)},_setConversationUnreadCount:function(t,e,i){var n=this.windowManager.getConversationModelByIdAndParticipant(t,i.get("uuid"));n&&n.set("unreadCount",e)},_generateBrowserNotification:function(t,e,i){var n,s=!1;e<=0||(this.activeWindow.isActive&&this.windowManager.get("isConversationOpen")?(n=this.windowManager.getConversationModelByIdAndParticipant(t,i.get("uuid")),n&&this.windowManager.isConversationMinimized(n)&&(s=!0)):s=!0,s&&this.messagingNotifier.notifyOnUnread(t,i))},_showErrorMessage:function(t){u.alert(t)},_onWindowManagerChange:function(t){var e,i,n=t.isInboxOpen(),s=t.isConversationOpen(),o=n||s;return this.user.isVerifiedEmail()&&o?(s?(e=this.getPollingFrequencyConversation(),i=this.getBackoffRatesConversation()):(e=this.getPollingFrequencyInbox(),i=this.getBackoffRatesInbox()),this.messagingPoller.setFrequency(e),this.messagingPoller.setBackoffRates(i),void this.messagingPoller.start()):void this.messagingPoller.stop()},_onConversationMessagesSendRequested:function(){this._playSoundName("send-sound")},_onConversationMessageSent:function(t,e){this.messagingLogger.logMessageSent(t,e)},_onConversationMessageFailed:function(t,e){this.messagingLogger.logMessageFailed(t,e)},_onConversationMessageInput:function(t,e){this.messagingPoller.resetPollingFrequency(),this.messagingPoller.poll()},_openConversationFromBlogName:function(t,e){var i=new h({name:t});return i.fetch_popover_data().then(n.bind(function(){return n.isEmpty(i.get("uuid"))?void this._showErrorMessage(s("Could not load conversation.")):i.get("can_receive_messages")?void this._openConversationUsingTumblelogModels([i],e):void this._showErrorMessage(s("This Tumblr can't receive messages."))},this))},_onEventBusLogout:function(){this.windowPersistenceManager.clear()},_onEmptyInboxNewMessageClick:function(t){this.messagingLogger.logInboxEmptyNewMessageClick(this.currentBlogModel.getChannel().get("name"),t)},_onEmptyInboxSuggestionClick:function(t,e,i){this.messagingLogger.logEmptySuggestionClick(this.currentBlogModel.getChannel().get("name"),t.get("name"),e,i)}});t.exports=N},function(t,e,i){"use strict";var n=i(3),s=function(){window.onfocus=n.bind(this.onFocus,this),window.onblur=n.bind(this.onBlur,this)};s.prototype.onFocus=function(t){this.isActive=!0},s.prototype.onBlur=function(t){this.isActive=!1},s.prototype.isActive=!0;var o,r=function(){return null==o&&(o=new s),o};t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(180),o=i(214),r=i(136),a=o.extend({name:"MessagingLogger",defaults:{isDebugEnabled:!1,platform:"web"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},logInboxOpened:function(t){var e={conversationCount:t,status_indicator_enabled:s.bool("status_indicator")};this._logIt("inbox:open",e)},logInboxClosed:function(){this._logIt("inbox:closed")},logConversationOpened:function(t,e){this._logIt("conversation:open",{conversationId:t.get("id"),context:e,status_indicator_enabled:s.bool("status_indicator"),status_indicator:t.getOtherParticipant().get("seconds_since_last_activity")!==-1?"greendot":"none"})},logConversationClosed:function(t,e){this._logIt("conversation:closed",{conversationId:t.get("id"),context:e})},logConversationDeleted:function(t){this._logIt("conversation:deleted",{conversationId:t.get("id")})},logConversationStarted:function(t,e){this._logIt("conversation:started",{context:e})},logMessageSent:function(t,e){!n.isEmpty(e)&&e.isNew()&&this.logConversationStarted(e),this._logIt("message:sent",this._getMessageLoggingData(t,e))},logMessageFailed:function(t,e){this._logIt("message:failure",this._getMessageLoggingData(t,e))},logFollow:function(t){this._logIt("conversation:follow",{blogName:t})},logBlock:function(t){this._logIt("block",{blockingBlog:t.currentTumblelog,blockedBlog:t.blockedTumblelog})},logNotification:function(t){this._logIt("notification:display",{conversationId:t})},logNotificationPermissionGranted:function(){this._logIt("notification:permission:granted")},logNotificationPermissionDenied:function(){this._logIt("notification:permission:denied")},logConversationWindowsLoaded:function(t,e){
this._logIt("conversation:windows:loaded",{numOpen:t.length,numMinimized:e.length})},logConversationMinimized:function(t){this._logIt("conversation:minimized",{conversationId:t.get("id")})},logConversationUnminimized:function(t){this._logIt("conversation:unminimized",{conversationId:t.get("id")})},logConversationSpamIntent:function(t){this._logIt("conversation:spam:intent",{conversationId:t.get("id")})},logConversationSpamSuccess:function(t){this._logIt("conversation:spam:success",{conversationId:t.get("id")})},logConversationSpamFail:function(t){this._logIt("conversation:spam:fail",{conversationId:t.get("id")})},logImagePreviewAdd:function(t,e){this._logImagePreviewAction("add",t,e)},logImagePreviewDismiss:function(t,e){this._logImagePreviewAction("dismiss",t,e)},logImagePreviewEdit:function(t,e){this._logImagePreviewAction("edit",t,e)},logComposePluginClick:function(t,e){var i,s=e.getName();n.isEmpty(s)||(i=s+":intent",this._logIt(i,{conversationId:t.get("id")}))},logPeeprOpen:function(t,e,i,o,r){var a={url:t,blogName:e,status_indicator_enabled:s.bool("status_indicator"),status_indicator:r?"greendot":"none"};n.isEmpty(i)||n.extend(a,{postId:i}),n.isEmpty(o)||n.extend(a,{searchTagTerm:o}),this._logIt("peepr:open",a),this._logIt("Kraken:peepr:open",a)},logMessagingPermalinkOpen:function(t){var e={blogName:t};this._logIt("conversation-permalink:open",e)},logInboxEmptyNewMessageClick:function(t,e){var i={blogName:t},n=e?"new:inbox:empty:new-message:button:click":"old:inbox:empty:new-message:button:click";this._logIt(n,i)},logEmptySuggestionClick:function(t,e,i,n){var s={sendingBlog:t,receivingBlog:e,context:i},o=n?"new:inbox:empty:suggestion":"old:inbox:empty:suggestion";this._logIt(o,s)},_logImagePreviewAction:function(t,e,i){var s,o,r,a=i.get("context");n.isEmpty(a)||(s=i.get("loggingData"),o=a+":"+t,r=n.extend({},s,{conversationId:e.get("id")}),this._logIt(o,r))},_getMessageLoggingData:function(t,e){var i,s,o,r,a,l,c,u,h;return n.isEmpty(t)?null:(l=t.isPost(),i=l?0:(t.getMessage()||"").length,s=t.get("type"),o=t.get("context"),a=t.get("loggingData"),h=t.get("creationUserAction"),r=n.extend({},a,{conversationId:e?e.get("id"):null,messageLength:i,messageType:s}),n.isEmpty(h)||n.extend(r,{creationUserAction:h}),l&&(c=t.get("post").toJSON(),u=n.get(c,"blog.uuid")||n.get(c,"blog"),n.extend(r,{postBlogUuid:u,postId:n.get(c,"id")})),n.isEmpty(o)||n.extend(r,{context:o}),r)},_logIt:function(t,e){e=e||{},n.extend(e,{platform:this.get("platform")}),r.trigger("Kraken:Messaging:"+t,{loggingData:e})}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(697),o=i(698),r=s.extend({name:"MessagingPoller",defaults:n.defaults({url:o,frequency:15e3},s.prototype.defaults),initialize:function(t){return t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"channels","user")),this._requestData={unread_messages:!0},s.prototype.initialize.apply(this,arguments)},getRequestData:function(){return this._requestData},hasResponseChanged:function(t){return!n.isEmpty(n.get(t,"unread_messages"))}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(214),r=o.extend({name:"BasePoller",defaults:{url:null,requestType:"GET",dataType:"JSON",cache:!1,frequency:6e4,backoffRates:[],stopAfterNumErrors:3,isPolling:!1,hasPolled:!1,isDebugEnabled:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"callback")),this.currentErrorCount=0,this.currentUnchangedCount=0},start:function(t){this.set("isPolling",!0),t?this.scheduleNextPoll():this.poll()},stop:function(){this.set("isPolling",!1),this.cancel()},cancel:function(){this.cancelCurrent(),this.cancelNext()},cancelCurrent:function(){this._currentRequest&&(n.result(this._currentRequest,"abort"),this._currentRequest=null)},cancelNext:function(){this._nextPollToken&&(clearTimeout(this._nextPollToken),this._nextPollToken=null)},beforeRemove:function(){this.stop()},setFrequency:function(t){this.set("frequency",t),this.resetPollingFrequency()},setBackoffRates:function(t){this.set("backoffRates",t),this.resetPollingFrequency()},resetPollingFrequency:function(){this.currentUnchangedCount=0,this.set("hasPolled",!1)},poll:function(){this.cancel(),this._lastPollTime=(new Date).getTime();var t=this.makeRequest.call(this);return t.done(n.bind(this._onRequestSuccess,this)).fail(n.bind(this._onRequestFail,this)).always(n.bind(this._onRequestAlways,this)),this._currentRequest=t,t},getRequestData:function(){return{}},hasResponseChanged:function(){return!0},resetErrorCount:function(){this.currentErrorCount=0,this.start()},parse:function(t){return t},getBackoffRate:function(){var t,e=this.get("backoffRates");return n.isEmpty(e)||!n.isArray(e)||0===this.currentUnchangedCount?1:(t=Math.min(this.currentUnchangedCount,e.length)-1,Math.max(1,n.get(e,t,1)))},getPollingFrequency:function(){return this.get("frequency")*this.getBackoffRate()},makeRequest:function(){var t=this.getRequestData(),e={url:this.get("url"),type:this.get("requestType"),dataType:this.get("dataType"),cache:this.get("cache"),data:t};return s.ajax(e)},scheduleNextPoll:function(){var t=this.getPollingFrequency();return this.set("hasPolled",!0),!!this.get("isPolling")&&void(!n.isFinite(t)||t<=0||(this.currentErrorCount<=this.get("stopAfterNumErrors")?(this.cancelNext(),this._nextPollToken=setTimeout(n.bind(this.poll,this),t)):this.stop()))},_onRequestSuccess:function(t){this.currentErrorCount=0,t=this.parse(t),this.callback&&this.callback(t,this._lastPollTime),this.hasResponseChanged(t)||!this.get("hasPolled")?this.currentUnchangedCount=0:this.currentUnchangedCount++},_onRequestFail:function(){this.currentErrorCount++},_onRequestAlways:function(){this.scheduleNextPoll()}});t.exports=r},function(t,e){"use strict";var i="/svc/user/counts";t.exports=i},function(t,e,i){"use strict";var n=i(7),s=i(3),o={CONVERSATION_FETCHING:"conversation:fetching",CONVERSATION_OPEN_CONVERSATION_MODEL:"conversation:open:model:conversation",CONVERSATION_OPEN_PARTICIPANT_MODELS:"conversation:open:model:partipants",CONVERSATION_OPEN_TUMBLR_URL:"conversation:open:tumblr:url",CONVERSATION_OPEN_MESSAGING_URL:"conversation:open:messaging:url",CONVERSATION_DELETE_MODEL:"conversation:delete:model",CONVERSATION_MESSAGE_SENT:"conversation:message:sent",CONVERSATION_MESSAGE_SENDING:"conversation:message:sending",CONVERSATION_MESSAGE_FAILED:"conversation:message:failed",CONVERSATION_MESSAGE_INPUT:"conversation:message:input",CONVERSATION_MESSAGES_SEND_REQUESTED:"conversation:messages:send:requested",CONVERSATION_MESSAGES_SENDING:"conversation:messages:sending",CONVERSATION_MESSAGES_UNREAD_FETCHED:"conversation:messages:unread:fetched",CONVERSATION_MARK_AS_SPAM:"conversation:spam",CONVERSATION_IMAGE_PREVIEW_ADD:"conversation:image:preview:add",CONVERSATION_IMAGE_PREVIEW_DISMISS:"conversation:image:preview:dismiss",CONVERSATION_IMAGE_PREVIEW_EDIT:"conversation:image:preview:edit",CONVERSATION_IMAGE_LIGHTBOX:"conversation:image:lightbox",CONVERSATION_COMPOSE_PLUGIN_CLICK:"conversation:compose:plugin:click",BLOCK:"block",NEW_EMPTY_INBOX_SUGGESTION_CLICK:"new:inbox:suggestion:click",NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:"new:inbox:new-message:click",OLD_EMPTY_INBOX_SUGGESTION_CLICK:"old:inbox:suggestion:click",OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK:"old:inbox:new-message:click"},r=function(){};r.extend=n.Model.extend,s.extend(r.prototype,n.Events),s.extend(r.prototype,o),t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(214),o=i(701),r=s.extend({name:"MessagingUnreadManager",defaults:{dataChannelKey:"mention_key",overridesExpirationInMs:500},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"channels"));var e=this.channels.map(function(t){return{channelId:t.get("uuid")}});this.unreadCollection=new o(e),this.unreadCollectionOverrides=new o(e),this.listenTo(this.unreadCollection,"change:data",this._onUnreadCollectionChange)},setData:function(t){this._pruneOverrides(),this._updateUnreadCollection(t),this.unreadData=t},setConversationModelCount:function(t,e){var i,n=t.get("id"),s=t.get("participantUuid"),o=this.unreadCollectionOverrides.findWhere({channelId:s});o&&(i=o.get("data")||{},i[n]=e,o.set({data:i,updateDate:new Date}),this._updateUnreadCollection(this.unreadData))},_getOverridesData:function(){var t=this.get("dataChannelKey");return this.unreadCollectionOverrides.reduce(function(e,i){var s=i.get("data"),o=this.channels.get(i.get("channelId")),r=o.get(t);return n.isEmpty(s)||(e[r]=s),e},{},this)},_pruneOverrides:function(){var t=new Date,e=this.get("overridesExpirationInMs");this.unreadCollectionOverrides.each(function(i){var s=i.get("updateDate");n.isDate(s)&&t-s>e&&i.set({updateDate:null,data:null})})},_updateUnreadCollection:function(t,e){var i=this._getOverridesData();this.unreadCollection.each(function(e){var s=this.channels.get(e.get("channelId")),o=s.get(this.get("dataChannelKey")),r=n.get(t,o),a=n.get(i,o);n.isEmpty(a)||(r=n.merge({},r,a)),e.set("data",r)},this)},_onUnreadCollectionChange:function(t){var e,i=t.get("data")||null,s=t.previous("data")||null,o=this.channels.get(t.get("channelId"));this.trigger("change:channel",o,i),n.each(i,function(t,i){e=n.get(s,i),e!==t&&this.trigger("change:conversation",i,t,o)},this)}});t.exports=r},function(t,e,i){"use strict";var n=i(190),s=i(702),o=n.extend({model:s});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({idAttribute:"channelId",defaults:{channelId:null,data:null}});t.exports=s},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(192),r=i(214),a=i(704),l=i(705),c=i(707),u=i(708),h=i(709),d=r.extend({name:"MessagingWindowManager",defaults:{isInboxOpen:!1,isConversationOpen:!1,inboxAnimationSpeed:100,conversationAnimationSpeed:250,isMultipleOpenWindowsEnabled:!1,conversationPopoversContainerClass:"messaging-conversation-popovers",containerClass:"messaging-conversations-container",openConversationsContainerClass:"messaging-open-conversations",minimizedConversationsContainerClass:"messaging-minimized-conversations",bodyClassConversationsHasOpen:"messaging-conversations-open",bodyClassConversationsHasMinimized:"messaging-conversations-minimized",containerClassConversationsHasOpen:"has-open",containerClassConversationsHasMinimized:"has-minimized",persistenceKeyOpen:"open",persistenceKeyMinimized:"minimized"},initialize:function(t){t=s.extend({},t),s.extend(this.attributes,s.pick(t,s.keys(this.defaults))),s.extend(this,s.pick(t,"eventBus","user","channels","currentBlogModel","keyboardManager","inboxConfig","conversationConfig","persistenceManager")),this.openConversations=new l,this.minimizedConversations=new l,this.onlineStatusModel=new c,this.onlineStatusModel.on("sync",this._setParticipantOnlineStatuses,this),this.listenTo(this.openConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.openConversations,"add remove",this._onOpenConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onMinimizedConversationsCollectionChange),this.listenTo(this.openConversations,"add",this._onConversationAdd),this.listenTo(this.openConversations,"remove",this._onConversationRemove),this.listenTo(this.minimizedConversations,"add",this._onConversationAdd),this.listenTo(this.minimizedConversations,"remove",this._onConversationRemove),this.persistenceManager&&this.listenTo(this.persistenceManager,"sync",this._onPersistenceManagerSync)},remove:function(t){this.isInboxOpen()&&this.removeInbox(),this.isConversationOpen()&&this.removeConversations(t)},saveConversationsState:function(t,e){this.persistenceManager&&!this.get("isSyncing")&&this.persistenceManager.save(t.pluck("model"),e)},loadConversationsState:function(){var t,e;this.persistenceManager&&(e=this.persistenceManager.load(this.get("persistenceKeyMinimized")),t=this.persistenceManager.load(this.get("persistenceKeyOpen")),e.then(s.bind(function(t){var e=this;this._addLoadedConversationModels(t,this.minimizedConversations,{isMinimized:!0}),t.length&&setTimeout(function(){e._getOnlineStatusOfParticipants(t)},1e3),this.trigger("conversations:loaded:minimized",t)},this)),t.then(s.bind(function(t){this._addLoadedConversationModels(t,this.openConversations),this.trigger("conversations:loaded:open",t)},this)),o.join(t,e).spread(s.bind(function(t,e){this.trigger("conversations:loaded",t,e)},this)))},_addLoadedConversationModels:function(t,e,i){s.each(t,function(t,n){s.delay(s.bind(function(){this._addLoadedConversationModel(t,e,i)},this),n)},this)},_getOnlineStatusOfParticipants:function(t){this.otherParticipants=t.map(function(t){return t.getOtherParticipant()}),this.onlineStatusModel.fetch({data:{participantIds:this.otherParticipants.map(function(t){return t.get("uuid")})}})},_setParticipantOnlineStatuses:function(t){var e=this;t=t.toJSON(),s.forIn(t,function(t,i){var n=s.find(e.otherParticipants,function(t){return t.get("name")===i});n.set("seconds_since_last_activity",t)}),delete this.otherParticipants},_addLoadedConversationModel:function(t,e,i){var n={skipAnimationOnRender:!0},s=this._createConversationPopover(t,n,i),o={isFromPersistence:!0,context:"persistence"};return e.add({model:t,popover:s,options:o},o)},addInbox:function(t,e){var i=this.get("inboxAnimationSpeed");return this.isInboxOpen()?this.inboxPopover:(this.inboxCollection=t,this.inboxPopover=this._createInboxPopover(t),this.trigger("inbox:adding",t,this.inboxPopover,e),i>0?setTimeout(s.bind(function(){this._afterInboxOpened(e)},this),i):this._afterInboxOpened(e),this.listenToOnce(this.inboxPopover,"close",function(){this._onInboxClose(e)}),this.set("isInboxOpen",!0),this.inboxPopover)},removeInbox:function(t){t||(t=this.inboxCollection),t===this.inboxCollection&&this.inboxPopover&&this.inboxPopover.teardown()},isInboxOpen:function(){return this.get("isInboxOpen")},addConversation:function(t,e){var i,n=this.get("isMultipleOpenWindowsEnabled");return n||this.minimizeConversations(!0),i=this._createConversationPopover(t),t.set("lastOpenedDateTs",(new Date).getTime()),this.openConversations.add({model:t,popover:i,options:e}),i},removeConversation:function(t,e){var i=this._getWindowModel(t);this.openConversations.remove(i,{skipAnimation:e})},isConversationMinimized:function(t){var e,i=this.getConversationPopover(t);return!!i&&(e=i.getView(),e&&e.isMinimized())},removeConversations:function(t){this.openConversations.remove(this.openConversations.models,{skipAnimation:t})},isConversationOpen:function(){return this.get("isConversationOpen")},getConversationPopover:function(t){var e=this._getWindowModel(t);return e?e.getPopover():null},getConversationModelByIdAndParticipant:function(t,e){return this.openConversations.getByIdAndParticipant(t,e)||this.minimizedConversations.getByIdAndParticipant(t,e)},minimizeConversations:function(t){var e=s.clone(this.openConversations.models);s.each(e,function(e){e.getView().minimize(t)})},_createConversationPopover:function(t,e,i){var n,o=s.result(this.conversationConfig,"options"),r=s.get(this.conversationConfig,"constructor"),a=s.get(this.conversationConfig,"popoverOptions"),l=s.bind(function(e){return s.extend({},o,{eventBus:this.eventBus,user:this.user,channels:this.channels,model:t,popoverContainer:e.el,keyboardManager:this.keyboardManager},i)},this);return a=s.extend({},a,{viewConstructor:r,viewOptions:l},e),this.conversationsPopoversContainer||this._createConversationsPopoversContainer(),n=new u(a),n.render(),this._removeTimer&&clearTimeout(this._removeTimer),n},_createInboxPopover:function(t){var e,i=s.result(this.inboxConfig,"options"),n=s.get(this.inboxConfig,"constructor"),o=s.result(this.inboxConfig,"popoverOptions"),r=s.bind(function(e){return s.extend({},i,{eventBus:this.eventBus,collection:t,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,popoverContainer:e.el})},this);return o=s.extend({},o,{viewConstructor:n,animationSpeed:this.get("inboxAnimationSpeed"),viewOptions:r}),e=new a(o),e.render(),e},_removeConversationPopover:function(t,e){var i=this.get("conversationAnimationSpeed");e||i<=0?t.remove():t.teardown(),this._checkRemoveConversationPopoversContainer(e)},_checkRemoveConversationPopoversContainer:function(t){var e=this.get("conversationAnimationSpeed"),i=function(){var t=this.openConversations.length>0,e=this.minimizedConversations.length>0;t||e||this._removeConversationPopoversContainer()};this._removeTimer&&(clearTimeout(this._removeTimer),this._removeTimer=null),t||e<=0?i.call(this):this._removeTimer=setTimeout(s.bind(function(){i.call(this),this._removeTimer=null},this),e)},_focusNextConversationWindow:function(t){return this._incrementFocusConversationWindow(t,1)},_focusPreviousConversationWindow:function(t){return this._incrementFocusConversationWindow(t,-1)},_incrementFocusConversationWindow:function(t,e){var i,n,o,r,a,l=[];return l.push.apply(l,this.openConversations.models),l.push.apply(l,this.minimizedConversations.models),a=l.length,!(a<2)&&(i=s.indexOf(l,t),n=i+=e,!(n>=a||n<0)&&(o=s.get(l,n),!s.isEmpty(o)&&(r=o.getPopover(),r.focus(),!0)))},_callAfterDelay:function(t,e){e>0?setTimeout(s.bind(t,this),e):t.call(this)},_onConversationAdd:function(t,e,i){var n=s.get(i,"isMoving",!1);n||this._afterConversationWindowModelAdded(t,i)},_onConversationRemove:function(t,e,i){var n=s.get(i,"skipAnimation",!1),o=s.get(i,"isMoving",!1);o||this._afterConversationWindowModelRemoved(t,n)},_onPersistenceManagerSync:function(t,e){this._syncFlushData||(this._syncFlushData={}),s.set(this._syncFlushData,t,e),this._syncFlushTimer||(this._syncFlushTimer=setTimeout(s.bind(function(){this._flushSync(this._syncFlushData),delete this._syncFlushTimer,delete this._syncFlushData},this),50))},_flushSync:function(t){var e=s.get(t,this.get("persistenceKeyOpen"),[]),i=s.get(t,this.get("persistenceKeyMinimized"),[]),n=this.openConversations.pluck("model"),o=this.minimizedConversations.pluck("model"),r=this._getConversationLookupCache(e),a=this._getConversationLookupCache(i),l=this._getConversationLookupCache(n),c=this._getConversationLookupCache(o),u=[],h=[],d=[],p=[];this.set("isSyncing",!0),s.each(l,s.bind(function(t,e){s.has(r,e)||(s.has(a,e)?h.push(t):u.push(t))},this)),d=s.reduce(c,s.bind(function(t,e,i){return!s.has(a,i)&&s.has(r,i)&&t.push(e),t},this),[]),p=s.reduce(r,s.bind(function(t,e,i){return s.has(l,i)||s.has(c,i)||t.push(e),t},this),[]),s.each(h,s.bind(function(t){var e=this.openConversations.getByConversationModel(t);e.getView().minimize(!0)},this)),s.each(d,s.bind(function(t){var e=this.minimizedConversations.getByConversationModel(t);e.getView().unminimize(!0)},this)),s.each(u,s.bind(function(t){this.removeConversation(t,!0)},this)),s.each(p,s.bind(function(t){this.addConversation(t)},this)),this.set("isSyncing",!1)},_getConversationLookupCacheKey:function(t){var e=[t.getParticipantId()].concat(t.getParticipantsIds());return e.join(":")},_getConversationLookupCache:function(t){return s.mapKeys(t,this._getConversationLookupCacheKey)},_insertElementAtIndex:function(t,e,i){var n=e.children();0===n.length||0===i?e.prepend(t):i>=n.length?e.append(t):t.insertBefore(s.get(n,i))},_onConversationWindowTab:function(t,e){this._focusNextConversationWindow(t)&&e.preventDefault()},_onConversationWindowShiftTab:function(t,e){this._focusPreviousConversationWindow(t)&&e.preventDefault()},_onMinimizedConversationsCollectionChange:function(t,e,i){s.get(i,"isFromPersistence")||this.saveConversationsState(this.minimizedConversations,this.get("persistenceKeyMinimized"))},_onOpenConversationsCollectionChange:function(t,e,i){s.get(i,"isFromPersistence")||this.saveConversationsState(this.openConversations,this.get("persistenceKeyOpen"))},_onConversationsCollectionChange:function(){var t=this.openConversations.length>0||this.minimizedConversations.length>0;this.set("isConversationOpen",t),this._addBodyClasses(),this._addContainerClasses()},_addBodyClasses:function(){var t=n("body");t.toggleClass(this.get("bodyClassConversationsHasOpen"),this.openConversations.length>0),t.toggleClass(this.get("bodyClassConversationsHasMinimized"),this.minimizedConversations.length>0)},_addContainerClasses:function(){var t=this.conversationsPopoversContainer;t&&(t.toggleClass(this.get("containerClassConversationsHasOpen"),this.openConversations.length>0),t.toggleClass(this.get("containerClassConversationsHasMinimized"),this.minimizedConversations.length>0))},_onInboxClose:function(t){var e=this.get("inboxAnimationSpeed");this.trigger("inbox:removing",this.inboxCollection,this.inboxPopover,t),this.set("isInboxOpen",!1),e>0?setTimeout(s.bind(function(){this._afterInboxClosed(t)},this),e):this._afterInboxClosed(t)},_onChangeConversationMinimized:function(t,e){var i=e?this.openConversations:this.minimizedConversations,n=e?this.minimizedConversations:this.openConversations,s=i.getByConversationModel(t),o=e?"conversation:minimized":"conversation:unminimized",r={isMoving:!0};e||this.get("isMultipleOpenWindowsEnabled")||this.minimizeConversations(!0),i.remove(s,r),n.add(s,r),this.trigger(o,s.getConversation(),s.getPopover())},_afterInboxOpened:function(t){this.trigger("inbox:added",this.inboxCollection,this.inboxPopover,t)},_afterInboxClosed:function(t){this.trigger("inbox:removed",this.inboxCollection,this.inboxPopover,t),this.inboxPopover=null,this.inboxCollection=null},_createConversationsPopoversContainer:function(){return this.conversationsPopoversContainer?this.conversationsPopoversContainer:(this.conversationsPopoversContainer=n("<div />").addClass(this.get("conversationPopoversContainerClass")),this.openConversationsContainer=new h({collection:this.openConversations,className:[this.get("containerClass"),this.get("openConversationsContainerClass")].join(" ")}).render(),this.minimizedConversationsContainer=new h({collection:this.minimizedConversations,className:[this.get("containerClass"),this.get("minimizedConversationsContainerClass")].join(" "),isScrollEnabled:!0,isAdjustToBrowserHeightEnabled:!0}).render(),this.conversationsPopoversContainer.append(this.openConversationsContainer.$el),this.conversationsPopoversContainer.append(this.minimizedConversationsContainer.$el),n("body").append(this.conversationsPopoversContainer),this._addContainerClasses(),this.conversationsPopoversContainer)},_removeConversationPopoversContainer:function(){this.conversationsPopoversContainer&&(this.conversationsPopoversContainer.remove(),this.conversationsPopoversContainer=null),this.openConversationsContainer&&(this.openConversationsContainer.remove(),this.openConversationsContainer=null),this.minimizedConversationsContainer&&(this.minimizedConversationsContainer.remove(),this.minimizedConversationsContainer=null)},_getWindowModel:function(t){return this.openConversations.getByConversationModel(t)||this.minimizedConversations.getByConversationModel(t)},_addConversationWindowEvents:function(t){var e=t.getView();this.listenTo(e,"keydown:tab",function(e){this._onConversationWindowTab(t,e)}),this.listenTo(e,"keydown:shift+tab",function(e){this._onConversationWindowShiftTab(t,e)}),this.listenToOnce(e,"close",function(){this.removeConversation(t.getConversation())}),this.listenTo(e,"change:isMinimized",function(e,i){this._onChangeConversationMinimized(t.getConversation(),i)})},_afterConversationWindowModelAdded:function(t){var e=t.getConversation(),i=t.getPopover(),n=t.getOptions(),s=this.get("conversationAnimationSpeed"),o=function(){this.trigger("conversation:added",e,i,n)};this.trigger("conversation:adding",e,i,n),this._addConversationWindowEvents(t),this._callAfterDelay(o,s)},_afterConversationWindowModelRemoved:function(t,e){var i=this.get("conversationAnimationSpeed"),n=t.getView(),o=t.getPopover(),r=t.getConversation(),a=t.getOptions(),l=function(){this.trigger("conversation:removed",r,o,a)};this.stopListening(o),this.stopListening(n),this._removeConversationPopover(o,e),this.trigger("conversation:removing",r,o,a),e||i<=0?l.call(this):setTimeout(s.bind(l,this),i)}});t.exports=d},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=o.extend({className:"popover--inbox-popover",mixins:[r],defaults:{animationSpeed:100},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"viewOptions","viewConstructor"))},render:function(){return this.$wrapper=s("<div />").addClass("popover-inner").appendTo(this.$el),this.$wrapper.addClass("hide-popover"),this.$pinned.addClass("active"),this._createView(this.viewOptions),n.defer(n.bind(function(){this.$wrapper.removeClass("hide-popover")},this)),this},teardown:function(){var t=this.get("animationSpeed");return this.$wrapper.addClass("hide-popover"),this.$pinned.removeClass("active"),t>0?setTimeout(n.bind(this._afterHide,this),this.get("animationSpeed")):this._afterHide(),this},getView:function(){return this.inboxView},_createView:function(t){t=n.isFunction(t)?t.call(this,this):t,this.inboxView&&this.inboxView.remove(),this.inboxView=new this.viewConstructor(t),this.$wrapper.html(this.inboxView.render().$el)},_afterHide:function(){this.inboxView&&this.inboxView.remove(),this.$el.remove()}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(706),r=s.extend({model:o,comparator:function(t){return t.getConversation().get("lastOpenedDateTs")},getByIdAndParticipant:function(t,e){var i=this.find(function(i){var n=i.getConversation();return n.get("id")===t&&n.get("participantUuid")===e});return i?i.getConversation():null},getByConversationModel:function(t){return this.find(function(e){var i=e.getConversation();return!n.isEmpty(i)&&i.isSameConversation(t)})}});t.exports=r},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{popover:null,model:null,options:null,skipAnimation:!1,isMinimizing:!1},getOptions:function(){return this.get("options")},getConversation:function(){return this.get("model")},getPopover:function(){return this.get("popover")},getView:function(){var t=this.getPopover();return t?t.getView():null}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(185),o=s.extend({url:"/svc/onlinestatus",parse:function(t){return n.result(t,"response")||{}}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.extend({className:"popover--conversation-popover",defaults:{animationSpeed:250,skipAnimationOnRender:!1,skipAnimationOnRemove:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"viewOptions","viewConstructor")),n.isFunction(this.viewOptions)&&(this.viewOptions=this.viewOptions.call(this,this))},render:function(){return this.conversationView=new this.viewConstructor(this.viewOptions),this.$el.html(this.conversationView.render().$el),!this.get("skipAnimationOnRender")&&this.get("animationSpeed")>=0&&this._animateIn(),this},teardown:function(){var t=this.get("animationSpeed");return!this.get("skipAnimationOnRemove")&&t>=0?(this.$el.addClass("hide-popover"),setTimeout(n.bind(this.remove,this),t)):this.remove(),this},beforeRemove:function(){this.conversationView&&this.conversationView.remove()},getView:function(){return this.conversationView},poll:function(){var t=this.getView();if(t)return t.poll()},refresh:function(t){var e=this.getView();if(e)return e.refresh(t)},fetch:function(){var t=this.getView();if(t)return t.fetch()},focus:function(){var t=this.getView();if(t)return t.focus()},isMinimized:function(){var t=this.getView();if(t)return t.isMinimized()},_animateIn:function(){this.$el.addClass("hide-popover"),n.defer(n.bind(function(){this.rendered&&this.$el.removeClass("hide-popover")},this))}});t.exports=o},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(492),a=o.extend({defaults:{isScrollEnabled:!1,isAdjustToBrowserHeightEnabled:!1},initialize:function(t){t=s.extend({},t),s.extend(this.attributes,s.pick(t,s.keys(this.defaults))),s.extend(this,s.pick(t,"collection"))},render:function(){return this.get("isScrollEnabled")?(this.$rootContainer=n("<div />").addClass("scroller").appendTo(this.$el),this.scrollBar=new r({el:this.$rootContainer.get(0)}),this.get("isAdjustToBrowserHeightEnabled")&&this.listenTo(this.scrollBar,"resize",this._onScrollResize)):this.$rootContainer=this.$el,this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this._renderAllPopovers(),this.scrollBar&&s.defer(s.bind(this._updateScroll,this)),this},remove:function(){this.scrollBar&&(this.stopListening(this.scrollBar),this.scrollBar.remove())},_renderAllPopovers:function(){var t=this.$rootContainer;this.rendered&&(t.empty(),this.collection.each(s.bind(function(e){var i=e.getPopover();this.rendered&&i&&t.append(i.$el)},this)))},_updateScroll:function(){this.rendered&&this.scrollBar&&(this.get("isAdjustToBrowserHeightEnabled")&&this._updateScrollHeight(),this.scrollBar.update())},_updateScrollHeight:function(){var t,e,i=89;this.scrollBar&&this.rendered&&(t=n(window).height(),e=this.$rootContainer.get(0).scrollHeight,this.$el.height(Math.min(t-i,e)),this.$rootContainer.scrollTop(e))},_onCollectionAdd:function(t,e,i){var n=t.getPopover(),o=n.$el,r=e.indexOf(t),a=this.$rootContainer,l=a.children();this.rendered&&(0===l.length||0===r?a.prepend(o):r>=l.length?a.append(o):o.insertBefore(s.get(l,r)),this.scrollBar&&this._updateScroll())},_onCollectionRemove:function(t,e,i){this.scrollBar&&s.defer(s.bind(this._updateScroll,this))},_onCollectionReset:function(t,e){this._renderAllPopovers()},_onScrollResize:function(){this._updateScrollHeight()}});t.exports=a},function(t,e,i){"use strict";var n=i(8),s=i(192),o=i(3),r=i(214),a=i(711),l=r.extend({name:"MessagingWindowPersistence",defaults:{storageKeyPrefix:"messaging",isSyncEnabled:!1},initialize:function(t){t=o.extend({},t),o.extend(this.attributes,o.pick(t,o.keys(this.defaults))),o.extend(this,o.pick(t,"user")),this.get("isSyncEnabled")&&this._addSyncListeners()},save:function(t,e){var i,n=s.defer(),r=this._getStorageKey(e);return i=o.map(t,this._getObjectFromModel),this._saveLocalStorage(r,i),n.resolve(),n.promise},load:function(t){var e=s.defer(),i=this._getStorageKey(t),n=this._loadLocalStorage(i),r=o.map(n,this._getModelFromObject);return e.resolve(r||[]),e.promise},clear:function(){var t,e=window.localStorage;if(e){t=this._getStorageKey();try{o.each(o.keys(e),function(i){o.startsWith(i,t+":")&&e.removeItem(i)})}catch(t){this._triggerError(t)}}},remove:function(){this.get("isSyncEnabled")&&this._removeSyncListeners()},_addSyncListeners:function(){n(window).on("storage.messaging-window-persistence",o.bind(this._onStorageChange,this))},_removeSyncListeners:function(){n(window).off(".messaging-window-persistence")},_onStorageChange:function(t){var e,i,n=o.get(t,"originalEvent.key"),s=o.get(t,"originalEvent.newValue"),r=this._getStorageKey(),a=n.substring(r.length+1);if(!o.isEmpty(n)&&!o.isEmpty(a)&&o.startsWith(n,r)&&!o.isEmpty(s))try{e=JSON.parse(s),i=o.map(e,this._getModelFromObject),this.trigger("sync",a,i),this.trigger("sync:"+a,i)}catch(t){this._triggerError(t)}},_getStorageKey:function(t){var e=[this.get("storageKeyPrefix"),this.user.get("name"),t];return o.compact(e).join(":")},_saveLocalStorage:function(t,e){if(window.localStorage)try{window.localStorage.setItem(t,JSON.stringify(e))}catch(t){this._triggerError(t)}},_loadLocalStorage:function(t){var e;if(!window.localStorage)return[];try{return e=window.localStorage.getItem(t),o.isEmpty(e)?[]:JSON.parse(e)}catch(t){return this._triggerError(t),[]}},_getObjectFromModel:function(t){var e=["uuid","url","name","avatar_url","theme"],i=t.get("participants").map(function(t){return t.pick(e)});return{id:t.get("id"),participantUuid:t.get("participantUuid"),participants:i,lastOpenedDateTs:t.get("lastOpenedDateTs")}},_getModelFromObject:function(t){return new a(t)},_triggerError:function(t){
this.trigger("error",t)}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(712),r=i(713),a=i(185),l=i(714),c=i(720),u=i(722),h=a.extend({url:"/svc/conversations/messages",mixins:[o,r],relations:{messages:c,participants:u},relationsOrder:["participants","messages"],defaults:{id:null,status:null,last_modified_ts:null,last_read_ts:null,participants:null,messages:null,can_send:!0,is_possible_spam:!1,is_blurred_images:!1,lastOpenedDateTs:null,participantUuid:null,unreadCount:0},fetchNonErrorCodes:[404],fetchNoRetryOnErrorCodes:[403,429],isUnread:function(){return this.get("last_modified_ts")>this.get("last_read_ts")},flushMessageQueue:function(t){return this.flushQueue(this.sendMessage,t)},canRetryFetch:function(t){return n.isFinite(t)&&!n.contains(this.fetchNoRetryOnErrorCodes,t)},markAsRead:function(){var t=(new Date).getTime();this.set({last_read_ts:parseInt(t/1e3,10),unreadCount:0})},parse:function(t,e){var i=n.get(t,"response")||t;return n.get(e,"isFetchInbox")&&n.extend(i,this.pick("is_possible_spam","is_blurred_images")),i},destroy:function(t){var e={conversation_id:this.get("id"),participant:this.get("participantUuid")};return t=n.extend({},t,{url:this.url+"?"+s.param(e)}),a.prototype.destroy.call(this,t)},markAsSpam:function(t){t=t||"inline";var e={conversation_id:this.get("id"),participant:this.get("participantUuid"),context:t,type:"spam"};return s.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:e})},fetchConversation:function(t){var e=new s.Deferred,i=function(){e.resolve.apply(this,arguments)},o=function(){e.reject.apply(this,arguments)};return this.fetch(this._getFullFetchOptions(t)).then(n.bind(i,this)).fail(n.bind(function(t,e){var s=n.get(t,"status");this.isNew()&&n.contains(this.fetchNonErrorCodes,s)?i.call(this,{},e):o.apply(this,arguments)},this)),e},poll:function(t,e){var i;return this.isNew()?(new s.Deferred).reject():(i={participant:this.get("participantUuid"),conversation_id:this.get("id")},e&&n.extend(i,{limit:e}),this.get("messages").poll({isPolling:!0,data:i}))},getConversationDataForMessage:function(){var t={participant:this.get("participantUuid")};return this.isNew()?n.extend(t,{participants:this.getParticipantsIds()}):n.extend(t,{conversation_id:this.get("id")}),t},addMessage:function(t,e){return e=e||{},t.set(this.getConversationDataForMessage()),this.get("messages").add(t),t},sendMessage:function(t,e){return e=e||{},t.set(this.getConversationDataForMessage()),t.save(null,e).then(n.bind(function(t){var i=this.parse(t,e);this.isNew()?this.set(n.omit(i,"messages")):this.set(n.pick(i,"is_possible_spam"))},this))},getParticipantModel:function(){return this.get("participants").get(this.get("participantUuid"))},getParticipantId:function(){return this.get("participantUuid")},getParticipantsIds:function(){return this.get("participants").pluck("uuid")},getOtherParticipant:function(){var t=this.get("participants").getWithout([this.getParticipantId()]);return n.first(t)},getInboxMessage:function(){var t=this.get("messages").where({isError:!1});return n.last(t)},isSameConversation:function(t){var e=t.getParticipantId(),i=t.getParticipantsIds(),s=this.getParticipantId(),o=this.getParticipantsIds();return s===e&&n.union(o,i).length===o.length},unblurImages:function(){this.set("is_blurred_images",!1);var t={conversation_id:this.get("id"),participant:this.get("participantUuid"),type:"unblur"};s.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:t})},shouldBlurImageMessage:function(t){return!(!this.get("is_blurred_images")||!t.isImage())&&t.get("participant")!==this.getParticipantId()},_getFullFetchOptions:function(t){var e=this.isNew()?this._getDataForFetchByParticipants():this._getDataForFetchById();return e=n.extend({},e,{participant:this.get("participantUuid")}),n.extend({},t,{isFetching:!0,cache:!1,reset:!0,data:e})},_getDataForFetchById:function(t){return{conversation_id:this.get("id")}},_getDataForFetchByParticipants:function(t){return{participants:this.getParticipantsIds()}}},{createPostMessage:function(t,e,i){return i=n.extend({},i,{type:l.POST,post:{blog:e,id:t,is_nsfw:n.get(i,"is_nsfw",!1)}}),new l(n.omit(i,"is_nsfw"))},createTextMessage:function(t,e){return e=n.extend({},e,{type:l.TEXT,message:t,content:{text:t}}),new l(e)},createImagePostMessage:function(t,e,i,n,s,o){var r=h.createPostMessage(t,e,o),a=r.getPost();return a.setType("photo"),a.addThumbnail(i,n,s),r},createImageMessage:function(t,e,i,s,o){return o=n.extend({},o,{type:l.IMAGE,file:e,image:{original_size:{width:i,height:s,url:t}}}),new l(o)},createStickerMessage:function(t,e,i,s){return s=n.extend({},s,{type:l.STICKER,sticker_id:t,sticker:{url:e,original_size_url:i}}),new l(s)}});t.exports=h},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(187),r=new o({defaults:{relationKeys:function(){return n.keys(this.relations)},getRelations:function(){return n.pick(this.attributes,this.relationKeys())}},before:{initialize:function(t,e){this._bootstrapRelations(t,e)}},extend:{_isModelOrCollection:function(t){return t instanceof s.Collection||t instanceof s.Model},_bootstrapRelations:function(t,e){this._isBootstrapped||(n.forEach(this.relations,function(i,s){var o=this.attributes[s];!n.isEmpty(o)&&o instanceof i||(this.attributes[s]=new i(t[s],e))},this),this._isBootstrapped=!0)}},around:{set:function(t,e,i,o){var r,a,l,c,u,h,d=this.attributes,p=this.relationKeys(),_=!this._isBootstrapped;return n.isObject(e)?(r=e,o=i):(r={})[e]=i,o=o||{},u=n.result(o,"relationalSetOptions")||{},this._bootstrapRelations(r,o),a=n.pick(r,p),n.isEmpty(a)?t.apply(this,n.rest(arguments)):(h=n.isEmpty(this.relationsOrder)?n.keys(a):this.relationsOrder,_||n.forEach(h,function(t){r[t]&&(c=a[t],l=d[t],this._isModelOrCollection(l)&&(o.unset?l instanceof s.Collection?l.reset():l instanceof s.Model&&l.clear():(this._isModelOrCollection(c)&&(c=c.toJSON()),o.reset&&l instanceof s.Collection?l.reset(c,n.extend({},o,u[t])):l.set(c,n.extend({},o,u[t])))))},this),t.call(this,n.omit(r,p),o))},toJSON:function(t){var e=t.apply(this,n.rest(arguments))||{};for(var i in this.relations)this.relations.hasOwnProperty(i)&&(e[i]=n.result(e[i],"toJSON")||e[i]);return e}}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(187),r=new o({extend:{getQueue:function(){return this.queue||(this.queue=[]),this.queue},getQueueItems:function(){return n.pluck(this.getQueue(),"item")},clearQueue:function(){this.getQueue().length=0},isFlushingQueue:function(){return this._isFlushingQueue===!0},hasQueue:function(){return this.getQueue().length>0},appendToQueue:function(t,e){var i=this.getQueue();return t=this._getItemsAsArray(t),i.push.apply(i,this._constructItemWrappers(t,e)),i},prependToQueue:function(t,e){var i=this.getQueue();return t=this._getItemsAsArray(t),i.unshift.apply(i,this._constructItemWrappers(t,e)),i},removeFromQueue:function(t){return t=this._getItemsAsArray(t),this.queue=n.reduce(this.getQueue(),function(e,i){var s=n.get(i,"item");return n.contains(t,s)?e:(e.push(i),e)},[]),this.queue},flushQueue:function(t,e){var i,o=this.getQueue();return this._isFlushingQueue?this._flushQueueDeferred:n.isFunction(t)?(this._isFlushingQueue=!0,this._flushQueueDeferred=new s.Deferred,i=function(){var s,r,a;if(this._isFlushingQueue){if(0===o.length)return this._isFlushingQueue=!1,void this._onQueueSuccess(e);s=o.shift(),r=n.get(s,"item"),a=n.get(s,"options"),this._onQueueItemStart(r,a,e),t.call(this,r,a,e).then(n.bind(function(){this._onQueueItemSuccess(r,a,e),i.call(this)},this)).fail(n.bind(function(){this._isFlushingQueue=!1,this._onQueueItemFail(r,a,e)},this))}},i.call(this),this._flushQueueDeferred):(new s.Deferred).reject()},abortFlush:function(){this._isFlushingQueue&&(this._isFlushingQueue=!1,this._flushQueueDeferred.reject())},_getItemsAsArray:function(t){return n.isArray(t)||(t=[t]),t},_constructItemWrappers:function(t,e){return n.map(t,function(t){return{item:t,options:e}})},_onQueueItemStart:function(t,e,i){this._flushQueueDeferred.notify(t,!1,e,i,this.getQueueItems())},_onQueueItemSuccess:function(t,e,i){this._flushQueueDeferred.notify(t,!0,e,i,this.getQueueItems())},_onQueueItemFail:function(t,e,i){this._flushQueueDeferred.reject(t,e,i,this.getQueueItems())},_onQueueSuccess:function(t){this._flushQueueDeferred.resolve(t)}}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(185),r=i(530),a=i(712),l=i(715),c=i(716),u=i(717),h={TEXT:"TEXT",POST:"POSTREF",IMAGE:"IMAGE",STICKER:"STICKER"},d=o.extend({mixins:[a],relations:{content:l,post:c,image:u},idAttribute:"ts",defaults:{conversation_id:null,type:h.TEXT,ts:null,participant:null,participants:null,content:null,message:null,post:null,image:null,file:null,sticker:null,sticker_id:null,collapseGroup:null,clientTs:null,tsHeader:null,isQueued:!1,isPending:!1,isError:!1,isCollapsed:!1,canRetry:!0,hasAnimation:!1,context:null,creationUserAction:null},persistedFields:["conversation_id","type","participant","participants","message","post","context","sticker_id"],saveNoRetryOnErrorCodes:[403,404],validSendMessageContexts:["post-chrome","messaging-gif","messaging-image-upload"],initialize:function(){return this.set("clientTs",Date.now()),o.prototype.initialize.apply(this,arguments)},parse:function(t,e){var i=n.get(t,"response.messages.data.0")||t,s=n.get(i,"images");return n.isArray(s)&&n.extend(i,{image:n.first(s)}),i},save:function(t,e){var i,a,l,c,u;return e=n.extend({validate:!0,parse:!0},e),t=t||{},t&&this.set(t),a=this.toJSON(),l=n.pick(a,this.persistedFields),c=this._getServerLoggingContext(),n.isEmpty(c)?delete l.context:n.extend(l,{context:c}),n.extend(e,{data:l,emulateJSON:!0}),this.isImage()?(u=this.get("file"),this.uploader=new r({name:"data",uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:this.url(),fileUpload:{multiple:!1,formData:l}}),this.uploader.addFiles([u]),i=this.uploader.getCurrentRequest(),i?i.then(n.bind(function(t){e.parse&&(t=this.parse(t,e)),this.set(t,e)},this)):(i=new s.Deferred,i.reject())):i=o.prototype.save.call(this,t,e),this.set({isPending:!0,isQueued:!1}),i.then(n.bind(function(){this.set("isError",!1)},this)).fail(n.bind(function(t){this.set({isError:!0,canRetry:this._canRetryOnErrorCode(n.get(t,"status"))})},this)).always(n.bind(function(){this.set("isPending",!1)},this)),i},getActionMarkup:function(t,e,i){return e=e||"",i=i||"",this.isText()?n.isEmpty(t)?null:e+n.escape(t)+i:this.isPost()?this.getPost().getActionMarkup(t,e,i):this.isImage()?this.getImage().getActionMarkup(t,e,i):null},getPost:function(){return this.get("post")},getImage:function(){return this.get("image")},getTimestamp:function(){var t=this.get("ts");return t?parseInt(t,10):this.get("clientTs")},getMessage:function(){return this.isText()?this.get("content").get("text"):this.isPost()?this.getPost().getMessage():""},isError:function(){return this.get("isError")},isText:function(){return this.get("type")===h.TEXT},isPost:function(){return this.get("type")===h.POST},isImage:function(){return this.get("type")===h.IMAGE},isDisabledPost:function(){return this.isPost()&&this.get("post").isDisabled()},isPending:function(){return this.get("isPending")},canRetry:function(){return this.get("canRetry")},_canRetryOnErrorCode:function(t){return n.isFinite(t)&&!n.contains(this.saveNoRetryOnErrorCodes,t)},_getServerLoggingContext:function(){var t=this.get("context");return!n.isEmpty(t)&&(t=n.first(t.split(":")),n.contains(this.validSendMessageContexts,t))?t:null}},h);t.exports=d},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{text:null,formatting:[]}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(185),r=i(265),a=o.extend({defaults:{type:null,summary:null,state:null,photos:[],is_nsfw:!1},setType:function(t){var e=["photo","link","quote","audio","video","chat"];n.contains(e,t)&&this.set("type",t)},getMessage:function(){return"gif"===this.getType()?null:this.get("summary")},getActionMarkup:function(t,e,i){var o,r,a,l,c;return e=e||"",i=i||"",t=n.escape(t),r=!n.isEmpty(t),l=r?s("%1$s%2$s%3$s sent a post that's no longer available",e,t,i):s("sent a post that's no longer available"),this.isDisabled()?l:(o=this.getType(),a=r?s("%1$s%2$s%3$s sent a post",e,t,i):s("sent a post"),c=r?{photo:s("%1$s%2$s%3$s sent a photo post",e,t,i),photoset:s("%1$s%2$s%3$s sent a photoset",e,t,i),gif:s("%1$s%2$s%3$s sent a GIF",e,t,i),link:s("%1$s%2$s%3$s sent a link",e,t,i),quote:s("%1$s%2$s%3$s sent a quote",e,t,i),audio:s("%1$s%2$s%3$s sent an audio post",e,t,i),video:s("%1$s%2$s%3$s sent a video",e,t,i),chat:s("%1$s%2$s%3$s sent a chat",e,t,i)}:{photo:s("sent a photo post"),photoset:s("sent a photoset"),gif:s("sent a GIF"),link:s("sent a link"),quote:s("sent a quote"),audio:s("sent an audio post"),video:s("sent a video"),chat:s("sent a chat")},n.has(c,o)?n.get(c,o):a)},getType:function(){var t;if("photo"===this.get("type")){if(this._isThumbnailGIF())return"gif";if(t=this.get("photos")||[],t.length>1)return"photoset"}return this.get("type")},getThumbnail:function(t){var e,i=this._getClientThumbnail();return n.isEmpty(i)?(e=this._getPostThumbnail(t),n.isEmpty(e)?null:e):i},hasThumbnail:function(t){return!n.isEmpty(this.getThumbnail(t))},getScaledDimensionsForWidth:function(t,e){var i;return n.has(t,"width")&&n.has(t,"height")?(i=Math.round(n.get(t,"height")/(n.get(t,"width")/e)),{width:e,height:i}):null},isDisabled:function(){return"disabled"===this.get("state")},addThumbnail:function(t,e,i){!n.isEmpty(t)&&n.isNumber(e)&&n.isNumber(i)&&this.set("clientThumbnail",{url:t,width:e,height:i})},_getClientThumbnail:function(){return this.get("clientThumbnail")},_getPostThumbnail:function(t){var e,i,s=this.get("thumbnail_url"),o=this.get("thumbnail_height"),r=this.get("thumbnail_width"),a=this.get("photos");return t=t||250,!n.isEmpty(a)||!n.isEmpty(s)&&n.isFinite(o)&&n.isFinite(r)?n.isEmpty(a)?{url:s,height:o,width:r}:(i=n.sortBy(n.get(n.first(a),"alt_sizes"),"width"),e=n.find(i,function(e){return n.get(e,"width",0)>=t}),n.isEmpty(e)?n.last(i):e):null},_isThumbnailGIF:function(){var t,e=n.get(this.getThumbnail(),"url");return!n.isEmpty(e)&&(t=r.getExtension(e),"gif"===(t||"").toLowerCase())}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(185),r=i(712),a=i(718),l=i(719),c=o.extend({mixins:[r],relations:{alt_sizes:a,original_size:l},defaults:{alt_sizes:null,original_size:null},getActionMarkup:function(t,e,i){return t=n.escape(t),e=e||"",i=i||"",n.isEmpty(t)?s("sent a photo"):s("%1$s%2$s%3$s sent a photo",e,t,i)},getAltSizes:function(){return this.get("alt_sizes")},getHighResImageUrl:function(){var t=this.getAltSizes().sort().last();return n.isEmpty(t)?null:t.get("url")},getOriginalSize:function(){return this.get("original_size")},hasAltSizes:function(){return!this.getAltSizes().isEmpty()},getImageAtSize:function(t){var e,i=this.getAltSizes().sort();return t=t||250,i.isEmpty()?this.getOriginalSize():(e=i.find(function(e){return e.get("width")>=t}),n.isEmpty(e)&&(e=i.last()),e)}});t.exports=c},function(t,e,i){"use strict";var n=i(190),s=i(719),o=n.extend({model:s,comparator:function(t){return t.get("width")}});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({idAttribute:"url",defaults:{width:null,height:null,url:null}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(721),r=i(714),a=s.extend({url:"/svc/conversations/messages",mixins:[o],model:r,_getRoot:function(t){return n.has(t,"response")?n.get(t,"response.messages"):t},parse:function(t,e){return n.get(this._getRoot(t),"data")||[]},parsePreviousLink:function(t,e){return n.get(this._getRoot(t),"_links.previous")},parseNextLink:function(t,e){return n.get(this._getRoot(t),"_links.next")},poll:function(t){return t=t||{},n.extend(t,{cache:!1,remove:!1,skipParseLinks:!0}),this.fetch(t)}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(187),r=new o({extend:{setNextLink:function(t){var e,i=this.hasNextPage();this._nextLink=t,e=this.hasNextPage(),i!==e&&this.trigger("change:hasNextPage",this,e)},setPreviousLink:function(t){var e,i=this.hasPreviousPage();this._previousLink=t,e=this.hasPreviousPage(),i!==e&&this.trigger("change:hasPreviousPage",this,e)},getNextLink:function(){return this._nextLink},getPreviousLink:function(){return this._previousLink},hasNextPage:function(){return!n.isEmpty(this.getNextLink())},hasPreviousPage:function(){return!n.isEmpty(this.getPreviousLink())},fetchNextPage:function(t,e){return t=t||{},this.hasNextPage()?(t.isInfiniteScroll!==!1&&n.extend(t,{skipParsePreviousLink:!0,remove:!1}),this._fetchPage(this.getNextLink(),t)):s.reject()},fetchPreviousPage:function(t,e){return t=t||{},this.hasPreviousPage()?(t.isInfiniteScroll!==!1&&n.extend(t,{skipParseNextLink:!0,remove:!1}),this._fetchPage(this.getPreviousLink(),t)):s.reject()},_fetchPage:function(t,e){var i=n.isString(t)?t:t.href;return e=e||{},n.extend(e,{url:i}),this.fetch(e)}},defaults:{parsePreviousLink:function(t,e){return null},parseNextLink:function(t,e){return null}},before:{reset:function(t){this.setPreviousLink(null),this.setNextLink(null)},parse:function(t,e){e=e||{},e.skipParseLinks||(!e.skipParsePreviousLink&&n.isFunction(this.parsePreviousLink)&&this.setPreviousLink(this.parsePreviousLink(t,e)),!e.skipParseNextLink&&n.isFunction(this.parseNextLink)&&this.setNextLink(this.parseNextLink(t,e)))}}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(723),r=s.extend({model:o,getSortedByChannels:function(t,e){var i=this.clone(),s=e?-1:1,o=t.length;return i.sortBy(function(e){var i=n.indexOf(t,e.get("uuid")),r=i>-1,a=r?o-i:-1;return s*a})},getWithout:function(t){var e=this.clone();return e.filter(function(e){return!n.contains(t,e.get("uuid"))})}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(712),o=i(250),r=i(185),a=i(724),l=r.extend({url:"/svc/conversations/participant_info",mixins:[s],relations:{theme:a},defaults:{theme:null,is_blog_following_you:!1,is_following_blog:!1,duration_blog_following_you:null,duration_following_blog:null,seconds_since_last_activity:-1,blog_tags:[]},idAttribute:"uuid",parse:function(t){return!n.has(t,"theme")&&n.has(t,"global_theme_params")&&n.extend(t,{theme:n.get(t,"global_theme_params")}),n.get(t,"response",t)},getAvatarUrl:function(t){return t=t||96,o(this.get("avatar_url"),t)},getAvatarShape:function(){return this.get("theme").get("avatar_shape")},getBlogTags:function(){var t=this.get("blog_tags");return n.isArray(t)?t:[]},getDescription:function(){return this.get("theme").get("show_description")!==!0?"":this.get("description")},fetchAdditionalInfo:function(t,e){return e=n.extend({},e,{merge:!0,data:{q:this.get("uuid"),participant:t}}),this.fetch(e)},isFollowingYou:function(){return this.get("is_blog_following_you")===!0},isFollowing:function(){return this.get("is_following_blog")===!0},isMutuals:function(){return this.isFollowingYou()&&this.isFollowing()},getDurationFollowingYouSeconds:function(){var t=this.get("duration_blog_following_you");return this.isFollowingYou()&&n.isNumber(t)?t:null},getDurationFollowingSeconds:function(){var t=this.get("duration_following_blog");return this.isFollowing()&&n.isNumber(t)?t:null},getDurationMutualsSeconds:function(){var t,e;return this.isMutuals()?(t=this.getDurationFollowingSeconds(),e=this.getDurationFollowingYouSeconds(),Math.min(t,e)):null}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(663),o=i(185),r=o.extend({defaults:{background_color:null,link_color:null,avatar_shape:null,header_image_focused:null,show_header_image:!0,adjustBrightnessFactor:.3},getHeaderImage:function(){return this.get("show_header_image")===!0?this.get("header_image_focused"):null},getBackgroundTint:function(){return this.getTint(this.get("background_color"))},getAccentTint:function(){return this.getTint(this.get("link_color"))},getTint:function(t){var e;return this.get("tint"+t)?this.get("tint"+t):n.isEmpty(t)?null:(e=s.isLight(t,.5)?s.isLight(t,.05,.95)?r.TINT_WHITE:r.TINT_LIGHT:r.TINT_DARK,this.set("tint"+t,e),e)},isDark:function(t){return this.getTint(t)===r.TINT_DARK},isReadableOn:function(t,e){return t=s.hexToHsv(t),e=s.hexToHsv(e),!s.compare(t,e)},adjustColorForBackground:function(t,e){var i=this.get("adjustBrightnessFactor");return this.isReadableOn(t,e)?t:this.adjustBrightness(t,this.isDark(t)?i:i*-1)},getReadableColor:function(t,e){return this.isReadableOn(t,e)?t:s.readable(t)},adjustBrightness:function(t,e){return s.brighten(t,e)},getTintSuffix:function(t){return t===r.TINT_WHITE?"-white":t===r.TINT_LIGHT?"-light":t===r.TINT_DARK?"-dark":void 0}},{TINT_LIGHT:"light",TINT_DARK:"dark",TINT_WHITE:"white"});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(214),r=i(136),a=o.extend({name:"MessagingNotifier",defaults:{isEnabled:!1,notificationTimeout:5e3,notificationIcon:null},initialize:function(t){n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},notifyOnUnread:function(t,e){var i=s("New message for %1$s",e.get("name")),n={conversationId:t,channelUuid:e.get("uuid")};this._generateNotification(i,n)},_supportsNotifications:function(){return this.get("isEnabled")&&"Notification"in window},_needsNotificationPermission:function(){return this._supportsNotifications()&&"granted"!==window.Notification.permission&&"denied"!==window.Notification.permission},_isNotificationPermissionGranted:function(){return this._supportsNotifications()&&"granted"===window.Notification.permission},_requestPermission:function(t){window.Notification.requestPermission(t)},_generateNotification:function(t,e){var i,s;this._supportsNotifications()&&(s={icon:this.get("notificationIcon")},this._isNotificationPermissionGranted()?(i=new Notification(t,s),i instanceof Notification&&(i.addEventListener("click",n.bind(function(t){r.trigger("messaging:conversation:open:id",e.conversationId,e.channelUuid,"notification"),t.target.close()}),this),n.delay(n.bind(function(){this.close()},i),this.get("notificationTimeout")),this.trigger("notification:display",e.conversationId))):this._needsNotificationPermission()&&this._requestPermission(n.bind(function(i){this.trigger("notification:permission:change","granted"===i),this._generateNotification(t,e)},this)))}});t.exports=a},function(t,e,i){"use strict";var n,s=i(214),o=i(3),r=i(727),a=i(728),l=i(729),c=s.extend({name:"NotificationSoundManager",initialize:function(){var t=o.get(this.data,"sounds",[]),e=o.get(this.data,"soundpacks",{});this.soundCollection=new r(this._getSoundModels(t)),this.soundPackCollections=this._getSoundpackCollections(e)},playSoundName:function(t){var e=this.soundCollection.get(t);o.isEmpty(e)||this._playSoundModel(e)},playRandomFromSoundpack:function(t){var e=o.get(this.soundPackCollections,t);e&&this._playSoundModel(e.sample())},_playSoundModel:function(t){var e=new l({model:t}).render();this.listenToOnce(e,"ended",this._removeSoundView),e.play()},_removeSoundView:function(t){t.remove()},_getSoundModels:function(t){return o.map(t,function(t,e){return new a({name:e,filePath:t})})},_getSoundpackCollections:function(t){var e=this;return o.reduce(t,function(t,i,n){return t[n]=new r(e._getSoundModels(i)),t},{})}}),u=function(){return null==n&&(n=new c),n};t.exports=u},function(t,e,i){"use strict";var n=i(190),s=i(728),o=n.extend({model:s});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({idAttribute:"name",defaults:{name:null,filePath:null,fileType:"audio/mpeg"}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(730),r=s.extend({tagName:"audio",template:o,defaults:{filePath:null,fileType:null},events:{ended:"triggerRemove"},initialize:function(t){n.extend(this,n.pick(t,"model"))},getTemplateData:function(){return this.model.toJSON()},play:function(){this.el.play()},triggerRemove:function(){this.trigger("ended",this)}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<source src="'+__e(filePath)+'" type="'+__e(fileType)+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.extend({renderWithTemplate:n.noop,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"channels"))},afterRender:function(){this.listenTo(this.channels,"change:unread_messages_count_sum",this._onChangeChannelUnreadCount),this._onChangeChannelUnreadCount()},updateBadge:function(t){t>0&&this.$(".tab_notice_value").text(t>99?"99+":t),this.$(".tab_notice").toggleClass("tab-notice--active",t>0)},_onChangeChannelUnreadCount:function(){this.updateBadge(n.sum(this.channels.pluck("unread_messages_count_sum")))}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(277),r=i(226),a=i(496),l=i(733),c=i(746),u=i(752),h=i(756),d=i(741),p=i(760),_=r.extend({className:"messaging-inbox",template:p,defaults:{isLoading:!1,isAutoFetch:!0,isEmpty:!1,isLoadingEmptyInboxFavorites:!1,numFavorites:5},mixins:[o],subviews:{headerView:{constructor:c,options:function(t){return{eventBus:t.eventBus,user:t.user,channels:t.channels,currentBlogModel:t.currentBlogModel,popoverContainer:t.popoverContainer,isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}},composeView:{constructor:u,options:function(t){return{eventBus:t.eventBus,favoritesCollection:t.favoritesCollection,currentBlogModel:t.currentBlogModel,keyboardManager:t.keyboardManager,isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}},conversationsView:{constructor:l,options:function(t){return{eventBus:t.eventBus,collection:t.collection,emptyInboxCollection:t.emptyInboxCollection,currentBlogModel:t.currentBlogModel,channels:t.channels,favoritesCollection:t.favoritesCollection,appendFavoritesToInboxLimit:t.appendFavoritesToInboxLimit,isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}},inboxRecipientsView:{constructor:d,options:function(t){return{eventBus:t.eventBus,collection:t.favoritesCollection,title:s("Recently Followed"),context:"new:inbox:empty",isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}},emptyView:{constructor:h,options:function(t){return{eventBus:t.eventBus,collection:t.emptyInboxCollection}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection","user","channels","favoritesCollection","emptyInboxCollection","popoverContainer","currentBlogModel","appendFavoritesToInboxLimit","keyboardManager","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.loader=new a({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.set({isLoading:!this.getCurrentChannel().get("isInboxFetched"),isEmpty:0===this.collection.length}),this.listenTo(this,"change",this._setViewStates),this.listenTo(this.collection,"sync error",this._onSyncCollection),this.listenTo(this.collection,"update reset",this._onChangeCollection),this.listenTo(this.collection,"request",this._onRequestCollection),this.listenTo(this.composeView,"submit",this._onComposeSubmitRecipient),this.listenTo(this.headerView,"change:isComposing",this._setViewStates),this._setViewStates(),this.get("isAutoFetch")&&this.fetch(),this._fetchEmptyInboxFavorites(),this.isNewEmptyInboxEnabled&&this._fetchFavorites()},beforeRemove:function(){this.keyboardManager.remove("inbox")},getTemplateData:function(){return{isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled}},getCurrentChannel:function(){return this.currentBlogModel.getChannel()},fetch:function(t){this.collection.fetchInbox(this.currentBlogModel.getId(),t)},_onComposeSubmitRecipient:function(t){this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_NAMES,t)},_setViewStates:function(){var t=this.get("isEmpty"),e=this.get("isLoading")||this.get("isLoadingEmptyInboxFavorites"),i=this.headerView.get("isComposing");this.loader.set("loading",e&&!i),this.conversationsView.toggle(!i&&!t&&!e),this.emptyView.toggle(t&&!i&&!e&&!this.isNewEmptyInboxEnabled),this.inboxRecipientsView&&this.inboxRecipientsView.toggle(t&&!i&&!e&&this.isNewEmptyInboxEnabled),this.composeView.$el.toggle(i),i&&this.composeView.focus()},_onChangeCollection:function(){this.set("isEmpty",0===this.collection.length)},_onSyncCollection:function(){this.set({isLoading:!1,isEmpty:0===this.collection.length}),this.getCurrentChannel().set("isInboxFetched",!0)},_onRequestCollection:function(t,e,i){this.set({isEmpty:0===this.collection.length,isLoading:!this.getCurrentChannel().get("isInboxFetched")})},_fetchEmptyInboxFavorites:function(){var t=this;this.set("isLoadingEmptyInboxFavorites",!0),this.emptyInboxCollection.fetchFavorites(null,null,null,this.isNewEmptyInboxEnabled,"empty").then(function(){t.rendered&&(t.isNewEmptyInboxEnabled||t.favoritesCollection.reset(n.take(t.emptyInboxCollection.toJSON(),t.get("numFavorites"))))}).always(function(){t.rendered&&t.set("isLoadingEmptyInboxFavorites",!1)})},_fetchFavorites:function(){var t=this.get("numFavorites"),e=this.currentBlogModel.getId();this.favoritesCollection.fetchFavorites(t,e,null,!0)}});t.exports=_},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(734),a=i(277),l=i(331),c=i(735),u=i(740),h=i(741),d=i(745),p=o.extend({className:"inbox-conversations",template:d,mixins:[a,r],defaults:{isPaginating:!1,showFavorites:!1,hasNextPage:!0,showLoadingContainer:!0,appendFavoritesToInboxLimit:3},subviews:{conversations:{constructor:c,enableBatchRendering:!0,options:function(t){return{eventBus:t.eventBus,channels:t.channels,currentBlogModel:t.currentBlogModel}},collection:function(t){return t.collection}},paginationLoaderView:{constructor:l,options:{variation:"small h-centered",loading:!1}},favoritesView:{constructor:h,options:function(t){return{showMessageOnEmpty:!1,eventBus:t.eventBus,collection:t.favoritesCollection,title:s(t.isNewEmptyInboxEnabled?"Recently Followed":"More Tumblrs to talk to"),context:"inbox:moretumblrs",isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection","channels","favoritesCollection","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el}),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:showFavorites",this._onChangeShowFavorites),this.listenTo(this,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this,"change:showLoadingContainer",this._onChangeShowLoadingContainer),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this.collection,"update reset change",this._onCollectionChange),this.listenTo(this.favoritesCollection,"update reset",this._onFavoritesCollectionChange),this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this,"batch:rendered:conversations",this._onConversationsBatchRendered),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"change:hasNextPage",this._onChangeCollectionHasNextPage),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollBottom),this._setViewStates(),this._onChangeCollectionHasNextPage(this.collection,this.collection.hasNextPage()),this._onChangeShowFavorites(this,this.get("showFavorites")),this._onChangeHasNextPage(this,this.get("hasNextPage")),this._onChangeShowLoadingContainer(this,this.get("showLoadingContainer")),n.defer(n.bind(this.updateScrollBar,this))},toggle:function(t){this.$el.toggle(t),this.updateScrollBar()},beforeRemove:function(){this.scrollBar&&this.scrollBar.destroy()},getNextPage:function(){this.rendered&&this.collection.hasNextPage()&&(this.set("isPaginating",!0),this.collection.fetchNextPage().always(n.bind(function(){this.rendered&&this.set("isPaginating",!1)},this)))},updateScrollBar:function(){this.scrollBar&&this.scrollBar.update()},_setViewStates:function(){var t=this.get("hasNextPage"),e=this.collection.length>0&&!t&&this.collection.length<=this.get("appendFavoritesToInboxLimit");
this.set({showFavorites:e,showLoadingContainer:t}),this.updateScrollBar()},_saveModelOrder:function(){this.lastModelOrder=this._getModelOrderString()},_getModelOrderString:function(){return n.pluck(this.collection.models,"cid").join(" ")},_onCollectionSort:function(t){var e=this._getModelOrderString();this.lastModelOrder&&e.indexOf(this.lastModelOrder)===-1&&this.renderCollectionSubviews("conversations"),this._saveModelOrder()},_onCollectionChange:function(t,e){this._setViewStates(),this._saveModelOrder()},_onCollectionSync:function(){this._onChangeCollectionHasNextPage(this.collection,this.collection.hasNextPage())},_onCollectionReset:function(t){this.$el.scrollTop(0),this._saveModelOrder()},_onConversationsBatchRendered:function(){this.updateScrollBar()},_onChangeCollectionHasNextPage:function(t,e){this.set("hasNextPage",e&&t.length>=10)},_onChangeHasNextPage:function(t,e){this._setViewStates()},_onChangeIsPaginating:function(t,e){this.paginationLoaderView.set("loading",e)},_onScrollBottom:function(t){t&&this.getNextPage()},_onChangeShowFavorites:function(t,e){this.favoritesView.$el.toggle(e)},_onChangeShowLoadingContainer:function(t,e){this.js$("loader-container").toggle(e)},_onFavoritesCollectionChange:function(){this.updateScrollBar()}});t.exports=p},function(t,e,i){"use strict";var n=i(3),s=i(187),o=new s({defaults:{removeCollectionSubviews:function(t){var e=this[t];this.subviews[t]&&!n.isEmpty(e)&&(e=this[t],this._subviews=n.difference(this._subviews,e),n.invoke(e,"remove"),this[t].length=0)},removeCollectionSubview:function(t,e){var i,s=this[t];this.subviews[t]&&!n.isEmpty(s)&&(i=n.findWhere(s,{model:e}),i&&(this._subviews=n.without(this._subviews,i),i.remove(),this[t]=n.without(this[t],i)))},addNewCollectionSubview:function(t,e,i){var s=this.subviews[t];if(i||(i=this._getSubviewCollection(t)),s&&i){var o=s.container||this._createDefaultContainerFunction(t),r=s.prepareViewForAdd||this._createDefaultPrepareViewForAddFunction(t),a=s.options||{},l={insertionIndex:i.indexOf(e)},c=n.has(this,t),u=this.createCollectionSubviewRenderer([e],o,r,a,t,c,l);return this._isBatchRenderingInProgress(t)?void this.once("rendered:"+t,u,this):void(this.rendered?u():this.once("rendered",u,this))}},sortCollectionSubviews:function(t,e){var i,s=this.subviews[t];e||(e=this._getSubviewCollection(t)),s&&e&&this[t]&&(i=n.pluck(e.models,"cid"),i=n.zipObject(i,n.range(0,i.length)),this[t]=n.sortBy(this[t],function(t){return n.get(i,t.model.cid,0)}))},batchRenderCollectionSubviews:function(t){var e=this.subviews[t];if(e){var i=e.container||this._createDefaultContainerFunction(t),s=e.prepareView||this._createDefaultPrepareViewFunction(t),o=e.options||{},r=n.result(e,"batchSize")||5,a=n.result(e,"batchDelay")||100,l=this._getSubviewCollection(t),c=n.chunk(l.models,r),u=n.map(c,function(e,r){return n.bind(function(){var n=this.createCollectionSubviewRenderer(e,i,s,o,t,r>0);return n.call(this)},this)},this),h=n.bind(function(){this._scheduleBatchRenders(t,u,a)},this);this.rendered?h():this.once("rendered",h,this)}},_isBatchRenderingInProgress:function(t){return n.get(this._deferredRenders,t,[]).length>0},_scheduleBatchRenders:function(t,e,i){var s=e.length,o=function(){this._afterBatchRenderCollectionSubviews(t)},r=function(e){e.call(this,t),this._afterEachBatchRenderCollectionSubviews(t),s--,0===s&&o.call(this)};return this._deferredRenders||(this._deferredRenders={}),n.has(this._deferredRenders,t)||(this._deferredRenders[t]=[]),this._cancelBatchRenders(t),0===s?void o.call(this):void n.each(e,function(e,s){var o;return 0===s?void r.call(this,e):(o=setTimeout(n.bind(function(){r.call(this,e),this._deferredRenders[t]=n.without(this._deferredRenders[t],o)},this),i*(s+1)),void this._deferredRenders[t].push(o))},this)},_cancelBatchRenders:function(t){n.isEmpty(this._deferredRenders)||(n.isEmpty(t)||n.has(this._deferredRenders,t))&&(n.isEmpty(t)?(n.each(this._deferredRenders,function(t,e){n.each(t,function(t){clearTimeout(t)},this)},this),this._deferredRenders={}):(n.each(this._deferredRenders[t],function(t){clearTimeout(t)},this),this._deferredRenders[t].length=0))},_afterEachBatchRenderCollectionSubviews:function(t){this.trigger("batch:rendered:"+t)},_afterBatchRenderCollectionSubviews:function(t){this.trigger("rendered:"+t)},_attachCollectionListeners:function(t){var e=this._getSubviewCollection(t);e&&(this.listenTo(e,"add",n.partial(this.addNewCollectionSubview,t)),this.listenTo(e,"remove",n.partial(this.removeCollectionSubview,t)),this.listenTo(e,"reset",n.partial(this.renderCollectionSubviews,t)),this.listenTo(e,"update",n.partial(this.sortCollectionSubviews,t)))},_getSubviewCollection:function(t){var e=n.get(this.subviews[t],"collection");return e===!0?this.collection:n.isFunction(e)?e(this):e?e:null},_createDefaultPrepareViewForAddFunction:function(t){var e=this.subviews[t];return n.bind(function(i,s){var o=i.children(),r=new e.constructor(s),a=s.insertionIndex;return r.$el.attr("data-subview",t),n.isNumber(a)&&a<o.length?r.$el.insertBefore(o.get(a)):i.append(r.$el),r},this)}},before:{renderSubviews:function(){n.each(this.subviews,function(t,e){t.collection&&this._attachCollectionListeners(e)},this)},beforeRemove:function(){this._cancelBatchRenders()}},around:{renderCollectionSubviews:function(t,e){var i=this.subviews[e];if(i)return this.removeCollectionSubviews(e),n.result(i,"enableBatchRendering")===!0?this.batchRenderCollectionSubviews(e):t.apply(this,n.rest(arguments))}}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(736),a=i(737),l=i(277),c=i(262),u=i(180),h=i(182),d=i(738),p=o.extend({className:"inbox-conversation",template:r,mixins:[l],subviews:{statusIndicator:{constructor:d,options:function(t){return{isOnline:t.otherParticipant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:u.bool("status_indicator"),name:t.otherParticipant.get("name")}}}},defaults:{maxInitialMessageLength:100,currentMessage:null},events:{"click [data-open-conversation]":"_onClickConversation"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","channels","currentBlogModel")),this.participants=this.model.get("participants"),this.sortedParticipants=this.participants.getSortedByChannels(this._getOwnSortedBlogIds()),this.otherParticipant=n.first(this.sortedParticipants),this.set("currentMessage",this.model.getInboxMessage())},afterRender:function(){this.listenTo(this.model,"change:last_read_ts change:last_modified_ts",this._onChangeTimestamps),this.listenTo(this,"change:currentMessage",this._onChangeCurrentMessage),this._onChangeCurrentMessage(this,this.get("currentMessage"));var t=this.$el.find(".pixelated-avatar");n.each(t,n.bind(function(t){s(t).removeClass("hide").addClass("show"),c.drawPixelatedImages(this)},this))},openConversation:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this.model,"inbox")},getTemplateData:function(){var t=h(),e=this.otherParticipant.get("is_adult"),i=t.get("channels").map(function(t){return t.name}),s=n.contains(i,this.model.get("blogName")),o=u.bool("safe_mode")&&t.get("safe_mode");return{name:this.otherParticipant.get("name"),avatarUrl:this.otherParticipant.getAvatarUrl(),message:this._getEscapedMessageMarkup(this.get("currentMessage")),isSafeModeEnabled:o,isUser:s,blogIsAdult:e}},getMessageParticipant:function(t){return this.participants.get(t.get("participant"))},_getEscapedMessageMarkup:function(t){var e,i=this._getAdditionalBlogName(t),s=n.escape(t.getMessage());return n.isEmpty(s)||(s=s.substring(0,this.get("maxInitialMessageLength"))),e=t.getActionMarkup(i,'<span class="name">',"</span>"),n.compact([e,s]).join(": ")},_safeTruncateMessage:function(t){var e=this.js$("message"),i=this.js$("message-text"),s=function(){a(e),n.isFunction(t)&&t.call(this,i.html())};e.height()?s.call(this):(this.$el.css("visibility","hidden"),n.defer(n.bind(function(){this.rendered&&(s.call(this),this.$el.css("visibility",""))},this)))},_isLastMessageFromSelf:function(t){return!n.isEmpty(t)&&!n.isEmpty(this.otherParticipant)&&this.otherParticipant.get("uuid")!==t.get("uuid")},_getAdditionalBlogName:function(t){var e;return n.isEmpty(t)?null:(e=this.getMessageParticipant(t),n.isEmpty(e)?null:this._isLastMessageFromSelf(e)?e.get("name"):null)},_onChangeTimestamps:function(t){this.set("currentMessage",this.model.getInboxMessage())},_onChangeCurrentMessage:function(t,e){var i=this.getMessageParticipant(e),s=e.get("truncatedText");this.$el.toggleClass("is-unread",this.model.isUnread()&&!this._isLastMessageFromSelf(i)),n.isEmpty(s)?(this.js$("message-text").html(this._getEscapedMessageMarkup(e)),this._safeTruncateMessage(function(t){e.set("truncatedText",t)})):this.js$("message-text").html(s)},_onClickConversation:function(t){t.preventDefault(),this.openConversation()},_getOwnSortedBlogIds:function(){return this.channels.getSortedIds(this.currentBlogModel.getId())}});t.exports=p},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-open-conversation href="#" class="inbox-row"><div data-subview="statusIndicator"></div> ',__p+=blogIsAdult&&isSafeModeEnabled&&!isUser?' <canvas class="avatar post-activity-avatar-image post_sub_avatar_image pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" width="36" height="36" alt="'+__e(name)+'"></canvas> ':' <img class="avatar" src="'+__e(avatarUrl)+'"> ',__p+=' <div class="info-container"><div class="name-container"><h3 class="name">'+__e(name)+'</h3></div><h4 class="message" data-js-message><span class="text" data-js-message-text>'+(null==(__t=message)?"":__t)+"</span></h4></div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";function n(t,e){return t.scrollHeight-e.maxHeight<5}function s(t){return parseInt(c(t).css("max-height"),10)}function o(t,e,i){var s,o=t.nodeValue,r=l.get(e,"truncationString","..."),a="",c="",u=0,h=o.length;if(n(i,e))return!0;for(;u<=h;)s=u+h>>>1,a=l.trimRight(o.substring(0,s))+r,t.nodeValue=a,n(i,e)?(u=s+1,a.length>c.length&&(c=a)):h=s-1;return c.length>0?(t.nodeValue=c,!0):(t.nodeValue="",!1)}function r(t,e,i){var n=c(t).contents();l.each(n.get().reverse(),function(t){t.nodeType===Node.TEXT_NODE?o(t,e,i):r(t,e,i)})}function a(t,e){if(e=e||{},l.defaults(e,{truncationString:"..."}),t instanceof c&&(t=t.get(0)),l.has(e,"maxHeight")||l.extend(e,{maxHeight:s(t)}),l.isFinite(l.get(e,"maxHeight"))&&!n(t,e))return r(t,e,t)}var l=i(3),c=i(8);t.exports=a},function(t,e,i){"use strict";var n=i(130),s=i(226),o=i(739),r=s.extend({template:o,className:"status-indicator-wrapper",initialize:function(t){this.set({isOnline:t.isOnline&&t.canSeeUIFlag,ariaText:n("%1$s is online",t.name)})},render:function(){return this.get("isOnline")?s.prototype.render.call(this):this}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div aria-label="'+__e(ariaText)+'" title="online" class="status-indicator"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(492),o=s.extend({defaults:n.defaults({isDisabled:!1,isAtTop:!1,isAtBottom:!1,topThreshold:50,bottomThreshold:50},s.prototype.defaults),initialize:function(t){return this.options=t||{},s.prototype.initialize.call(this,this.options.el,this.options)},render:function(){return this.listenTo(this,"change:isAtTop",this._changeIsAtTop),this.listenTo(this,"change:isAtBottom",this._changeIsAtBottom),s.prototype.render.apply(this,arguments)},_stealScroll:function(t){return this.get("isDisabled")?(t.preventDefault(),void t.stopPropagation()):s.prototype._stealScroll.apply(this,arguments)},update:function(){return this._updateInfiniteScrollFlags(),s.prototype.update.apply(this,arguments)},_onScrollStop:function(){return this._updateInfiniteScrollFlags(),s.prototype._onScrollStop.apply(this,arguments)},getCurrentPositions:function(){return this._setCurrentPositions(),{height:this._currentHeight,scrollBottom:this._currentScrollBottom,scrollTop:this._currentScrollTop}},isAtTop:function(){return this.get("isAtTop")},isAtBottom:function(){return this.get("isAtBottom")},_isAtTop:function(t){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollTop<=t&&this._currentHeight>t},_isAtBottom:function(t){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollBottom<=t&&this._currentHeight>t},_isUserScroll:function(){var t,e=5;return!!n.isFinite(this._previousScrollHeight)&&(t=Math.abs(this._currentScrollHeight-this._previousScrollHeight),t<=e)},setDisabled:function(t){this.set("isDisabled",t)},isDisabled:function(){return this.get("isDisabled")},_setCurrentPositions:function(){var t=this.container;this._previousScrollHeight=this._currentScrollHeight,this._currentScrollHeight=t.scrollHeight,this._currentHeight=t.clientHeight,this._currentScrollBottom=t.scrollHeight-t.scrollTop-this.container.clientHeight,this._currentScrollTop=t.scrollTop},_updateInfiniteScrollFlags:function(){return!this.destroyed&&(this._setCurrentPositions(),void this.set({isAtTop:this._isAtTop(this.get("topThreshold")),isAtBottom:this._isAtBottom(this.get("bottomThreshold"))}))},_changeIsAtTop:function(t,e){this.trigger("scrolltop",e)},_changeIsAtBottom:function(t,e){this.trigger("scrollbottom",e)}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(734),r=i(277),a=i(232),l=i(478),c=i(742),u=i(744),h=s.extend({className:"inbox-recipients",template:u,mixins:[r,a,o,l],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},defaults:{isEmpty:!0,showMessageOnEmpty:!0,selectedView:null,context:"inbox:recipients"},subviews:{recipients:{constructor:c,options:function(t){return{eventBus:t.eventBus,onSelect:n.bind(t._onSubviewSelect,t),onClear:n.bind(t._onSubviewClear,t),context:t.context,isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}},collection:function(t){return t.collection}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection","title","context","isNewEmptyInboxEnabled")),this.keyboardViewName="recipients",this.disableKeys()},afterRender:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this._onCollectionChange(this.collection),this._onChangeIsEmpty(this,this.get("isEmpty"))},getTemplateData:function(){return{title:this.title,noResultsText:this.collection.getNoResultsFoundMessage()}},toggle:function(t){this.$el.toggle(t),t&&this.deselect(this.keyboardViewName)},_onChangeSelectedView:function(t,e){var i=this.previous("selectedView");i&&i.setSelected(!1),e&&e.setSelected(!0)},_onChangeIsEmpty:function(t,e){this.get("showMessageOnEmpty")?this.js$("no-results-container").toggle(e):(this.js$("container").toggle(!e),this.js$("no-results-container").hide())},_shuffleNoResultsText:function(){this.js$("no-results-text").text(this.collection.getNoResultsFoundMessage())},_onCollectionSort:function(){this.renderCollectionSubviews("recipients")},_onCollectionChange:function(t){this.set("isEmpty",0===t.length),this.deselect(this.keyboardViewName)},_onCollectionSync:function(t){0===t.length&&this.get("showMessageOnEmpty")&&this._shuffleNoResultsText()},_onSubviewSelect:function(t){this.set("selectedView",t),this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.recipients,t))},_onSubviewClear:function(t){this.set("selectedView",null),this.deselect(this.keyboardViewName)},_onKeyPressDown:function(t){var e;t.preventDefault(),e=this.isLastSelected(this.keyboardViewName)?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",e)},_onKeyPressUp:function(t){var e;t.preventDefault(),e=this.isFirstSelected(this.keyboardViewName)?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",e)},_onKeyPressEnter:function(t){var e,i=this.get("selectedView");t.preventDefault(),i?e=i.model:1===this.collection.length&&(e=this.collection.first()),e&&this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[e],this.context)}});t.exports=h},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(262),r=i(737),a=i(277),l=i(180),c=i(226),u=i(182),h=i(743),d=c.extend({className:"inbox-recipient",template:h,mixins:[a],defaults:{isSelected:!1,context:"inbox:recipients"},events:{"click [data-start-conversation]":"_onStartConversationClick",mouseenter:"_onRecipientHover",mouseleave:"_onRecipientLeave"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","onSelect","onClear","context","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.isNewEmptyInboxEnabled&&r(this.js$("tags-string"));var t=this.$el.find(".pixelated-avatar");n.each(t,n.bind(function(t){this.$(t).removeClass("hide").addClass("show"),o.drawPixelatedImages(this)},this))},setSelected:function(t){this.rendered&&this.set("isSelected",t)},getTemplateData:function(){var t=u(),e=this.model.get("is_adult"),i=n.pluck(t.get("channels"),"name"),s=n.contains(i,this.model.get("name")),o=l.bool("safe_mode")&&t.get("safe_mode");return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled,tagsString:this.getTagsString(),isSafeModeEnabled:o,isUser:s,blogIsAdult:e}},getTagsString:function(){var t=this.model.get("tags");return n.isEmpty(t)?null:t.length>1?s("Posts about #%1$s and #%2$s",t[0],t[1]):1===t.length?s("Posts about #%1$s",t[0]):void 0},_onStartConversationClick:function(t){t.preventDefault(),this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[this.model],this.get("context")),this.isNewEmptyInboxEnabled&&this.eventBus.trigger(this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this.model,this.get("context"),!0)},_onChangeIsSelected:function(t,e){this.$el.toggleClass("selected",e)},_onRecipientHover:function(){n.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onRecipientLeave:function(){n.isFunction(this.onClear)&&this.onClear(this,this.model)}});t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-start-conversation href="/conversation/new/'+__e(name)+'" class="inbox-row"> ',__p+=blogIsAdult&&isSafeModeEnabled&&!isUser?' <canvas class="avatar post-activity-avatar-image post_sub_avatar_image pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" width="36" height="36" alt="'+__e(name)+'"></canvas> ':' <img class="avatar" src="'+__e(avatarUrl)+'"> ',__p+=' <div class="info-container"> ',__p+=isNewEmptyInboxEnabled?" <h3>"+__e(name)+'</h3><h4 class="tags" data-js-tags-string>'+__e(tagsString)+'</h4><h4 class="send-link">'+__e(__("Send a message"))+"</h4> ":" <h3>"+__e(name)+"</h3><h4>"+__e(title)+"</h4> ",__p+=" </div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div data-js-container> ",title&&(__p+=" <h2>"+__e(title)+"</h2> "),__p+=' <div data-subview="recipients[]"></div><div data-js-no-results-container class="no-results"><p data-js-no-results-text>'+__e(noResultsText)+"</p></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-js-conversations-container><div data-subview="conversations[]"></div><div data-subview="favoritesView"></div></div><div class="inbox-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(747),r=i(749),a=i(751),l=s.extend({className:"inbox-header",template:a,defaults:{isComposing:!1},subviews:{senderView:{constructor:o,options:function(t){return{eventBus:t.eventBus,user:t.user,channels:t.channels,popoverContainer:t.popoverContainer,currentBlogModel:t.currentBlogModel}}},composeToggleView:{constructor:r,options:function(t){return{eventBus:t.eventBus,isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","user","channels","popoverContainer","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.listenTo(this.composeToggleView,"change:isComposing",function(t,e){this.set("isComposing",e)}),this.listenTo(this,"change:isComposing",function(t,e){this.composeToggleView.set("isComposing",e)})}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(650),r=i(748),a=s.extend({className:"inbox-sender",template:r,subviews:{blogSelector:{constructor:o,options:function(t){return{className:"inbox-sender-blog-selector",collection:t.channels,popoverOptions:{popoverContainer:t.popoverContainer},currentTumblelog:t.channels.findWhere({uuid:t.currentBlogModel.getId()}),badgeCountField:"unread_messages_count_sum"}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","user","channels","currentBlogModel","popoverContainer"))},afterRenderSubviews:function(){this.listenTo(this.blogSelector,"change:currentTumblelog",this._onBlogSelectorChange)},_onBlogSelectorChange:function(t,e){this.currentBlogModel.setChannel(e)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="blogSelector" class="blog-selector"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(750),a=o.extend({className:"inbox-compose-toggle",template:r,defaults:{isComposing:!1},events:{"click [data-js-compose-toggle]":"_onClickToggleCompose"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isComposing",this._onChangeIsComposing)},getTemplateData:function(){return{message:s(this.isNewEmptyInboxEnabled?"New Message":"Compose message")}},_onChangeIsComposing:function(t,e){this.$el.toggleClass("active",e)},_onClickToggleCompose:function(t){var e=void 0;t.preventDefault(),this.set("isComposing",!this.get("isComposing")),e=this.isNewEmptyInboxEnabled?this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this.eventBus.trigger(e,this.isNewEmptyInboxEnabled)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<a href="#" class="compose-toggle compose-start" data-js-compose-toggle>'+__e(message)+'</a><a href="#" class="compose-toggle compose-cancel" data-js-compose-toggle>'+__e(__("Nevermind"))+"</a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="senderView"></div><div data-subview="composeToggleView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(130),r=i(226),a=i(277),l=i(753),c=i(741),u=i(496),h=i(755),d=r.extend({className:"inbox-compose",template:h,defaults:{isShowFavorites:!0,isLoading:!1,showLoadingAfterMs:250,hasEditorFocus:!1},events:{"input [data-js-textinput]":"_onTextInputChange","focus [data-js-textinput]":"_onTextInputFocus","blur [data-js-textinput]":"_onTextInputBlur"},mixins:[a],subviews:{favoritesView:{constructor:c,options:function(t){return{showMessageOnEmpty:!1,eventBus:t.eventBus,collection:t.favoritesCollection,title:o(t.isNewEmptyInboxEnabled?"Recently Followed":"Favorites"),context:"inbox:favorites",isNewEmptyInboxEnabled:t.isNewEmptyInboxEnabled}}},searchResultView:{constructor:c,options:function(t){return{eventBus:t.eventBus,collection:t.collection,context:"inbox:typeahead"}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","favoritesCollection","currentBlogModel","keyboardManager","isNewEmptyInboxEnabled")),this.collection=new l,this._debouncedSearch=n.bind(n.debounce(this._search,250),this)},afterRenderSubviews:function(){this.loader=new u({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this._onChangeIsShowFavorites(this,this.get("isShowFavorites"))},_setKeyboardState:function(){this.keyboardManager.remove("inbox:compose"),this.get("hasEditorFocus")&&(this.get("isShowFavorites")?this.keyboardManager.add("inbox:compose:favorites",this.favoritesView):this.keyboardManager.add("inbox:compose:results",this.searchResultView))},_onChangeHasEditorFocus:function(t,e){this._setKeyboardState()},fetchResults:function(t){var e=this.currentBlogModel.getChannel().get("uuid");return this.set("isLoading",!0),this.collection.fetchByQuery(t,e).always(n.bind(function(){this.rendered&&this.set({isShowFavorites:!1,isLoading:!1})},this))},clear:function(){this.js$("textinput").val("")},focus:function(){this.js$("textinput").focus()},blur:function(){this.js$("textinput").blur()},beforeRemove:function(){this.keyboardManager.remove("inbox:compose")},_search:function(t){n.isEmpty(t)?this.set("isShowFavorites",!0):this.fetchResults(t)},_onTextInputChange:function(t){this._debouncedSearch(s(t.target).val())},_onTextInputBlur:function(t){this.set("hasEditorFocus",!1)},_onTextInputFocus:function(t){this.set("hasEditorFocus",!0)},_onChangeIsShowFavorites:function(t,e){this.favoritesView.toggle(e),this.searchResultView.toggle(!e),this._setKeyboardState()},_onChangeIsLoading:function(t,e){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),e?void(this._loaderTimeout=setTimeout(n.bind(function(){this.loader.set("loading",!0)},this),this.get("showLoadingAfterMs"))):this.loader.set("loading",!1)}});t.exports=d},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(130),r=i(190),a=i(723),l=i(754),c=r.extend({url:"/svc/conversations/participant_suggestions",model:a,resultCache:{},fetchFlags:["empty","post"],initialize:function(){return this.getNoResultsFoundMessage=l([o("That isn't anyone."),o("Uh, who?"),o("Huh what?"),o("Never heard of 'em."),o("???"),o("Eh?"),o("Whaaa?")]),r.prototype.initialize.apply(this,arguments)},parse:function(t,e){return s.get(t,"response.blogs")||t},fetchByQuery:function(t,e,i){return i=i||{},s.extend(i,{reset:!0,data:{q:t,participant:e}}),this.fetch(i)},fetchFavorites:function(t,e,i,n,o,r){return t=t||8,r=r||{},s.extend(r,{reset:!0,data:{limit:t,participant:e,include_recent:i,exclude_active:n},flag:o}),this.fetch(r)},fetch:function(t){var e=JSON.stringify(s.get(t,"data")),i=s.get(t,"flag",""),o=new n.Deferred,a=s.get(this.resultCache,e);return this.cancelFetch(),a&&this.fetchFlags.indexOf(i)!==-1?(this.reset(a),this.trigger("sync",this),o.resolve(),o):(this._request=r.prototype.fetch.apply(this,arguments),this._request.then(s.bind(function(t){this.fetchFlags.indexOf(i)!==-1&&s.set(this.resultCache,e,this.parse(t))},this)).always(s.bind(function(){this._request=null},this)),this._request)},cancelFetch:function(){this._request&&(this._request.abort(),this._request=null)}});t.exports=c},function(t,e,i){"use strict";function n(t){var e,i;return t=t||[],function(){return s.isEmpty(e)&&(e=s.shuffle(t),s.isEmpty(i)||(e=s.without(e,i))),i=e.pop()}}var s=i(3);t.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="inbox-compose-input"><label class="label"><span class="label-text-container"> '+__e(__("To:"))+' </span><span class="input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="input" data-js-textinput></span></label></div><div class="inbox-compose-main"><div data-subview="loader"></div><div data-subview="favoritesView"></div><div data-subview="searchResultView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(277),r=i(226),a=i(757),l=i(759),c=r.extend({className:"inbox-empty",template:l,mixins:[o],subviews:{blogsView:{constructor:a,options:function(t){return{collection:t.collection,eventBus:t.eventBus}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection"))},getTemplateData:function(){return{header:s("Talk to a Tumblr")}},toggle:function(t){this.$el.toggle(t)}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(758),a=o.extend({className:"inbox-empty-blogs",template:r,defaults:{numItemsPerRow:4},events:{"click [data-js-start-conversation]":"_onStartConversation"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection"))},afterRender:function(){this.listenTo(this.collection,"update reset",this.render)},getTemplateData:function(){var t,e=this.get("numItemsPerRow"),i=n.map(this.collection.models,function(t){return n.extend(t.toJSON(),{avatarUrl:t.getAvatarUrl()})});return i.length>0&&(t=Math.max(1,Math.floor(i.length/e)),i=i.slice(0,t*e)),{blogs:i}},_onStartConversation:function(t){var e=s(t.currentTarget).attr("data-js-start-conversation"),i=this.collection.findWhere({name:e});this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[i],"inbox:empty"),
this.eventBus.trigger(this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,i,"old:inbox:empty",!1),t.preventDefault()}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)_.isEmpty(blogs)||(__p+=' <div class="blogs"> ',_.each(blogs,function(t){__p+=' <a class="blog" href="/messaging/conversation/'+__e(t.name)+'" data-js-start-conversation="'+__e(t.name)+'"><img class="avatar" src="'+__e(t.avatarUrl)+'" alt="'+__e(t.name)+'" title="'+__e(t.name)+'" width="40" height="40"> </a> '}),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><div class="header-container"><h2 class="header" data-js-header>'+__e(header)+'</h2></div><div data-subview="blogsView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div data-subview="headerView"></div><div data-subview="composeView"></div><div class="inbox-main"><div data-subview="loader"></div><div data-subview="conversationsView"></div></div> ',isNewEmptyInboxEnabled&&(__p+=' <div class="empty-suggestions"><div data-subview="inboxRecipientsView"></div></div> '),__p+=' <div data-subview="emptyView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(235),r=i(130),a=i(226),l=i(331),c=i(277),u=i(220).animation,h=i(437),d=i(136),p=i(762),_=i(764),g=i(790),f=i(792),m=i(796),v=i(799),b=i(801),y=i(776),w=i(711),k=i(803),C=i(806),x=i(768).html,S=i(754),T=i(808),E=i(813),P=i(816),F=i(828),I=a.extend({template:F,className:"messaging-conversation-wrapper",defaults:{isError:!1,canSend:!0,isPossibleSpam:!1,isLoading:!0,isHidePendingPost:!1,isFetching:!0,isFetched:!1,isFetchingIcebreakers:!1,isOffline:!1,isAutoFetch:!0,isMinimized:!1,isDropping:!1,isCurrentDropValid:!0,animateInMessageDuration:500,minimizeOpeningClass:"is-minimize-opening",minimizeClosingClass:"is-minimize-closing",droppingClassName:"is-dropping",noBlurSupportClass:"no-blur-support",imagePreviewAnimateInDurationMs:300,imagePreviewAnimateOutDurationMs:200,imagePreviewAnimateInEasing:[.22,.685,.03,.895],imagePreviewAnimateOutEasing:[.895,.03,.685,.22],imageUploadMaxBytes:null,canModifySafeMode:!0},events:{"click [data-js-tumblelog-name]":"_onBlogClick","click [data-js-messaging-tumblelog-name]":"_onMessagingBlogClick","click [data-js-lightbox-url]":"_onImageLightboxUrlClick","click [data-js-main]":"_onMainContainerClick",dragover:"_onDragOver",dragenter:"_onDragEnter",dragleave:"_onDragLeave",drop:"_onDragDrop",keydown:"_onKeyDown"},mixins:[c],subviews:{conversationLoaderView:{constructor:l,options:{variation:"small centered",loading:!1}},headerView:{constructor:p,options:function(t){return{eventBus:t.eventBus,participants:t.sortedParticipants,theme:t.theme,channels:t.channels,user:t.user}}},messagesView:{constructor:_,options:function(t){return{eventBus:t.eventBus,collection:t.model.get("messages"),participants:t.model.get("participants"),conversation:t.model,isSafeModeEnabled:t.isSafeModeEnabled,messageFormatter:t.messageFormatter,animateInMessage:n.bind(t._animateInMessage,t),otherParticipant:t.otherParticipant,canModifySafeMode:t.canModifySafeMode}}},previewView:{constructor:f,options:function(t){return{animateInDurationMs:t.get("imagePreviewAnimateInDurationMs"),animateOutDurationMs:t.get("imagePreviewAnimateOutDurationMs"),animateInEasing:t.get("imagePreviewAnimateInEasing"),animateOutEasing:t.get("imagePreviewAnimateOutEasing")}}},composeView:{constructor:m,options:function(t){return{eventBus:t.eventBus,keyboardManager:t.keyboardManager,keyboardNamespace:t.keyboardNamespace+":compose",pluginsArray:t.getPluginsArray(),pluginAnimateInDurationMs:t.get("imagePreviewAnimateOutDurationMs"),pluginAnimateOutDurationMs:t.get("imagePreviewAnimateInDurationMs"),pluginAnimateInEasing:t.get("imagePreviewAnimateOutEasing"),pluginAnimateOutEasing:t.get("imagePreviewAnimateInEasing")}}},minimizedView:{constructor:v,options:function(t){return{eventBus:t.eventBus,model:t.model}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","user","model","channels","messageFormatter","popoverContainer","keyboardManager","collection","isSafeModeEnabled","canModifySafeMode")),this.keyboardNamespace="conversation:"+this.cid,this.model||(this.model=new w),this.messageFormatter||(this.messageFormatter=new x),this.conversation=this.model,this.sortedParticipants=this._getSortedParticipantsCopy(),this.otherParticipant=this.conversation.getOtherParticipant(),this.getGenericErrorMessage=S([r("Something went screwy."),r("Something's busted."),r("Something got snagged."),r("Something's acting up."),r("Something sucks!"),r("Internet is being dumb."),r("Computer weirdness."),r("The server is being foolish."),r("Something fizzled."),r("The internet evaporated."),r("The internet is being wiggly."),r("Something went splat."),r("Server turned to dust."),r("Something's wonky."),r("Something's not happening."),r("Something's not working."),r("Something got messed up."),r("Unknown, totally annoying error."),r("A nameless error mysteriously occurred."),r("Our computer is a loser."),r("Something pooped out."),r("Something fell into a volcano."),r("Something is all gummed up."),r("Something melted.")]),this.permanentPostErrorMessage=r("Can't send this post."),this.getRetryPostErrorMessage=S([r("Hrm. Post didn't send."),r("Blegh. Post didn't send."),r("Fffft. Post didn't send."),r("Welp. Post didn't send."),r("Sending machine broke.")]),this.customErrorMessages={403.7001:r("Please verify your email address before talking to a Tumblr."),403.7003:r("Sorry, %1$s only allows messages from Tumblrs they follow.",this.otherParticipant.get("name")),409:r("You can only send messages to Tumblrs you follow."),429:r("You've hit the daily limit on new conversations. Impressive.")},this.getSpamErrorMessage=S([r("Look sketchy?"),r("Look suspicious?"),r("Look fishy?"),r("Look shady?"),r("Seem fake?"),r("Is this spam?")]),this.easeOutExpo=[.19,1,.22,1],this.dragCount=0},render:function(){return this.imageUploadPlugin=new E({imageUploadMaxBytes:this.getImageUploadMaxBytes()}),a.prototype.render.apply(this,arguments)},afterRenderSubviews:function(){this.listenTo(this,"change:isError change:isLoading",this._setOpenViewStates),this.listenTo(this,"change:isHidePendingPost change:isFetching change:isError change:isFetchingIcebreakers",this._setLoadingState),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:canSend",this._onChangeCanSend),this.listenTo(this,"change:isPossibleSpam",this._onChangeIsPossibleSpam),this.listenTo(this,"change:isMinimized",this._onChangeIsMinimized),this.listenTo(this,"change:isDropping",this._onChangeIsDropping),this.listenTo(this,"change:isCurrentDropValid",this._onChangeIsCurrentDropValid),this.listenTo(d,"tumblr_lightbox:form:hide",this._onTumblrLightboxFormHide),this.listenTo(this.composeView,"submit",this._onComposeSubmit),this.listenTo(this.composeView,"resize",this._onComposeResize),this.listenTo(this.composeView,"input",this._onComposeInput),this.listenTo(this.composeView,"focus",this._onComposeFocus),this.listenTo(this.composeView,"blur",this._onComposeBlur),this.listenTo(this.composeView,"plugin:preview:add:image",this._onComposeViewPluginPreviewAddImage),this.listenTo(this.composeView,"plugin:click",this._onComposeViewPluginClick),this.listenTo(this.composeView,"pasteBlob",this._onComposePasteBlob),this.listenTo(this.headerView,"closeClick",this._onTriggeredClose),this.listenTo(this.headerView,"minimizeClick",this._onHeaderMinimizeClick),this.listenTo(this.headerView,"moreActionsClick",this._onHeaderMoreActions),this.listenTo(this.conversation,"change:id",this._onChangeId),this.listenTo(this.conversation,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.conversation,"change:can_send",this._onChangeConversationCanSend),this.listenTo(this.conversation,"change:is_possible_spam",this._onChangeConversationIsPossibleSpam),this.listenTo(this.conversation.get("messages"),"change:hasNextPage",this._onChangeMessagesHasNextPage),this.listenTo(this.messagesView,"pillClick",this._onPillClick),this.listenTo(this.messagesView,"messageRetryClick",this._onMessageRetryClick),this.listenTo(this.messagesView,"messageImageUnblur",this._onMessageImageUnblur),this.listenTo(this.composeView,"close",this._onTriggeredClose),this.listenTo(this.minimizedView,"click",this._onMinimizedViewClick),this.listenTo(this.previewView,"close",this._onPreviewViewClose),this.listenTo(this.previewView,"closing",this._onPreviewViewClosing),this.listenTo(this.previewView,"dismiss",this._onPreviewViewDismiss),this.listenTo(this.previewView,"edit",this._onPreviewViewEdit),this._setLoadingState(),this._setMainViewStates(),this._setOpenViewStates(),this._onChangeConversationCanSend(this.conversation,this.conversation.get("can_send")),this._onChangeCanSend(this,this.get("canSend")),this._onChangeConversationIsPossibleSpam(this.conversation,this.conversation.get("is_possible_spam")),this._onChangeIsPossibleSpam(this,this.get("isPossibleSpam")),this.get("isAutoFetch")&&this.fetch(),this.mainTheme=this._applyTheme(this.el),this.js$("conversation-open").toggleClass(this.get("noBlurSupportClass"),!h.cssFilters())},beforeRemove:function(){this.conversation.get("messages").reset(this.conversation.getInboxMessage()),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("close")},fetch:function(t){return t=t||{},n.extend(t,{error:n.bind(this._onFetchConversationFail,this)}),this.set("isFetching",!0),this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this._pendingQueueItems=this.conversation.getQueueItems(),this.conversation.clearQueue(),this.conversation.fetchConversation(t).then(n.bind(this._onFetchConversationSuccess,this)).always(n.bind(this._onFetchConversationAlways,this))},poll:function(t,e){return t=t||{},this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this.conversation.poll(t,e).then(n.bind(function(){this.messagesView.scrollToBottom()},this))},refresh:function(t){this._queueMessages(t.getQueueItems()),this.unminimize(),this.focus()},focus:function(){return this.isMinimized()?this.focusMinimized():this.focusCompose(),this},getImageUploadMaxBytes:function(){return this.get("imageUploadMaxBytes")},getPluginsArray:function(){var t=[];return t.push(new T({collection:this.collection})),n.isEmpty(this.imageUploadPlugin)||t.push(this.imageUploadPlugin),t.push(new P),t},isMinimized:function(){return this.get("isMinimized")},focusMinimized:function(){this.minimizedView&&this.minimizedView.focus()},focusCompose:function(){this.composeView&&this.composeView.focus()},toggleMinimize:function(t,e){var i,o,r,a=new s.Deferred,l=this.get("minimizeOpeningClass"),c=this.get("minimizeClosingClass"),u=this.js$("conversation-open"),h=this.js$("conversation-minimized"),d=[a];return t===this.isMinimized()?(new s.Deferred).resolve():(i=function(){this.set("isMinimized",t)},o=function(){a.resolve()},e?(i.call(this),o.call(this)):t?this._addAnimationClass(u,c).then(n.bind(function(){i.call(this),this._addAnimationClass(h,l).then(n.bind(o,this))},this)):this._addAnimationClass(h,c).then(n.bind(function(){i.call(this),this._addAnimationClass(u,l).then(n.bind(o,this))},this)),t||this.get("isFetched")||(r=this.fetch(),d.push(r)),s.when.apply(s,d))},minimize:function(t){return this.toggleMinimize(!0,t)},unminimize:function(t){return this.toggleMinimize(!1,t)},_showError:function(t){var e,i;return this.conversationErrorView&&this.conversationErrorView.remove(),i=this.js$("main"),e=new b(t),i.append(e.render().$el),this.conversationErrorView=e,this.set({isError:!0,isOffline:!0}),this._applyTheme(e.el),e},_hideError:function(){this.conversationErrorView&&(this.conversationErrorView.remove(),this.conversationErrorView=null),this.set({isError:!1,isOffline:!1}),this.focus()},_onFetchConversationSuccess:function(){this.rendered&&(this.set("isFetched",!0),this._hideError(),this.conversation.markAsRead(),this.otherParticipant.set(this.conversation.getOtherParticipant().toJSON()),this.messagesView.statusBannerView.trigger("setActiveTime",this.otherParticipant.get("seconds_since_last_activity")),this.minimizedView.trigger("setIsOnline",this.otherParticipant.get("seconds_since_last_activity")!==-1),this._queueMessages(this._pendingQueueItems),this._pendingQueueItems=null,this.conversation.get("messages").hasNextPage()||(this.set("isFetchingIcebreakers",!0),this._createIcebreakersView().always(n.bind(function(){this.set("isFetchingIcebreakers",!1),this.focus()},this))))},_flushMessageQueue:function(){var t;return this.conversation.hasQueue()?(t=this.conversation.getQueueItems(),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,t,this.conversation),this.conversation.isFlushingQueue()?this._flushDefer:(this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SENDING,t,this.conversation),this._flushDefer=this.conversation.flushMessageQueue().progress(n.bind(this._onFlushProgress,this)).fail(n.bind(this._onFlushFail,this)).always(n.bind(this._onFlushAlways,this)),this._flushDefer)):(new s.Deferred).reject()},_onFlushProgress:function(t,e){this.rendered&&this.set("isHidePendingPost",!e&&!this._canRenderPendingMessage(t)),e?this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENT,t,this.conversation):this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENDING,t,this.conversation)},_onFlushFail:function(t){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_FAILED,t,this.conversation),this.rendered&&(this._canRenderPendingMessage(t)||(this.conversation.get("messages").remove(t),this._showPostSendingError(t)),this._flushMessageQueue())},_onFlushAlways:function(){this.rendered&&(this.set("isHidePendingPost",!1),this.focus())},_onFetchConversationFail:function(t,e){var i,s=e.status,o=n.get(e,"responseJSON.errors.0.code");this.rendered&&(n.isFinite(o)&&o>0&&(i=this.customErrorMessages[s+"."+o]),n.isEmpty(i)&&(i=n.get(this.customErrorMessages,s,this.getGenericErrorMessage())),this._showError({message:i,buttonCallback:n.bind(this._onConversationErrorRetryClick,this),showButton:t.canRetryFetch(n.get(e,"status"))}))},_showPostSendingError:function(t){var e,i,s;this.rendered&&(t.canRetry()?(e=this.getRetryPostErrorMessage(),s=n.partial(this._onPostSendingErrorRetryClick,t)):(e=this.permanentPostErrorMessage,i=r("Close"),s=this._onPostSendingErrorCloseClick),this._showError({message:e,buttonCallback:n.bind(s,this),buttonText:i}))},_onPostSendingErrorCloseClick:function(){this._hideError()},_onPostSendingErrorRetryClick:function(t){this._resendMessage(t).then(n.bind(function(){this._hideError()},this))},_onFetchConversationAlways:function(){this.rendered&&this.set("isFetching",!1)},_onComposeSubmit:function(t,e){var i,s,o=this.previewView.getMessage(),r=!n.isEmpty(t),a=!n.isEmpty(o);r&&(i=w.createTextMessage(t,{hasAnimation:!0,creationUserAction:e})),a&&(o.set({isFromPreview:!0,hasAnimation:!0,creationUserAction:e}),r&&i.set({context:o.get("context")})),s=n.compact([o,i]),a?this.previewView.close().then(n.bind(function(){n.delay(n.bind(function(){this.rendered&&this._queueMessages(s)},this),150)},this)):this._queueMessages(s),this.messagesView.scrollToBottom()},_canRenderPendingMessage:function(t){return!n.isEmpty(t)&&(!t.isPost()||t.getPost().hasThumbnail())},_queueMessages:function(t,e){return n.isEmpty(t)?(new s.Deferred).reject():(e=n.extend({},e,{isSendingMessage:!0}),n.isArray(t)||(t=[t]),n.each(t,n.bind(function(t){t.set("isQueued",!0),this.conversation.addMessage(t,e)},this)),this.conversation.appendToQueue(t,e),this._flushMessageQueue())},_resendMessage:function(t){var e=this.conversation.get("messages");return e.last()!==t&&e.remove(t),this._queueMessages(t)},_onComposeResize:function(){this.messagesView.updateScrollBar()},_onComposeInput:function(t,e){this.trigger("compose:input",t,e),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_INPUT,this.conversation,t)},_onComposeFocus:function(t){this.trigger("compose:focus",t)},_onComposeBlur:function(t){this.trigger("compose:blur",t)},_onComposePasteBlob:function(t){this._isFileDropEnabled()&&this._addImageToFilePreview(t,"clipboard")},_onChangeId:function(t){t.isNew()||this.trigger("created",t)},_onChangeUnreadCount:function(t,e){0===e||this.isMinimized()||(this.messagesView.isAtBottom()?this._fetchUnreadMessages().then(n.bind(function(){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED)},this)):this.messagesView.showPill(e).then(n.bind(this._fetchUnreadMessages,this)).catch(n.noop))},_fetchUnreadMessages:function(){var t=this.conversation.get("unreadCount"),e=Math.min(10,t+5);return 0===t?(new s.Deferred).reject():(this.conversation.markAsRead(),this.poll(null,e))},_getSortedParticipantsCopy:function(){var t=this.conversation.get("participants"),e=this.channels.getSortedIds(this.conversation.get("participantUuid")),i=t.getSortedByChannels(e,!0);return new t.constructor(i)},_setLoadingState:function(){var t=this.get("isFetching")||this.get("isHidePendingPost")||this.get("isFetchingIcebreakers");this.set("isLoading",!this.get("isError")&&t)},_setMainViewStates:function(){var t=this.get("isMinimized"),e=this.js$("conversation-open"),i=this.js$("conversation-minimized");e.toggle(!t),i.toggle(t),t?i.css("display",""):e.css("display","")},_setOpenViewStates:function(){var t=this.get("isError"),e=this.get("isLoading");this.messagesView.toggle(!t&&!e),this.composeView.set("isDisabled",t||e),this.conversationLoaderView.set("loading",e)},_setDragDropClasses:function(){var t=this.get("droppingClassName"),e=this.get("isCurrentDropValid"),i=this.get("isDropping"),n=this._isFileDropEnabled(),s=n&&i&&e;this.js$("conversation-open").toggleClass(t,s),this.js$("conversation-minimized").toggleClass(t,s)},_createIcebreakersView:function(){var t;return this.icebreakersView?(t=new s.Deferred,t.reject(),t):this.otherParticipant.fetchAdditionalInfo(this.conversation.getParticipantId()).then(n.bind(function(){var t;this.rendered&&(t=this.conversation.isNew(),this.icebreakersView=new C({participant:this.otherParticipant,isShowTags:t,isShowRelationship:!t,isShowDescription:!t}),this.messagesView.addHeaderView(this.icebreakersView))},this))},_onTriggeredClose:function(){this.trigger("close")},_onHeaderMoreActions:function(t){this.actionsPopover&&this.actionsPopover.isOrWasRecentlyRendered()||this._showMoreActionsPopover(t)},_onHeaderMinimizeClick:function(){this.minimize()},_onMinimizedViewClick:function(){this.unminimize()},_onPillClick:function(){this.focus()},_onBlogClick:function(t){var e=s(t.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,{blogName:e.attr("data-js-tumblelog-name"),postId:e.attr("data-js-post-id"),searchTagTerm:e.attr("data-js-tumblelog-tag"),url:e.attr("href"),originalEvent:t,otherParticipant:this.otherParticipant})},_onMessagingBlogClick:function(t){var e=s(t.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,{blogName:e.attr("data-js-messaging-tumblelog-name"),url:e.attr("href"),originalEvent:t})},_onImageLightboxUrlClick:function(t){t.preventDefault();var e,i=s(t.currentTarget),o=i.attr("data-js-lightbox-width"),r=i.attr("data-js-lightbox-height"),a=i.attr("data-js-lightbox-lowres-url"),l=i.attr("data-js-lightbox-url");n.isEmpty(a)||n.isEmpty(l)||(e={width:o,height:r,low_res:a,high_res:l},n.get(e,"low_res")&&(this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,{lightBoxImageData:[e]}),this.composeView.set("isLightboxOpen",!0)))},_onActionsBlock:function(t){var e=this.conversation.getParticipantModel();n.isEmpty(e)||this.eventBus.trigger(this.eventBus.BLOCK,{currentTumblelog:e.get("name"),blockedTumblelog:t,context:"messaging"},this.conversation)},_onActionsDelete:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_DELETE_MODEL,this.conversation)},_applyTheme:function(t){var e;return n.isEmpty(this.otherParticipant)?null:(e=this.otherParticipant.get("theme"),n.isEmpty(e)?null:new y({el:t,theme:e}).render())},_showMoreActionsPopover:function(t){var e;this.actionsPopover&&this.actionsPopover.remove(),this.actionsPopover=new k({autoTeardown:!0,pinnedSide:"bottom",pinnedTarget:t,popoverContainer:this.popoverContainer,viewOptions:{participants:this.conversation.get("participants"),user:this.user}}),e=this.actionsPopover.getView(),this.listenTo(e,"block",this._onActionsBlock),this.listenTo(e,"delete",this._onActionsDelete),this.actionsPopover.render()},_animateInMessage:function(t,e,i){var s,r,a=t.$el,l=this.composeView.$el.offset(),c=a.offset(),u=Math.max(0,l.top-c.top)+a.height();i.get("isFromPreview")?s=0:(r=e.offset(),s=l.left-r.left),this.messagesView.setIsAnimating(!0),o.animate(a,{translateY:[0,u],translateX:[0,s],opacity:[1,1]},{duration:this.get("animateInMessageDuration"),easing:this.easeOutExpo,complete:n.bind(function(){this.messagesView.setIsAnimating(!1),i.set("hasAnimation",!1),a.css("transform","")},this)})},_addAnimationClass:function(t,e){var i=new s.Deferred;return t.removeClass(e),u(t,function(){t.removeClass(e),i.resolve()}),t.addClass(e),i},_addImageToFilePreview:function(t,e){var i=function(){this.imageUploadPlugin.addImageFile(t,e)};this.isMinimized()?this.unminimize().then(n.bind(i,this)):i.call(this)},_isFileDropEnabled:function(){return this.rendered&&!this.previewView.hasImage()&&this.get("canSend")&&!this.get("isError")},_onConversationErrorRetryClick:function(t){return this.fetch()},_onChangeIsOffline:function(t,e){this.composeView.set("isOffline",e)},_onMessageRetryClick:function(t){this._resendMessage(t)},_onMessageImageUnblur:function(t){this.conversation.unblurImages()},_onChangeConversationCanSend:function(t,e){this.set("canSend",e)},_onChangeConversationIsPossibleSpam:function(t,e){this.set("isPossibleSpam",e)},_onChangeCanSend:function(t,e){var i=r("This Tumblr can't receive messages.");this.composeView.toggle(e),!e&&this.canSendErrorView||e&&!this.canSendErrorView||(e?(this.messagesView.removeFooterView(this.canSendErrorView),delete this.canSendErrorView):(this.canSendErrorView=new g({message:i,showErrorIcon:!0}),this.messagesView.addFooterView(this.canSendErrorView)))},_onChangeIsPossibleSpam:function(t,e){e&&this.isPossibleSpamView||!e&&!this.isPossibleSpamView||(e?(this.isPossibleSpamView=new g({message:this.getSpamErrorMessage(),actionText:r("Mark as spam"),actionCallback:n.bind(this._onMarkAsSpamLinkClick,this)}),this.messagesView.addFooterView(this.isPossibleSpamView)):(this.messagesView.removeFooterView(this.isPossibleSpamView),delete this.isPossibleSpamView))},_onChangeIsMinimized:function(t,e){this._setMainViewStates(),e||n.defer(n.bind(function(){this.messagesView.updateScrollBar(),this.focus(),this.conversation.get("unreadCount")>0&&(this._fetchUnreadMessages(),this.messagesView.scrollToBottom())},this)),this.trigger(e?"minimized":"unminimized")},_onChangeIsDropping:function(t,e){this._setDragDropClasses()},_onChangeIsCurrentDropValid:function(t,e){this._setDragDropClasses()},_onMainContainerClick:function(){window.getSelection().isCollapsed&&this.focus()},_onKeyDown:function(t){var e=t.keyCode;9===e&&(t.shiftKey?this.trigger("keydown:shift+tab",t):this.trigger("keydown:tab",t))},_onDragOver:function(t){var e=n.get(t,"originalEvent.dataTransfer.types",[]),i=n.contains(e,"Files"),s=this._isFileDropEnabled();t.preventDefault(),this.set("isCurrentDropValid",i),n.set(t,"originalEvent.dataTransfer.dropEffect",i&&s?"copy":"none")},_onDragEnter:function(){this.dragCount++,this.set("isDropping",!0)},_onDragLeave:function(){this.dragCount--,this.set("isDropping",this.dragCount>0)},_onDragDrop:function(t){var e=n.get(t,"originalEvent.dataTransfer.files",[]);if(t.preventDefault(),this.dragCount=0,this.set("isDropping",!1),0!==e.length)return this.previewView.hasImage()?void(this.isMinimized()&&this.unminimize()):void(this._isFileDropEnabled()&&this._addImageToFilePreview(n.last(e),"drop"))},_onComposeViewPluginPreviewAddImage:function(t){this.previewView.addImage(t),this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!1),this.focus(),this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this.conversation,t)},_onComposeViewPluginClick:function(t){this.eventBus.trigger(this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this.conversation,t)},_onPreviewViewClosing:function(t){this.focus()},_onPreviewViewClose:function(t){this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!0),this.focus()},_onPreviewViewDismiss:function(t){this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this.conversation,t)},_onPreviewViewEdit:function(t){this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_EDIT,this.conversation,t)},_onMarkAsSpamLinkClick:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_MARK_AS_SPAM,this.conversation,this.otherParticipant)},_onChangeMessagesHasNextPage:function(t,e){!this.rendered||this.conversation.isNew()||e||this._createIcebreakersView()},_onTumblrLightboxFormHide:function(){this.composeView.set("isLightboxOpen",!1)}});t.exports=I},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(763),a=s.extend({className:"conversation-header",template:r,mixins:[o],defaults:{separator:"+"},attributes:{"data-js-theme-background-color-or-image-class":!0,"data-js-theme-accent-color-on-background":!0},events:{"click [data-js-close]":"_onClickCloseButton","click [data-js-more-actions]":"_onClickMoreActions","click [data-js-minimize]":"_onClickMinimizeButton"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants","user","channels"))},getTemplateData:function(){var t;return t=this.channels.length>1?this.participants.toJSON():n.invoke(this.participants.getWithout(this.channels.pluck("uuid")),"toJSON"),t=n.filter(t,function(t){return!n.isEmpty(n.get(t,"name"))}),{participants:t,separator:this.get("separator")}},_onClickCloseButton:function(t){this.trigger("closeClick"),t.preventDefault()},_onClickMoreActions:function(t){var e=t.currentTarget;this.trigger("moreActionsClick",e),t.preventDefault()},_onClickMinimizeButton:function(t){this.trigger("minimizeClick"),t.preventDefault()}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="conversation-header-image" data-js-theme-header-image></div><div class="conversation-header-main"><div data-js-title class="title"> ';var lastIndex=participants.length-2;__p+=" ",_.each(participants,function(t,e){__p+=' <a href="'+__e(t.url)+'" target="_blank" data-js-tumblelog-name="'+__e(t.name)+'">'+__e(t.name)+"</a> "+__e(e===lastIndex?" "+separator+" ":e<lastIndex?", ":"")+" "}),__p+=' </div><div class="controls" data-js-theme-accent-color-on-background><a href="#" data-js-more-actions class="more-actions">'+__e(__("Actions"))+'</a><a href="#" data-js-minimize class="minimize">'+__e(__("Minimize"))+'</a><a href="#" data-js-close class="close">'+__e(__("Close"))+"</a></div></div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(9),o=i(192),r=i(226),a=i(734),l=i(277),c=i(331),u=i(740),h=i(765),d=i(784),p=i(786),_=i(787),g=r.extend({className:"conversation-messages",template:p,mixins:[l,a],defaults:{isVisible:!0,isPaginating:!1,tsHeaderThreshold:36e5,collapseMessagesThreshold:6e4,pillClickScrollSpeed:500,pillBottomThreshold:80},subviews:{paginationLoaderView:{constructor:c,options:{variation:"small h-centered",loading:!1}},messagesView:{constructor:h,options:function(t){return{eventBus:t.eventBus,participants:t.participants,conversation:t.conversation,formatter:t.messageFormatter,animateInMessage:t.animateInMessage,isSafeModeEnabled:t.isSafeModeEnabled,afterRetryClick:n.bind(t.afterRetryClick,t),afterImageUnblur:n.bind(t.afterImageUnblur,t),canModifySafeMode:t.canModifySafeMode}},collection:function(t){return t.collection}},statusBannerView:{constructor:_,options:function(t){return{otherParticipant:t.otherParticipant,name:t.otherParticipant.get("name")}}},pillView:{constructor:d,options:function(t){return{eventBus:t.eventBus}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","collection","participants","conversation","messageFormatter","animateInMessage","isSafeModeEnabled","otherParticipant","canModifySafeMode"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el,bottomThreshold:this.get("pillBottomThreshold")}),this.listenTo(this.collection,"update reset",this._onCollectionUpdate),this.listenTo(this.collection,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this.collection,"change:isError",this._onChangeMessageIsError),this.listenTo(this.scrollBar,"scrolltop",this._onScrollChangeIsAtTop),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollChangeIsAtBottom),this.listenTo(this.scrollBar,"scrollstop",this._createPositionSnapshot),this.listenTo(this.pillView,"click",this._onPillViewClick),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this._onChangeHasNextPage(this.collection,this.collection.hasNextPage()),n.defer(n.bind(function(){this._processMessages(),this.updateScrollBar(),this.scrollToBottom()},this))},beforeRemove:function(){this.scrollBar&&this.scrollBar.destroy()},scrollToBottom:function(t){this._setScrollTop(this.el.scrollHeight,t)},getNextPage:function(){this.collection.hasNextPage()&&(this.set("isPaginating",!0),this.collection.fetchNextPage({at:0,isPaginating:!0,scrollBottom:this._getCurrentScrollBottom()}).always(n.bind(function(){this.set("isPaginating",!1)},this)))},updateScrollBar:function(){var t,e=this.scrollBar.isDisabled();this.scrollBar.setDisabled(!0),this.scrollBar&&this.scrollBar.update(),t=this._getPositionDiff(),t&&this._setScrollTop(this.$el.scrollTop()+t.height+t.scrollTop),this._createPositionSnapshot(),this.scrollBar.setDisabled(e)},afterRetryClick:function(t){this.trigger("messageRetryClick",t)},afterImageUnblur:function(t){this.trigger("messageImageUnblur",t)},toggle:function(t){this.set("isVisible",t)},isAtBottom:function(){return!this._lastPosition||!this.scrollBar||this._lastPosition.scrollBottom<this.get("pillBottomThreshold")},showPill:function(t){return this._pillDefer&&this._pillDefer.reject(),this._pillDefer=o.defer(),this.pillView.setCount(t),this._pillDefer.promise},addHeaderView:function(t){var e=this._getCurrentScrollBottom();return this.js$("header").append(t.render().$el),this._adjustScrollbarAfterNewElements(e),t},removeHeaderView:function(t){return t.remove()},addFooterView:function(t){return this.js$("footer").append(t.render().$el),
t},removeFooterView:function(t){return t.remove()},setIsAnimating:function(t){this.$el.toggleClass("is-animating",t)},_onChangeIsVisible:function(t,e){this.$el.css("visibility",e?"":"hidden"),e&&(this.updateScrollBar(),this.scrollToBottom())},_setScrollTop:function(t,e){e?this.$el.animate({scrollTop:t},e):this.$el.scrollTop(t),this._createPositionSnapshot()},_getCurrentScrollBottom:function(){return this.el.scrollHeight-this.$el.scrollTop()},_onCollectionUpdate:function(t,e){this._processMessages(e),n.get(e,"isPaginating")&&this._adjustScrollbarAfterNewElements(n.get(e,"scrollBottom")),n.defer(n.bind(function(){this.rendered&&this._adjustScrollbarAfterFetch(e)},this))},_adjustScrollbarAfterFetch:function(t){this.scrollBar&&this.scrollBar.update(),n.get(t,"isPolling")||n.get(t,"isPaginating")||this.scrollToBottom(),this._createPositionSnapshot()},_adjustScrollbarAfterNewElements:function(t){n.isNumber(t)&&(this.scrollBar.setDisabled(!0),this._setScrollTop(this.el.scrollHeight-t),n.delay(n.bind(function(){this.scrollBar.setDisabled(!1)},this),500))},_onChangeIsPaginating:function(t,e){this.paginationLoaderView.set("loading",e)},_onChangeHasNextPage:function(t,e){this.js$("loader-container").toggle(e)},_processMessages:function(t){var e,i=this.get("tsHeaderThreshold"),s=this.get("collapseMessagesThreshold"),o=(new Date).getTime();n.get(t,"isPolling")&&(o="new"),this.collection.each(function(t){t.set({tsHeader:this._getTimestampHeader(t,e,i),isCollapsed:this._getIsCollapsed(t,e,s,o)}),e=t},this)},_getTimestampHeader:function(t,e,i){var n=t?t.getTimestamp():null,o=e?e.getTimestamp():null,r=!o||n-o>i;return r?s(n).calendar():null},_getIsCollapsed:function(t,e,i,n){return t.has("collapseGroup")||t.set("collapseGroup",t.isNew()?"new":n),!!e&&(t.get("collapseGroup")===e.get("collapseGroup")&&(t.get("participant")===e.get("participant")&&t.getTimestamp()-e.getTimestamp()<i))},_getScrollPosition:function(){return this.scrollBar.getCurrentPositions()},_createPositionSnapshot:function(){this._lastPosition=this._getScrollPosition()},_getPositionDiff:function(){if(this._lastPosition){var t=this._getScrollPosition();return{scrollTop:this._lastPosition.scrollTop-t.scrollTop,scrollBottom:this._lastPosition.scrollBottom-t.scrollBottom,height:this._lastPosition.height-t.height}}},_onScrollChangeIsAtTop:function(t){t&&this.getNextPage()},_onScrollChangeIsAtBottom:function(t){t&&this._pillDefer&&(this._pillDefer.resolve(this.pillView.getCount()),this.pillView.setCount(0))},_onPillViewClick:function(){this.pillView.setCount(0),this.scrollToBottom(this.get("pillClickScrollSpeed")),this._pillDefer&&this._pillDefer.resolve()},_onChangeMessageIsError:function(){this.scrollToBottom()}});t.exports=g},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(714),l=i(766),c=i(767),u=i(773),h=i(775),d=i(778),p=i(780),_=i(782),g=o.extend({className:"conversation-message",template:l,mixins:[r],defaults:{pendingClassName:"is-pending"},events:{"click [data-js-retry-button]":"_onRetryClick"},messagesTypes:{},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants","conversation","afterRetryClick","formatter","animateInMessage","afterImageUnblur","isSafeModeEnabled","canModifySafeMode")),this.addMessageType(a.STICKER,_,function(t){return{conversation:t.conversation}}),this.isSafeModeEnabled&&"true"===this.model.get("post").get("is_nsfw")?this.addMessageType(a.POST,h,function(t){return{conversation:t.conversation,canModifySafeMode:t.canModifySafeMode}}):this.addMessageType(a.POST,u),this.addMessageType(a.IMAGE,d,function(t){return{conversation:t.conversation,afterImageUnblur:n.bind(t.afterImageUnblur,t)}}),this.addMessageType(a.TEXT,c,function(t){return{formatter:t.formatter}})},afterRenderSubviews:function(){var t=this.createMessageView(this.model.get("type"));return t?(this.js$("message-container").html(t.render().$el),this.model.get("hasAnimation")&&n.isFunction(this.animateInMessage)&&this.animateInMessage(this,this.js$("message-bubble"),this.model),this.listenTo(this.model,"change:isPending",this._onChangeIsPending),this.listenTo(this.model,"change:isError",this._onChangeIsError),this.listenTo(this.model,"change:isCollapsed",this._onChangeIsCollapsed),this.listenTo(this.model,"change:isQueued",this._onChangeIsQueued),this.listenTo(this.model,"change:tsHeader",this._onChangeTsHeader),this.listenTo(this.model,"change:isPending change:isError change:canRetry change:id",this.setRetryButtonState),this._onChangeIsPending(this.model,this.model.get("isPending")),this._onChangeIsError(this.model,this.model.get("isError")),this._onChangeTsHeader(this.model,this.model.get("tsHeader")),this._onChangeIsCollapsed(this.model,this.model.get("isCollapsed")),this._onChangeIsQueued(this.model,this.model.get("isQueued")),void this.setRetryButtonState()):void this.remove()},addMessageType:function(t,e,i){this.messagesTypes[t]={constructor:e,options:i}},getMessageType:function(t){return n.get(this.messagesTypes,t)},createMessageView:function(t){var e,i=this.getMessageType(t);return n.isEmpty(i)||!n.has(i,"constructor")?null:(e=n.get(i,"options",{}),n.isFunction(e)&&(e=e.call(this,this)),n.extend(e,{model:this.model,participants:this.participants,eventBus:this.eventBus,setRetryButtonState:n.bind(this.setRetryButtonState,this)}),new i.constructor(e))},setRetryButtonState:function(){var t,e,i,n,o,r,a,l;this.rendered&&(t=this.js$("retry-button",!0),0!==t.length&&(o=this.model.isNew(),e=this.model.get("isPending"),i=this.model.get("canRetry"),n=this.model.get("isError"),r=s(i?"Retry":"Could not send"),a=e?s("Trying..."):r,l=n&&o,t.toggle(l),l&&(t.text(a).prop("disabled",e||!i),t.toggleClass(this.get("pendingClassName"),e))))},_onChangeTsHeader:function(t,e){this.timestampView&&this.timestampView.remove(),n.isEmpty(e)||(this.timestampView=new p({model:this.model}),this.$el.prepend(this.timestampView.render().$el))},_onChangeIsCollapsed:function(t,e){this.$el.toggleClass("collapsed",e)},_onChangeIsPending:function(t,e){this.$el.toggleClass("pending",e)},_onChangeIsError:function(t,e){this.$el.toggleClass("error",e)},_onChangeIsQueued:function(t,e){this.$el.toggleClass("queued",e)},_onRetryClick:function(t){t.preventDefault(),this.model.get("canRetry")&&(this.trigger("retryClick",this.model),n.isFunction(this.afterRetryClick)&&this.afterRetryClick(this.model))}});t.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<div data-js-message-container></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(768).html,a=i(8),l=i(262),c=i(772),u=s.extend({className:"conversation-message-text message-container",mixins:[o],template:c,defaults:{fullWidthBubblePercentThreshold:60,fullWidthBubbleClass:"full-width-bubble"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants")),this.formatter=t.formatter||new r},afterRenderSubviews:function(){this.listenTo(this.model.get("content"),"change",this.render),this.$el.width()?this._setBubbleStyles():n.defer(n.bind(this._setBubbleStyles,this));var t=this.$el.find(".pixelated-avatar");n.each(t,n.bind(function(t){a(t).removeClass("hide").addClass("show"),l.drawPixelatedImages(this)},this))},getTemplateData:function(){var t=this.participants.get(this.model.get("participant")),e=this.model.toJSON(),i=this.formatter.render(n.get(e,"content.text"),n.get(e,"content.formatting"));return{message:i,canPixelateAvatar:t?t.get("can_pixelate_avatar"):null,avatarUrl:t?t.getAvatarUrl():null,name:t?t.get("name"):null,url:t?t.get("url"):null}},_setBubbleStyles:function(){var t=this.get("fullWidthBubblePercentThreshold"),e=this.js$("message-bubble"),i=this.$el.width(),n=e.width();n>t/100*i&&e.addClass(this.get("fullWidthBubbleClass"))}});t.exports=u},function(t,e,i){"use strict";t.exports={html:i(769)}},function(t,e,i){"use strict";var n=i(3),s=i(770),o=i(771),r=s.extend({name:"html",formatters:{link:o},escape:function(t){return n.escape(t)},applyFormatting:function(t,e){var i=n.bind(this.escape,this),s=n.bind(this.getFormatter,this),o={};n.forEach(e,function(t){var e=s(t.type);if(e){var i=t.position,r=t.attributes,a=i[0],l=i[1];n.isEmpty(o[a])&&(o[a]=[]),n.isEmpty(o[l])&&(o[l]=[]),o[a].push(n.bind(e.open,this,r)),o[l].unshift(n.bind(e.close,this,r))}},this);var r,a,l=n.sortBy(n.keys(o),function(t){return n.parseInt(t)}),c="",u=0;return n.forEach(l,function(e){r=o[e],a=t.substr(u,e-u),c+=i(a),n.forEach(r,function(t){c+=t()}),u=e},this),a=t.substr(u),c+=i(a)}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(215),o=s.extend({name:"unknown",formatters:{},constructor:function(t){this.options=t||{},n.isFunction(this.formatters)?this.formatters=this.formatters():this.formatters=n.clone(this.formatters||{})},registerFormatter:function(t,e){this.formatters[t]=e},getFormatter:function(t){return n.result(this.formatters,t)},escape:function(t){return t},applyFormatting:function(t,e){return this.escape(t)},postFilter:function(t){return t},render:function(t,e){return this.postFilter(this.applyFormatting(t,e))}});t.exports=o},function(t,e,i){"use strict";function n(t){return s(t).omit(s.isUndefined).reduce(function(t,e,i){return(t?t+" ":"")+o('%s="%s"',s.escape(i),s.escape(e))},"")}var s=i(3),o=i(6).sprintf,r={open:function(t){var e=n({"data-js-tumblelog-name":t.blog_name,"data-js-post-id":t.post_id,"data-js-messaging-tumblelog-name":t.messaging_blog_name,target:"_blank",href:t.url});return"<a "+e+">"},close:function(t){return"</a>"}};t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"> ',__p+=canPixelateAvatar?' <canvas class="pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" alt="'+__e(name)+'"></canvas> ':' <img src="'+__e(avatarUrl)+'"> ',__p+=' </a><div class="message-bubble" data-js-message-bubble><div class="message-bubble-header"><a href="'+__e(url)+'" class="name" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+'</a><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+'</button></div><div class="message">'+(null==(__t=message)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(737),a=i(774),l=s.extend({className:"conversation-message-post",mixins:[o],template:a,defaults:{thumbnailWidth:210},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants","model","setRetryButtonState"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError change:isPending",this._onModelChange),this.listenTo(this.model.get("post"),"change:summary change:state",this._onModelChange),this._startTruncateSummary()},getThumbnailAtWidth:function(t){var e,i=this.model.get("post"),s=i.getThumbnail(t);return n.isEmpty(s)?null:(e=i.getScaledDimensionsForWidth(s,t),n.extend({},s,e))},getTemplateData:function(){var t=this.model.get("post"),e=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:t.getType(),isDisabled:t.isDisabled(),isError:this.model.get("isError"),isPending:this.model.get("isPending"),actionString:e?t.getActionMarkup(e.get("name")):null,message:t.getMessage(),thumbnail:i,avatarUrl:e?e.getAvatarUrl():null,name:e?e.get("name"):null,blogUrl:e?e.get("url"):null,url:t.get("post_url"),postBlogName:t.get("blog_name"),postId:t.get("id")}},_startTruncateSummary:function(){n.defer(n.bind(this._truncateSummary,this))},_truncateSummary:function(){r(this.js$("summary",!0))},_onModelChange:function(){this.renderWithTemplate(),this._startTruncateSummary(),n.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+"</span> ",_.isEmpty(message)||(__p+=' <span class="text">'+__e(message)+"</span> "),__p+=" </div> ",_.isEmpty(url)||(__p+=" </a> "),__p+=' <button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> ",_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'" class="icon"></a> '),__p+=" "),__p+=" </div> ",_.isEmpty(thumbnail)||(__p+=' <div class="thumbnail"> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <img class="full-width" src="'+__e(_.get(thumbnail,"url"))+'" width="'+__e(_.get(thumbnail,"width"))+'" height="'+__e(_.get(thumbnail,"height"))+'"> ',_.isEmpty(url)||(__p+=" </a> "),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(773),o=i(776),r=i(777),a=i(136),l=i(8),c=s.extend({className:"conversation-message-safemode-post",template:r,events:{"click .link-safemode-settings":"_onlinkClick"},initialize:function(t){n.extend(this,n.pick(t,"conversation","canModifySafeMode")),s.prototype.initialize.apply(this,arguments)},getTemplateData:function(){var t=this.model.get("post"),e=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:t.getType(),isDisabled:t.isDisabled(),actionString:e?t.getActionMarkup(e.get("name")):null,thumbnail:i,avatarUrl:e?e.getAvatarUrl():null,name:e?e.get("name"):null,blogUrl:e?e.get("url"):null,canModifySafeMode:this.canModifySafeMode?this.canModifySafeMode:null}},afterRenderSubviews:function(){this.theme=new o({el:this.el,theme:this.conversation.getOtherParticipant().get("theme")}).render()},_onlinkClick:function(t){t.preventDefault();var e={source:"messaging_post"};a.trigger("Kraken:safeMode:FilteringSettingLinkClicked",{loggingData:e}),window.open(l(t.currentTarget).attr("href"))}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(277),r=i(230),a=i(180),l=s.extend({mixins:[o,r],defaults:{removeDataAttrAfterApplyingTheme:!0},configuration:{"theme-background-color":{themeField:"background_color",applyStyle:"background-color"},"theme-accent-color":{themeField:"link_color",applyStyle:"color"},"theme-accent-color-on-white":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(t,e,i){t.css("color",i.adjustColorForBackground(e,"#ffffff"))}},"theme-accent-color-on-grey":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(t,e,i){t.css("color",i.adjustColorForBackground(e,"#f2f2f2"))}},"theme-accent-color-on-background":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(t,e,i){t.css("color",i.getReadableColor(e,i.get("background_color")))}},"theme-accent-color-as-background":{themeField:"link_color",unsetMissingStyle:"background-color",applyStyle:function(t,e,i){t.css("background-color",i.adjustColorForBackground(e,"#ffffff"))}},"theme-button":{themeField:function(t){var e=t.get("background_color"),i=t.get("link_color");return n.isEmpty(e)||n.isEmpty(i)?null:{text:e,background:t.getReadableColor(i,e)}},applyStyle:function(t,e,i){t.addClass("themed"),i.getHeaderImage()||t.css({"background-color":e.background,"border-color":e.background,color:e.text})}},"theme-header-image":{themeField:function(t){return t.getHeaderImage()},applyStyle:function(t,e){t.css("background-image","url("+e+")")}},"theme-background-tint":{themeField:function(t){return t.getTintSuffix(t.getBackgroundTint())},applyStyle:function(t,e,i){t.addClass("theme-background"+e)}},"theme-background-color-or-image-class":{themeField:"background_color",applyStyle:function(t,e,i){n.isEmpty(i.getHeaderImage())?t.css("background-color",e):t.addClass("has-image")}},"theme-avatar-shape-class":{themeField:"avatar_shape",applyStyle:function(t,e){t.addClass("avatar-shape--"+e)}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"theme"))},render:function(){this.theme&&!a.bool("aim_messenger")&&n.each(this.configuration,function(t,e){var i,s,o=t.unsetMissingStyle,r=t.applyStyle;if(i=n.isFunction(t.themeField)?t.themeField.call(this,this.theme):this.theme.get(t.themeField),s=this.js$(e),0!==s.length){if(n.isEmpty(i))return void(n.isFunction(o)?o.call(this,s,i,this.theme):n.isEmpty(o)?n.isFunction(r)||s.css(r,""):s.css(o,""));n.isFunction(r)?r.call(this,s,i,this.theme):s.css(r,i),this.get("removeDataAttrAfterApplyingTheme")&&s.removeAttr("data-js-"+e)}},this)},setTheme:function(t){return this.theme=t,this.render()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+'</span></div><div class="post-content-inner"><p><span class="message">'+__e(__("This post may contain sensitive media."))+"</span><br> ",__p+=canModifySafeMode?" "+(null==(__t=__("%1$sSafe Mode is on%2$s",'<a class="link link-safemode-settings" href="/settings/account#safe_mode" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ":" "+(null==(__t=__("%1$sWhy am I seeing this?%2$s",'<a class="link link-safemode-settings" href="/docs/nsfw" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ",__p+=' </p></div><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(262),l=i(331),c=i(779),u=o.extend({className:"conversation-message-image",mixins:[r],template:c,defaults:{thumbnailWidth:195,isBlurred:!1,blurClassName:"is-blur",unblurringClassName:"is-unblurring",errorClassName:"is-error",pendingClassName:"is-pending",blurAnimationDurationMs:300,blurMessageString:null},events:{"click [data-js-overlay-container]":"_onOverlayContainerClick"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants","conversation","model","setRetryButtonState","afterImageUnblur")),this.set("blurMessageString",s("Blurred because you don't follow this Tumblr yet. Click to reveal.")),this.image=this.model.getImage()},afterRenderSubviews:function(){this.listenTo(this,"change:isBlurred",this._onChangeIsBlurred),this.listenTo(this.model,"change:isPending",this._onModelIsPendingChange),this.listenTo(this.model,"change:isError",this._onModelIsErrorChange),this.listenTo(this.conversation,"change:is_blurred_images",this._onChangeConversationIsBlurredImages),this.listenTo(this.image.getAltSizes(),"update reset",this._onModelImagesUpdate),this._onChangeConversationIsBlurredImages(this.conversation,this.conversation.get("is_blurred_images")),this._onChangeIsBlurred(this,this.get("isBlurred"))},getTemplateData:function(){var t=this.image.getImageAtSize(this.get("thumbnailWidth")),e=this.getThumbnailDimensions(t),i=n.get(e,"width"),s=n.get(e,"height"),o=this.participants.get(this.model.get("participant"));return this.thumbnailUrl=this.thumbnailUrl||t.get("url"),{name:o?o.get("name"):null,avatarUrl:o?o.getAvatarUrl():null,blogUrl:o?o.get("url"):null,highResUrl:this.image.hasAltSizes()?this.image.getHighResImageUrl():null,lowResUrl:this.thumbnailUrl,thumbnailImageUrl:this.thumbnailUrl,originalWidth:this.image.getOriginalSize().get("width"),originalHeight:this.image.getOriginalSize().get("height"),thumbnailWidth:i,thumbnailHeight:s}},getThumbnailDimensions:function(t){var e=this.get("thumbnailWidth"),i=a.heightForWidth(e,t.get("width"),t.get("height"));return n.extend({},{width:e,height:i})},_onModelIsPendingChange:function(t,e){e?(this.imageLoaderView=new l({variation:"small centered",loading:e}),this.js$("image-loader-container").append(this.imageLoaderView.render().$el)):this._removeImageLoader(),this.$el.toggleClass(this.get("pendingClassName"),e)},_onModelIsErrorChange:function(t,e){this.$el.toggleClass(this.get("errorClassName"),e)},_removeImageLoader:function(){this.imageLoaderView&&this.imageLoaderView.remove()},_onModelImagesUpdate:function(){this.renderWithTemplate(),this._toggleBlurred(this.get("isBlurred")),n.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()},_toggleBlurred:function(t){var e=this.get("unblurringClassName"),i=this.js$("overlay-text",!0),s=!t&&this.previous("isBlurred"),o=this.get("blurClassName");this.$el.toggleClass(o,t).toggleClass(e,s),t?i.text(this.get("blurMessageString")):s||i.empty(),this._unblurTimer&&clearTimeout(this._unblurTimer),s&&(this._unblurTimer=n.delay(n.bind(function(){this.rendered&&(i.empty(),this.$el.removeClass(e),delete this._unblurTimer)},this),this.get("blurAnimationDurationMs")))},_onChangeIsBlurred:function(t,e){this._toggleBlurred(e)},_onChangeConversationIsBlurredImages:function(t,e){this.set("isBlurred",e&&t.shouldBlurImageMessage(this.model))},_onOverlayContainerClick:function(t){this.get("isBlurred")&&(t.preventDefault(),t.stopImmediatePropagation(),this.set("isBlurred",!1),n.isFunction(this.afterImageUnblur)&&this.afterImageUnblur(this.model))}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=' <a href="'+__e(highResUrl)+'" data-js-lightbox-url="'+__e(highResUrl)+'" data-js-lightbox-width="'+__e(originalWidth)+'" data-js-lightbox-height="'+__e(originalHeight)+'" data-js-lightbox-lowres-url="'+__e(lowResUrl)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><div class="conversation-image-loader" data-js-image-loader-container></div><img class="full-width" data-js-message-image src="'+__e(thumbnailImageUrl)+'" width="'+__e(thumbnailWidth)+'" height="'+__e(thumbnailHeight)+'"><div class="overlay" data-js-overlay-container><p class="text" data-js-overlay-text></p></div></div> ',_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(781),r=s.extend({className:"conversation-message-timestamp",template:o,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus"))},getTemplateData:function(){return{label:this.model.get("tsHeader")}}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-js-label class="inline-activity timestamp">'+__e(label)+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(783),a=s.extend({className:"conversation-message-sticker message-container",mixins:[o],template:r,defaults:{thumbnailWidth:210,rawWidth:1280,errorClassName:"is-error"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participants","conversation"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError",this._onModelIsErrorChange)},getTemplateData:function(){var t=this.model.toJSON(),e=t.sticker.original_size_url,i=t.sticker.url,n=this.participants.get(this.model.get("participant"));return{name:n?n.get("name"):null,avatarUrl:n?n.getAvatarUrl():null,blogUrl:n?n.get("url"):null,rawUrl:e?e:null,url:i?i:null,thumbnailWidth:this.get("thumbnailWidth"),rawWidth:this.get("rawWidth")}},_onModelIsErrorChange:function(t){this.$el.toggleClass(this.get("errorClassName"),t)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(rawUrl)||(__p+=' <a href="'+__e(rawUrl)+'" data-js-lightbox-url="'+__e(rawUrl)+'" data-js-lightbox-width="'+__e(rawWidth)+'" data-js-lightbox-height="'+__e(rawWidth)+'" data-js-lightbox-lowres-url="'+__e(url)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><img class="full-width" data-js-message-image src="'+__e(url)+'" width="'+__e(thumbnailWidth)+'"></div> ',_.isEmpty(rawUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(785),l=o.extend({className:"conversation-pill hide-pill",template:a,mixins:[r],events:{"click [data-js-unread-button]":"_onClick"},defaults:{count:0,maxCount:99},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus"))},afterRender:function(){this.listenTo(this,"change:count",this._onChangeCount),this._onChangeCount(this,this.get("count"))},setCount:function(t){this.set("count",n.isFinite(t)?t:0)},getCount:function(){return this.get("count")},getTitle:function(t){var e,i;return n.isFinite(t)?(e=this.get("maxCount"),i=t>e?e+"+":t,t>1?s("%1$s unread messages",i):s("%1$s unread message",i)):null},getTemplateData:function(){return{title:this.getTitle(this.get("count"))}},_onChangeCount:function(t,e){var i=this.getTitle(e);this.$el.toggleClass("hide-pill",0===e||n.isEmpty(i)),e>0&&this.js$("unread-button").text(i)},_onClick:function(t){t.preventDefault(),this.trigger("click")}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button tabindex="-1" data-js-theme-button data-js-unread-button class="unread-button">'+__e(title)+"</button>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="conversation-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div><div data-js-header></div><div data-subview="messagesView[]" class="message-list"></div><div data-subview="statusBannerView"></div><div data-subview="pillView"></div><div data-js-footer></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(180),o=i(226),r=i(738),a=i(788),l=i(789),c=o.extend({template:a,className:"chat-status-banner",subviews:{statusIndicator:{constructor:r,options:function(t){return{isOnline:t.get("seconds_since_last_activity")!==-1,canSeeUIFlag:s.bool("status_indicator"),name:t.get("name")}}}},initialize:function(t){this.set("name",n.get(t,"name","")),this.listenTo(this,"setActiveTime",function(t){this.set("lastOnlineString",l(t)),this.render()})},render:function(){return this.get("lastOnlineString")?o.prototype.render.call(this):this}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<span class="status-text"><div data-subview="statusIndicator"></div>'+__e(lastOnlineString)+"</span>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";function n(t){return!(t===-1||t>o)&&(t>=r?s("Active in the last 4 hours"):t>=a?s("Active in the last 3 hours"):t>=l?s("Active in the last 2 hours"):t>=0&&s("Active in the last hour"))}var s=i(130),o=14400,r=10800,a=7200,l=3600;t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(791),r=s.extend({className:"conversation-message-error",template:o,defaults:{message:null,showErrorIconClass:"show-icon",showErrorIcon:!1,actionText:null},events:{"click [data-js-action]":"_onClickAction"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","actionCallback"))},getTemplateData:function(){return{message:this.get("message"),actionText:this.get("actionText")}},afterRender:function(){this.$el.toggleClass(this.get("showErrorIconClass"),this.get("showErrorIcon"))},_onClickAction:function(t){
t.preventDefault(),n.isFunction(this.actionCallback)&&this.actionCallback()}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message"> '+__e(message)+" ",_.isEmpty(actionText)||(__p+=' <span class="action-container"><a href="#" data-js-action class="action">'+__e(actionText)+"</a></span> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(277),a=i(262),l=i(793),c=i(235),u=i(794),h=o.extend({className:"conversation-preview",template:l,mixins:[r],events:{"click [data-js-image-container]":"_onImageContainerClick","click [data-js-preview-remove]":"_onClickPreviewRemove"},defaults:{isVisible:!1,isEditable:!1,maxHeight:150,maxWidth:210,animateInDurationMs:300,animateOutDurationMs:200,animateInEasing:[.22,.685,.03,.895],animateOutEasing:[.895,.03,.685,.22]},afterRender:function(){this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this.listenTo(this,"change:isEditable",this._onChangeIsEditable),this._onChangeIsVisible(this,this.get("isVisible")),this._onChangeIsEditable(this,this.get("isEditable"))},hasImage:function(){return!s.isEmpty(this.previewImageModel)},addImage:function(t){var e=t.get("height"),i=t.get("width"),n=this.get("maxHeight"),o=this.get("maxWidth"),r=a.maxSize(i,e,o,n),l=this.js$("image-container");return this.previewImageView&&this.previewImageView.remove(),this.previewImageView=new u({src:t.get("url"),width:s.get(r,"width"),height:s.get(r,"height")}),l.append(this.previewImageView.render().$el),this.set("isVisible",!0),this.set("isEditable",s.isFunction(t.get("editCallback"))),this.previewImageModel=t,this._slideElement(l)},_slideElement:function(t,e){var i=new n.Deferred,o=t.height(),r=t.offset().top-this.$el.offset().top,a=o+r;return c.animate(t,{translateY:e?[a,0]:[0,a]},{duration:e?this.get("animateOutDurationMs"):this.get("animateInDurationMs"),easing:e?this.get("animateOutEasing"):this.get("animateInEasing"),complete:s.bind(function(){i.resolve(),t.css("transform","")},this)}),i},getMessage:function(){return s.isEmpty(this.previewImageModel)?null:this.previewImageModel.get("message")},close:function(){return this.trigger("closing",this.previewImageModel),this._slideElement(this.js$("image-container"),!0).then(s.bind(this._onAfterCloseAnimation,this))},_onAfterCloseAnimation:function(){var t=this.previewImageModel;this.previewImageView.remove(),delete this.previewImageModel,delete this.previewImageView,this.set("isVisible",!1),this.trigger("close",t)},_onImageContainerClick:function(t){var e,i=this.previewImageModel;this.get("isEditable")&&!s.isEmpty(i)&&(e=i.get("editCallback"),s.isFunction(e)&&(t.preventDefault(),e(t),this.trigger("edit",i)))},_onClickPreviewRemove:function(t){t.preventDefault(),t.stopPropagation(),this.trigger("dismiss",this.previewImageModel),this.close()},_onChangeIsVisible:function(t,e){this.$el.toggle(e)},_onChangeIsEditable:function(t,e){this.$el.toggleClass("editable",e)}});t.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="conversation-preview-image-container" data-js-image-container><a href="#" class="conversation-preview-remove" data-js-preview-remove>'+__e(__("Remove"))+"</a></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(795),r=s.extend({className:"conversation-preview-image",template:o,defaults:{width:null,height:null,src:null,context:null,loggingData:null},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<img src="'+__e(src)+'" width="'+__e(width)+'" height="'+__e(height)+'" alt="'+__e(__("GIF"))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(235),o=i(130),r=i(277),a=i(232),l=i(226),c=i(797),u=i(754),h=i(798),d=l.extend({className:"conversation-compose",template:h,mixins:[r,a],events:{"click [data-js-submit-button]":"_onSubmitButtonClick","input [data-js-text-input]":"_onTextInputChange","keydown [data-js-text-input]":"_onTextInputKeydown","focus [data-js-text-input]":"_onTextInputFocus","blur [data-js-text-input]":"_onTextInputBlur","paste [data-js-text-input]":"_onTextInputPaste"},keycommands:{"keydown:escape":"_onKeyPressEscape"},defaults:{isValid:!0,isDisabled:!1,isOffline:!1,placeholder:null,offlinePlaceholder:null,currentPlaceholder:null,currentText:null,hasEditorFocus:!1,isAutoValidationEnabled:!0,buttonSubmittedClass:"submitted",hideComposePluginsClass:"hide-compose-plugins-container",hidingComposePluginsClass:"hiding-compose-plugins-container",isShufflePlaceholder:!0,isPluginsVisible:!0,composeAnimationSpeed:200,pluginAnimateInDurationMs:200,pluginAnimateOutDurationMs:300,pluginAnimateInEasing:[.895,.03,.685,.22],pluginAnimateOutEasing:[.22,.685,.03,.895],isLightboxOpen:!1},subviews:{composePluginsView:{constructor:c,options:function(t){return{pluginsArray:t.pluginsArray}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","keyboardManager","keyboardNamespace","pluginsArray","isGifSearchEnabled","isSendAPost")),this.getRandomPlaceholder=u([o("New message"),o("Your message here"),o("Write a message"),o("Say something"),o("Say your thing")]),n.isEmpty(this.pluginsArray)&&this.hideComposePluginsView(!0),this.set("isShufflePlaceholder",n.isEmpty(this.get("placeholder"))),n.isEmpty(this.get("placeholder"))&&this.set("placeholder",this.getRandomPlaceholder()),this.set("currentPlaceholder",this.get("placeholder")),n.isEmpty(this.get("offlinePlaceholder"))&&this.set("offlinePlaceholder",o("Currently offline")),this.keyboardManager&&this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this,"change:isValid",this._onChangeIsValid),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:currentText",this._onChangeCurrentText),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this.listenTo(this,"change:isAutoValidationEnabled",this._onChangeIsAutoValidationEnabled),this.listenTo(this.composePluginsView,"plugin:preview:add:image",this._onComposePluginPreviewAddImage),this.listenTo(this.composePluginsView,"plugin:click",this._onComposePluginClick),this._onChangeIsValid(this,this.get("isValid")),this._onChangeIsDisabled(this,this.get("isDisabled")),this._onChangeIsOffline(this,this.get("isOffline")),this._onChangeCurrentPlaceholder(this,this.get("currentPlaceholder")),this._onChangeCurrentText(this,this.get("currentText")),this._setValidState(),n.defer(n.bind(function(){this._resizeInput()},this))},getTemplateData:function(){return{placeholder:this.get("placeholder"),isSendAPost:this.isSendAPost}},hideComposePluginsView:function(t){var e,i=this.get("hideComposePluginsClass"),o=this.get("hidingComposePluginsClass");if(this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!1),t)return void this.$el.addClass(i);this.$el.addClass(o),this._resizeInput(),e=this.composePluginsView.$el.outerWidth(),s.animate(this.$el,{marginLeft:[-e,0]},{duration:this.get("pluginAnimateOutDurationMs"),easing:this.get("pluginAnimateOutEasing"),complete:n.bind(function(){this._resizeInput(),this.$el.css("marginLeft","").addClass(i).removeClass(o)},this)})}},showComposePluginsView:function(t){var e,i=this.get("hideComposePluginsClass");if(!this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!0),t)return void this.$el.removeClass(i);e=this.composePluginsView.$el.outerWidth(),this.$el.css("margin-left",-e).removeClass(i),this._resizeInput(),s.animate(this.$el,{marginLeft:[0,-e]},{duration:this.get("pluginAnimateInDurationMs"),easing:this.get("pluginAnimateInEasing"),complete:n.bind(function(){this._resizeInput(),this.$el.css("marginLeft","")},this)})}},toggle:function(t){this.$el.toggle(t),t&&this.$el.css("display","")},submit:function(t){var e=this.get("currentText");this.get("isValid")&&!this.get("isDisabled")&&(this.trigger("submit",e,t),this._startAnimation(n.bind(function(){this.trigger("submit:animated",e,t)},this)),this.clear())},escape:function(){this.get("isLightboxOpen")||(n.isEmpty(this.get("currentText"))?this.trigger("close"):this.clear())},clear:function(){this.js$("text-input").val(""),this.set("currentText",""),this.get("isShufflePlaceholder")&&this._setPlaceholderState(),this._resizeInput()},focus:function(){n.defer(n.bind(function(){this.rendered&&this.js$("text-input").focus()},this))},getMessage:function(){return this.js$("text-input").val()},setPlaceholder:function(t){this.set({placeholder:t,isShufflePlaceholder:!1}),this._setPlaceholderState()},beforeRemove:function(){this.keyboardManager&&this.keyboardManager.remove(this.keyboardNamespace)},toggleAutoValidation:function(t){this.set("isAutoValidationEnabled",t)},_onComposePluginPreviewAddImage:function(t){this.trigger("plugin:preview:add:image",t)},_onComposePluginClick:function(t){this.trigger("plugin:click",t)},_onKeyPressEscape:function(t){t.preventDefault(),this.escape()},_onTextInputChange:function(){var t=n.trim(this.js$("text-input").val());this._resizeInput(),this.set("currentText",t),this.trigger("input",t,this)},_setValidState:function(){return this.get("isAutoValidationEnabled")?void this.set("isValid",!n.isEmpty(this.get("currentText"))):void this.set("isValid",!0)},_resizeInput:function(){var t,e=this.js$("text-input"),i=e.get(0);this._originalInputHeight||(this._originalInputHeight=e.outerHeight()),this.$el.css("height",this.$el.height()),e.css("height","auto"),t=i.scrollHeight,Math.abs(t-this._originalInputHeight)<5&&(t=this._originalInputHeight),e.css("height",t),this.$el.css("height",""),this._detectResize()},_detectResize:function(){var t=this.$el.height();return this._previousHeight?void(t!==this._previousHeight&&(this.trigger("resize",t),this._previousHeight=t)):void(this._previousHeight=t)},_startAnimation:function(t){var e=this.js$("submit-button"),i=this.get("buttonSubmittedClass");return n.isEmpty(i)?void(n.isFunction(t)&&t.call(this)):(e.addClass(i),void n.delay(n.bind(function(){e.removeClass(i),n.isFunction(t)&&t.call(this)},this),this.get("composeAnimationSpeed")))},_setPlaceholderState:function(){this.set("currentPlaceholder",this.get("isShufflePlaceholder")?this.getRandomPlaceholder():this.get("placeholder"))},_onChangeCurrentText:function(t,e){this._setValidState()},_onChangeIsValid:function(t,e){this.js$("submit-button").prop("disabled",!e||this.get("isDisabled"))},_onSubmitButtonClick:function(t){t.preventDefault(),this.submit("button")},_onChangeIsDisabled:function(t,e){this.js$("text-input").prop("disabled",e),this.js$("submit-button").prop("disabled",e||!this.get("isValid")),this.composePluginsView.toggleDisabled(e)},_onChangeIsOffline:function(t,e){e?(this.set("previousPlaceholder",this.get("placeholder")),this.set("currentPlaceholder",this.get("offlinePlaceholder"))):this.set("currentPlaceholder",this.get("previousPlaceholder"))},_onChangeCurrentPlaceholder:function(t,e){this.js$("text-input").attr("placeholder",e)},_onTextInputFocus:function(){this.set("hasEditorFocus",!0),this.trigger("focus",this)},_onTextInputBlur:function(){this.set("hasEditorFocus",!1),this.trigger("blur",this)},_onTextInputPaste:function(t){var e,i,s=n.get(t,"originalEvent.clipboardData.items",[]),o=n.filter(s,{kind:"file"});this.get("isDisabled")||0!==o.length&&(e=n.last(o),e&&(i=n.result(e,"getAsFile"),this.trigger("pasteBlob",i)))},_onTextInputKeydown:function(t){13!==t.keyCode||t.shiftKey||(this.submit("keyboard"),t.preventDefault())},_onChangeHasEditorFocus:function(t,e){this.keyboardManager&&this.keyboardManager.toggle(this.keyboardNamespace,t,e)},_onChangeIsAutoValidationEnabled:function(t,e){this._setValidState()}});t.exports=d},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.extend({className:"conversation-compose-plugins-container",mixins:[],renderWithTemplate:n.noop,defaults:{isDisabled:!1},initialize:function(t){t=n.extend({},t),n.extend(this,n.pick(t,"pluginsArray"))},afterRender:function(){this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),n.each(this.pluginsArray,n.bind(this._addPluginView,this)),this._onChangeIsDisabled(this,this.get("isDisabled"))},toggleDisabled:function(t){this.set("isDisabled",t)},_addPluginView:function(t){t.render(),this.$el.append(t.el),this.listenTo(t,"preview:add:image",this._onPluginViewPreviewAddImage),this.listenTo(t,"click",this._onPluginViewClick)},_onPluginViewPreviewAddImage:function(t){this.trigger("plugin:preview:add:image",t)},_onPluginViewClick:function(t){this.trigger("plugin:click",t)},_onChangeIsDisabled:function(t,e){n.each(this.pluginsArray,n.bind(function(t){t.toggleDisabled(e)}),this)}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=isSendAPost?' <div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="compose-text-input-container"><div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ":' <div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="compose-text-input-container"><div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(180),o=i(226),r=i(277),a=i(738),l=i(800),c=o.extend({className:"conversation-minimized",tagName:"a",attributes:{href:"#"},template:l,mixins:[r],events:{click:"_onClick"},defaults:{maxBadgeCount:99,activeBadgeClass:"tab-notice--active",newMessageClass:"new-message"},subviews:{statusIndicator:{constructor:a,options:function(t){return{isOnline:t.get("isOnline"),canSeeUIFlag:s.bool("status_indicator"),name:t.participant.get("name")}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus")),this.participant=this.model.getOtherParticipant(),this.set({blogName:this.participant?this.participant.get("name"):null,avatarUrl:this.participant?this.participant.getAvatarUrl():null,statusIndicatorUiFlag:s.bool("status_indicator")})},setIsOnline:function(t){this.set("isOnline",t),this.renderSubviews()},afterRenderSubviews:function(){this.listenTo(this.model,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.model,"sync",this._onConversationSync),this.listenTo(this,"setIsOnline",this.setIsOnline),this.listenTo(this.participant,"change:seconds_since_last_activity",function(t,e){this.setIsOnline(e!==-1)})},updateBadge:function(t){var e=this.get("maxBadgeCount"),i=this.get("activeBadgeClass");t>0&&this.js$("badge-value").text(t>e?e+"+":t),this.js$("badge").toggleClass(i,t>0)},animate:function(){var t=this.get("newMessageClass");this.$el.addClass(t),n.delay(n.bind(function(){this.$el.removeClass(t)},this),250)},focus:function(){this.$el.focus()},blur:function(){this.$el.blur()},_onChangeUnreadCount:function(t,e){this.updateBadge(e),e>0&&this.animate()},_onConversationSync:function(t){this.renderWithTemplate(),this.renderSubviews()},_onClick:function(t){t.preventDefault(),this.blur(),this.trigger("click")}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="avatar"><img src="'+__e(avatarUrl)+'" title="'+__e(blogName)+'"></div><div data-subview="statusIndicator"></div><div class="conversation-minimized-badge tab_notice tab-notice--outlined '+__e(statusIndicatorUiFlag?"status-indicator-active":"")+'" data-js-badge><span class="tab_notice_value" data-js-badge-value>2</span></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(226),r=i(277),a=i(802),l=o.extend({className:"conversation-error",mixins:[r],template:a,defaults:{message:null,isLoading:!1,showButton:!0,buttonText:null,buttonTextLoading:null,buttonTextCurrent:null},events:{"click [data-js-button]":"_onClickButton"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","buttonCallback")),n.isEmpty(this.get("message"))&&this.set("message",s("Something went screwy.")),n.isEmpty(this.get("buttonText"))&&this.set("buttonText",s("Retry")),n.isEmpty(this.get("buttonTextLoading"))&&this.set("buttonTextLoading",s("Retrying...")),n.isEmpty(this.get("buttonTextCurrent"))&&this.set("buttonTextCurrent",this.get("buttonText"))},afterRender:function(){this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:buttonTextCurrent",this._onChangeButtonTextCurrent),this.listenTo(this,"change:showButton",this._onChangeShowButton),this._onChangeIsLoading(this,this.get("isLoading")),this._onChangeShowButton(this,this.get("showButton"))},getTemplateData:function(){return{message:this.get("message"),buttonText:this.get("buttonTextCurrent")}},_onClickButton:function(t){t.preventDefault(),this.get("isLoading")||(this.set("isLoading",!0),this.trigger("buttonClick"),n.isFunction(this.buttonCallback)&&this.buttonCallback.call(this,this))},_onChangeIsLoading:function(t,e){var i=e?this.get("buttonTextLoading"):this.get("buttonText");this.set("buttonTextCurrent",i),this.js$("button").toggleClass("disabled",e).prop("disabled",e)},_onChangeButtonTextCurrent:function(t,e){this.js$("button").text(e)},_onChangeShowButton:function(t,e){this.js$("button").toggle(e)}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><label>'+__e(message)+'</label><button data-js-theme-button data-js-button class="chrome">'+__e(buttonText)+"</button></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=i(804),l=o.extend({className:"popover--conversation-actions info_popover popover_gradient popover",mixins:[r],initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"viewOptions")),this.view=new a(this.viewOptions)},render:function(){return this.$wrapper=s("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$wrapper.html(this.view.render().$el),this},teardown:function(){return this.remove()},getView:function(){return this.view}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(805),a=o.extend({className:"conversation-actions",tagName:"ul",template:r,events:{"click [data-js-block-blogname]":"_onBlockClick","click [data-js-delete-conversation]":"_onDeleteConversationClick"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","user","participants")),this.blockableParticipants=this.participants.getWithout(this.user.channels.pluck("uuid"))},getTemplateData:function(){return{blockableParticipants:n.invoke(this.blockableParticipants,"toJSON")}},_onBlockClick:function(t){var e=s(t.currentTarget),i=e.attr("data-js-block-blogname");t.preventDefault(),n.isEmpty(i)||this.trigger("block",i)},_onDeleteConversationClick:function(t){t.preventDefault(),this.trigger("delete")}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<li><a class="external-link" href="/settings/dashboard">'+__e(__("Sound settings"))+'</a></li><li><a href="#" data-js-delete-conversation>'+__e(__("Delete conversation"))+"</a></li> ",_.each(blockableParticipants,function(t){__p+=' <li><a href="#" data-js-block-blogname="'+__e(t.name)+'">'+__e(__("Block %1$s",t.name))+"</a></li> "});return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(8),r=i(9),a=i(180),l=i(226),c=i(277),u=i(262),h=i(354),d=i(737),p=i(776),_=i(738),g=i(807),f=n.template('<a href="<%- blogUrl %>/tagged/<%- tag %>" data-js-tumblelog-name="<%- blogName %>" data-js-tumblelog-tag="<%- tag %>">'),m=l.extend({className:"conversation-icebreakers",template:g,mixins:[c],defaults:{isShowTags:!0,isShowRelationship:!0,isShowDescription:!0},subviews:{statusIndicator:{constructor:_,options:function(t){return{isOnline:t.participant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:a.bool("status_indicator"),name:t.participant.get("name")}}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"eventBus","participant"))},getTemplateData:function(){return{description:this.get("isShowDescription")?this._getCleanDescriptionString():null,relationship:this.get("isShowRelationship")?this._getRelationshipString():null,tagsMarkup:this.get("isShowTags")?this._getTagsDescriptionMarkup():null,canPixelateAvatar:this.participant.get("can_pixelate_avatar"),name:this.participant.get("name"),avatarUrl:this.participant.getAvatarUrl(),url:this.participant.get("url")}},afterRender:function(){this.theme=new p({el:this.el,theme:this.participant.get("theme")}).render(),this.get("isShowDescription")&&n.defer(n.bind(function(){d(this.js$("description"))},this));var t=this.$el.find(".pixelated-avatar");n.each(t,n.bind(function(t){o(t).removeClass("hide").addClass("show"),u.drawPixelatedImages(this)},this))},_getOpeningTagAnchor:function(t){var e=this.participant.get("name"),i=this.participant.get("url");return f({blogUrl:i,blogName:e,tag:t})},_getClosingTagAnchor:function(){return"</a>"},_getOpeningTagText:function(){return'<span class="text">'},_getClosingTagText:function(){return"</span>"},_getTagsDescriptionMarkup:function(){var t=this.participant.getBlogTags(),e=this._getOpeningTagText(),i=this._getClosingTagText(),o=this._getClosingTagAnchor();return t.length>1?s("%1$sPosts about%2$s %3$s#%4$s%5$s %6$sand%7$s %8$s#%9$s%10$s",e,i,this._getOpeningTagAnchor(t[0]),n.escape(t[0]),o,e,i,this._getOpeningTagAnchor(t[1]),n.escape(t[1]),o):1===t.length?s("%1$sPosts about%2$s %3$s#%4$s%5$s",e,i,this._getOpeningTagAnchor(t[0]),n.escape(t[0]),o):null},_getCleanDescriptionString:function(){return h.stripTags(this.participant.getDescription())},_getRelationshipString:function(){var t;if(this.participant.isMutuals()){if(t=this._getRelativeTimeString(this.participant.getDurationMutualsSeconds()),!n.isEmpty(t))return s("Mutuals for %1$s",t)}else if(this.participant.isFollowingYou()){if(t=this._getRelativeTimeString(this.participant.getDurationFollowingYouSeconds()),!n.isEmpty(t))return s("Followed you %1$s ago",t)}else if(this.participant.isFollowing()&&(t=this._getRelativeTimeString(this.participant.getDurationFollowingSeconds()),!n.isEmpty(t)))return s("Following for %1$s",t);return s("Not following each other")},_getRelativeTimeString:function(t){return n.isNumber(t)?r(Date.now()-1e3*t).fromNow(!0):null}});t.exports=m},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'" data-js-theme-avatar-shape-class> ',__p+=canPixelateAvatar?' <canvas class="avatar pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" alt="'+__e(name)+'"></canvas> ':' <img src="'+__e(avatarUrl)+'"> ',__p+=' <div data-subview="statusIndicator"></div></a><div class="name"><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+"</a></div> ",_.isEmpty(description)||(__p+=' <div class="description" data-js-description><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"> '+__e(description)+" </a></div> "),__p+=" ",_.isEmpty(relationship)||(__p+=' <div class="relationship">'+__e(relationship)+"</div> "),__p+=" ",_.isEmpty(tagsMarkup)||(__p+=' <div class="tags">'+(null==(__t=tagsMarkup)?"":__t)+"</div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(468),r=i(809),a=i(811),l=i(711),c=i(812),u=r.extend({className:"conversation-compose-plugin conversation-compose-plugin--gif-search",template:c,defaults:s.defaults({selectedGif:null,query:"",resultLimit:200,resultImageWidth:250},r.prototype.defaults),events:{click:"_onClick"},initialize:function(t){t=s.extend({},t),s.extend(this,s.pick(t,"collection")),this.popoverOptions={collection:this.collection,query:this.get("query"),resultLimit:this.get("resultLimit"),imageWidth:this.get("resultImageWidth"),loggingContext:this.getName(),loadFullImageBeforeSelect:!1,autoTeardown:!0,teardownOnEscape:!0,pinnedTarget:this.$el,pinnedSide:"top",isFixedPosition:!0}},getName:function(){return"messaging-gif"},onEdit:function(t,e,i){var s,o,r;this.$el.is(":visible")||(o=n(i.currentTarget),r=o.height(),s={pinnedTarget:o,shift:{x:0,y:Math.ceil(r*-.8)}}),this._openGifSearchPopover(t,e,s)},_onClick:function(t){t.preventDefault(),this._openGifSearchPopover(this.get("query")),this.trigger("click",this)},_openGifSearchPopover:function(t,e,i){var n;this.gifSearchPopover&&this._closePopover(),n=s.extend({},this.popoverOptions,i,{query:t,selectedImageUrl:e}),this.gifSearchPopover=new o(n),this.gifSearchPopover.render(),this.toggleActive(!0),this.listenToOnce(this.gifSearchPopover,"close",this._onGifSearchPopoverClose),this.listenToOnce(this.gifSearchPopover,"selectImage",this._onGifSearchPopoverSelectImage),this.listenTo(this.collection,"search",function(t){this.set("query",t)})},_closePopover:function(){this.stopListening(this.gifSearchPopover),this.stopListening(this.collection),this.gifSearchPopover.teardown(),this.toggleActive(!1)},_onGifSearchPopoverSelectImage:function(t){var e,i,n,o,r,c,u,h=s.get(t,"postId"),d=s.get(t,"postBlogUuid"),p=this.get("resultImageWidth"),_=this.getName();s.isEmpty(h)||s.isEmpty(d)||(n=s.get(t,"mediaUrl",""),r=s.get(t,"width"),c=s.get(t,"height"),u=this.get("query"),o=n.replace(/_\d+\./,"_"+p+"."),e=l.createImagePostMessage(h,d,o,r,c,{context:_,loggingData:{query:u}}),i=new a({url:o,width:r,height:c,message:e,context:_,editCallback:s.bind(s.partial(this.onEdit,u,n),this),loggingData:{query:u,postId:h,postBlogUuid:d}}),this.addToImagePreview(i),this._closePopover())},_onGifSearchPopoverClose:function(){this._closePopover()}});t.exports=u},function(t,e,i){"use strict";var n=i(810),s=n.extend({tagName:"button",attributes:{"data-js-theme-accent-color-on-white":!0},afterRender:function(){this.listenTo(this,"change:isActive",this._onChangeIsActive),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this._onChangeIsActive(this,this.get("isActive")),this._onChangeIsDisabled(this,this.get("isDisabled"))},_onChangeIsActive:function(t,e){this.$el.toggleClass("active",e)},_onChangeIsDisabled:function(t,e){this.$el.prop("disabled",e)}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.extend({defaults:{isDisabled:!1,isActive:!1},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},getName:function(){return null},addToImagePreview:function(t){this.trigger("preview:add:image",t)},toggleActive:function(t){this.set("isActive",t)},toggleDisabled:function(t){this.set("isDisabled",t)}});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{message:null,url:null,width:null,height:null,editCallback:null}});t.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add GIF"));return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(8),r=i(277),a=i(213),l=i(809),c=i(811),u=i(711),h=i(814),d=i(815),p=l.extend({className:"conversation-compose-plugin conversation-compose-plugin--image-upload",template:d,mixins:[r],defaults:n.defaults({isFilePickerOpen:!1},l.prototype.defaults),events:{click:"_onClick",focus:"_onFocus","change [data-js-file-picker]":"_onFilePickerChange","click [data-js-file-picker]":"_onFilePickerClick"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,"imageUploadMaxBytes"))},getName:function(){return"messaging-image-upload"},afterRender:function(){this.listenTo(this,"change:isFilePickerOpen",this._onChangeIsFilePickerOpen),l.prototype.afterRender.apply(this,arguments)},addImageFile:function(t,e){var i=void 0,o=void 0,r=Math.floor(this.get("imageUploadMaxBytes")/1048576);this.messagingImageUploader=new h({file:t,imageUploadMaxBytes:this.get("imageUploadMaxBytes")}),this.messagingImageUploader.uploadImage().then(n.bind(function(s){var r=n.get(s,"src"),a=n.get(s,"width"),l=n.get(s,"height");o=u.createImageMessage(r,t,a,l,{context:this.getName(),loggingData:{imageSource:e}}),i=new c({url:r,file:t,width:a,height:l,message:o,context:this.getName(),editCallback:n.bind(this.onEdit,this),loggingData:{imageSource:e}}),this.addToImagePreview(i)},this),function(t){var e=n.get(t,"type");if(e)switch(e){case"format":a.alert(s("Invalid file type."));break;case"size":a.alert(s("Image must be smaller than %1$sMB",r))}else a.alert(s("Something about that file is off. Try sending something else."))})},_openFilePicker:function(){this.$el.focus(),this.set("isFilePickerOpen",!0),this.js$("file-picker").click()},onEdit:function(){this._openFilePicker()},_onFilePickerChange:function(t){var e=n.first(o(t.target).prop("files"));this.set("isFilePickerOpen",!1),this.js$("file-picker").val(""),
this.addImageFile(e,"filesystem")},_onFilePickerClick:function(t){t.stopPropagation()},_onClick:function(t){this._openFilePicker(),this.trigger("click",this)},_onFocus:function(){this.set("isFilePickerOpen",!1)},_onChangeIsFilePickerOpen:function(t,e){this.toggleActive(e)}});t.exports=p},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(214),r=i(259),a=i(260),l=o.extend({name:"MessagingImageUploader",defaults:{imageUploadMaxBytes:null,file:null},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},uploadImage:function(){var t=new s.Deferred,e=this.get("imageUploadMaxBytes"),i=this.get("file"),o=function(){t.resolve.apply(this,arguments)},l=function(){t.reject.apply(this,arguments)};return i?n.get(i,"type","").match(/image\/(jpg|jpeg|png|gif)/i)?n.get(i,"size")>e?t.reject({type:"size"}):(a.read(i).then(function(t){r.load(t.objectUrl||t.base64).then(o,l)}),t):t.reject({type:"format"}):t.reject()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add Photo"))+' <input type="file" class="input-file-picker" data-js-file-picker name="messaging-photo" accept="image/*" tabindex="-1">';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(277),o=i(811),r=i(711),a=i(809),l=i(817),c=i(827),u=a.extend({className:"conversation-compose-plugin conversation-compose-plugin--stickers",template:c,mixins:[s],defaults:n.defaults({},a.prototype.defaults),events:{click:"_onClick"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t)),this.popoverOptions={autoTeardown:!0,teardownOnEscape:!0,pinnedTarget:this.$el,pinnedSide:"top",isFixedPosition:!0}},getName:function(){return"messaging-stickers"},onEdit:function(){this._openStickersPopover()},_openStickersPopover:function(){this.stickersPopover&&this._closePopover(),this.stickersPopover=new l(this.popoverOptions),this.stickersPopover.render(),this.toggleActive(!0),this.listenToOnce(this.stickersPopover,"close",this._onCloseStickersPopover),this.listenToOnce(this.stickersPopover,"stickers:select:sticker",this._onSelectStickersPopover)},_onClick:function(t){t.preventDefault(),this._openStickersPopover(),this.trigger("click",this)},_closePopover:function(){this.stopListening(this.stickersPopover),this.stickersPopover.teardown(),this.toggleActive(!1)},_onCloseStickersPopover:function(){this._closePopover()},_onSelectStickersPopover:function(t,e){var i=void 0,s=void 0,a=t.toJSON(),l=a.id,c=a.sticker_pack_id,u=a.url,h=a.original_size_url,d=250,p={stickerId:l,stickerPackId:c};i=r.createStickerMessage(l,u,h,{context:this.getName(),loggingData:p}),s=new o({url:u,width:d,height:d,message:i,context:this.getName(),editCallback:n.bind(this.onEdit,this),loggingData:p}),this.addToImagePreview(s),this._closePopover()}});t.exports=u},function(t,e,i){"use strict";var n=i(226),s=i(283),o=i(818),r=n.extend({className:"popover--stickers",mixins:[s],initialize:function(t){this.stickers=new o,this.listenTo(this.stickers,"all",this.trigger)},render:function(){this.stickers.render().$el.appendTo(this.$el)},teardown:function(){return this.$el.remove(),this}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(214),r=i(819),a=i(820),l=i(821),c=function(){};c.extend=s.Model.extend,n.extend(c.prototype,s.Events);var u=new c,h=o.extend({name:"Stickers",defaults:{selectedStickerPack:null},initialize:function(t){t=n.extend({},t);var e=n.get(this.data,"stickers",[]);this.stickers=new r(this._createStickerModels(e)),this.eventBus=u;var i=n.extend({eventBus:this.eventBus,stickers:this.stickers},t);this.view=new l(i),this.listenTo(this.eventBus,"select:sticker",this._onSelectSticker)},render:function(){return this.view.render(),this.trigger("append"),this.view},_onSelectSticker:function(t,e){this.trigger("stickers:select:sticker",t,e)},_createStickerModels:function(t){return n.map(t,function(t){return new a({description:t.description,id:t.id,media_key:t.media_key,sticker_pack_id:t.sticker_pack_id,url:t.url,original_size_url:t.original_size_url})})}});t.exports=h},function(t,e,i){"use strict";var n=i(190),s=i(820),o=n.extend({model:s});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{description:null,id:null,media_key:null,sticker_pack_id:null,url:null,original_size_url:null}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(822),r=i(826),a=s.extend({className:"messaging-stickers-container",template:r,subviews:{stickerResultsView:{constructor:o,options:function(t){return{eventBus:t.eventBus,collection:t.stickers}}}},initialize:function(t){t=n.extend({},t),n.extend(this,n.pick(t,"eventBus","stickers"))}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(734),r=i(277),a=i(492),l=i(823),c=i(825),u=s.extend({className:"messaging-stickers-results",mixins:[r,o],template:c,subviews:{stickerResultView:{constructor:l,options:function(t){return{eventBus:t.eventBus}},collection:function(t){return t.collection}}},initialize:function(t){t=n.extend({},t),n.extend(this,n.pick(t,"eventBus","collection"))},afterRenderSubviews:function(){this.scrollbar=new a(this.$el.first()),this.updateScrollbar()},beforeRemove:function(){this.scrollbar&&this.scrollbar.destroy()},updateScrollbar:function(){this.rendered&&this.scrollbar&&n.defer(n.bind(this.scrollbar.update,this.scrollbar))}});t.exports=u},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(824),a=s.extend({className:"messaging-stickers-result",mixins:[o],template:r,events:{click:"_onClick"},initialize:function(t){t=n.extend({},t),n.extend(this,n.pick(t,"eventBus"))},getTemplateData:function(){var t=this.model.toJSON();return{stickerId:t.id,src:t.url}},_onClick:function(t){t.preventDefault(),this.eventBus.trigger("select:sticker",this.model,this)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-js-sticker-result data-sticker-id="'+__e(stickerId)+'"><a href="#"><img src="'+__e(src)+'" width="100px"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="messaging-stickers-results-wrapper" data-subview="stickerResultView[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="stickerResultsView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add Sticker"));return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="messaging-conversation messaging-conversation--open" data-js-theme-background-tint data-js-conversation-open data-js-theme-accent-color-on-white><div data-subview="headerView"></div><div class="conversation-main" data-js-theme-background-color data-js-main><div data-subview="messagesView"></div><div data-subview="conversationLoaderView"></div></div><div data-subview="previewView"></div><div data-subview="composeView"></div></div><div class="messaging-conversation messaging-conversation--minimized" data-js-conversation-minimized data-js-theme-accent-color-on-white data-js-theme-avatar-shape-class><div data-subview="minimizedView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{channel:null},getChannel:function(){return this.get("channel")},setChannel:function(t){return this.set("channel",t)},getId:function(){return this.get("channel").get("uuid")},getPrevChannel:function(){return this.previous("channel")},getPrevProperty:function(t){var e=this.getPrevChannel();return e?e.get(t):null},getPrevId:function(){return this.getPrevProperty("uuid")}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(721),r=i(711),a=s.extend({url:"/svc/conversations",mixins:[o],model:r,comparator:function(t){return-t.get("last_modified_ts")},_getRoot:function(t){return n.has(t,"response")?n.get(t,"response"):t},parse:function(t,e){return n.get(this._getRoot(t),"conversations")||[]},parsePreviousLink:function(t,e){return n.get(this._getRoot(t),"_links.previous")},parseNextLink:function(t,e){return n.get(this._getRoot(t),"_links.next")},fetchInbox:function(t,e){e=e||{};var i=n.extend({},e.data,{participant:t});return n.extend(e,{cache:!1,remove:!1,skipParseLinks:0!==this.length,data:i,isFetchInbox:!0}),this.fetch(e)},getUnreadCount:function(){return n.reduce(this.models,function(t,e){return e.isUnread()?t+1:t},0)}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(190),o=i(832),r=s.extend({model:o,getSortedModels:function(t){return this.sortBy(function(e){return e.get("uuid")===t?-1:0})},getSortedIds:function(t){var e=this.getSortedModels(t);return n.pluck(n.invoke(e,"toJSON"),"uuid")}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(185),o=i(712),r=i(830),a=i(191),l=s.extend({idAttribute:"uuid",mixins:[o],relations:{conversations:r},defaults:{conversations:null,unread_messages_count_sum:0}});n.defaults(l.prototype,a.prototype),t.exports=l},function(t,e,i){"use strict";var n,s=i(8),o=i(214),r=i(834),a=i(835),l=o.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){s(".l-footer").length&&(this.footerView=new r({el:".l-footer"})),s(".sidebar_nav").length&&(this.sidebarFooterView=new a({el:".pinned_sidebar_footer"}))}});t.exports=function(){return n||(n=new l),n}},function(t,e,i){"use strict";var n=i(226),s=n.extend({});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(220).transition,a=s.extend({defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(o,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility),this.$nav=this.$el.find(".sidebar_nav")},onScroll:function(t){t&&(t.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0))},toggleVisibility:function(t,e){e===!0?(this.showElement(),n.defer(n.bind(function(){this.$nav.toggleClass("visible",e)},this))):(r(this.$nav,n.bind(function(){this.hideElement()},this)),this.$nav.toggleClass("visible",e)),o.trigger("toastr:canDisplayToggle",e)},hideElement:function(){this.$el.css("display","none")},showElement:function(){this.$el.css("display","block")}});t.exports=a},function(t,e,i){"use strict";var n=i(8),s=i(214),o=i(136),r=i(437),a=s.extend({name:"SponsoredPosts",initialize:function(){if(this.isScrollEnabled=!1,this.transform=r.get("transform"),this.transform){this.rings=n(),this.ctas=n();var t=n.proxy(this.checkForRingsAndCTAs,this);o.on("AutoPaginator:after",t),o.on("sponsoredPosts:checkRings",t),this.checkForRingsAndCTAs()}},checkForRingsAndCTAs:function(){this.rings=this.rings.add(".sponsored_badge_icon .ring, .recommendation-reason-footer .icon_explore"),this.ctas=this.ctas.add(".tsp-cta-animated").map(function(){var t=n(this);this.$el=t,this.elHeight=t.height(),this.elBottom=t.offset().top+t.height(),this.$aCTA=t.find("a.cta"),this.$aCTA.css("color","#ffffff"),this.$overlay=t.find(".tsp-opacity-overlay");var e=/([\d]+)[^\d]+([\d]+)[^\d]+([\d]+).+/.exec(this.$overlay.css("border-top-color")),i=e[1],s=e[2],o=e[3];return this.overlayColor=i+", "+s+", "+o,this.$aCTA.addClass("cta-color-applied"),this}),!this.isScrollEnabled&&(this.rings.length>0||this.ctas.length>0)&&(this.isScrollEnabled=!0,o.on("DOMEventor:flatscroll",this.onWindowScroll,this))},onWindowScroll:function(t){var e=t.windowScrollTop,i=void 0,n=void 0;for(i=0,n=this.rings.length;i<n;i++)this.rings[i].style[this.transform]="rotate("+e+"deg)";for(i=0,n=this.ctas.length;i<n;i++)this._setCtaVisual(t,this.ctas[i])},_setCtaVisual:function(t,e){var i=200,n=t.windowHeight-(e.elBottom-t.windowScrollTop),s=void 0;n<e.elHeight?s=1:n>=0&&n<=i?s=1-n/i:(s=0,this.ctas=this.ctas.not(e),e.$el.removeClass("tsp-cta-animated"));var o=2*(s-.5),r="rgba("+e.overlayColor+", "+o+")";e.$overlay.css({opacity:s,"border-color":r});var a=s<.5?"#FFFFFF":"";e.$aCTA.css("color",a)}});t.exports=a},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(214),a=i(838),l=i(841),c=i(129),u=r.extend({name:"peepr",params:"",selector:"body",initialize:function(){var t=c.get("Components/Peepr")||{};this.params=t,t.blog_name&&(this.listenToOnce(o,"peepr:close",this.onPeeprClose),n(document).ready(s.bind(this.onPeeprRequestWithParams,this))),this.$container=n(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(o,"peepr-open-request",this.onPeeprRequest),this.$container.on("click","[data-peepr]",s.bind(this.onPeeprTargetClicked,this))},onPeeprTargetClicked:function(t){if(!t.ctrlKey&&!t.metaKey){t.preventDefault();var e=n(t.currentTarget),i=e.data("peepr");if(i){var s=i.tumblelog,r=i.postId,a=i.searchTagTerm,l=i.replyNoteToTumblelogName;o.trigger("peepr-open-request",{tumblelog_name:s,post_id:r,searchTagTerm:a,reply_note_to_tumblelog_name:l})}else window.open(e.attr("href"))}},onPeeprClose:function(){window.Backbone.history.navigate("/dashboard")},onPeeprRequestWithParams:function(){o.trigger("peepr-open-request",{tumblelog_name:this.params.blog_name,post_id:this.params.post_id})},onPeeprRequest:function(t){t.tumblelog_name&&(t.editing_appearance="undefined"!=typeof t.editing_appearance&&t.editing_appearance,this.open(t))},open:function(t){t.className="peepr-drawer","blogrecommendations"===a().containerDrawerName?a().replace(l,t,"peepr-drawer-container"):a().canOpen()&&a().open(l,t,"peepr-drawer-container")}});t.exports=u},function(t,e,i){"use strict";var n,s=i(8),o=i(3),r=i(130),a=i(214),l=i(136),c=i(232),u=i(213),h=i(839),d=a.extend({name:"drawer",selector:"body",mixins:[c],defaults:{suspended:!1,needsCloseConfirmation:!1},keycommands:{"keydown:escape":"initiateClose"},initialize:function(){this.$glass=null,this.$container=s(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(l,"post:form:show",this.suspend),this.listenTo(l,"post:form:hide",this.resume),this.listenTo(l,"drawer:suspend",this.suspend),this.listenTo(l,"drawer:resume",this.resume),this.listenTo(l,"drawer:enableCloseConfirmation",this.enableCloseConfirmation),this.listenTo(l,"drawer:disableCloseConfirmation",this.disableCloseConfirmation),this.listenTo(l,"drawer:hideGlass",this.hideGlass),this.listenTo(l,"indashblog:post:photo_lightbox",this.disableKeys),this.listenTo(l,"tumblr_lightbox:form:hide",this.enableKeys),this.$container.on("click.drawerOpen keyup","[data-drawer-open]",o.bind(this.onClickOpen,this))},suspend:function(){this.set("suspended",!0)},resume:function(){this.set("suspended",!1)},enableCloseConfirmation:function(){this.set("needsCloseConfirmation",!0)},disableCloseConfirmation:function(){this.set("needsCloseConfirmation",!1)},canOpen:function(){return!this.get("suspended")&&!this.view},isSuspended:function(){return this.get("suspended")},isOpen:function(){return!!this.view},toggle:function(t,e){this.canOpen?this.open(t,e):this.close()},open:function(t,e,i,n){this.containerDrawerName=n,this.view=new h({subviews:{"drawer-content":{constructor:t,options:e||{}}}}),this.view.$el.addClass(i),this._toggleContainerDrawerClass(n,!0),this.showGlass(),l.trigger("keycommands:suspend"),this.append(),this.trigger("open"),l.trigger("drawer:open")},replace:function(t,e,i,n){this.view?(this._toggleContainerDrawerClass(this.containerDrawerName,!1),this._toggleContainerDrawerClass(n,!0),this.view.animateRemove(),this.view=null,this.containerDrawerName=n,o.delay(o.bind(function(){this.view=new h({subviews:{"drawer-content":{constructor:t,options:e||{}}}}),this.view.$el.addClass(i),this.append()},this),400)):this.open(t,e,i)},onClickOpen:function(t){if("keyup"!==o.get(t,"type")||13===o.get(t,"keyCode")){t.preventDefault();var e=s(t.currentTarget).attr("data-drawer-open");this.trigger("open:"+e),l.trigger("drawer:open:"+e)}},initiateClose:function(){this.view&&!this.get("suspended")&&(this.get("needsCloseConfirmation")===!0?u.confirm(r("Close without sending?"),o.bind(this.close,this),this.noop,r("OK"),r("Cancel")):this.close())},close:function(){this.view&&(this._toggleContainerDrawerClass(this.containerDrawerName,!1),this.view.animateRemove(),this.view=null,this.containerDrawerName=null,this.hideGlass(),l.trigger("keycommands:resume"),this.trigger("close"),l.trigger("drawer:close"))},remove:function(){return this.close(),this},showGlass:function(){this.$glass=s("<div>",{class:"ui_peepr_glass"}).appendTo(this.$container);var t=o.bind(function(){this.$container.addClass("peepr")},this);this.animationDelay=o.delay(t,50),this.$glass.on("click",o.bind(this.initiateClose,this))},hideGlass:function(){var t=this.$glass;this.$glass=null,this.$container.removeClass("peepr"),this.animationDelay&&clearTimeout(this.animationDelay),o.delay(function(){t.remove()},150)},_getContainerClassNameForDrawerName:function(t){return o.isEmpty(t)?null:"peepr--"+t},_toggleContainerDrawerClass:function(t,e){var i=this._getContainerClassNameForDrawerName(t);o.isEmpty(this.$container)||o.isEmpty(i)||this.$container.toggleClass(i,e)}});t.exports=function(){return n||(n=new d),n}},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(226),a=i(840),l=r.extend({template:a,className:"drawer",defaults:{visible:!1},initialize:function(t){t.subviews&&(this.$body=n("body"),this.bindEvents())},bindEvents:function(){this.listenTo(o,"DOMEventor:keydown:tab",this.disableKey)},afterRender:function(){this.show()},disableKey:function(t){var e=n(t.target).is("input");e||t.preventDefault()},show:function(){this.get("visible")||(this.set("visible",!0),this.toggleAnimation("open",!0))},hide:function(t){this.get("visible")?(this.set("visible",!1),this.toggleAnimation("open",!1),s.delay(t,500)):t()},toggleAnimation:function(t,e){var i=s.bind(function(){this.$el.toggleClass(t,e)},this);window.requestAnimationFrame?window.requestAnimationFrame(i):s.defer(i)},animateRemove:function(){return this.hide(s.bind(function(){this.remove()},this)),this}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+=null==(__t=_subview("drawer-content"))?"":__t;return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(136),r=i(226),a=i(180),l=i(842),c=i(843),u=i(844),h=i(845),d=i(848),p=i(849),_=i(851),g=i(853),f=i(855),m=i(856),v=i(191),b=i(857),y=i(182),w=i(1079),k=r.extend({template:u,subviews:{posts:{constructor:h},emptyStateMessage:{constructor:p},header:{constructor:d},bigLoader:{constructor:f},timeline:{constructor:b},survey:{constructor:_},overlay:{constructor:w}},initialize:function(t){this.$body=s("body"),this.options=t,this.loadCount=0,this.user=y(),this.set("isSafeModeEnabled",a.bool("safe_mode")&&this.user.get("safe_mode")),this.set("oneTruePost",a.bool("one_true_post_on_peepr")),this.set("isTagFilteringEnabled",a.bool("user_tag_filtering")),this.get("isSafeModeEnabled")&&(this.set("shouldBypassSafeMode",n.get(this.options,"should_bypass_safemode",!1)),this.set("canModifySafeMode",n.get(this.options,"can_modify_safe_mode",!1))),this.get("isTagFilteringEnabled")&&this.set("shouldBypassTagFiltering",n.get(this.options,"should_bypass_tagfiltering",!1)),this.setCollection(),this.postKeycommandsView=new m({el:this.$el}),this.bindEvents(),this.fetchPostsAndOrBlog(),o.trigger("peepr:open",{tumblelog_name:this.options.tumblelog_name,post_id:this.options.post_id,loggingData:{tumblelog_name:this.options.tumblelog_name,post_id:this.options.post_id}}),l.setup()},isMine:function(t,e){return t.channels.models.some(function(t){return t.id===e})},setupSubviews:function(){if(this.get("isSafeModeEnabled")&&this.get("isAdult")&&!this.get("shouldBypassSafeMode")&&!this.isMine(y(),this.options.tumblelog_name)){this.$el.addClass("overlay-container"),this.posts.remove();var t={blogName:this.options.tumblelog_name};o.trigger("Kraken:safeMode:SafeModeBlogPageShown",{loggingData:t})}else this.get("isSafeModeEnabled")&&this.overlay&&this.overlay.remove()},fetchPostsAndOrBlog:function(){var t=this;this.get("oneTruePost")?(this.collection.fetchBlog(),this.listenToOnce(o,"peepr:timeline:posts-fetched",function(){t.collection.trigger("peepr:postsAndBlogFetch")})):this.collection.fetchPostsAndBlog()},setCollection:function(){var t=this;this.collection&&this.collection.stopListening();var e=new v({name:this.options.tumblelog_name});this.set("shouldBypassTagFiltering",n.get(this.options,"should_bypass_tagfiltering",!1)),this.set("shouldBypassSafeMode",n.get(this.options,"should_bypass_safemode",!1)),this.set("canModifySafeMode",n.get(this.options,"can_modify_safe_mode",!1)),this.collection=new g([],{blogNameOrId:this.options.tumblelog_name,tumblelogData:e.toJSON(),postId:this.options.post_id,shouldBypassSafeMode:this.get("shouldBypassSafeMode"),shouldBypassTagFiltering:this.get("shouldBypassTagFiltering"),canModifySafeMode:this.get("canModifySafeMode")}),this.listenTo(this.collection.tumblelog,"change:global_theme_params",this.setBkgColor),this.listenTo(this.collection,"error",this.onSyncError),this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.onFirstSync),this.listenTo(this.collection,"emptyState",function(e){t.emptyStateMessage.setNewMessage(e)}),n.each(this.subviews,function(t){t.options=n.defaults({collection:this.collection,editing_appearance:this.options.editing_appearance,searchTagTerm:this.options.searchTagTerm||""},t.options||{})},this)},bindEvents:function(){this.$el.scroll(this.onBodyScroll),this.listenTo(o,"peepr-open-request",this.onPeeprOpenRequest),this.listenTo(o,"peepr:like_update",this.onPostLike),this.listenTo(o,"peepr:follow_update",this.onHeaderFollow),this.listenTo(o,"indashblog:post:reblog",this.onLegacyReblog),this.listenTo(o,"indashblog:search:start indashblog:search:clear",this.scrollToPosts)},afterRender:function(){this.autoPager&&(this.autoPager.close(),this.autoPager=null),document.activeElement.blur(),this.get("oneTruePost")||this.get("shouldBypassSafeMode")||this.get("shouldBypassTagFiltering")||(this.autoPager=new c({$target:this.$(".peepr-body")}),this.listenTo(this.autoPager,"trigger",n.throttle(this.onAutopagerTrigger,500,{trailing:!1}))),this.get("shouldBypassSafeMode")&&o.trigger("Kraken:safeMode:NsfwPostPreview")},onAutopagerTrigger:function(){this.collection.fetchMore(),this.log("paginate",{postCount:this.collection.length})},onBodyScroll:function(t){var e={windowScrollTop:s(t.currentTarget).scrollTop()};window.requestAnimationFrame?requestAnimationFrame(function(){o.trigger("peepr-body-scroll",e)}):o.trigger("peepr-body-scroll",e)},onLegacyReblog:function(t){var e="POST_CONTEXT_PEEPR";t.reblog_key||(t.reblog_key=this.collection.get(t.id).get("reblog_key")),o.trigger("postForms:reblog",{reblogSource:e,reblogId:t.id,reblogKey:t.reblog_key,pt:t.pt}),this.listenToOnce(o,"postForms:saved",this.onPostFormReblogSuccess),this.log("peepr_reblog",{postId:t.id})},onPostFormReblogSuccess:function(t,e){this.log("peepr_reblog_success",{postId:e.responseJSON.post.id})},onPostLike:function(t,e){this.log("peepr_like_update",{postId:e.id,liked:e.liked})},onHeaderFollow:function(t){this.log("peepr_follow",{following:t})},onFirstSync:function(){this.rendered&&(this.set("isAdult",this.collection.tumblelog.get("nsfw")),this.setupSubviews(),this.setBkgColor(),this.bigLoader.hide(),this.$(".indash_blog").addClass("intro"),n.delay(n.bind(function(){this.rendered&&this.$(".indash_blog").removeClass("intro")},this),1e3),this.options.reply_note_to_tumblelog_name&&o.trigger("drawer:notes:open",this.options.reply_note_to_tumblelog_name),this.log(this.loadCount?"reload":"load"),this.loadCount++)},onPeeprOpenRequest:function(t){t.tumblelog_name&&(this.options=t,this.setCollection(),this.reload())},reload:function(){this.autoPager&&this.stopListening(this.autoPager),this.removeSubviews(),this.render(),this.fetchPostsAndOrBlog()},setBkgColor:function(){var t=this.collection.tumblelog.get("global_theme_params")||{};n.has(t,"background_color")&&this.$(".peepr-body").css("background-color",t.background_color)},scrollToPosts:function(){this.headerScrollHeight=this.headerScrollHeight||this.$(".header_image_wrapper").height()-this.$(".navigation").height(),this.$el.scrollTop(this.headerScrollHeight)},onSyncError:function(){this.log("ajax-error",{offset:this.collection.length,path:window.location.href})},log:function(t,e){var i=n.defaults({blogname:this.options.tumblelog_name,postId:this.options.postId,loadCount:this.loadCount},e||{});o.trigger("Kraken:peepr:log:"+t,{loggingData:{payload:i}})},remove:function(){this.log("close"),this.collection.stopListening(),this.postKeycommandsView&&this.postKeycommandsView.remove(),o.trigger("peepr:close",this.options.tumblelog_name,this.options.post_id),o.trigger("Kraken:peepr:close",this.options.tumblelog_name,this.options.post_id),r.prototype.remove.call(this)}});t.exports=k},function(t,e,i){"use strict";var n,s=i(8),o=i(3),r=i(136),a=i(214),l=a.extend({name:"TrackingPixels",initialize:function(){this.listenTo(r,"component:TrackingPixels",this.initPixels)},initPixels:function(t){t.init&&o.each(t.init,function(t){t.script&&s("body").append(t.script)})}});t.exports={setup:function(){return n||(n=new l),n}}},function(t,e,i){"use strict";var n=i(136),s=i(3),o=i(7),r=i(215),a=i(181),l=r.extend({defaults:{offset:175,throttle:200,lockStep:!1,triggerCachingDelta:-1},constructor:function(t){this.options=s.extend({},this.defaults,t),this.handler=s.bind(this.options.$target?this.onTargetScroll:this.onWindowScroll,this),this.options.throttle&&(this.handler=s.throttle(this.handler,this.options.throttle)),this.locked=!1,this.bindEvents()},forceCheck:function(t){this.options.$target?this.handler(null,t):this.handler(a.rect(),t)},bindEvents:function(){this.options.$target?this.options.$target.parent().on("scroll",this.handler):(this.listenTo(n,"DOMEventor:flatscroll",this.handler),this.listenTo(n,"DOMEventor:flatresize",this.handler))},unlock:function(){this.locked=!1},onWindowScroll:function(t,e){if(!this.locked&&(this.buffer||(this.buffer=this.getBuffer(t)),this.nearBottom(t))){var i=s.clone(t);if(!e&&this.options.triggerCachingDelta!==-1&&this.triggerCache){var n=Math.abs(t.windowScrollTop-this.triggerCache.windowScrollTop);if(n<this.options.triggerCachingDelta)return}this.trigger("trigger"),this.options.lockStep&&(this.locked=!0),e||this.options.triggerCachingDelta===-1||(this.triggerCache=i)}},onTargetScroll:function(t,e){var i=this.options.$target.parent().height(),n=this.options.$target.outerHeight(),s=this.options.$target.position().top,o={windowScrollTop:-s,documentHeight:n,windowHeight:i};this.onWindowScroll(o,e)},getRemainingDocHeight:function(t){return t.documentHeight-t.windowScrollTop-t.windowHeight-this.buffer},getBuffer:function(t){var e=t.windowHeight;return!s.isNull(e)&&Math.round(.666*e)},nearBottom:function(t){if(s.isNull(t.windowScrollTop))return!1;var e=this.options.offset,i=this.getRemainingDocHeight(t);return i<e},close:function(){this.options.$target&&this.options.$target.parent().off("scroll",this.handler)}});s.extend(l.prototype,o.Events),t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="peepr-body"><div class="indash_blog"><header data-subview="header" class="header"></header> ',oneTruePost?__p+=' <div data-subview="timeline" class="timeline"></div> ':(__p+=' <div class="empty-state-message" data-subview="emptyStateMessage"></div><main data-subview="posts" class="posts"></main> ',isSafeModeEnabled&&shouldBypassSafeMode&&(__p+=' <div data-subview="survey" class="survey"></div> '),__p+=" ",isSafeModeEnabled&&(__p+=' <div data-subview="overlay" class="overlay"></div> '),__p+=" "),__p+=' </div></div><div data-subview="bigLoader"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(136),r=i(226),a=i(180),l=i(846),c=i(331),u=i(847),h=r.extend({className:"posts",template:u,initialize:function(){this.postViews=[],this.listenTo(o,"indashblog:post:photo_lightbox",this.onLightboxRequest),this.listenTo(this.collection,"sync",this.onCollectionSync),this.listenTo(this.collection,"reset",this.onCollectionReset),this.listenTo(this.collection,"request",this.onCollectionRequest),this.listenTo(this.collection,"add",this.renderPost),this.counter=1,this.adViews=[],this.listenTo(o,"indashblog:inject:ad",this.setupDarla),this.listenTo(o,"DOMEventor:flatresize",this.setMinHeight),this.listenTo(o,"indashblog:search:results-end",this.onSearchResultsEnd)},afterRender:function(){return this.loader=new c,this.$el.append(this.loader.render().$el),n.delay(this.setMinHeight.bind(this),2e3),this},setupDarla:function(t){this.darlaAd=t.ads},setMinHeight:function(){if(this.rendered&&!this.collection.shouldBypassSafeMode&&!this.collection.shouldBypassTagFiltering){var t=s(window).height();this.navHeight=n.isUndefined(this.navHeight)?[".peepr-body .navigation",".peepr-body .info_wrapper",".peepr-body .blogless-advertiser"].reduce(function(t,e){return t+s(e).outerHeight()},0):this.navHeight,this.$el.css("min-height",t-this.navHeight+"px")}},renderPost:function(t){if(!a.bool("one_true_post")){var e=new window.Tumblr.IndashBlog.PostView({model:t});this.postViews.push(e);var i=this.$("[data-js-peepr-post-container]");if(i.append(e.render().el),this.postViews.length%10===2&&this.darlaAd){var s=this.collection.tumblelog.get("global_theme_params")||{};this.counter+=1,this.counter%=10;var r=new l({el:this.darlaAd,headerThemeParams:s,counter:this.counter});this.adViews.push(r),i.append(r.$el),r.render()}n.defer(n.bind(function(){this.make_tags_draggable(),this.stopListening(o,"drawer:notes:open")},e))}},onSearchResultsEnd:function(t){t&&(this.searchResultsEndView=t,this.$("[data-js-peepr-post-container]").append(this.searchResultsEndView.render().$el))},onCollectionReset:function(){this.searchResultsEndView&&this.searchResultsEndView.remove(),this.darlaAd&&(n.each(this.adViews,function(t){t.remove()}),this.adViews=[]),this.collection.length?this.collection.each(this.renderPost,this):(n.each(this.postViews,function(t){t.remove()}),this.postViews=[])},onCollectionRequest:function(){this.loader.set("loading",!0)},onCollectionSync:function(){this.loader.set("loading",!1)},onLightboxRequest:function(t){
var e=t.post,i=e.get("photos"),s=t.photoset_index||1,r=[];n.each(i,function(t){r.push({width:t.original_size.width,height:t.original_size.height,low_res:t.alt_sizes[0].url,high_res:t.original_size.url})}),o.trigger("lightbox-open-request",r,s)}});t.exports=h},function(t,e,i){"use strict";var n=i(226),s=n.extend({initialize:function(t){this.options=t||{},this.counter=this.options.counter},render:function(){if(window.DARLA){var t=this.$el.find(".ad-content").first().attr("data-yam-ad-id");window.DARLA.add({name:"LRECP",sp:"1197719223",ps:"LREC",ssl:!0}),window.DARLA.addPos({asz:"300x250",dest:"tgt-"+t,h:"250",id:t,pos:"LREC-"+this.counter,w:"300"}),window.DARLA.render.RenderMgr.nuke("LREC-"+this.counter),window.DARLA.event("LRECP",{ps:"LREC-"+this.counter});var e=this.options.headerThemeParams;e.title_color&&e.link_color&&(this.$(".section_header").css("color",e.title_color),this.$(".sponsored_badge .ring").css("color",e.title_color),this.$(".sponsored_badge .dollar_sign").css("color",e.title_color),this.$(".ad-link").css("color",e.link_color))}}});t.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<div data-js-peepr-post-container></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(136),r=i(226),a=i(129),l=i(665),c=r.extend({renderWithTemplate:n.noop,className:"header",initialize:function(t){this.options=t,this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.insertHeader)},insertHeader:function(){this.header=new window.Tumblr.IndashBlog.HeaderView({model:this.collection.tumblelog,el:this.$el,is_peepr:!0,show_share_controls:!0,show_follow_button:!0,show_user_controls:!0,show_dismiss_controls:!1,on_customize_open:n.bind(this.renderAllFontStyles,this)}).render(),this.setupHeader()},setupHeader:function(){var t=this.collection.tumblelog.get("global_theme_params").title_font;this.renderSingleFontStyle(t),this.$(".navigation").width(this.$el.width()||585),o.trigger("indashblog:ready-animation-start"),this.options.editing_appearance&&this.header.start_customizing(),this.options.searchTagTerm&&o.trigger("peeprsearch:change:term",{term:this.options.searchTagTerm})},renderAllFontStyles:function(){n.each(l,function(t){this.appendFontToHead(t)},this)},renderSingleFontStyle:function(t){var e=n.result(l,t);e&&this.appendFontToHead(e)},appendFontToHead:function(t){var e=a.get("Context/hosts/assets_host")||"",i="webfont_"+t.path;if(t.path&&!s("head #"+i).length){var o=e+"/fonts/"+t.path+"/stylesheet.css";o+=n.has(t,"_v")?"?v="+t._v:"",s("<link>",{id:i,rel:"stylesheet",type:"text/css",href:o}).appendTo(s("head"))}},remove:function(){this.header&&this.header.remove(),r.prototype.remove.call(this)}});t.exports=c},function(t,e,i){"use strict";var n=i(226),s=i(850),o=n.extend({template:s,setNewMessage:function(t){t.indexOf("\\n")>0&&(t=t.replace(/\\n/,"")),this.set("message",t);var e=this.collection.tumblelog.get("global_theme_params")||{};this.set("accentColor",e.title_color?e.title_color:""),this.render()},render:function(){return this.get("message")?n.prototype.render.call(this):this}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div style="color:'+__e(accentColor)+'" class="empty-state-message-box">'+__e(message)+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(226),s=i(852),o=i(277),r=i(3),a=i(8),l=i(136),c=n.extend({className:"survey",template:s,mixins:[o],events:{"click [data-js-feedback]":"_onClickFeedbackButton"},initialize:function(t){this.$el.hide(),this.options=t,this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.setupSurvey)},getTemplateData:function(){var t=this.collection.length?this.collection.first().get("survey")[0]:null,e=r.get(t,"submission_confirmation"),i=r.get(t,"title"),n=r.get(t,"options");return this.options=n,{title:i,submissionConfirmation:e,options:n}},setupSurvey:function(){var t=this;this.renderWithTemplate();var e=this.collection.tumblelog.get("global_theme_params").title_color,i=this.collection.tumblelog.get("global_theme_params").background_color,n=this.js$("feedback");n.each(function(n,s){t.$(s).css({"background-color":e,color:i})});var s=this.js$("text");s.each(function(i,n){t.$(n).css("color",e)}),this.$el.show()},_onClickFeedbackButton:function(t){var e=parseInt(t.currentTarget.attributes["data-index"].value,10),i=this.options[e].link.href,n=this.options[e].link.method,s=this.options[e].link.body_params;a.ajax({method:n,url:i,withFormKey:!0,data:s}).done(r.bind(this._callback,this)),l.trigger("Kraken:safeMode:SurveyOptionSelected",{loggingData:r.pick(s,["post_id","survey_id","user_response"])})},_callback:function(){this.js$("header-survey").hide(),this.js$("thanks-text").show()}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="survey-body"><div data-js-header-survey class="header-survey"><div data-js-text class="help-text"> ',_.isEmpty(title)||(__p+=" "+__e(title)+" "),__p+=' </div><div class="reply-text"> ',_.isEmpty(options)||(__p+=" ",_.each(options,function(t,e){__p+=' <button data-js-feedback data-index="'+__e(e)+'" class="tx-button">'+__e(t.text)+"</button> "}),__p+=" "),__p+=' </div></div><div data-js-text data-js-thanks-text class="thanks-text hide"> ',_.isEmpty(submissionConfirmation)||(__p+=" "+__e(submissionConfirmation)+" "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(192),o=i(136),r=i(347),a=i(190),l=i(854),c=a.extend({model:r,url:"/svc/indash_blog",blogNameOrId:"",_hasFetchedEverything:!1,initialize:function(t,e){this.loading=!1,this.tumblelog=new l,e=e||{},this.blogNameOrId=e.blogNameOrId,this.postId=e.postId,this.shouldBypassSafeMode=n.get(e,"shouldBypassSafeMode",!1),this.shouldBypassTagFiltering=n.get(e,"shouldBypassTagFiltering",!1),e.tumblelogData&&this.tumblelog.set(e.tumblelogData),e.url&&(this.url=e.url),this.listenTo(o,"indashblog:post:like",this.likePostbyId),this.bindBlogSearchEvents()},bindBlogSearchEvents:function(){this.listenTo(o,"indashblog:search:start",this.blogSearchStarted),this.listenTo(o,"indashblog:search:complete",this.blogSearchCompleted),this.listenTo(o,"indashblog:search:post-added",this.blogSearchPostAdded),this.listenTo(o,"indashblog:search:results-end",this.blogSearchResultsEnd),this.listenTo(o,"indashblog:search:clear",this.blogSearchClear)},blogSearchStarted:function(){this.searchMode=!0,this.reset(),this.trigger("request",this),this.loading=!0,o.trigger("indashblog:search:fetch-requested")},blogSearchPostAdded:function(t){this.add(t)},blogSearchCompleted:function(t){this.reset(t),this.trigger("sync",this),this.loading=!1},blogSearchResultsEnd:function(t){this._hasFetchedEverything=!0,this.loading=!1,this.trigger("sync",this)},blogSearchClear:function(){this.searchMode=!1,this.reset(),this.trigger("request",this),this.fetch()},fetchPostsAndBlog:function(t){var e=this,i=this.fetch(t),n=this.fetchBlog(t);s.all([i,n]).then(function(){o.trigger("indashblog:nextPageLoaded"),e.trigger("Kraken:peepr:postsAndBlogFetch"),e.trigger("peepr:postsAndBlogFetch")})},fetchBlog:function(t){return s(this.isTumblelogComplete()?null:this.tumblelog.fetch({tumblelog_name_or_id:this.blogNameOrId}))},fetch:function(t){if(!this.loading)return this.searchMode?(this.trigger("request",this),void o.trigger("indashblog:search:fetch-requested",t)):(t=t||{},t.blogNameOrId&&(this.blogNameOrId=t.blogNameOrId),t.data={tumblelog_name_or_id:this.blogNameOrId,post_id:this.postId||null,limit:this.postId?1:t.limit||10,offset:t.offset||0,should_bypass_safemode:this.shouldBypassSafeMode,should_bypass_tagfiltering:this.shouldBypassTagFiltering},this.loading=!0,a.prototype.fetch.call(this,t))},fetchMore:function(t){if(t=t||{},!this.hasFetchedEverything()&&!this.loading){if(this.searchMode)return this.trigger("request",this),void o.trigger("indashblog:search:fetch-requested",t);var e=this.models.length;return this.postId&&(e-=1,this.postId=null),t=n.extend({offset:e,remove:!1},t),this.fetch(t)}},parse:function(t,e){if(this.tumblelog.set("isOnline",n.get(t,"response.seconds_since_last_activity",-1)!==-1),(!t.response.posts.length||t.response.posts.length<e.data.limit)&&(this._hasFetchedEverything=!0),t.response.tumblelog&&this.tumblelog.set(t.response.tumblelog),t.response.peepr_ad&&o.trigger("indashblog:inject:ad",{ads:t.response.peepr_ad}),o.trigger("indashblog:nextPageLoaded"),n.has(t.response,"empty_tumblelog_message")||n.has(t.response,"post_not_found_message")){var i=t.response.empty_tumblelog_message||t.response.post_not_found_message;this.trigger("emptyState",i)}return t.response.tracking_html&&!n.isEmpty(t.response.tracking_html)&&o.trigger("component:TrackingPixels",{init:t.response.tracking_html}),this.loading=!1,t.response.posts},reset:function(){this._hasFetchedEverything=!1,a.prototype.reset.apply(this,arguments)},hasFetchedEverything:function(){return this._hasFetchedEverything},likePostbyId:function(t,e){var i=this.get(t);i&&(e=e||"mouse",i.like(e),o.trigger("peepr:like_update",i.get("tumblelog"),i.toJSON()),o.trigger("Kraken:peepr:like_update",i.get("tumblelog"),i.toJSON()))},isTumblelogComplete:function(){return this.tumblelog.has("global_theme_params")}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(191),o=i(136),r=i(185),a=i(665),l=r.extend({url:"/svc/indash_blog/header",initialize:function(t,e){e=e||{},this.listenTo(this,"change",this.onModelChange)},onModelChange:function(t){this.tumblelog=this.tumblelog||new s({name:this.get("name")}),this.tumblelog_name_or_id=this.get("name");var e=this.get("following"),i=this.tumblelog.has("following")&&e!==this.tumblelog.get("following");if(t.hasChanged("following")&&i){var n=e?"FOLLOW_SOURCE_PEEPR_HEADER":"UNFOLLOW_SOURCE_PEEPR_HEADER",r={can_subscribe:t.get("following"),is_blocking:t.get("is_blocking")};return t.get("following")||(r.is_subscribed=!1),this.set(r),this.tumblelog.save_following({following:e},{source:n}),o.trigger("peepr:follow_update",e),void o.trigger("Kraken:peepr:follow_update",e)}this.tumblelog.set(this.toJSON())},get_theme_param:function(t){var e=this.get("global_theme_params")||{};return e[t]},set_theme_params:function(t){var e=n.clone(this.get("global_theme_params"));this.set("global_theme_params",n.extend({},e,t))},parse:function(t,e){return n.get(t,"response",t)},fetch:function(t){return t=t||{},t.data={tumblelog_name_or_id:t.tumblelog_name_or_id||this.get("name")},r.prototype.fetch.call(this,t)},save:function(t,e){var i=n.extend({},this.defaults,t);return i.global_theme_params=n.omit(i.global_theme_params,["header_image_dimens","header_image_focused"]),e=e||{},e.contentType="application/json",e.data=JSON.stringify({tumblelog_name_or_id:this.get("name"),tumblelog:i}),e.withFormKey=!0,r.prototype.save.call(this,t,e)},getAvailableFonts:function(){return a}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(331),r=s.extend({renderWithTemplate:n.noop,className:"peepr-big-loader",initialize:function(t){this.options=n.defaults({},t),this.loader=new o,this.loader.set("loading",this.options.loading)},render:function(){this.$el.append(this.loader.render().$el)},toggle:function(t){this.options.loading=t,this.loader.set("loading",t),this.$el.toggleClass("hidden",!t)},show:function(){this.toggle(!0)},hide:function(){this.toggle(!1)}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(136),r=i(232),a=i(219),l=a.extend({mixins:[r],keycommands:{"keydown:j":"scrollToNextItem","keydown:k":"scrollToPrevItem","keydown:l":"like","keydown:r":"reblog","keydown:s":"share","keydown:period":"ttt","keydown:enter":"openBlog"},defaults:{selector:".post",scrollOffset:60,speed:200},initialize:function(t){this.options=n.defaults(t||{},this.defaults),this.listenTo(o,"post:form:show indashblog:keycommands:suspend",this.disableKeys),this.listenTo(o,"post:form:hide indashblog:keycommands:resume",this.enableKeys),this.listenTo(o,"keycommands:resume",this.onDashboardKeycommandsResume),this.listenTo(o,"drawer:close",this.resumeDashboardKeycommands)},onDashboardKeycommandsResume:function(){o.trigger("keycommands:suspend")},resumeDashboardKeycommands:function(){this.stopListening(o,"keycommands:resume"),o.trigger("keycommands:resume")},indexPageableItems:function(){var t={};this.currentPosition=this.getScrollOffset(),this.goToPosition=0,this.$(this.options.selector).each(function(e){var i=s(this);t[e]=Math.round(i.position().top)}),this.positions=t},getScrollOffset:function(){return this.$el.scrollTop()},like:function(){var t=this.findPostId();t&&o.trigger("indashblog:post:like",t,"keyboard")},reblog:function(){var t=this.findPostId();t&&o.trigger("indashblog:post:reblog",{id:t},"keyboard")},share:function(){var t=this.$(".post[data-post-id="+this.findPostId()+"] [data-subview=share]");n.isEmpty(t)||1!==t.length||t.get(0).click()},ttt:function(){this.goToPosition=1,this.$el.stop().animate({scrollTop:0},this.options.speed,n.bind(function(){this.animating=!1},this))},openBlog:function(){var t=this.$("[data-post-id="+this.findPostId()+"] .reblog_info.post_info_link");t.length&&o.trigger("peepr-open-request",{url:t.attr("href"),tumblelog_name:t.data("tumblelog-name")})},scrollToNextItem:function(){this.indexPageableItems(),this.nextPosition()},scrollToPrevItem:function(){this.indexPageableItems(),this.previousPosition()},nextPosition:function(){for(var t in this.positions){var e=this.positions[t];e>this.currentPosition+this.options.scrollOffset&&(e<this.goToPosition||!this.goToPosition)&&(this.goToPosition=e)}this.animate()},previousPosition:function(){for(var t in this.positions){var e=this.positions[t];e<this.currentPosition-this.options.scrollOffset&&e>this.goToPosition&&(this.goToPosition=e)}this.animate()},animate:function(){this.goToPosition&&!this.animating&&(this.animating=!0,this.$el.stop().animate({scrollTop:this.goToPosition-this.options.scrollOffset},this.options.speed,n.bind(function(){this.animating=!1},this)))},findPostId:function(){if(this.goToPosition-this.options.scrollOffset===this.getScrollOffset()){var t=n.invert(this.positions)[this.goToPosition];if(t){var e=this.$(this.options.selector).get(t);if(e)return s(e).data("post-id")}}return!1}});t.exports=l},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(226),a=i(858),l=r.extend({className:"flag--one-true-post",initialize:function(){var t=this;a(function(e){t.component=new e({container:t.el,variant:"peepr",url:"/svc/tumblelog/"+t.collection.tumblelog.get("name")+"/peepr",fetch:!1}),t.shouldRenderImmediately&&t.render(),t.component.fetch().then(function(){o.trigger("peepr:timeline:posts-fetched"),o.trigger("Kraken:peepr:timeline:posts-fetched")})}),this.listenTo(o,"DOMEventor:flatresize",this.setMinHeight)},render:s.noop,afterRender:function(){s.isEmpty(this.component)?this.shouldRenderImmediately=!0:(this.setMinHeight(),this.component.view.set("$scrollTarget",this.$el.closest(".peepr-body")),this.component.append())},setMinHeight:function(){if(this.rendered){var t=n(window).height();this.navHeight=s.isUndefined(this.navHeight)?[".peepr-body .navigation",".peepr-body .info_wrapper",".peepr-body .blogless-advertiser"].reduce(function(t,e){return t+n(e).outerHeight()},0):this.navHeight,this.$el.css("min-height",t-this.navHeight+"px")}}});t.exports=l},function(t,e,i){"use strict";var n=i(248),s=function(t){i.e(4,function(e){try{t(i(859))}catch(t){n(t,"timeline")}})};t.exports=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";function n(t){s||(s=r.get("Context/hosts"));var e=o.snakeCase(t);return o.endsWith(e,"_host")||(e+="_host"),o.get(s,e)}var s,o=i(3),r=i(129),a={get:o.memoize(n)};t.exports=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";function n(t){return"string"==typeof t||t&&"object"===("undefined"==typeof t?"undefined":l(t))&&"[object String]"===p.call(t)||!1}function s(){var t=new g;return t.cid=f,f+=1,m[t.cid]=t,t}function o(t,e){for(var i,n=v.length-1;n>=0;n--)v[n].message_callback(t,e);for(n=b.length-1;n>=0;n--)i=b[n],i&&i.shouldRespond&&i.shouldRespond(t,e)&&i.cb(t,e)}function r(t){if(t||(t={}),!(u&&u.stringify&&u.parse))throw"Must have JSON parsing and stringify";if(t.iframe&&(t.window=t.iframe.contentWindow,!t.origin)){var e=t.iframe.src,i=e.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);i&&(t.origin=i[1])}this.namespace=t.namespace?t.namespace+":":"",this.origin=t.origin||"*",this.responders={_method_callback_responder:y,_syn:d(this._syn,this)},this._on_connected=new _,this._unanswered_calls={},this.on_connection(d(this.enable_sending_post_message,this)),v.push(this),t.window&&this.setWindow(t.window)}function a(t,e,i){i||(i=this.origin),t.postMessage(e,i)}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=i(128),u=c("JSON",function(t){return t&&t.stringify}),h=[].slice,d=function(t,e){return function(){return t.apply(e,arguments)}},p=Object.prototype.toString,_=i(944),g=i(945),f=1,m={},v=[],b=[];!function(){var t=window.addEventListener?"addEventListener":"attachEvent",e=window[t],i="attachEvent"===t?"onmessage":"message";e(i,function(t){var e;if("string"==typeof t.data){try{t.data&&"{"===t.data[0]&&(e=u.parse(t.data))}catch(t){}e&&e.method&&o(t,e)}},!1)}();var y=function(t){if(t.cid_response&&t.cid_response in m){var e=m[t.cid_response];e.resolve.call(null,this,t.response),delete m[t.cid_response]}};r.prototype.setWindow=function(t){if(t){this.window=t;var e=this.call("_syn");e.then(d(function(t,e){"ack"===e&&this._is_connected()},this))}},r.on=function(t,e){var i;i="*"===t?function(){return!0}:"*"===t[t.length-1]?function(e,i){return 0===i.method.indexOf(t.substring(0,t.length-2))}:function(e,i){return i.method===t},b.push({shouldRespond:i,cb:e})},r.off=function(t){for(var e,i=b.length-1;i>=0;i--)if(b[i].cb===t){e=i;break}return!!(e&&e>-1)&&(b.splice(e,1),!0)},r.prototype.match_origin=function(t){return"*"===this.origin||this.origin===t},r.prototype.message_callback=function(t,e){var i;if((!this.window||t.source===this.window)&&this.match_origin(t.origin)){if(e.method&&e.method.slice(0,this.namespace.length)===this.namespace&&(i=e.method.slice(this.namespace.length,e.method.length)),e.args&&n(e.args))try{e.args=u.parse(e.args)}catch(t){return}this.call_responder(i,t,e)}},r.prototype.call_responder=function(t,e,i){var n,s;if(t){if(i.args||(i.args=[]),s=this.responders[t],!s)return this._unanswered_calls[t]||(this._unanswered_calls[t]=[]),void this._unanswered_calls[t].push(arguments);n=s.apply(e,i.args),i.cid&&"_method_callback_responder"!==t&&this.send_to_window(e.source,"_method_callback_responder",{cid_response:i.cid,response:n})}},r.prototype._syn=function(){return this._is_connected(),"ack"},r.prototype._is_connected=function(){this.connected||(this.connected=!0,this._on_connected.trigger(this))},r.prototype.on_connection=function(t){return this._on_connected.push.apply(this._on_connected,arguments),this},r.prototype.method=function t(e){var i=this,t=function(){var t=1<=arguments.length?h.call(arguments,0):[];return t.unshift(e),i.send.apply(i,t)};return t},r.prototype.call=function(){var t=1<=arguments.length?h.call(arguments,0):[];return this.window?(t.unshift(this.window),this.call_on_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.call_on_window=function(t,e){var i=3<=arguments.length?h.call(arguments,2):[],n=s();try{var o=u.stringify({method:this.namespace+e,args:i,cid:n.cid});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,o):this.send_post_message(t,o)}catch(t){n.reject(t)}return n.promise()},r.prototype.send=function(){var t=1<=arguments.length?h.call(arguments,0):[];return this.window?(t.unshift(this.window),this.send_to_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.send_to_window=function(t,e){var i=3<=arguments.length?h.call(arguments,2):[],n=u.stringify({method:this.namespace+e,args:i});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,n):this.send_post_message(t,n)},r.prototype.send_post_message=function(){this._delayed_sent_messages||(this._delayed_sent_messages=[]),this._delayed_sent_messages.push(arguments)},r.prototype.enable_sending_post_message=function(){if(this.send_post_message=a,this._delayed_sent_messages){for(var t=0;t<this._delayed_sent_messages.length;t+=1)a.apply(this,this._delayed_sent_messages[t]);delete this._delayed_sent_messages}},r.prototype.listening_to=function(t){return t in this.responders},r.prototype.listen_to=function(t,e,i){if(n(t)){if(t in this.responders)return void console.warn("already listening to this method, turn it off first");if(i&&(e=d(e,i)),this.responders[t]=e,this._unanswered_calls[t]){var s,o=this._unanswered_calls[t];delete this._unanswered_calls[t];for(var r=0;r<o.length;r+=1)s=o[r],this.call_responder.apply(this,s)}}else{var a=t;for(t in a)a.hasOwnProperty(t)&&this.listen_to(t,a[t],i)}},r.prototype.stop_listen_to=function(t){return"_method_callback_responder"===t?void console.warn("cannot disable the method callback responder"):void delete this.responders[t]},r.prototype.ensureChannelConnection=function(t){this.send_to_window(t,"_syn")},t.exports=r},function(t,e){"use strict";function i(){this.length=0}var n=[].slice,s=[].push;i.prototype={slice:n,indexOf:Array.prototype.indexOf},i.prototype.push=function(){if(this.triggered_with)for(var t=1<=arguments.length?n.call(arguments,0):[],e=0;e<t.length;e+=1)t[e].apply(null,this.triggered_with);return s.apply(this,arguments)},i.prototype.trigger=function(){var t=1<=arguments.length?n.call(arguments,0):[],e=this.length;this.triggered_with=t;for(var i=0;i<e;i+=1)this[i].apply(null,this.triggered_with);return this},t.exports=i},function(t,e,i){"use strict";function n(){this._on_resolved=new r,this._on_rejected=new r,this.then=o(this.then,this),this.fail=o(this.fail,this),this.resolve=o(this.resolve,this),this.reject=o(this.reject,this)}var s=[].slice,o=function(t,e){return function(){return t.apply(e,arguments)}},r=i(944);n.prototype.then=function(){return this._on_resolved.push.apply(this._on_resolved,arguments),this},n.prototype.success=n.prototype.then,n.prototype.fail=function(){return this._on_resolved.push.apply(this._on_rejected,arguments),this},n.prototype.resolve=function(){if(!this.resolved&&!this.rejected)return this._on_resolved.trigger.apply(this._on_resolved,arguments),this.resolved=!0,this},n.prototype.reject=function(){if(!this.resolved&&!this.rejected)return this._on_rejected.trigger.apply(this._on_rejected,arguments),this.rejected=!0,this},n.prototype.reject_timeout=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=t.shift();return setTimeout(o(function(){this.reject.apply(this,t)},this),e),this},n.prototype.promise=function(){function t(){var t=this;this.fail=function(){return e.fail.apply(e,arguments),t},this.then=function(){return e.then.apply(e,arguments),t},this.success=this.then,this.reject_timeout=function(){return e.reject_timeout.apply(e,arguments),t},this.cid=e.cid}var e=this;return new t},t.exports=n},,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(248),s=function(t){i.e(5,function(e){try{t(i(970))}catch(t){n(t,"post-activity")}})};t.exports=s},,,function(t,e,i){"use strict";function n(t){return(t||a())-a.realStartedAt}var s=i(3),o=i(129),r=s.once(function(){return o.get("Context/time")}),a=s.get(window,"Tumblr.getRealNow");if(!a){var l=window.performance,c=l&&l.timing&&l.timing.responseStart||Date.now();a=function(){return r()+(Date.now()-c)},a.startedAt=(new Date).getTime(),a.realStartedAt=a()}t.exports={getRealNow:a,startedAt:a.startedAt,realStartedAt:a.realStartedAt,getElapsed:n}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(3),s=i(7),o=i(214),r=i(182),a=i(191),l=i(136),c=i(1021),u=i(1022),h=i(753),d=i(723),p=i(1065),_=new h,g=o.extend({name:"MessagingSharePost",initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),this.options=t,this.user=r(),this.channels=this._getChannelsEnabledForMessagingAsCollection(),this.messagingShareLogger=new c},render:function(){return this.openPopover(this.options),this},openPopover:function(t){var e,i,s=n.get(t,"postId"),o=n.get(t,"blogUuid"),r=n.get(t,"isNsfw"),a=n.get(t,"favoritesNames",[]),l=n.get(t,"popoverContainer"),c=n.get(t,"pinnedTarget"),h=n.get(t,"externalNetworksData",{}),d=new p(n.extend({post_id:s,tumblelog_name:o},h));return n.isEmpty(s)?null:n.isEmpty(o)?null:n.isEmpty(c)?null:(e={viewOptions:n.bind(function(t){return{shareData:{blogUuid:o,postId:s,isNsfw:r},popoverContainer:t.el,favoritesCollection:_,additionalFavorites:this._getAdditionalFavoritesAsParticipants(a),channels:this.channels,externalNetworksDataModel:d,isExternalSharingEnabled:this.isExternalSharingEnabled(),senderBlogUuid:this.user.getCurrentMessagingChannelUuid()}},this),autoTeardown:!0,teardownOnEscape:!1,pinnedSide:"bottom",isFixedPosition:!1,pinnedTarget:c,popoverContainer:l},this.messagingShareLogger.logShareIntent(s,o),i=new u(e).render(),this._afterPopoverOpen(i),i)},isExternalSharingEnabled:function(){return n.get(this.data,"is_external_sharing_enabled",!1)},_afterPopoverOpen:function(t){var e=t.getView();this.listenToOnce(t,"close",function(){this._onPopoverClose(t)}),this.listenTo(e,"external:click",this._onPopoverExternalNetworkShareClick),this.listenTo(e,"external:success",this._onPopoverExternalNetworkShareSuccess),this.listenTo(e,"external:fail",this._onPopoverExternalNetworkShareFail),l.trigger("keycommands:suspend")},_onPopoverClose:function(t){this.stopListening(t),this.stopListening(t.getView()),l.trigger("keycommands:resume")},_onPopoverExternalNetworkShareClick:function(t){this.messagingShareLogger.logExternalNetworkClicked(t)},_onPopoverExternalNetworkShareSuccess:function(t){this.messagingShareLogger.logExternalNetworkShareSuccess(t)},_onPopoverExternalNetworkShareFail:function(t){this.messagingShareLogger.logExternalNetworkShareFail(t)},_getChannelsEnabledForMessagingAsCollection:function(){return new s.Collection(this.user.getChannelsEnabledForMessaging())},_getAdditionalFavoritesAsParticipants:function(t){return n.reduce(t,function(t,e){var i=new a({name:e});return i.get("uuid")&&i.get("can_receive_messages")&&t.push(new d(i.toJSON(),{parse:!0})),t},[],this)}});t.exports=g},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=o.extend({name:"MessagingShareLogger",defaults:{namespace:"postchrome-interactions",platform:"web",isDebugEnabled:!1},initialize:function(t){t=s.extend({},t),s.extend(this.attributes,s.pick(t,s.keys(this.defaults)))},logShareIntent:function(t,e){this._logIt("share:intent",{postId:t,postBlogUuid:e})},logExternalNetworkClicked:function(t){var e=t.getName(),i=t.getPostModel(),o=s.extend({},this._getCommonExternalShareData(t),{viewType:t.getType()});this._logIt("share:external",o),r.trigger("dashboard-share:"+e),t.isTypePopup()&&!s.isEmpty(i)&&n.ajax({url:"/svc/share/"+e,method:"POST",withFormKey:!0,data:{post_id:i.get("post_id"),tumblelog_name:i.get("tumblelog_name"),share_fallback:!0}})},logExternalNetworkShareSuccess:function(t){this._logIt("share:external:success",this._getCommonExternalShareData(t))},logExternalNetworkShareFail:function(t){this._logIt("share:external:fail",this._getCommonExternalShareData(t))},_logIt:function(t,e){e=e||{},s.extend(e,{platform:this.get("platform")}),r.trigger(this.get("namespace")+":"+t,{loggingData:e})},_getCommonExternalShareData:function(t){var e=t.getPostModel(),i={network:t.getName()};return s.isEmpty(e)||s.extend(i,{postId:e.get("post_id"),tumblelogName:e.get("tumblelog_name")}),i}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(283),a=i(1023),l=o.extend({className:"popover--messaging-share-post popover popover_menu popover_gradient",mixins:[r],initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"viewOptions"))},render:function(){var t=n.isFunction(this.viewOptions)?this.viewOptions(this):this.viewOptions;return this.$wrapper=s("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$pinned.addClass("active"),this.sharePostView&&(this.stopListening(this.sharePostView),this.sharePostView.remove()),this.sharePostView=new a(t),this.listenToOnce(this.sharePostView,"close",this.teardown),this.$wrapper.html(this.sharePostView.render().$el),this},teardown:function(){return this.sharePostView&&this.sharePostView.remove(),this.remove()},getView:function(){return this.sharePostView}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(136),r=i(277),a=i(232),l=i(226),c=i(496),u=i(1024),h=i(331),d=i(1025),p=i(1027),_=i(1031),g=i(1059),f=i(1061),m=i(1063),v=i(471),b=i(711),y=i(776),w=i(796),k=i(753),C=i(1064),x=l.extend({className:"messaging-share-post",template:u,defaults:{senderBlog:null,isSending:!1,isLoading:!1,isLoadingFavorites:!1,isDisabled:!1,isEmpty:!1,isShowFavorites:!0,isShowMessage:!1,isShowExternalNetworksRow:!0,isExternalSharingEnabled:!0,isShowingExternalNetworkSubview:!1,closeAfterExternalNetworkShareMs:3e3,showLoadingAfterMs:250,numFavorites:10,defaultPlaceholder:null,additionalFavoritesPlaceholder:null,sendingPlaceholder:null,currentPlaceholder:null,focusIndex:0,isResultContainerFocused:!1,isExternalNetworksContainerFocused:!1,loadingClass:"is-loading",baseLoggingContext:"post-chrome",tabbingView:null},mixins:[r,a],keycommands:{"keydown:up":"_onKeyPressUp","keydown:down":"_onKeyPressDown","keydown:tab":"_onKeyPressTab","keydown:shift+tab":"_onKeyPressShiftTab","keydown:escape":"_onKeyPressEscape"},subviews:{searchView:{constructor:d,options:function(t){return{collection:t.collection,selectedRecipientModel:t.selectedRecipientModel,keyboardManager:t.keyboardManager,keyboardNamespace:"messagingshare:search"}}},resultsView:{constructor:p,options:function(t){return{collection:t.collection,selectedRecipientModel:t.selectedRecipientModel,keyboardManager:t.keyboardManager,keyboardNamespace:"messagingshare:results"}}},messageView:{constructor:w,options:function(t){return{isAutoValidationEnabled:!1,className:"messaging-share-post-message",placeholder:t.get("currentPlaceholder"),keyboardManager:t.keyboardManager,keyboardNamespace:"messagingshare:message",buttonSubmittedClass:"submitted--send-a-post",animationSpeed:250,pluginsArray:t.pluginsArray,isSendAPost:!0}}},externalNetworksView:{constructor:_,options:function(t){return{isExternalSharingEnabled:t.get("isExternalSharingEnabled"),keyboardManager:t.keyboardManager,keyboardNamespace:"messagingshare:external",externalNetworksDataModel:t.externalNetworksDataModel}}},errorView:{constructor:f},favoritesLoaderView:{constructor:h,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(t){var e;t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"favoritesCollection","shareData","channels","popoverContainer","additionalFavorites","externalNetworksDataModel")),this.collection=new k,e=this.channels.findWhere({uuid:n.get(t,"senderBlogUuid")})||this.channels.first(),
this.keyboardManager=new v({allowMultipleActiveViews:!0}),n.isEmpty(this.get("defaultPlaceholder"))&&this.set("defaultPlaceholder",s("Say something if you like...")),n.isEmpty(this.get("additionalFavoritesPlaceholder"))&&this.set("additionalFavoritesPlaceholder",s("Discuss this post if you like...")),n.isEmpty(this.get("sendingPlaceholder"))&&this.set("sendingPlaceholder",s("Sending...")),this.set({currentPlaceholder:this.get("defaultPlaceholder"),senderBlog:e}),this.additionalFavoritesIds=n.pluck(n.invoke(this.additionalFavorites,"toJSON"),"uuid"),this.channelIds=this.channels.pluck("uuid"),this.selectedRecipientModel=new C,this.blogSelectorPlugin=new m({collection:this.channels,currentTumblelog:e,popoverOptions:{popoverContainer:this.popoverContainer}}),this.pluginsArray=[this.blogSelectorPlugin],this.disableKeys()},afterRenderSubviews:function(){this.loader=new c({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this._onSearchInputDebounced=n.bind(n.debounce(function(){this._onSearchInput(this.searchView.getQuery())},250),this),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isSending",this._onChangeIsSending),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:isLoadingFavorites",this._onChangeisLoadingFavorites),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isShowExternalNetworksRow",this._onChangeIsShowExternalNetworksRow),this.listenTo(this,"change:isShowMessage",this._onChangeIsShowMessage),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.blogSelectorPlugin.getBlogSelector(),"change:currentTumblelog",this._onBlogSelectorChange),this.listenTo(this.messageView,"submit:animated",this._onMessageSubmit),this.listenTo(this.searchView,"search",this._onSearchInputDebounced),this.listenTo(this.searchView,"clear",this._onSearchClear),this.listenTo(this.searchView,"focus",this._onViewFocusChange),this.listenTo(this.searchView,"submit",this._onSearchSubmit),this.listenTo(this.messageView,"focus",this._onViewFocusChange),this.listenTo(this.resultsView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"share:subview:show",this._onExternalNetworkShowSubview),this.listenTo(this.externalNetworksView,"share:success",this._onExternalNetworkShareSuccess),this.listenTo(this.externalNetworksView,"share:fail",this._onExternalNetworkShareFail),this.listenTo(this.externalNetworksView,"share:click",this._onExternalNetworkClick),this.listenTo(this.collection,"sync",this._onCollectionSync),this._setViewStates(),this._fetchFavorites(),this._setCollectionState(),this.messageTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.messageView.el}),this.searchTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.searchView.el}),n.defer(n.bind(function(){this.rendered&&this.searchView.focus()},this)),this.keyboardManager.add("messagingshare:main",this),this.focusKeys()},beforeRemove:function(){this.keyboardManager.remove("messagingshare")},fetchByQuery:function(t){n.isEmpty(t)?this.set({isEmpty:!1,isShowFavorites:!0,isLoading:!1}):(this.set("isLoading",!0),this.collection.fetchByQuery(t,this.get("senderBlog").get("uuid")).always(n.bind(function(){this.rendered&&this.set("isLoading",!1)},this)))},getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},clearSelectedRecipient:function(){this.selectedRecipientModel.set("participant",null)},sendPost:function(t,e){var i,s,r,a=this.shareData,l=n.get(this.shareData,"postId"),c=n.get(this.shareData,"blogUuid"),u=n.get(this.shareData,"isNsfw"),h=[],d=!n.isEmpty(t),p=this._getLoggingContext();this.get("isDisabled")||this.get("isSending")||n.isEmpty(a)||(s=b.createPostMessage(l,c,{context:p,creationUserAction:e,is_nsfw:u}),h.push(s),d&&(r=b.createTextMessage(t,{context:p,creationUserAction:e}),h.push(r)),i=this._createConversation(),n.isEmpty(i)||(this.set("isSending",!0),i.appendToQueue(h),o.trigger("messaging:conversation:open:model",i,p),this.close()))},close:function(){this.trigger("close")},_createConversation:function(){var t=this.get("senderBlog"),e=this.getSelectedRecipient();if(n.isEmpty(t)||n.isEmpty(e))return null;var i=t.toJSON(),s=e.toJSON();return new b({participantUuid:t.get("uuid"),participants:[i,s]})},_onCollectionSync:function(t){var e;return!this.rendered||n.isEmpty(this.searchView.getQuery())?void this._setCollectionState():(this.clearSelectedRecipient(),e=0===this.collection.length,e&&this.errorView.setTitle(this.collection.getNoResultsFoundMessage()),this.set({isShowFavorites:!1,isEmpty:e}),void this._resetResultsScroll())},_resetResultsScroll:function(){this.resultsView.$el.scrollLeft(0)},_resetExternalNetworksScroll:function(){this.externalNetworksView.$el.scrollLeft(0)},_applyTheme:function(t){this.messageTheme.setTheme(t),this.searchTheme.setTheme(t)},_setViewStates:function(){var t=this.get("isShowMessage"),e=this.get("isEmpty"),i=this.get("isLoadingFavorites"),n=this.get("isShowExternalNetworksRow");this.js$("submission").toggleClass("show-submission",t),this.js$("external").toggle(n),this.errorView.$el.toggle(e),this.resultsView.toggle(!e),this.favoritesLoaderView.set("loading",i),this._setFocusViews()},_onSearchInput:function(t){this.rendered&&this.fetchByQuery(t)},_onSearchClear:function(){this.rendered&&(this.fetchByQuery(null),this.clearSelectedRecipient())},_onSearchSubmit:function(){this.get("isShowFavorites")||1===this.collection.length&&this.selectedRecipientModel.set("participant",this.collection.first())},_setPlaceholderState:function(){var t=this.getSelectedRecipient(),e=this.get("isSending"),i=!n.isEmpty(t)&&n.contains(this.additionalFavoritesIds,t.get("uuid"));return e?void this.set("currentPlaceholder",this.get("sendingPlaceholder")):void this.set("currentPlaceholder",i?this.get("additionalFavoritesPlaceholder"):this.get("defaultPlaceholder"))},_setButtonState:function(){var t=this.get("isSending"),e=this.get("isDisabled"),i=t||e;this.messageView.set("isDisabled",i)},_setDisabledState:function(){var t=this.getSelectedRecipient(),e=this.get("senderBlog"),i=!n.isEmpty(t)&&t.get("uuid")===e.get("uuid");this.set("isDisabled",i)},_setCollectionState:function(){this.get("isShowFavorites")&&this.collection.reset(this.favoritesCollection.toJSON())},_setFocusViews:function(){var t=[this.searchView],e=[];this.get("isEmpty")||this.get("isLoadingFavorites")||(t.push(this.resultsView),e.push(this.resultsView)),this.get("isShowExternalNetworksRow")&&(t.push(this.externalNetworksView),e.push(this.externalNetworksView)),this.get("isShowMessage")&&t.push(this.messageView),this._focusViews=t,this._tabbableViews=e},_getLoggingContext:function(){var t,e,i=this.get("baseLoggingContext"),s=this.getSelectedRecipient();return n.isEmpty(s)?i:(t=n.contains(this.additionalFavoritesIds,s.get("uuid")),e=t?"trail":this.get("isShowFavorites")?"favorites":"search",i+":"+e)},_onChangeIsSending:function(t,e){this._setButtonState(),this._setPlaceholderState()},_onChangeIsDisabled:function(t,e){this._setButtonState()},_onChangeSelectedRecipient:function(t,e){var i=!n.isEmpty(e);i?(this.messageView.focus(),this._applyTheme(e.get("theme"))):this.searchView.focus(),this.set("isShowMessage",i),this._setViewStates(),this._setDisabledState(),this._setPlaceholderState()},_onChangeIsEmpty:function(){this._setViewStates()},_onChangeIsShowFavorites:function(){this._setCollectionState(),this._resetResultsScroll()},_onChangeIsShowExternalNetworksRow:function(){this._setViewStates(),this._resetExternalNetworksScroll()},_onChangeIsShowMessage:function(t,e){this.set("isShowExternalNetworksRow",!e)},_onBlogSelectorChange:function(t,e){this.set("senderBlog",e),this.messageView.focus(),this._setDisabledState()},_onChangeIsLoading:function(t,e){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),e?void(this._loaderTimeout=setTimeout(n.bind(function(){this.rendered&&(this.loader.set("loading",!0),this.$el.addClass(this.get("loadingClass")))},this),this.get("showLoadingAfterMs"))):(this.$el.removeClass(this.get("loadingClass")),void this.loader.set("loading",!1))},_onChangeisLoadingFavorites:function(){this._setViewStates()},_onMessageSubmit:function(t,e){this.sendPost(t,e)},_onChangeCurrentPlaceholder:function(t,e){this.messageView.setPlaceholder(e)},_addAdditionalFavorites:function(){!n.isEmpty(this.additionalFavorites)&&n.isArray(this.additionalFavorites)&&n.each(this.additionalFavorites.reverse(),function(t){var e=t.get("uuid"),i=this.favoritesCollection.get(e);n.contains(this.channelIds,e)||(n.isEmpty(i)?this.favoritesCollection.unshift(t):(this.favoritesCollection.remove(e),this.favoritesCollection.unshift(i)))},this)},_fetchFavorites:function(){var t=this;this.set("isLoadingFavorites",!0),this.favoritesCollection.fetchFavorites(this.get("numFavorites"),null,!0,!1,"post").always(function(){t.rendered&&(t._addAdditionalFavorites(),t._setCollectionState(),t.set("isLoadingFavorites",!1))})},_getFocusViews:function(){return this._focusViews},_moveFocusUp:function(){this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var t=this._getFocusViews()||[];this.set("focusIndex",Math.min(t.length-1,this.get("focusIndex")+1))},_onViewFocusChange:function(t){var e=this._getFocusViews(),i=n.indexOf(e,t);this.set("tabbingView",n.contains(this._tabbableViews,t)?t:null),this.set("focusIndex",i,{silent:!0})},_onChangeFocusIndex:function(t,e){var i=n.get(this._getFocusViews(),e);this.set("tabbingView",n.contains(this._tabbableViews,i)?i:null),n.result(i,"focus")},_onKeyPressTab:function(t){var e=this.get("tabbingView");t.preventDefault(),n.isEmpty(e)||e.isLastFocused()?this._moveFocusDown():e.focusNext()},_onKeyPressShiftTab:function(t){var e=this.get("tabbingView");t.preventDefault(),n.isEmpty(e)||e.isFirstFocused()?this._moveFocusUp():e.focusPrevious()},_onKeyPressEscape:function(t){this.close(),t.preventDefault()},_onKeyPressUp:function(t){t.preventDefault(),this._moveFocusUp()},_onKeyPressDown:function(t){t.preventDefault(),this._moveFocusDown()},_onExternalNetworkShowSubview:function(t){var e="messagingshare:externalnetwork",i=new g({externalNetworkSubview:t});i.render(),this.disableKeys(),this.keyboardManager.add(e,i),this.listenToOnce(i,"goBack",function(){this.stopListening(t),this.keyboardManager.remove(e,i),this.enableKeys(),i.remove(),this.set("isShowingExternalNetworkSubview",!1),this.searchView.focus()}),this.listenToOnce(i,"close",function(){this.close()}),this.js$("external-network-subview-wrapper").html(i.$el),this.set("isShowingExternalNetworkSubview",!0)},_onExternalNetworkShareSuccess:function(t){setTimeout(n.bind(function(){this.rendered&&this.close()},this),this.get("closeAfterExternalNetworkShareMs")),this.trigger("external:success",t)},_onExternalNetworkShareFail:function(t){this.trigger("external:fail",t)},_onExternalNetworkClick:function(t){this.trigger("external:click",t)}});t.exports=x},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchView"></div><div class="messaging-share-post-main"><div class="messaging-share-post-results-wrapper"><div data-subview="errorView"></div><div data-subview="resultsView"></div><div data-subview="favoritesLoaderView"></div></div><div data-subview="loader"></div></div><div data-js-external class="messaging-share-post-external-networks-wrapper"><div data-subview="externalNetworksView"></div></div><div data-js-submission class="messaging-share-post-submission"><div data-subview="messageView"></div></div><div data-js-external-network-subview-wrapper></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(277),a=i(232),l=i(1026),c=o.extend({className:"messaging-share-post-search",template:l,mixins:[r,a],events:{"input [data-js-input]":"_onInputChange","focus [data-js-input]":"_onInputFocus","blur [data-js-input]":"_onInputBlur",click:"_onContainerClick"},defaults:{hasSelectedBlogNameClass:"has-selected-blog",isFocused:!1,currentQuery:""},keycommands:{"keydown:backspace":"_onKeyPressBackspace","keydown:enter":"_onKeyPressEnter"},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"selectedRecipientModel","keyboardManager","keyboardNamespace")),this.disableKeys()},afterRender:function(){this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:currentQuery",this._onChangeCurrentQuery),this.js$("selected-blog").hide()},focus:function(){this.js$("input").focus()},getQuery:function(){return this.get("currentQuery")},_clearInput:function(){this._setInputValue()},_setInputValue:function(t){t=t||"",this.js$("input").val(t),this._prevVal=t},_getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},_hasSelectedRecipient:function(){return!n.isEmpty(this._getSelectedRecipient())},_onChangeSelectedRecipient:function(t,e){this._setBlogPillRecipient(e),n.isEmpty(e)?this._setInputValue(this.get("currentQuery")):this._clearInput()},_setBlogPillRecipient:function(t){var e=!n.isEmpty(t);this.js$("selected-blog").text(e?t.get("name"):"").toggle(e),this.$el.toggleClass(this.get("hasSelectedBlogNameClass"),e)},_setCurrentQuery:function(t,e){e&&this.unset("currentQuery",{silent:!0}),this.set("currentQuery",t)},_onInputChange:function(t){var e,i,n=s(t.currentTarget).val();this._prevVal!==n&&(e=this.get("currentQuery"),i=this._hasSelectedRecipient()&&n===e,this._setCurrentQuery(n,i),this._prevVal=n)},_onKeyPressBackspace:function(t){this._hasSelectedRecipient()&&(t.preventDefault(),this._setCurrentQuery("",!0))},_onKeyPressEnter:function(t){t.preventDefault(),this.trigger("submit",this)},_onContainerClick:function(){this.focus()},_onInputFocus:function(){this.set("isFocused",!0)},_onInputBlur:function(){this.set("isFocused",!1)},_onChangeIsFocused:function(t,e){e?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onChangeCurrentQuery:function(t,e){e=e||"",this._hasSelectedRecipient()&&this._setBlogPillRecipient(null),n.isEmpty(e)?this.trigger("clear"):this.trigger("search",e)}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="search-input-wrapper" data-js-search-container><div class="search-input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="search-input" placeholder="'+__e(__("Message to..."))+'" data-js-input> <button class="selected-blog" data-js-selected-blog data-js-theme-accent-color-as-background></button></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(734),r=i(232),a=i(492),l=i(478),c=i(1028),u=i(1030),h=s.extend({className:"messaging-share-post-results",template:u,defaults:{isFocused:!1,focusedView:null,selectedView:null},mixins:[r,o,l],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{resultView:{constructor:c,options:function(t){return{onSelect:n.bind(t._onSubviewSelect,t),onFocus:n.bind(n.partial(t._setIsFocusedDebounced,!0),t),onBlur:n.bind(n.partial(t._setIsFocusedDebounced,!1),t)}},collection:function(t){return t.collection}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"collection","selectedRecipientModel","keyboardNamespace","keyboardManager")),this.keyboardViewName="resultView",this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipientModel),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),this.scrollbar=new a(this.$el),this.updateScrollbar()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(t){this.$el.toggle(t),t||this.resetFocus()},focus:function(){var t=this.get("selectedView"),e=!n.isEmpty(t);e&&this.setSelectedIndex(this.keyboardViewName,n.indexOf(this.resultView,t)),e?this.set("focusedView",this.getSelectedView(this.keyboardViewName)):this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){this.set("focusedView",this.selectNext(this.keyboardViewName))},focusPrevious:function(){this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(t){this.rendered&&this.scrollbar&&n.defer(n.bind(this.scrollbar.update,this.scrollbar))},beforeRemove:function(){this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_onKeyPressLeft:function(t){t.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(t){t.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(t){t.preventDefault()},_onChangeFocusedView:function(t,e){var i=this.previous("focusedView");i&&i.setFocused(!1),e&&e.setFocused(!0)},_onChangeSelectedView:function(t,e){var i=this.previous("selectedView");i&&i.setSelected(!1),e&&e.setSelected(!0)},_onSubviewSelect:function(t,e){var i=t!==this.get("selectedView")?t:null,s=n.isEmpty(i)?null:e;this.selectedRecipientModel.set("participant",s),this.set("selectedView",i)},_setIsFocused:function(t){this.rendered&&this.set("isFocused",t)},_onChangeIsFocused:function(t,e){e?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onChangeSelectedRecipientModel:function(t,e){var i;return n.isEmpty(e)?void this.set("selectedView",null):(i=n.find(this.resultView,function(t){return t.model.get("uuid")===e.get("uuid")}),void this.set("selectedView",i))}});t.exports=h},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1029),r=i(776),a=s.extend({className:"messaging-share-post-result",tagName:"a",attributes:{href:"#",tabIndex:1},events:{click:"_onSelect",focus:"_onFocus",blur:"_onBlur"},defaults:{isSelected:!1,isFocused:!1,selectedClass:"is-selected",focusedClass:"is-focused"},template:o,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"onSelect","onFocus","onBlur"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.conversationTheme=new r({theme:this.model.get("theme"),el:this.el}).render()},getTemplateData:function(){return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),avatarShape:this.model.getAvatarShape()}},setSelected:function(t){this.rendered&&this.set("isSelected",t)},setFocused:function(t){this.rendered&&this.set("isFocused",t)},_onSelect:function(t){t.preventDefault(),n.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onFocus:function(t){t.preventDefault(),n.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(t){t.preventDefault(),n.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onChangeIsSelected:function(t,e){this.$el.toggleClass(this.get("selectedClass"),e)},_onChangeIsFocused:function(t,e){this.$el.toggleClass(this.get("focusedClass"),e),e&&this.$el.focus()}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="container" data-js-theme-accent-color-on-grey><div class="avatar" data-js-theme-avatar-shape-class><img src="'+__e(avatarUrl)+'" alt="'+__e(name)+'" title="'+__e(name)+'"></div><div class="name">'+__e(name)+'</div><div class="title">',__p+=_.isEmpty(title)?"&nbsp;":__e(title),__p+="</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="resultView[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(734),r=i(232),a=i(492),l=i(347),c=i(331),u=i(478),h=i(1032),d=i(1034),p=i(1036),_=i(1058),g=s.extend({className:"messaging-share-post-external-networks",template:_,defaults:{isLoading:!1,isFocused:!1,focusedView:null,isExternalSharingEnabled:!0},mixins:[r,o,u],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{networkView:{constructor:d,options:function(t){return{onFocus:n.bind(n.partial(t._setIsFocusedDebounced,!0),t),onBlur:n.bind(n.partial(t._setIsFocusedDebounced,!1),t),onShowSubview:n.bind(t._onShowSubview,t),onShareSuccess:n.bind(t._onShareSuccess,t),onShareFail:n.bind(t._onShareFail,t),onShareClick:n.bind(t._onShareClick,t)}},collection:function(t){return t.collection}},networksLoaderView:{constructor:c,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"keyboardNamespace","keyboardManager","externalNetworksDataModel")),this._setIsFocusedDebounced=n.debounce(n.bind(this._setIsFocused,this),0),this.keyboardViewName="networkView",this.collection=new h,this.disableKeys()},afterRenderSubviews:function(){if(this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this.externalNetworksDataModel,"request",this._externalNetworksDataModelRequest),this.listenTo(this.externalNetworksDataModel,"sync",this._externalNetworksDataModelSync),this.scrollbar=new a(this.$el),this.updateScrollbar(!0),this._onChangeIsLoading(this,this.get("isLoading")),this.externalNetworksDataModel.isPopulated())this.updateComponents();else{if(!this.externalNetworksDataModel.isValid())return;this.externalNetworksDataModel.fetch()}},beforeRemove:function(){this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(t){this.$el.toggle(t),t||this.resetFocus()},focus:function(){this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){this.set("focusedView",this.selectNext(this.keyboardViewName))},focusPrevious:function(){this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(t){this.rendered&&this.scrollbar&&n.defer(n.bind(this.scrollbar.update,this.scrollbar))},updateComponents:function(){this.collection.reset(n.map(this._getExternalNetworks(),function(t){return{component:t}}))},_setIsFocused:function(t){this.rendered&&this.set("isFocused",t)},_getExternalNetworks:function(){var t=this.get("isExternalSharingEnabled"),e=[{Constructor:p.Permalink,options:this._getPermalinkOptions,isExternal:!1},{Constructor:p.Embed,options:this._getEmbedOptions,isExternal:!1},{Constructor:p.Email,options:this._getEmailOptions,isExternal:!0},{Constructor:p.Flag,options:this._getFlagOptions,isExternal:!1},{Constructor:p.Facebook,options:this._getFacebookOptions,isExternal:!0},{Constructor:p.Twitter,options:this._getTwitterOptions,isExternal:!0},{Constructor:p.Pinterest,options:this._getPinterestOptions,isIncluded:this._isShowPinterest,isExternal:!0},{Constructor:p.Reddit,options:this._getRedditOptions,isExternal:!0}];return n.reduce(e,n.bind(function(e,i){var s;return!t&&i.isExternal?e:n.isFunction(i.isIncluded)&&!i.isIncluded.call(this)?e:(s=new i.Constructor(this._getBaseAndNetworkOptions(i.options.call(this))),e.push(s),e)},this),[])},_getPermalinkOptions:function(){return{}},_getEmbedOptions:function(){return{}},_getEmailOptions:function(){return{}},_getTwitterOptions:function(){var t=this.externalNetworksDataModel.get("twitter_username");return{isPopup:n.isEmpty(t),username:t}},_getFacebookOptions:function(){return{isPopup:!0}},_getPinterestOptions:function(){var t=this.externalNetworksDataModel.get("pinterest_share_window"),e=n.get(t,"url"),i=n.get(t,"dimensions");return{popupOptions:i,popupUrl:e}},_isShowPinterest:function(){return this.externalNetworksDataModel.get("show_pinterest")},_getRedditOptions:function(){return{}},_getFlagOptions:function(){return{}},_getBaseExternalNetworkOptions:function(){var t=this.externalNetworksDataModel.toJSON(),e=n.extend({},t,{id:n.get(t,"post_id")}),i=new l(e);return{postModel:i}},_getBaseAndNetworkOptions:function(t){return this._baseExternalNetworkOptions||(this._baseExternalNetworkOptions=this._getBaseExternalNetworkOptions()),n.extend({},this._baseExternalNetworkOptions,t)},_onKeyPressLeft:function(t){t.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(t){t.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(t){t.preventDefault()},_onChangeFocusedView:function(t,e){var i=this.previous("focusedView");i&&i.setFocused(!1),e&&e.setFocused(!0)},_onChangeIsFocused:function(t,e){e?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onShowSubview:function(t){this.trigger("share:subview:show",t)},_onShareSuccess:function(t){this.trigger("share:success",t)},_onShareFail:function(t){this.trigger("share:fail",t)},_onShareClick:function(t){this.trigger("share:click",t)},_onChangeIsLoading:function(t,e){this.networksLoaderView.set("loading",e)},_externalNetworksDataModelRequest:function(t){this.set("isLoading",!0)},_externalNetworksDataModelSync:function(t){this.set("isLoading",!1),this.updateComponents()}});t.exports=g},function(t,e,i){"use strict";var n=i(190),s=i(1033),o=n.extend({model:s});t.exports=o},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{component:null}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1035),r=s.extend({className:"messaging-share-post-external-network",tagName:"a",attributes:{href:"#",tabIndex:1},events:{focus:"_onFocus",blur:"_onBlur",click:"_onClick"},defaults:{isFocused:!1,focusedClass:"is-focused"},template:o,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"onFocus","onBlur","onShareSuccess","onShareFail","onShareClick","onShowSubview")),this.component=this.model.get("component")},getTemplateData:function(){return{label:this.component.getLabel()}},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this.component,"share:fail",this._onShareFail),this.listenToOnce(this.component,"share:success",this._onShareSuccess),this._setLinkClass(),this._setLinkHref()},remove:function(){this.stopListening(this.component)},setFocused:function(t){this.rendered&&this.set("isFocused",t)},_setLinkHref:function(){var t=this.component.getButtonHref();n.isEmpty(t)||this.$el.attr({href:t,target:"_blank"})},_setLinkClass:function(){this.$el.addClass("network--"+this.component.getName())},_onFocus:function(t){t.preventDefault(),n.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(t){t.preventDefault(),n.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onClick:function(t){this.onShareClick&&this.onShareClick(this.component),this.component.isTypeHref()||(t.preventDefault(),this.component.isTypeCallback()?this.component.onClickHandler(t):this.component.isTypePopup()?this._openShareWindow():this.component.isTypeSubview()&&this.component.getSubviewInstance().then(n.bind(function(t){n.isFunction(this.onShowSubview)&&this.onShowSubview(t)},this)).catch(n.bind(function(t){},this)))},_openShareWindow:function(){var t=this.component.getPopupUrl(),e=this.component.getPopupOptions(),i=this.component.getName();n.isEmpty(t)||window.open(t,i+"-share-dialog",e)},_onChangeIsFocused:function(t,e){this.$el.toggleClass(this.get("focusedClass"),e),e&&this.$el.focus()},_onShareSuccess:function(){n.isFunction(this.onShareSuccess)&&this.onShareSuccess(this.component)},_onShareFail:function(){n.isFunction(this.onShareFail)&&this.onShareFail(this.component)}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(label);return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(1037),s=i(1044),o=i(1045),r=i(1046),a=i(1047),l=i(1048),c=i(1051),u=i(1055);t.exports={Facebook:n,Reddit:s,Pinterest:o,Permalink:r,Embed:l,Flag:a,Email:c,Twitter:u}},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(130),r=i(1038),a=i(1040),l=r.extend({defaults:{isPopup:!0,username:null,getUsernameUrl:"/svc/facebook_status"},getName:function(){return"facebook"},getLabel:function(){return o("Facebook")},getType:function(){return this.get("isPopup")?r.TYPE_POPUP:r.TYPE_SUBVIEW},getPopupOptions:function(){return"width=626,height=436"},getPopupUrl:function(){var t=this.getPostTinyUrl()||this.getPostUrl();return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t)},getSubviewConstructor:function(){return a},getSubviewOptions:function(){return{username:this.get("username")}},afterSubviewCreated:function(t){s.isEmpty(this.get("username"))&&this._getUsername().then(s.bind(function(e){
this.set("username",e),t.set("username",e)},this))},_getUsername:function(){return n.ajax({url:this.get("getUsernameUrl"),method:"POST",withFormKey:!0})}});t.exports=l},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(192),r=i(214),a=i(1039),l=r.extend({name:"BaseExternalNetwork",initialize:function(t){s.extend(this.attributes,s.pick(t,s.keys(this.defaults))),s.extend(this,s.pick(t,"postModel"))},getName:function(){return null},getLabel:function(){return null},getType:function(){return l.TYPE_POPUP},getPopupUrl:function(){return null},getPopupOptions:function(){return null},getSubviewConstructor:function(){return null},getSubviewOptions:function(){return null},getButtonHref:function(){return null},onClickHandler:function(t){},getPostModel:function(){return this.postModel},getPostUrl:function(){return this.postModel.get("post_url")},getPostTinyUrl:function(){return this.postModel.get("post_tiny_url")},getShareUrl:function(){return"/svc/share/"+this.getName()},isTypePopup:function(){return this.isTypeEqual(l.TYPE_POPUP)},isTypeSubview:function(){return this.isTypeEqual(l.TYPE_SUBVIEW)},isTypeCallback:function(){return this.isTypeEqual(l.TYPE_CALLBACK)},isTypeHref:function(){return this.isTypeEqual(l.TYPE_HREF)},isTypeEqual:function(t){return this.getType()===t},createSubviewInstance:function(t){var e,i,n;return e=this.getSubviewConstructor(),s.isEmpty(e)?null:e.prototype instanceof a?(i=s.extend({},this.getSubviewOptions(),t),n=new e(i),this.listenToOnce(n,"remove",function(t){this.stopListening(t),this.afterSubviewRemoved(t)}),this.listenTo(n,"share",function(t,e){this.onSubviewShare(t,e)}),this.afterSubviewCreated(n),n):null},getSubviewInstance:function(t){var e=o.defer(),i=this.createSubviewInstance(t);return s.isEmpty(i)?e.reject("Could not create external network subview (subview constructor must extend ExternalNetworkEmbedSubview)."):e.resolve(i),e.promise},getShareRequestDataFromSubviewData:function(t){return t},sendShareRequest:function(t){return n.ajax({url:this.getShareUrl(),method:"POST",withFormKey:!0,data:t})},onSubviewShare:function(t,e){var i=this.getShareRequestDataFromSubviewData(t),n=s.extend({},this._getBaseShareRequestData(),i);return this._beforeShare(e,t),this.sendShareRequest(n).then(s.bind(function(){this._afterShareSuccess(e,t),this._afterShare(e,t)},this)).fail(s.bind(function(){this._afterShareFail(e,t),this._afterShare(e,t)},this))},afterSubviewCreated:function(t){},afterSubviewRemoved:function(t){},_getBaseShareRequestData:function(){var t=this.getPostModel(),e={post_id:t.get("post_id"),tumblelog_name:t.get("tumblelog_name")};return this.isTypeSubview()||s.extend(e,{share_fallback:!0}),e},_beforeShare:function(t,e){t.set({isSharing:!0,isShareSuccess:!1,isShareFail:!1}),this.trigger("share:start")},_afterShareSuccess:function(t,e){t.set({isShareSuccess:!0,isShareFail:!1}),t.onShareSuccess(e),this.trigger("share:success")},_afterShareFail:function(t,e){t.set({isShareFail:!0,isShareSuccess:!1}),t.onShareFail(e),this.trigger("share:fail")},_afterShare:function(t,e){t.set("isSharing",!1),t.afterShare(e),this.trigger("share:finished")}},{TYPE_POPUP:"popup",TYPE_SUBVIEW:"subview",TYPE_CALLBACK:"callback",TYPE_HREF:"href"});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(226),o=s.extend({defaults:{isSharing:!1,isShareSuccess:!1,isShareFail:!1},initialize:function(t){n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},getTitle:function(){return null},onShareSuccess:function(t){},onShareFail:function(t){},afterShare:function(t){},isShareSuccess:function(){return this.get("isShareSuccess")},isShareFail:function(){return this.get("isShareFail")},share:function(t){this.trigger("share",t,this)},close:function(){this.trigger("close",this)},remove:function(){return this.trigger("remove",this),s.prototype.remove.apply(this,arguments)}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1041),r=i(1043),a=i(277),l=o.extend({className:"external-network-facebook-subview external-network-form-subview",template:r,mixins:[a],defaults:n.defaults({username:null,characterLimit:255},o.prototype.defaults),getTitle:function(){var t=this.get("username");return n.isEmpty(t)?s("Facebook"):s("Facebook (%1$s)",t)},afterRender:function(){this.listenTo(this,"change:username",this._onChangeUsername),n.defer(n.bind(this.focus,this)),o.prototype.afterRender.apply(this,arguments)},getTemplateData:function(){return{characterLimit:this.get("characterLimit")}},focus:function(){this.js$("message").focus()},onFormSubmit:function(t){var e=this.js$("message").val();this.share({message:e})},_onChangeUsername:function(){this.trigger("changeTitle",this.getTitle())}});t.exports=l},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1039),r=i(1042),a=i(277),l=o.extend({tagName:"form",mixins:[a],className:"external-network-form-subview",defaults:n.defaults({isFormValid:!1,isShowConfetti:!0},o.prototype.defaults),events:{"click [data-js-success-container]":"_onSuccessContainerClick",submit:"_onFormSubmit"},initialize:function(t){n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),o.prototype.initialize.apply(this,arguments)},afterRender:function(){var t=this.getSubmitButtonElement();this.listenTo(this,"change:isFormValid",this._onChangeIsFormValid),this.listenTo(this,"change:isSharing",this._onChangeIsSharing),n.isEmpty(t)||(this.submitTextDefault=t.text(),this.submitTextSending=t.attr("data-text-sending")||s("Sending...")),this.validateForm(),this._setSubmitButtonState(),this._toggleElement(this.getShareFailElement(),!1),this._toggleElement(this.getShareSuccessElement(),!1)},getSubmitButtonElement:function(){return this.js$("submit-button")},getShareSuccessElement:function(){return this.js$("success-container")},getShareFailElement:function(){return this.js$("fail-container")},onShareSuccess:function(t){var e,i=this.getShareSuccessElement();this._toggleElement(i,!0),this._toggleElement(this.getShareFailElement(),!1),i&&this.get("isShowConfetti")&&(e=this._createConfettiView(),i.append(e.render().$el))},onShareFail:function(t){this._toggleElement(this.getShareFailElement(),!0),this._toggleElement(this.getShareSuccessElement(),!1)},isFormFieldsValid:function(){return!0},validateForm:function(){this.set("isFormValid",this.isFormFieldsValid())},setFormIsValid:function(t){this.set("isFormValid",t)},isFormValid:function(){return this.get("isFormValid")},onFormSubmit:function(t){},_createConfettiView:function(){return new r({className:"external-network-form-subview-confetti",autoParty:!0,amount:30,speed:.2})},_setSubmitButtonState:function(){var t=this.getSubmitButtonElement(),e=this.get("isFormValid"),i=this.get("isSharing"),n=!e||i;t.prop("disabled",n),t.text(i?this.submitTextSending:this.submitTextDefault)},_onChangeIsSharing:function(t,e){this._setSubmitButtonState()},_onChangeIsFormValid:function(t,e){this._setSubmitButtonState()},_onSuccessContainerClick:function(t){this.close()},_toggleElement:function(t,e){n.isEmpty(t)||t.toggleClass("visible",e)},_onFormSubmit:function(t){t.preventDefault(),this.onFormSubmit(t)}});t.exports=l},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(226),r=i(136),a=o.extend({id:"milestone-confetti",tagName:"canvas",defaults:{amount:100,autoParty:!1,colors:["#D95E40","#F2992E","#56BC8A","#529ECC","#A77DC2","#748089"],size:40,speed:.5,onDone:n.noop},__resize:function(){this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height())},_updateConfetti:function(t,e){this.confettiAngle+=.001,t.off||(t.tiltAngle+=t.tiltAngleIncrement,t.tilt=15*Math.sin(t.tiltAngle-e/3),t.y+=(Math.cos(this.confettiAngle+t.density)+.5*t.radius)*this.options.speed),t.y>this.el.height+20&&(this.isAnimating?(t.tilt=a.range(-10,10,!0),t.tileAngle=0,t.tiltAngleIncrement=a.range(.05,.1),t.x=Math.random()*this.el.width,t.y=-20):t.off||(t.off=!0,this.confettiOffscreen++))},_stopAnimating:function(){this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null),this.isAnimating=!1},_startAnimating:function(t){t=t||!1,this._stopAnimating(),this.animationInterval=setInterval(s.bind(this.draw,this),15),this.isAnimating=!!t||this.isAnimating},initialize:function(t){this.options=s.extend({},this.defaults,t||{}),this.colors=this.options.colors,this.$win=n(window),this.$parent=n(),this.context=this.el.getContext("2d"),this.animationInterval=null,this.confetti=[],this.confettiAngle=0,this.confettiOffscreen=0,this.isAnimating=!1},render:function(){return s.defer(s.bind(this.setup,this)),this},setup:function(){this.$parent=this.$el.parent(),this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height()),this.listenTo(r,"DOMEventor:flatresize",this.__resize);for(var t=this.options.size,e=.5*t,i=0,n=this.options.amount;i<n;i++)this.confetti.push({x:Math.random()*this.el.width,y:Math.random()*-this.el.height,radius:a.range(e,t),density:a.range(10,n),tilt:a.range(-10,10,!0),tiltAngle:0,tiltAngleIncrement:a.range(.05,.1),color:this.colors[a.range(0,this.colors.length-1,!0)],off:!1});this.options.autoParty&&this.party()},draw:function(){if(this.context.clearRect(0,0,this.el.width,this.el.height),this.confettiOffscreen===this.confetti.length)return this.trigger("confetti:animation:finished"),void this.remove();for(var t=5,e=0;e<this.confetti.length;e++){var i=this.confetti[e];this.context.beginPath(),this.context.lineWidth=.5*i.radius,this.context.strokeStyle=i.color,this.context.moveTo(i.x+i.tilt+i.radius/t,i.y),this.context.lineTo(i.x+i.tilt,i.y+i.tilt+i.radius/t),this.context.stroke(),this._updateConfetti(i,e)}},party:function(){return this.confettiOffscreen=0,this._startAnimating(!0),this},stopPartying:function(){return this.isAnimating=!1,this},remove:function(){return this._stopAnimating(),this.options.onDone(),o.prototype.remove.call(this)}},{range:function(t,e,i){i=i||!1;var n=(e-t)*Math.random()+t;return i?Math.round(n):n}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><textarea data-js-message maxlength="'+__e(characterLimit)+'" placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional Facebook message content"))+'"></textarea></div><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(130),s=i(1038),o=s.extend({getName:function(){return"reddit"},getLabel:function(){return n("Reddit")},getPopupOptions:function(){return"scrollbars=1,width=860,height=600"},getPopupUrl:function(){return"https://reddit.com/submit?url="+encodeURIComponent(this.getPostUrl())}});t.exports=o},function(t,e,i){"use strict";var n=i(130),s=i(1038),o=s.extend({defaults:{popupUrl:null,popupOptions:null},getName:function(){return"pinterest"},getLabel:function(){return n("Pinterest")},getPopupOptions:function(){return this.get("popupOptions")},getPopupUrl:function(){return this.get("popupUrl")}});t.exports=o},function(t,e,i){"use strict";var n=i(130),s=i(1038),o=s.extend({getName:function(){return"permalink"},getLabel:function(){return n("Permalink")},getType:function(){return s.TYPE_HREF},getButtonHref:function(){return this.getPostUrl()}});t.exports=o},function(t,e,i){"use strict";var n=i(136),s=i(130),o=i(1038),r=o.extend({getName:function(){return"flag"},getLabel:function(){return s("Report")},getType:function(){return o.TYPE_CALLBACK},onClickHandler:function(t){n.trigger("abuseform:open",{mode:"post",post:this.getPostModel()}),n.trigger("Kraken:abuseform:open",{mode:"post"})}});t.exports=r},function(t,e,i){"use strict";var n=i(130),s=i(1038),o=i(1049),r=s.extend({getName:function(){return"embed"},getLabel:function(){return n("Embed")},getType:function(){return s.TYPE_SUBVIEW},getSubviewConstructor:function(){return o},getSubviewOptions:function(){return{embedCode:this.postModel.getEmbedCode()}}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1039),r=i(1050),a=i(277),l=o.extend({tagName:"form",className:"external-network-embed-subview external-network-form-subview",defaults:{embedCode:null},mixins:[a],events:{"click [data-js-embed-code]":"_onEmbedCodeClick"},template:r,getTitle:function(){return s("Embed")},getTemplateData:function(){return{embedCode:this.get("embedCode")}},afterRender:function(){n.defer(n.bind(this.selectEmbedCode,this))},selectEmbedCode:function(){var t=this.js$("embed-code");t.focus(),t.select()},_onEmbedCodeClick:function(t){this.selectEmbedCode()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><textarea spellcheck="false" readonly="readonly" data-js-embed-code class="embed-code textarea" aria-label="'+__e(__("Embed code"))+'">'+__e(embedCode)+"</textarea></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1038),r=i(1052),a=o.extend({getName:function(){return"email"},getLabel:function(){return s("Email")},getType:function(){return o.TYPE_SUBVIEW},getSubviewConstructor:function(){return r},getShareRequestDataFromSubviewData:function(t){var e={message:n.get(t,"message"),email_address:n.get(t,"email")};return n.get(t,"isAllowReply",!1)&&n.extend(e,{allow_reply_to:!0}),e}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1053),r=i(1041),a=i(1054),l=r.extend({className:"external-network-email-subview external-network-form-subview",template:a,events:n.defaults({"input [data-js-email]":"_onEmailInput"},r.prototype.events),getTitle:function(){return s("Email")},afterRender:function(){n.defer(n.bind(this.focus,this)),r.prototype.afterRender.apply(this,arguments)},focus:function(){this.js$("email").focus()},isFormFieldsValid:function(){return o.isEmail(this.js$("email").val())},onFormSubmit:function(t){var e,i,n;this.isFormValid()&&(e=this.js$("email").val(),i=this.js$("message").val(),n=this.js$("allow-reply-checkbox").is(":checked"),this.share({email:e,message:i,isAllowReply:n}))},_onEmailInput:function(t){this.validateForm()}});t.exports=l},function(t,e,i){"use strict";var n=i(8),s={isBlank:function(t){return""===n.trim(t)},minLength:function(t,e){return t.length>=e},maxLength:function(t,e){return t.length<=e},range:function(t,e,i){return t.length>=e&&t.length<=i},pattern:function(t,e){return!!new RegExp(e,"gi").test(t)},isEmail:function(t){return this.pattern(t,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},isUrl:function(t){return this.pattern(t,"^\\s*((https?:)?[/\\\\]+)?([a-z0-9_-]+\\.){1,}([a-z\\.]{2,6})(/[^\\s]*)?\\s*$")},isTumblrUrl:function(t){return this.pattern(t,"^\\s*(?:https?:\\/\\/)?(?:(?:a|v[t]{0,2}(?:\\.media)?)\\.tumblr\\.com|[0-9]+\\.media(?:\\.tumblr\\.com)?|[0-9a-z\\._-]+\\/(?:post|image)|tumblr\\.com\\/dashboard\\/blog)\\/[a-z0-9\\/\\._-]+\\s*$")},equals:function(t,e){return t===e},isPhoneNumber:function(t){return t&&/^\d+$/.test(t)&&(10===t.length||11===t.length)},isPostalCode:function(t){return t&&/^\d+$/.test(t)&&(5===t.length||9===t.length)}};t.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><input type="email" data-js-email placeholder="'+__e(__("To email"))+'" class="email input" aria-label="'+__e(__("To email"))+'"><textarea maxlength="255" data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional email message content"))+'"></textarea><label class="reply-option"><span class="binary-switch reply-switch"><input type="checkbox" data-js-allow-reply-checkbox> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span> </span> '+__e(__("Let them reply to my email address"))+' </label></div><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(130),s=i(1038),o=i(1056),r=s.extend({defaults:{isPopup:!0,username:null,urlToken:"[URL]"},getName:function(){return"twitter"},getLabel:function(){return n("Twitter")},getType:function(){return this.get("isPopup")?s.TYPE_POPUP:s.TYPE_SUBVIEW},getPopupUrl:function(){var t=this.getPostTinyUrl()||this.getPostUrl();return"https://twitter.com/intent/tweet?url="+encodeURIComponent(t)},getPopupOptions:function(){return"width=550,height=420"},getSubviewConstructor:function(){return o},getSubviewOptions:function(){return{username:this.get("username"),urlToken:this.get("urlToken")}}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(130),o=i(1041),r=i(1057),a=i(277),l=o.extend({className:"external-network-twitter-subview external-network-form-subview",template:r,mixins:[a],defaults:n.defaults({username:null,urlToken:"[URL]",shortUrlLength:23,characterLimit:140,characterCount:0,characterCountExceedsLenghClass:"exceeds-length"},o.prototype.defaults),events:n.defaults({"input [data-js-message]":"_onMessageInput"},o.prototype.events),getTitle:function(){var t=this.get("username");return n.isEmpty(t)?s("Twitter"):s("Twitter (@%1$s)",t)},getTemplateData:function(){return{urlToken:this.get("urlToken")}},afterRender:function(){this.listenTo(this,"change:characterCount",this._onChangeCharacterCount),this._updateCharacterCount(),this._onChangeCharacterCount(this,this.get("characterCount")),n.defer(n.bind(this.focus,this)),o.prototype.afterRender.apply(this,arguments)},isFormFieldsValid:function(){var t=this.get("characterCount");return t>0&&t<=this.get("characterLimit")},onFormSubmit:function(t){this.isFormValid()&&this.share({message:this._getMessage()})},focus:function(){this.js$("message").focus()},_getMessage:function(){return this.js$("message").val()},_updateCharacterCount:function(){var t=this._calculateCharacterCount(this._getMessage());this.set("characterCount",t)},_updateCharacterCountContainer:function(t){var e=this.js$("character-count"),i=this.get("characterCountExceedsLenghClass"),n=this.get("characterLimit")-t;e.text(n).toggleClass(i,n<0)},_getUrlTokenCountFromMessage:function(t){var e=this.get("urlToken"),i=new RegExp(n.escapeRegExp(e),"ig"),s=t.match(i);return n.isEmpty(s)?0:s.length},_getAdditionalUrLengthFromMessage:function(t){var e=this.get("urlToken"),i=this.get("shortUrlLength"),n=this._getUrlTokenCountFromMessage(t);return 0===n?0:n*i-n*e.length},_calculateCharacterCount:function(t){return t.length+this._getAdditionalUrLengthFromMessage(t)},_onChangeCharacterCount:function(t,e){this._updateCharacterCountContainer(e)},_onMessageInput:function(t){this._updateCharacterCount(),this.validateForm()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<form class="form-main"><textarea data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional Twitter message content"))+'"> '+__e(urlToken)+'</textarea></form><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button><div data-js-character-count class="character-count"></div></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="networkView[]"></div><div data-subview="networksLoaderView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1060),r=i(277),a=i(232),l=s.extend({className:"messaging-share-post-external-network-subview-wrapper",template:o,mixins:[r,a],events:{"click [data-js-back-button]":"_onBackButtonClick"},keycommands:{"keydown:escape":"_onKeyPressEscape"},initialize:function(t){n.extend(this.attributes,n.pick(t,n.keys(this.defaults))),n.extend(this,n.pick(t,"externalNetworkSubview"))},getTemplateData:function(){return{title:this.externalNetworkSubview.getTitle()}},afterRender:function(){this.externalNetworkSubview.render(),this.listenTo(this.externalNetworkSubview,"changeTitle",this._onSubviewChangeTitle),this.listenToOnce(this.externalNetworkSubview,"close",this._onSubviewClose),this.js$("external-network-subview").html(this.externalNetworkSubview.$el)},goBack:function(){this.trigger("goBack")},close:function(){this.trigger("close")},remove:function(){return this.externalNetworkSubview.remove(),s.prototype.remove.apply(this,arguments)},_onSubviewChangeTitle:function(t){this.js$("title").text(t)},_onSubviewClose:function(){this.close()},_onBackButtonClick:function(t){t.preventDefault(),this.goBack()},_onKeyPressEscape:function(t){t.preventDefault(),this.externalNetworkSubview.isShareSuccess()?this.close():this.goBack()}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="header"><a href="#" data-js-back-button class="back-button">'+__e(__("Back"))+'</a><div data-js-title class="title">'+__e(title)+'</div></div><div class="external-network-subview" data-js-external-network-subview></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(277),r=i(1062),a=s.extend({className:"messaging-share-post-error",mixins:[o],template:r,defaults:{title:null},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)))},setTitle:function(t){this.set("title",t)},getTemplateData:function(){return{title:this.get("title")}},afterRender:function(){this.listenTo(this,"change:title",this._onChangeTitle)},_onChangeTitle:function(t,e){this.js$("title").text(e)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<p data-js-title>"+__e(title)+"</p>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(810),o=i(650),r=s.extend({className:"conversation-compose-plugin conversation-compose-plugin--blog-selector",defaults:n.defaults({currentTumblelog:null},s.prototype.defaults),renderWithTemplate:n.noop,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,n.pick(t,n.keys(this.defaults)));var e=n.extend({className:"conversation-compose-plugin-blog-selector",showName:!1,showCaret:!1},n.pick(t,"collection","currentTumblelog","popoverOptions"));this.blogSelectorView=new o(e)},afterRender:function(){this.blogSelectorView.render(),this.$el.html(this.blogSelectorView.el)},getName:function(){return"blog-selector"},getBlogSelector:function(){return this.blogSelectorView}});t.exports=r},function(t,e,i){"use strict";var n=i(185),s=n.extend({defaults:{participant:null}});t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(185),o=s.extend({url:function(){return"/svc/post/share/"+this.get("tumblelog_name")+"/"+this.get("post_id")},defaults:{post_id:null,tumblelog_name:null,twitter_username:null,has_facebook:null,pinterest_share_window:null,show_pinterest:null,post_url:null},parse:function(t){return n.get(t,"response.share_popover_data",t)},isValid:function(){return!n.isEmpty(this.get("post_id"))&&!n.isEmpty(this.get("tumblelog_name"))},isPopulated:function(){return!n.isEmpty(this.get("post_url"))}});t.exports=o},,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(226),s=i(130),o=i(1080),r=n.extend({className:"overlay",template:o,getTemplateData:function(){return{messageText:s("This Tumblr may contain sensitive media."),linkText:s("Safe Mode is on")}}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="overlay-wrapper post_content"><div class="post_content_inner safemode"><p><span class="message">'+__e(messageText)+'</span><br><a class="link" href="/settings/account" target="_blank" data-js-theme-accent-color>'+__e(linkText)+"</a></p></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(214),r=i(136),a=i(625),l=i(626),c=i(1082),u=i(1084),h=o.extend({name:"AskComponent",initialize:function(t){t=t||{},this.user=t.user,this.user&&(this.blog=this.user.getChannel(),this.question=new u({recipient:null,anonymous:!1,question:""}),this.listenTo(r,"ask:form:open",this.presentAskForm),this.listenTo(this.question,"save:success",this.onSaveSuccess))},presentAskForm:function(t){return this.askFormView?this:(this.question.set("recipient",t.recipient),n("body").addClass("postforms-open"),r.trigger("drawer:suspend"),r.trigger("keycommands:suspend"),this.glass=new a,this.modal=new l,this.askFormView=new c({model:this.question,characterLimit:500,recipient:{name:t.recipient,allowAnonymous:t.allow_anonymous},sender:this.blog}),this.askFormView.render(),this.modal.setContentSubView(this.askFormView),this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this.glass.show().then(s.bind(this.modal.show,this.modal)),this.listenTo(this.askFormView,"close",this.dismissAskForm),this.listenTo(this.askFormView,"submit",this.submit),this)},beforeRemove:function(){this.dismissAskForm()},dismissAskForm:function(){this.askFormView&&(this.stopListening(this.askFormView),this.modal.hide(),this.modal.remove(),this.modal=null,this.glass.hide(),this.glass.remove(),this.glass=null,this.askFormView.remove(),this.askFormView=null,r.trigger("keycommands:resume"),r.trigger("drawer:resume"),r.trigger("ask:form:hidden"),n("body").removeClass("postforms-open"))},submit:function(t){this.question.set("anonymous",!!t.anonymous),this.question.set("question",t.question),this.question.save()},onSaveSuccess:function(){r.trigger("ask:form:success"),this.dismissAskForm()}});t.exports=h},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(250),r=i(226),a=i(232),l=i(277),c=i(1083),u=r.extend({className:"ask-form",template:c,mixins:[a,l],keycommands:{"keydown:enter":"preventNewlines","keydown:escape":"dismiss"},events:{"click button.close":"dismiss","change .ask-anonymously-switch":"toggleAnonymous","submit form":"submit","input .ask-question":"onTextAreaUpdate"},initialize:function(t){this.characterLimit=t.characterLimit,this.sender=t.sender,this.recipient=t.recipient,this.onTextAreaUpdate=s.throttle(s.bind(this.onTextAreaUpdate,this),100),this.listenTo(this.model,"change:isSaving",this.toggleSubmit),this.listenTo(this.model,"save:success",this.render),this.listenTo(this.model,"save:error",this.displayErrors)},getTemplateData:function(){var t={};return t.recipient=s.clone(this.recipient)||{},t.recipient.allow_anonymous=t.recipient.allowAnonymous,t.sender=this.sender.toJSON(),t.sender.avatar_url=o(this.sender.get("avatar_url"))(128),t.character_limit=this.characterLimit,t},dismiss:function(){this.trigger("close")},toggleSubmit:function(t,e){e?this.disableSubmit():this.enableSubmit()},toggleAnonymous:function(t){var e=this.$(t.target);this.isAnonymous=e.prop("checked");var i=this.$$(".post_avatar_link"),n=this.$$(".ask-from .tumblelog_name"),s=this.$$(".ask-from .anonymous");this.isAnonymous?(i.removeClass("use_blog_avatar"),n.hide(),s.show()):(i.addClass("use_blog_avatar"),n.show(),s.hide())},submit:function(t){t.preventDefault(),this.trigger("submit",{question:this.$$(".ask-question").val(),anonymous:this.isAnonymous})},preventNewlines:function(t){t.preventDefault()},onTextAreaUpdate:function(){var t=this.$$(".ask-question").val(),e=t;t.match(/\n/g)&&(t=t.replace(/\n/g,""));var i=s.trim(t).length;0<i&&i<=this.characterLimit?this.enableSubmit():this.disableSubmit(),t!==e&&this.$$(".ask-question").val(t);var n=this.characterLimit-t.length,o=this.$$(".ask-character-count");o.text(n),n<=100?(o.addClass("active"),o.removeClass("count-ok count-warning count-danger"),n>40?o.addClass("count-ok"):n>20?o.addClass("count-warning"):o.addClass("count-danger")):o.removeClass("active")},enableSubmit:function(){this.model.get("isSaving")||this.$$(".ask-button").prop("disabled",!1)},disableSubmit:function(){this.$$(".ask-button").prop("disabled",!0)},showMessages:function(t,e){var i=this.$$("."+t),o=i.get(0);o&&(i.removeClass("active").hide().empty(),"string"==typeof e&&(e=[e]),s.each(e,s.bind(function(t){var e=n("<li/>",{text:t});i.append(e)},this)),i.show(),s.defer(function(){i.addClass("active")}))},displayErrors:function(t){this.showMessages("errors-ask",t)}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="post_form_wrapper v_center_el"><div class="post_avatar"><a class="post_avatar_link use_blog_avatar animating" data-user-avatar-url="'+__e(sender.avatar_url)+'" data-avatar-url="'+__e(sender.avatar_url)+'" data-blog-url="'+__e(sender.blog_url)+'"><span class="post_avatar_link blog_avatar anonymous" data-anonymous-avatar-url="/images/anonymous_avatar_64.gif" style="background-image: url(/images/anonymous_avatar_64.gif)"></span> <span class="post_avatar_link blog_avatar new" style="background-image: url('+__e(sender.avatar_url)+')"></span></a></div><div class="post-container"><form enctype="multipart/form-data" class="active"><div class="post-container-inner post post-form--asks"><div class="post-form--header"><div class="controls-container"> ';var senderMarkup='<span class="ask-from"><span class="tumblelog_name">'+sender.name+'</span><span class="anonymous">'+__("anonymous")+"</span></span>",recipientMarkup='<span class="ask-recipient-label">'+recipient.name+"</span>";
if(__p+=" "+(null==(__t=__('%1$s <span class="ask-to-label">to</span> %2$s',senderMarkup,recipientMarkup))?"":__t)+' <span class="ask-character-count"></span></div></div><div class="post-form--form post-content-text"><textarea class="ask-question" name="question" placeholder="'+__e(__("Ask me anything"))+'" maxlength="'+__e(character_limit)+'" autofocus></textarea></div><div class="post-form--bottom"><div class="post-form--controls"><div class="controls-container"><div class="control left"><button type="button" class="chrome flat close">'+__e(__("Close"))+"</button></div> ",recipient.allow_anonymous){__p+=' <div class="control right"><div class="ask-anonymously"> ';var randId=Math.floor(1e6*Math.random());__p+=' <label class="binary_switch"><input id="ask_anonymously_switch_'+__e(randId)+'" class="ask-anonymously-switch" type="checkbox" name="anonymous" value="1"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="ask-anonymously-label" for="ask_anonymously_switch_'+__e(randId)+'">'+__e(__("Ask anonymously"))+"</label></div></div> "}__p+=' <div class="control right"><button class="chrome blue ask-button" type="submit" disabled="disabled">'+__e(__("Ask"))+'</button></div></div></div><ul class="post-form--error-bar messages errors-ask"></ul></div></div></form></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(185),s=i(3),o=i(130),r=n.extend({urlRoot:"/svc/post/ask",validate:function(t){return s.trim(t.question)?this.isUrl(t.question)?{error:o("Sorry, but please don't include links in questions.")}:void 0:{error:o("You need to enter a question!")}},isUrl:function(t){return!!(t.match(/(http|https):\/\//i)||t.match(/www\./i)||t.match(/[a-zA-Z0-9]+(\.arpa|\.root|\.aero|\.biz|\.cat|\.com|\.coop|\.edu|\.gov|\.info|\.int|\.jobs|\.mil|\.mobi|\.museum|\.name|\.net|\.org|\.pro|\.travel|TLD|\.ac|\.ad|\.ae|\.af|\.ag|\.ai|\.al|\.am|\.an|\.ao|\.aq|\.ar|\.as|\.at|\.au|\.aw|\.ax|\.az|\.ba|\.bb|\.bd|\.be|\.bf|\.bg|\.bh|\.bi|\.bj|\.bm|\.bn|\.bo|\.br|\.bs|\.bt|\.bv|\.bw|\.by|\.bz|\.ca|\.cc|\.cd|\.cf|\.cg|\.ch|\.ci|\.ck|\.cl|\.cm|\.cn|\.co|\.cr|\.cu|\.cv|\.cx|\.cy|\.cz|\.de|\.dj|\.dk|\.dm|\.do|\.dz|\.ec|\.ee|\.eg|\.er|\.es|\.et|\.eu|\.fi|\.fj|\.fk|\.fm|\.fo|\.fr|\.ga|\.gb|\.gd|\.ge|\.gf|\.gg|\.gh|\.gi|\.gl|\.gm|\.gn|\.gp|\.gq|\.gr|\.gs|\.gt|\.gu|\.gw|\.gy|\.hk|\.hm|\.hn|\.hr|\.ht|\.hu|\.id|\.ie|\.il|\.im|\.in|\.io|\.iq|\.ir|\.is|\.it|\.je|\.jm|\.jo|\.jp|\.ke|\.kg|\.kh|\.ki|\.km|\.kn|\.kr|\.kw|\.ky|\.kz|\.la|\.lb|\.lc|\.li|\.lk|\.lr|\.ls|\.lt|\.lu|\.lv|\.ly|\.ma|\.mc|\.md|\.mg|\.mh|\.mk|\.ml|\.mm|\.mn|\.mo|\.mp|\.mq|\.mr|\.ms|\.mt|\.mu|\.mv|\.mw|\.mx|\.my|\.mz|\.na|\.nc|\.ne|\.nf|\.ng|\.ni|\.nl|\.no|\.np|\.nr|\.nu|\.nz|\.om|\.pa|\.pe|\.pf|\.pg|\.ph|\.pk|\.pl|\.pm|\.pn|\.pr|\.ps|\.pt|\.pw|\.py|\.qa|\.re|\.ro|\.ru|\.rw|\.sa|\.sb|\.sc|\.sd|\.se|\.sg|\.sh|\.si|\.sj|\.sk|\.sl|\.sm|\.sn|\.so|\.sr|\.st|\.su|\.sv|\.sy|\.sz|\.tc|\.td|\.tf|\.tg|\.th|\.tj|\.tk|\.tl|\.tm|\.tn|\.to|\.tp|\.tr|\.tt|\.tv|\.tw|\.tz|\.ua|\.ug|\.uk|\.um|\.us|\.uy|\.uz|\.va|\.vc|\.ve|\.vg|\.vi|\.vn|\.vu|\.wf|\.ws|\.ye|\.yt|\.yu|\.za|\.zm|\.zw)/i))},save:function(t,e){e=e||{};var i=e.success,o=e.error;e.success=s.bind(function(t,e){if(s.isEmpty(s.result(e.response,"errors")))this.trigger("save:success"),i&&i.call(null,t,e);else{var n=e.response.errors[0];this.trigger("save:error",n),o&&o.call(null,t,n)}this.set("isSaving",!1)},this),e.error=s.bind(function(t,e){this.trigger("save:error",e),o&&o.call(null,t,e)},this),this.set("isSaving",!0);var r=n.prototype.save.call(this,t,e);!r&&this.validationError&&(this.trigger("save:error",this.validationError.error),this.set("isSaving",!1))}});t.exports=r},function(t,e,i){"use strict";var n=i(214),s=i(1086),o=n.extend({name:"MobileNav",autoAppend:!0,view:function(){if(this.data)return new s(this.data)}});t.exports=o},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(136),a=i(181),l=i(180),c=i(276),u=i(230),h=i(1087),d=i(1088),p=i(1096),_=i(1106),g=o.extend({className:"mobile-header",mixins:[c,u],template:h,defaults:{logged_in:!1},initialize:function(t){t=s.extend({},t),s.extend(this.attributes,s.pick(t,s.keys(this.defaults))),this.subViews.logoTitle=new d(t),this.subViews.navMenu=new p(t),l.bool("mobile_web_sticky_header")&&this.setSticky(),this.subViews.search=new _(t)},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},setSticky:function(){n("body").addClass("sticky-header"),this.lastPosition=a.rect().windowScrollTop,this.listenTo(r,"DOMEventor:flatscroll",this.getScrollDirection)},getScrollDirection:function(t){t.windowScrollTop>45?s.delay(s.bind(function(){this.$el.addClass("sticky")},this),500):this.$el.removeClass("sticky"),this.lastPosition<t.windowScrollTop&&t.windowScrollTop>45?this.$el.addClass("hide-nav"):this.$el.removeClass("hide-nav"),this.lastPosition=t.windowScrollTop}});t.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="navMenu"></div><div data-subview="logoTitle"></div><div data-subview="search"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(180),r=i(276),a=i(230),l=i(1089),c=i(1090),u=i(1092),h=i(1094),d=s.extend({className:"nav-logo-title",mixins:[r,a],template:l,initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.subViews.logo=new c,o.bool("mobile_web_page_titles")&&this.get("page_title")&&this.get("logged_in")&&!this.get("search_term")?(this.subViews.pageTitle=new u(t),this.set("show_page_title",!0)):this.set("show_page_title",!1),this.set("show_search_field",!!this.get("search_term")),this.subViews.searchField=new h(t)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="mobile-logo-wrapper',show_page_title&&(__p+=" show-page-title "),__p+=" ",!_.isUndefined(show_search_field)&&show_search_field&&(__p+=" show-search-field "),__p+='"><div data-subview="logo"></div><div data-subview="pageTitle"></div><div data-subview="searchField"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(219),s=i(1091),o=n.extend({template:s,className:"mobile-logo",render:function(){return this.$el.html(this.template()),this}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<a href="/" class="logo-link"><svg class="svg-logo" width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path class="inner" d="M13.4404585,32.9978573 L13.1859215,33 C5.40091922,33 3.7112324,27.2768093 3.7112324,23.9359304 L3.7112324,14.6527709 L0.644574576,14.6527709 C0.288572835,14.6527709 0,14.3641866 0,14.0082147 L0,9.6266323 C0,9.1644545 0.291787135,8.7523442 0.72736069,8.5979279 C4.72423734,7.1880393 5.97738627,3.70267176 6.16328007,1.05159549 C6.21292323,0.34336573 6.58403216,0 7.20071368,0 L11.7729503,0 C12.1289164,0 12.4175249,0.28854863 12.4175249,0.64452051 L12.4175249,8.0664341 L17.7675867,8.0664341 C18.1235885,8.0664341 18.4121613,8.3550185 18.4121613,8.7109547 L18.4121613,13.9746459 C18.4121613,14.3306178 18.1235885,14.6191665 17.7675867,14.6191665 L12.3906676,14.6191665 L12.3906676,23.2008456 C12.3906676,25.3559968 13.8110674,25.9521997 14.6886074,25.9521997 C15.5299686,25.9319513 16.3586512,25.6757572 16.7738319,25.5090561 C17.0821548,25.3853159 17.3529775,25.3033938 17.595693,25.3640676 C17.8213012,25.420456 17.9700163,25.5802291 18.0701239,25.8719917 L19.4885237,30.0155572 C19.6024885,30.3446026 19.702489,30.70361 19.464595,30.9576614 C18.3476967,32.1504243 15.7600055,32.9595389 13.4404585,32.9978573 L13.4404585,32.9978573 Z"></path></svg></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(1093),a=s.extend({template:r,className:"page-title",mixins:[o],initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t)},render:function(){return this.$el.html(this.template(this.toJSON())),this}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(page_title);return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(136),r=i(230),a=i(1095),l=i(496),c=s.extend({template:a,className:"search-field",mixins:[r],events:{"submit form":"__submitForm"},__submitForm:function(){this.toggleLoader(!0)},__handleSearchClick:function(){var t=this.$searchInput.val();this.$el.hasClass("search-term-exists")?t===this.get("search_term")?this.setFocus():this.$submitForm.trigger("submit"):!t&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.hideSearchField():t&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.$submitForm.trigger("submit"):this.showSearchField()},__handleNsfwFilterClick:function(t){this.$searchNsfwFilterInput.val(t),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},__handleFilterChange:function(t){var e="top";"CREATED_DESC"===t.get("sort")&&(e="recent");var i=t.get("post_type").toLowerCase();this.$searchFilterSortInput.val(e),this.$searchFilterPostTypeInput.val(i),this.$searchNsfwFilterInput.val(t.get("filter_nsfw")),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.listenTo(o,"mobileHeader:search:click",this.__handleSearchClick),this.listenTo(o,"mobileHeader:nsfw:update",this.__handleNsfwFilterClick),this.listenTo(o,"mobileHeader:filter:update",this.__handleFilterChange),this.listenTo(o,"drawer:open",this.hideSearchField)},render:function(){return this.get("search_term")&&this.$el.addClass("search-term-exists"),this.$el.html(this.template(this.toJSON())),this.$searchInput=this.$(".search-input"),this.$searchNsfwFilterInput=this.$(".search-nsfw-filter-input"),this.$searchFilterSortInput=this.$(".filter-sort-input"),this.$searchFilterPostTypeInput=this.$(".filter-post-type-input"),this.$submitForm=this.$("form"),this.$mobileLogoWrapper=this.$el.parent(),this},toggleLoader:function(t){t?this.loader?this.loader.set("loading",!0):this.loader=new l({$container:this.$el,type:"bar",classModifiers:"top",loading:!0}):this.loader.set("loading",!1)},showSearchField:function(){this.$mobileLogoWrapper.addClass("show-search-field"),n.delay(n.bind(this.setFocus,this),250)},hideSearchField:function(){this.$searchInput.blur(),this.$mobileLogoWrapper.removeClass("show-search-field")},setFocus:function(){var t=2*this.$searchInput.val().length;this.$searchInput.focus(),this.$searchInput.get(0).setSelectionRange(t,t)}});t.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<form action="/search" method="get"><input type="text" placeholder="'+__e(__("Search Tumblr"))+'" autocomplete="off" class="search-input" id="search-input" name="q" value="',search_term&&(__p+=__e(search_term)),__p+='"> <input type="hidden" class="search-nsfw-filter-input" name="filter_nsfw"> <input type="hidden" class="filter-sort-input" name="sort" value="top"> <input type="hidden" class="filter-post-type-input" name="filter_post_type" value="any"> '+(null==(__t=_subview("loader"))?"":__t)+" </form>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(219),r=i(276),a=i(230),l=i(136),c=i(1097),u=i(1098),h=i(1104),d=o.extend({className:"nav-menu",template:c,mixins:[r,a],events:{"click .menu-burger":"__clickMenuBurger","click [data-subnav]":"__clickSubnav","click .sneeze-guard":"__clickSneezeGuard"},__clickSneezeGuard:function(t){t.preventDefault(),this.closeDrawer()},__clickSubnav:function(t){t.preventDefault(),this.openSubNav(s(t.currentTarget).data("subnav"))},__clickMenuBurger:function(t){t.preventDefault(),this.toggleDrawer()},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.get("drawer_open")&&this.openDrawer(),this.get("logged_in")?this.subViews.drawer=new u(t):this.subViews.drawer=new h(t),this.listenTo(l,"mobileHeader:search:click",this.closeDrawer)},render:function(){return this.$el.html(this.template()),this.$body=s("body"),this.$html=s("html"),this.attachSubViews(),this},toggleDrawer:function(){this.$el.hasClass("subnav-active")?this.closeSubNav():this.get("drawer_open")?this.closeDrawer():this.openDrawer()},openDrawer:function(){this.set("drawer_open",!0),this.$body.addClass("nav-drawer-open"),this.$html.addClass("nav-drawer-open"),this.$el.addClass("active"),l.trigger("drawer:open")},closeDrawer:function(){this.set("drawer_open",!1),this.$body.removeClass("nav-drawer-open"),this.$html.removeClass("nav-drawer-open"),this.$el.removeClass("active subnav-active"),l.trigger("drawer:closed")},openSubNav:function(t){this.$el.addClass("subnav-active"),l.trigger("drawer:subnav:open",t)},closeSubNav:function(){this.$el.removeClass("subnav-active"),l.trigger("drawer:subnav:close")}});t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="menu-burger"><div class="burger bun top"></div><div class="burger patty"></div><div class="burger bun bottom"></div></div><div class="drawer" data-subview="drawer"></div><div class="sneeze-guard"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(276),a=i(1099),l=i(1100),c=i(1102),u=s.extend({template:a,mixins:[r,o],className:"drawer logged-in",initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.subViews.primaryNav=new l(t),this.subViews.secondaryNav=new c(t)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="nav-wrapper"><div data-subview="primaryNav"></div><div data-subview="secondaryNav"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(1101),a=s.extend({template:r,mixins:[o],className:"primary-nav",initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t)},render:function(){return this.$el.html(this.template(this.toJSON())),this}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<nav class="nav-site-sections"><a href="/dashboard" class="nav-item with-icon"><span class="nav-text nav-item-dashboard">'+__e(__("Dashboard"))+'</span></a><a href="/likes" class="nav-item with-icon"><span class="nav-count">',parseInt(likes,10)>0&&(__p+=__e(likes)),__p+=' </span><span class="nav-text nav-item-likes">'+__e(__("Likes"))+'</span></a><a href="/following" class="nav-item with-icon"><span class="nav-count">'+__e(following)+'</span><span class="nav-text nav-item-following">'+__e(__("Following"))+'</span></a><a href="/settings" class="nav-item with-icon" data-subnav="settings"><span class="nav-text nav-item-settings has-subnav">'+__e(__("Settings"))+'</span></a><a href="'+__e(url_prefix)+'/new/text" class="nav-item with-icon"><span class="nav-text nav-item-create-post">'+__e(__("Create a post"))+'</span></a></nav><nav class="nav-blog-list"><span class="nav-section-title">'+__e(__("Blogs"))+"</span> ",_.each(blogs,function(t){__p+=' <a href="'+__e(t.url)+'" class="nav-item"><img src="'+__e(t.avatar)+'" class="blog-avatar"><div class="blog-name-wrapper"><span class="blog-name">'+__e(t.name)+'</span><span class="blog-title">'+(null==(__t=t.safe_title)?"":__t)+"</span></div></a> "}),__p+=" </nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(136),a=s.extend({mixins:[o],className:"secondary-nav",templates:{settings:i(1103)},_getTemplate:function(t){if("settings"===t)return this.templates.settings(this.toJSON())},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.listenTo(r,"drawer:subnav:open",this.render)},render:function(t){return t&&this.$el.html(this._getTemplate(t)),this}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<nav class="nav-site-sections"><a href="/settings/password" class="nav-item"><span class="nav-text">'+__e(__("Change Password"))+'</span></a><a href="/settings/tfa" class="nav-item"><span class="nav-text">'+__e(__("Two Factor Authentication"))+'</span></a><a href="/help" class="nav-item"><span class="nav-text">'+__e(__("Help"))+'</span></a><a href="/settings/account" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Account"))+'</span></a><a href="/settings/notifications" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Notifications"))+'</span></a><a href="/settings/apps" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Apps"))+"</span></a></nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(230),r=i(136),a=i(1105),l=s.extend({template:a,mixins:[o],className:"drawer logged-out",initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.listenToOnce(r,"drawer:open",this.downloadBackground)},downloadBackground:function(){var t=new Image,e=this.$splashBg.data("img-src");t.onload=n.bind(function(){this.$splashBg.css("background-image","url("+e+")"),this.$splashBg.addClass("loaded")},this),t.src=e},render:function(){return this.$el.html(this.template(this.toJSON())),this.$splashBg=this.$(".splash-bg"),this}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="splash-bg" data-img-src="'+__e(splash.image)+'"></div><div class="splash-sections"><div class="splash-section top"><a href="/login" class="splash-login">'+__e(__("Log in"))+'</a></div><div class="splash-section middle"><div class="middle-inner"><span class="splash-pitch">'+__e(__("Splash headline"))+'</span><a href="/register" class="signin tx-button blue" role="button">'+__e(__("Get started"))+"</a> ",has_app&&(__p+='<a href="'+__e(app_url)+'" class="tx-button get-the-app" role="button">'+__e(__("Get the app"))+"</a>"),__p+=' </div></div><div class="splash-section bottom"><a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-avatar" style="background-image:url('+__e(splash.avatar)+')"></a> <a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-name">'+__e(__("Posted by"))+"&nbsp;<strong>"+__e(splash.name)+"</strong></a></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(136),o=i(219),r=i(276),a=i(230),l=i(1107),c=i(1108),u=i(1110),h=i(1115),d=o.extend({className:"nav-search",mixins:[r,a],template:l,events:{"click .search-label":"__searchLabelClick","click .filter-icon":"__filterIconClick"},__searchLabelClick:function(){s.trigger("mobileHeader:search:click")},togglePopover:function(){this.popover||(this.popover=new u({pinnedTarget:this.subViews.filterIcon.$el,model:this.model}),this.popover.render(),this.listenTo(this.popover,"close",this.onPopoverClose))},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))},__filterIconClick:function(){this.togglePopover()},onFilterChange:function(t){s.trigger("mobileHeader:filter:update",t),this.popover.hide()},bindEvents:function(){this.model&&(this.listenTo(this.model,"change:sort",this.onFilterChange),this.listenTo(this.model,"change:post_type",this.onFilterChange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterChange))},initialize:function(t){t=n.extend({},t),n.extend(this.attributes,t),this.get("logged_in")&&(this.subViews.filterIcon=new c,this.model=new h({showOriginalPostsSwitch:!1,showNsfwSwitch:!0,sort:this.get("filter_sort").toUpperCase(),post_type:this.get("filter_post_type").toUpperCase(),filter_nsfw:this.get("filter_nsfw")}),this.bindEvents())},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this},teardown:function(){this.popover&&this.popover.teardown()}});t.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="toggle-filter"><div data-subview="filterIcon"></div><div data-subview="filters"></div></span><span class="search-label" for="search-input"></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(226),s=i(1109),o=n.extend({template:s,className:"filter-icon",render:function(){return this.$el.html(this.template()),this}});t.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(1111),s=i(1113),o=n.extend({className:n.prototype.className+" blog-search-filters-popover",Subview:s});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(220).transition,r=i(284),a=i(276),l=i(283),c=i(232),u=i(1112),h=s.extend({className:"popover--blog-search",mixins:[a,l,c],template:u,keycommands:{"keydown:down":"targetNextLi","keydown:tab":"targetNextLi","keydown:up":"targetPrevLi","keydown:shift+tab":"targetPrevLi","keyup:enter":"selectLi"},defaults:{keycommands:!1,keyboardFocusClass:"keyboard_focus"},initialize:function(t){return this.options=n.defaults(t,this.defaults),this.Subview?(this.subview=new this.Subview(t),void this.bindEvents()):void this.remove()},render:function(){return this.$el.html(this.template()),this.$(".popover_inner").append(this.subview.render().$el),this.$main=this.$el.find(".popover"),n.delay(n.bind(function(){this.$main.addClass("popover--active"),this.bindClickOutside()},this),1),this},bindEvents:function(){this.listenTo(this.subview,"remove",this.hide),this.options.keycommands||this.disableKeys()},bindClickOutside:function(){this._popoverBase.autoTeardown&&(this.clickOutside=new r(this.el),this.clickOutside.on("click:outside",this.hide,this))},unbindClickOutside:function(){this.clickOutside&&(this.clickOutside.remove(),this.clickOutside=null)},targetNextLi:function(t){t.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.next().length?this.$active.next():this.$(".popover_menu_item").first()):this.$active=this.$(".popover_menu_item").first(),this.$active.addClass(this.options.keyboardFocusClass),this.scrollToActive()},targetPrevLi:function(t){t.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.prev().length?this.$active.prev():this.$(".popover_menu_item").last()):this.$active=this.$(".popover_menu_item").last(),this.$active.addClass(this.options.keyboardFocusClass),this.scrollToActive()},selectLi:function(){this.$active&&this.trigger("itemSelected",this.$active)},scrollToActive:function(){this.$scrollable=this.$scrollable||this.$(".popover_inner"),this.$scrollable.scrollTop(this.$scrollable.scrollTop()+this.$active.position().top-this.$scrollable.height()+this.$active.outerHeight())},hide:function(){this.$main.removeClass("popover--active"),this.unbindClickOutside(),o(this.$el,n.bind(function(){this.subview.remove(),this.remove(),this.teardown()},this))}});t.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(226),o=i(1114),r=s.extend({template:o,events:{"click [data-filter]":"onFilterClick","click .sort_filter.toggle":"onToggleFilterClick","click .option-radio":"onCheckboxClick","change [type=checkbox]":"onCheckboxChange"},initialize:function(){this.bindEvents()},afterRender:function(){this.onPostTypeChange(),this.onSortChange(),this.onPostRoleChange(),this.onFilterNsfwChange()},bindEvents:function(){this.listenTo(this.model,"change:sort",this.onSortChange),this.listenTo(this.model,"change:post_type",this.onPostTypeChange),this.listenTo(this.model,"change:post_role",this.onPostRoleChange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterNsfwChange)},onPostRoleChange:function(){this.$("#post_role").prop("checked",this.model.get("post_role")!==this.model.defaults.post_role)},onPostTypeChange:function(){this.$(".post_type_filter.active").removeClass("active"),this.$('[data-filter="post_type:'+this.model.get("post_type")+'"]').addClass("active")},onFilterNsfwChange:function(){this.$(".search-nsfw-filter-checkbox-input").prop("checked",this.model.get("filter_nsfw")!==this.model.defaults.filter_nsfw)},onSortChange:function(){this.$(".sort_filter.active").removeClass("active"),this.$('[data-filter="sort:'+this.model.get("sort")+'"]').addClass("active")},onFilterClick:function(t){var e=n(t.currentTarget).data("filter").split(":");this.model.set(e[0],e[1])},onCheckboxChange:function(t){var e=n(t.currentTarget),i=t.currentTarget.id,s=e.data("value"),o=e.prop("checked");this.model.set(i,o?s:this.model.defaults[i])},onCheckboxClick:function(t){t.stopPropagation()},onToggleFilterClick:function(t){var e=n(t.currentTarget).find("[type=checkbox]"),i=e.prop("checked");e.prop("checked",!i).trigger("change")}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter" data-filter="sort:POPULARITY_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Top Posts"))+' </span></li><li class="popover_menu_item sort_filter" data-filter="sort:CREATED_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Recent Posts"))+" </span></li></ul> ",model.showOriginalPostsSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="post_role" id="post_role" data-value="ORIGINAL"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Original Posts"))+" </span></li></ul> "),__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item post_type_filter" data-filter="post_type:ANY"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("All Types"))+' </span></li><li class="popover_menu_item post_type_filter post_text_filter" data-filter="post_type:TEXT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_text_small"></i> '+__e(__("Text"))+' </span></li><li class="popover_menu_item post_type_filter post_photo_filter" data-filter="post_type:PHOTO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_photo_small"></i> '+__e(__("Photo"))+' </span></li><li class="popover_menu_item post_type_filter post_quote_filter" data-filter="post_type:QUOTE"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_quote_small"></i> '+__e(__("Quote"))+' </span></li><li class="popover_menu_item post_type_filter post_link_filter" data-filter="post_type:LINK"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_link_small"></i> '+__e(__("Link"))+' </span></li><li class="popover_menu_item post_type_filter post_chat_filter" data-filter="post_type:CHAT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_chat_small"></i> '+__e(__("Chat"))+' </span></li><li class="popover_menu_item post_type_filter post_audio_filter" data-filter="post_type:AUDIO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_audio_small"></i> '+__e(__("Audio"))+' </span></li><li class="popover_menu_item post_type_filter post_video_filter" data-filter="post_type:VIDEO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_video_small"></i> '+__e(__("Video"))+" </span></li></ul> ",model.showNsfwSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="filter_nsfw" id="filter_nsfw" data-value="true" class="search-nsfw-filter-checkbox-input"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Safe search"))+" </span></li></ul> ");
return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(136),o=i(185),r=i(190),a=o.extend({urlRoot:"/svc/search/blog_search",defaults:{next_offset:0,limit:10,sort:"CREATED_DESC",post_type:"ANY",term:"",unsetTerm:"",post_role:"ANY",filter_nsfw:!1,showOriginalPostsSwitch:!0,showNsfwSwitch:!1},initialize:function(){this.listenTo(this,"change:unsetTerm",this.onUnsetTermChange),this.listenTo(s,"peeprsearch:change:term",this.onTermSelect),this.listenTo(this,"change:term change:sort change:post_type change:post_role",this.resetSearch),this.posts=new r},resetSearch:function(){this.set(n.pick(this.defaults,["limit","next_offset"])),this.posts.reset(),this.trigger("search:reset")},reset:function(){this.posts.reset(),this.set(this.defaults),this.trigger("reset")},url:function(){var t=this.get("term").replace(/#/g,"");return this.urlRoot+"/"+this.get("blogname")+"/"+t},onTermSelect:function(t){this.search(t.term)},onUnsetTermChange:function(){s.trigger("peeprsearch:change:unsetTerm",{term:this.get("unsetTerm")})},search:function(t){t=t||this.get("unsetTerm"),t.length&&this.set("term",t)},fetch:function(){this.get("next_offset")<0||o.prototype.fetch.apply(this,arguments)},parse:function(t){return this.posts.length?n.each(t.response.posts,function(t){this.posts.add(t)},this):this.posts.reset(t.response.posts),delete t.response.posts,t.response},sync:function(t,e,i){"read"===t&&(i.data=this.pick("next_offset","limit","sort","post_type","post_role","filter_nsfw")),o.prototype.sync.apply(this,arguments)}});t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(214),r=i(136),a=i(132),l=i(1117),c=i(1118),u=o.extend({name:"YamPlusAd",counter:1,adConfiguration:{name:"LREC",sp:1197719223,ps:"LREC",ssl:1},initialize:function(t){this.listenTo(r,"darla:ready",this.setupFirstAd),this.listenTo(r,"darla:failure",this.checkAdexist),this.listenTo(r,"darla:success",this.checkAdexist),this.listenTo(r,"component:YamPlusAd",this.setupAd),window.DARLA_CONFIG||this.setupDarla()},$placeholderFor:function(t){return s("#yam-plus-ad-units-"+t)},canServeAds:function(){return window.DARLA},checkAdexist:function(t){if(this.canServeAds()&&t){var e=t[0].replace("LREC",""),i=this.$placeholderFor(e);0===i.find(".darla").length&&i.parents(".yamplus-unit-container").remove()}},setupDarla:function(){window.DARLA_CONFIG=l(this.setupFirstAd(!0)),c()},setupFirstAd:function(t){var e=s(".yam-plus-ad-container, .sidebar-ad-content").eq(0);if(!e.length)return null;var i=e.find(".yam-plus-ad-target"),n=i.attr("id"),o=e.attr("data-yam-ad-id"),r={dest:n,id:o};return t?r:this.setupAd(r)},setupAd:function(t){if(this.counter=this.counter+1,a.logSaw(this.name,"setupAd",window.DARLA),!this.canServeAds())return a.logSaw(this.name,"Cannot serve ads -- NO DARLA"),!1;t=n.defaults(t,{asz:"300x250",w:"300",h:"250",pos:"LREC-"+this.counter,id:!1,dest:!1,fdb:!0});var e="LRECP",i=n.defaults({name:e},this.adConfiguration);return a.logSaw(this.name,"DARLA.add",i),window.DARLA.add(i),window.DARLA.isAutoOn()||window.DARLA.startAuto(),window.DARLA.event("AUTO"),!0}});t.exports=u},function(t,e,i){"use strict";var n=i(3),s=i(136);t.exports=function(t){t=n.extend({dest:!1,id:!1},t);var e={positions:{DEFAULT:{w:"300",h:"250"},LREC:{dest:!1,id:!1}},events:{getEm:{ps:["LREC"],sp:1197719223},AUTO:{sp:1197719223,ps:{LREC:{autoRT:1e4,autoIV:1,autoMax:25,id:"LREC"}},autoStart:1,autoRT:1e4,autoDDG:1,ssl:!0,npv:!0}},onFailure:function(){s.trigger("darla:failure",arguments)},onSuccess:function(){s.trigger("darla:success",arguments)},onFinishParse:function(t,e){e.ps().forEach(function(t){""!==t.hasErr&&s.trigger("darla:failure",arguments)})}};return e.positions.LREC.dest=t.dest,e.positions.LREC.id=t.id,e}},function(t,e,i){"use strict";var n,s=("https:"===document.location.protocol?"https://":"http://")+"fc.yahoo.com/sdarla/php/client.php?f=1197719150",o=5,r=0,a=i(136),l=function t(){clearTimeout(n),n=null,window.DARLA&&!window.DARLA.inProgress()?a.trigger("darla:ready"):++r<o?n=setTimeout(t,1e3):a.trigger("darla:failure")};t.exports=function(){var t=document.createElement("script");t.async=!0;var e=document.getElementsByTagName("script")[0];t.src=s,e.parentNode.insertBefore(t,e),t.onload=l}},function(t,e,i){"use strict";var n=i(3),s=i(1120),o=s.extend({logKey:"dashboard_embed",logOptions:{init_event:!1},events:{"/^post:((?:un)?docked)$/":"handleEvent","post:embed:stateChange":"logStateChange"},handleEvent:function(t,e){var i=n.extend({},e);i.postData&&(i.post_id=i.postData.id,i.tumblelog=i.postData.tumblelog,delete i.postData),this.log(t,i)},logStateChange:function(t,e){if(!n.isEmpty(e)&&e.state&&e.postID&&e.service){if("tumblr"===e.service)return;this.log(e.state,{service:e.service,post_id:e.postID})}}});t.exports=o},function(t,e,i){"use strict";var n=i(7),s=i(3),o=i(215),r=i(136),a=i(132),l=[];l.push(i(1121));var c=/^\/(.+)\/([gimy]*)$/,u=o.extend({constructor:function(){this._eventHandlers=[],this.setupEndpoints(),this.initialize();var t=s.result(this,"events")||{};s.forEach(t,this._addEventHandlerByString,this);var e=s.result(this,"eventBus");this.listenTo(e,"all",this._handleEvent),a.log("LogLady","[instrument]",this.logKey)},logSpots:l,eventBus:r,_addEventHandlerByString:function(t,e){var i,n=e.match(c);if(n){var s=new RegExp(n[1],n[2]);i=function(t){var e=t.match(s);if(e){for(var i=new Array(e.length-1),n=0;n<e.length;n+=1)n>0&&(i[n-1]=e[n]);return i}}}else if("*"===e[e.length-1]){var o=e.substring(0,e.length-1);i=function(t){var e=t.indexOf(o);if(0===e)return[t.substring(o.length,t.length)]}}else i=function(t){return t===e?[t]:null};this._addEventHandler(t,i)},_addEventHandler:function(t,e){this._eventHandlers.push({method:t,matcher:e})},_handleEvent:function(t,e){for(var i,n,o,r=this._eventHandlers.length-1;r>=0;r--)i=this._eventHandlers[r],o=i.callback||this[i.method],o&&(n=i.matcher.call(this,t,e),s.isArray(n)&&(e&&e.loggingData&&n.push(s.cloneDeep(e.loggingData)),o.apply(this,n)))},setupEndpoints:function(){var t=s.result(this,"logSpots");this.loggers=s(t).map(function(t){return t(this)},this).compact().value()},initialize:s.noop,log:function(){for(var t=this.loggers.length-1;t>=0;t--){var e=this.loggers[t];e.trigger.apply(e,arguments)}}},{start:function(){return this._setupInstance||(this._setupInstance=new this),this._setupInstance}});s.extend(u.prototype,n.Events),t.exports=u},function(t,e,i){"use strict";function n(t){var e=s.result(t,"logKey"),i=s.result(t,"logEnv");if(e){var n=s.result(t,"logOptions")||{};return i&&(n.env=i),o.log(e,n)}}var s=i(3),o=i(1122);t.exports=n},function(t,e,i){"use strict";var n=i(1123),s=i(1133),o=new n({EventClass:s,event_payload_name:"payload",event_filter:function(){return!0},endpoint:function(){return[window.location.protocol,"//",window.location.hostname,"/services/cslog"].join("")}});t.exports=o},function(t,e,i){"use strict";function n(t){this.watching={},this.pending_events=[],this.endpoint=t.endpoint,this.overrides=t.overrides,t.event_payload_name&&(this.event_payload_name=t.event_payload_name),t.event_filter&&(this.event_filter=t.event_filter),t.payload_formatter&&(this.payload_formatter=t.payload_formatter),s.bindAll(this,"_flush_from_timeout"),this._flush_from_timeout();var e=t.EventClass||f;this.Log=g.extend({EventClass:e}),o(window).on("beforeunload.log_lady",s.bind(this._flush_on_unload,this)),this.set_flush_rate()}var s=i(3),o=i(8),r=i(7),a=(i(132),i(180)),l=i(972),c=l.getRealNow,u=i(1124),h=i(1125),d=i(1126),p=[].slice,_=i(1127),g=i(1129),f=i(1132),m=1e3;s.extend(n.prototype,r.Events,{initialize:s.noop,defaults:{flush_rate:15*m},min_flush_rate:function(){var t=s.map(this.watching,function(t){return s.result(t,"flush_rate")});return t.push(this.defaults.flush_rate),s.min(t)},set_flush_rate:function(t){return t&&(this.defaults.flush_rate=t),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var t=s.result(this,"endpoint"),e=this.build_payload();if(t&&!s.isEmpty(e)&&(!this.event_payload_name||!s.isEmpty(e[this.event_payload_name]))&&a.bool("log_lady"))return d(t,e,!this.unloading),this.last_flush_at=c(),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var t;for(var e in this.watching)t=this.watching[e],"function"==typeof t.unloaded&&t.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout);var t=this.flush();t!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},flush_is_overdue:function(){this.last_flush_at||(this.last_flush_at=c());var t=c()-this.last_flush_at;return t>this.flush_rate},watch:function(){var t,e,i,n=p.apply(arguments);for(i=0;i<n.length;i++)t=n[i],this.is_valid(t)&&(t.log_lady=this,this.watching[t.log_key]&&(e=this.watching[t.log_key],e&&s.isFunction(e.replaced)&&e.replaced(t)),this.watching[t.log_key]=t);return this.set_flush_rate(),this},unwatch:function(t){this.watching[t.log_key]&&t&&s.isFunction(t.replaced)&&t.replaced(),delete this.watching[t.log_key]},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},payload_formatter:function(t){return t},event_filter:function(){return!0},build_payload:function(){var t=s.merge({},this.watching,[this]),e=s(t).collect(function(t){return t.pending_log_events()}).flatten().filter(this.event_filter).collect(s.bind(function(t){return t.json},this)).value(),i={};return this.event_payload_name?i[this.event_payload_name]=this.payload_formatter(e):i=this.payload_formatter(e),i},is_valid:function(t){var e=!!t;return e&&(e=s.result(t,"log_key")),e&&(e=s.result(t,"uuid")),e&&(e=s.isFunction(t.pending_log_events)),e},log:function(t,e){if(t){if(!(t in this.watching)){e&&e.log_key&&console.warn("log key gets overridden by log name");var i=_("keys",t);e=s.extend({},i,e,{log_key:t});var n=new this.Log(e);this.watch(n)}return this.watching[t]}},new_uuid:h}),n.extend=u,n.Log=g,t.exports=n},function(t,e,i){"use strict";function n(t,e){var i,n=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,e);var o=function(){this.constructor=i};return o.prototype=n.prototype,i.prototype=new o,t.defaults&&(s.extend(i.prototype.defaults,t.defaults),delete t.defaults),t&&s.extend(i.prototype,t),i.__super__=n.prototype,i}var s=i(3);t.exports=n},function(t,e){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})}t.exports=i},function(t,e,i){"use strict";function n(t,e,i){return!!r.ajax({url:t,type:"POST",data:JSON.stringify(e),contentType:"text/plain",async:i})}function s(t,e,i){var s=window.navigator.sendBeacon(t,JSON.stringify(e));return s||(s=n(t,e,i)),s}var o,r=i(8);o=window.navigator&&window.navigator.sendBeacon?s:n,t.exports=o},function(t,e,i){"use strict";function n(){for(var t,e=r.apply(arguments),i=o,n=0;n<e.length;n++){if(t=e[n],!i||!s.has(i,t))return null;i=i[t]}return i}var s=i(3),o=i(1128),r=[].slice;t.exports=n},function(t,e,i){"use strict";var n,s=i(129),o=function(){return n||(n=s.get("Components/LogLady")),n};t.exports=o()},function(t,e,i){"use strict";function n(t,e){t.uuid?(e=t,t=e.uuid):e||!t||s.isString(t)||(e=t,t=void 0),this.options=s.extend({},this.defaults,e),delete this.options.log_key,delete this.options.env,delete this.options.uuid,l(this,"uuid",t||this._generate_uuid()),e.env||(e.env={}),s.each(e.flags,function(t){e.env.flags||(e.env.flags={}),e.env.flags[t]=r.bool(t)}),l(this,"env",e.env),this.log_key=e.log_key||this.log_key,this.events=[],this.event_count=0,this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||a.getRealNow()),delete this.options.started_at,this.initialize(e),this.options.init_event&&this.trigger("init")}var s=i(3),o=i(7),r=i(180),a=i(972),l=i(1130),c=i(1124),u=i(1125),h=i(1127),d=i(1132);s.extend(n.prototype,o.Events,{EventClass:d,initialize:s.noop,_generate_uuid:function(){return h("default_session")||u()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},generate_relative_id:function(){return this.event_count},unloaded:function(t){t||(t={}),t=this.before_unloaded(t)||{},this.options.keep_counts&&s.extend(t,{event_counts:this.event_counts}),s.isEmpty(t)||this.trigger("unload",t)},before_unloaded:function(t){return t},replaced:function(t){this.before_replaced(t);for(var e=this.pending_log_events();e.length;)this.log_lady.pending_events.push(e.shift())},before_replaced:s.noop,stop:function(){this.log_lady&&this.log_lady.unwatch(this)},trigger:function(t,e){var i=new this.EventClass(this,t,e);return this.options.keep_counts&&"init"!==t&&"unload"!==t&&(this.event_counts[t]||(this.event_counts[t]=0),this.event_counts[t]++),this.event_count+=1,this.pending_events.push(i),o.Events.trigger.call(this,t,i,this),this}}),n.extend=c,t.exports=n},function(t,e,i){"use strict";function n(t,e,i){s.isObject(i)&&o(i),Object.defineProperty(t,e,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var s=i(3),o=i(1131);t.exports=n},function(t,e){"use strict";function i(t){var e,s;Object.freeze(t);for(s in t)e=t[s],t.hasOwnProperty(s)&&null!==e&&"object"===("undefined"==typeof e?"undefined":n(e))&&!Object.isFrozen(e)&&i(e)}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=i},function(t,e,i){"use strict";function n(t,e,i){this.name=e,this.log_key=s.result(t,"log_key"),this.data=i||null;var n=r(),o=s.result(t,"generate_relative_id"),l=s.result(t,"env"),c=t.uuid,u={};u.log_key=this.log_key,u.uuid=c,u.event=this.name,u.ts=n,o!==!1&&void 0!==o&&(u.rid=o),u.elapsed=u.ts-a,u.data=this.data,u.env=l,this.json=u}var s=i(3),o=i(972),r=o.getRealNow,a=o.realStartedAt;t.exports=n},function(t,e,i){"use strict";function n(t){return o.isString(t)?t:JSON.stringify(t)}function s(t,e,i){this.name=e,this.log_key=o.result(t,"log_key"),this.data=i||null;var s=l(),r=o.result(t,"generate_relative_id"),u=o.result(t,"env"),h=t.uuid,d={category:this.log_key},p=8,_=new Array(p);_[0]=n(s),_[1]=n(c),_[2]=n(h),_[3]=n(r),_[4]=n(a.getElapsed(s)),_[5]=n(e),_[6]=n(i),_[7]=n(u),d.fields=_,this.json=d}var o=i(3),r=i(342),a=i(972),l=a.getRealNow,c=r.get("tmgioct");t.exports=s},function(t,e,i){"use strict";var n=i(3),s=i(1120),o=s.extend({logKey:"video_interactions",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"handleEvent"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},n.each(this.loggers,function(t){t.before_unloaded=n.bind(this.beforeUnloaded,this)},this)},handleEvent:function(t,e){if(!n.contains(this.excludedEvents,t)){var i=n.extend({},e);i.postData&&(i.post_id=i.postData.id,delete i.postData),this.log(t,i)}},cacheUnloadLog:function(t,e){this.unloadData[e.id]=e},beforeUnloaded:function(t){n.each(this.unloadData,function(t){this.handleEvent("unload",t)},this)},updateLogCache:function(t,e){var i=["elapsed","position"];this.unloadData[e.id]=n.extend(this.unloadData[e.id],n.pick(e,i))}});t.exports=o},function(t,e,i){"use strict";var n=i(3),s=i(1120),o=s.extend({logKey:"vendorbutton",logEnv:{referrer:document.location.pathname},events:{"VendorButton:*":"handleEvent"},handleEvent:function(t,e){var i=n.extend({},e);i.post_id=e.postData.id,i.root_post_id=e.postData.root_id,i.tumblelog=e.postData.tumblelog,delete i.postData,this.log(t,i)}});t.exports=o},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"dashboard_sharing",events:{"dashboard-share:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){e=e||{},this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"related_recommendations",logOptions:{init_event:!1},events:{"rapid-recommendations:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"explore_trending",logOptions:{init_event:!1},events:{"explore-trending:*":"log"},logEnv:{location:document.location.pathname}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"roadblock",events:{"roadblock:*":"log"}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"linkpost_interactions",logOptions:{init_event:!1},events:{"linkpost:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=i(129),o=n.extend({logKey:"recommended_blogs",logEnv:{context:s.get("Context/name"),location:document.location.pathname},logOptions:{init_event:!1},events:{"recommendedBlogs:*":"log"}});t.exports=o},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"postform_interactions",logOptions:{init_event:!1},events:{"postform-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"header_search",logEnv:{referrer:document.location.pathname},events:{"header_search:*":"log"}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"gifsearch_interactions",logOptions:{init_event:!1},events:{"gifsearch:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){"unload"!==t&&this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1120),o=n(s),r=i(1146),a=n(r),l=i(180),c=n(l),u=o.default.extend({logKey:"little_sister",logSpots:[],events:function(){return c.default.bool("little_sister_kill_switch")?{}:{"LSLog:*":"log"}},log:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.pt,n=e.is_ad,s=e.video_details,o=e.extraData;i&&(a.default.log(i).trigger(t,{pt:i,eventName:t,video_details:s,extraData:o}),(n||"supply_unload"===t)&&a.default.flush())}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=[];return(0,o.forEach)(t,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.pt,n=t.event_data,s=(0,o.find)(e,{pt:i});s||(s={pt:i,events:[]},e.push(s)),s.events.push(n)}),e}Object.defineProperty(e,"__esModule",{value:!0}),e.LsLogger=e.lsEndpoint=e.POST_TRACKER=void 0,e.logLadyFormat=s;var o=i(3),r=i(972),a=i(1123),l=n(a),c=i(1147),u=n(c),h=e.POST_TRACKER="pt",d=e.lsEndpoint="/services/bblog",p=e.LsLogger=l.default.extend({build_payload:function(){var t=l.default.prototype.build_payload.call(this),e=this.event_payload_name&&(0,o.isEmpty)(t[this.event_payload_name]);return(0,o.isEmpty)(t)||e?{}:(t.flushTime=(0,r.getRealNow)(),t)}}),_=new p({EventClass:u.default,event_payload_name:"trackers",event_filter:function(t){var e=t.data;return(0,o.has)(e,h)},payload_formatter:s,endpoint:d});e.default=_},function(t,e,i){"use strict";function n(t,e,i){this.name=e,this.log_key=s.result(t,"log_key"),this.data=i||{};var n=r(),o={pt:this.data.pt,event_data:{timestamp:n,eventString:this.data.eventName||e}};this.data.video_details&&(o.event_data.data=this.data.video_details),this.data.extraData&&(o.event_data.data=o.event_data.data||{},s.extend(o.event_data.data,this.data.extraData)),this.json=o}var s=i(3),o=i(972),r=o.getRealNow;t.exports=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1120),o=n(s),r=i(1149),a=n(r),l=i(180),c=n(l),u=o.default.extend({logKey:"kraken",logSpots:[],events:function(){return c.default.bool("kraken_web_logging_library")?{"Kraken:*":"log"}:{}},log:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.default.log("kraken").trigger(t,e),(e.is_ad||"supply_unload"===t)&&a.default.flush()}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.default.groupBy(t,function(t){return u.default.has(t,p.POST_TRACKER)&&!!t.pt})}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=(0,p.logLadyFormat)(t),i=function(t){var e=t.kraken;return delete e.pt,e},n=function(t){return t.data=t.data||t.kraken.event_details,delete t.data.pt,delete t.kraken,t};return e.map(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.pt,s=t.events;return{pt:e,krakenEvents:s.map(i),events:s.map(n)}})}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map(function(t){var e=t.event_data;return e.kraken})}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new d.default(window,t);return{language:e.language,manufacturer:e.vendor,os_version:e.osVersion,platform:e.platform,build_version:"1536594140-b87e7da",carrier:"",connection:"",model:""}}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return{};var e=s(t),i=o(e[f]),n=r(e[m]);return u.default.assign({krakenClientDetails:a()},i.length&&{trackers:i},n.length&&{krakenEvents:n})}Object.defineProperty(e,"__esModule",{value:!0});var c=i(3),u=n(c),h=i(1150),d=n(h),p=i(1146),_=i(1153),g=n(_),f="true",m="false",v=new p.LsLogger({EventClass:g.default,payload_formatter:l,event_filter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,i=t.name,n=e.pt;return!!n||u.default.includes(_.allowedEventNames,i)},endpoint:p.lsEndpoint});e.default=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(3),a=i(1151),l=n(a),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,t);var n=e.screen,o=e.location,a=e.navigator,c=a.appVersion,u=a.browserLanguage,h=a.cookieEnabled,d=a.onLine,p=a.language,_=a.languages,g=a.userAgent,f=a.vendor,m=new l.default(g).getResult(),v=m.browser,b=m.os,y=m.device,w=(new e.Date).getTime(),k=!0,C=e.outerWidth+"x"+e.outerHeight;(0,r.assign)(this,{appVersion:c,browserName:v.name,browserVersion:v.version,client:e,colorDepth:n.colorDepth,cookiesEnabled:h,createdAt:w,deviceModel:y.model,deviceType:y.type,deviceVendor:y.vendor,hasJavascript:k,isOnline:d,language:p||u,languages:_||[],location:o,osName:b.name,osVersion:b.version,resolution:C,screenHeight:n.height,screenWidth:n.width,userAgent:g,vendor:f},i)}return o(t,[{key:"toJSON",value:function(){var t=this.appVersion,e=this.colorDepth,i=this.cookiesEnabled,n=this.hasFlash,s=this.hasImages,o=this.hasJavascript,r=this.language,a=this.languages,l=this.isOnline,c=this.platform,u=this.plugins,h=this.resolution,d=this.screenHeight,p=this.screenWidth,_=this.createdAt,g=this.timezone,f=this.userAgent;return{app_version:t,color_depth:e,cookies_enabled:i,flash_enabled:n,images_enabled:s,javascript_enabled:o,language:r,languages:a,online:l,platform:c,plugins:u,resolution:h,screen_height:d,screen_width:p,time_zone_offset:g,timestamp:_,user_agent:f}}},{key:"screenType",get:function(){if(this.page)return this.page;var t=this.location.pathname,e={Dashboard:"/dashboard",Explore:"/explore",SearchResults:"/search"};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if((0,r.startsWith)(t,n))return i}return"Unknown"}},{key:"timezone",get:function(){return(new this.client.Date).getTimezoneOffset()}},{key:"isHeadlessBrowser",get:function(){var t=this,e=["_phantom","Buffer","callPhantom","domAutomation","domAutomationController","emit","spawn","webdriver"];return(0,r.some)(e,function(e){return!!t.client[e]})}},{key:"plugins",get:function(){return(0,r.map)(this.client.navigator.plugins,"name")}},{key:"hasImages",get:function(){var t=this.client.document.getElementById("clp_image");return!!t&&t.width>0}},{key:"hasFlash",get:function(){var t=this.client,e=t.ActiveXObject,i=t.navigator,n=!1;try{n=new e("ShockwaveFlash.ShockwaveFlash")}catch(t){n=i.mimeTypes["application/x-shockwave-flash"]&&i.mimeTypes["application/x-shockwave-flash"].enabledPlugin}return!!n}},{key:"platform",get:function(){var t=(0,r.get)(this,"client.navigator.platform"),e=(0,r.includes)(["iPhone","iPod","iPad","iPhone Simulator","iPod Simulator","iPad Simulator"],t),i=(0,r.includes)(["Android"],t);return e?"Web:iOS":i?"Web:Android":"Web"}}]),t}();e.default=c},function(t,e,i){var n;!function(s,o){"use strict";var r="0.7.12",a="",l="?",c="function",u="undefined",h="object",d="string",p="major",_="model",g="name",f="type",m="vendor",v="version",b="architecture",y="console",w="mobile",k="tablet",C="smarttv",x="wearable",S="embedded",T={extend:function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2===0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i},has:function(t,e){return"string"==typeof t&&e.toLowerCase().indexOf(t.toLowerCase())!==-1},lowerize:function(t){return t.toLowerCase()},major:function(t){return typeof t===d?t.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},E={rgx:function(){for(var t,e,i,n,s,r,a,l=0,d=arguments;l<d.length&&!r;){var p=d[l],_=d[l+1];if(typeof t===u){t={};for(n in _)_.hasOwnProperty(n)&&(s=_[n],typeof s===h?t[s[0]]=o:t[s]=o)}for(e=i=0;e<p.length&&!r;)if(r=p[e++].exec(this.getUA()))for(n=0;n<_.length;n++)a=r[++i],s=_[n],typeof s===h&&s.length>0?2==s.length?typeof s[1]==c?t[s[0]]=s[1].call(this,a):t[s[0]]=s[1]:3==s.length?typeof s[1]!==c||s[1].exec&&s[1].test?t[s[0]]=a?a.replace(s[1],s[2]):o:t[s[0]]=a?s[1].call(this,a,s[2]):o:4==s.length&&(t[s[0]]=a?s[3].call(this,a.replace(s[1],s[2])):o):t[s]=a?a:o;l+=2}return t},str:function(t,e){for(var i in e)if(typeof e[i]===h&&e[i].length>0){for(var n=0;n<e[i].length;n++)if(T.has(e[i][n],t))return i===l?o:i}else if(T.has(e[i],t))return i===l?o:i;return t}},P={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},F={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[g,v],[/(opios)[\/\s]+([\w\.]+)/i],[[g,"Opera Mini"],v],[/\s(opr)\/([\w\.]+)/i],[[g,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[g,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[g,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[g,v],[/(yabrowser)\/([\w\.]+)/i],[[g,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],v],[/(micromessenger)\/([\w\.]+)/i],[[g,"WeChat"],v],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[g,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[g,/(.+)/,"$1 WebView"],v],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[v,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[g,v],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[g,"UCBrowser"],v],[/(dolfin)\/([\w\.]+)/i],[[g,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[g,"Chrome"],v],[/;fbav\/([\w\.]+);/i],[v,[g,"Facebook"]],[/fxios\/([\w\.-]+)/i],[v,[g,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[g,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,g],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[g,[v,E.str,P.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[g,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[g,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[g,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,T.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[b,/ower/,"",T.lowerize]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[b,T.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[_,m,[f,k]],[/applecoremedia\/[\w\.]+ \((ipad)/],[_,[m,"Apple"],[f,k]],[/(apple\s{0,1}tv)/i],[[_,"Apple TV"],[m,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,_,[f,k]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[_,[m,"Amazon"],[f,k]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[_,E.str,P.device.amazon.model],[m,"Amazon"],[f,w]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[_,m,[f,w]],[/\((ip[honed|\s\w*]+);/i],[_,[m,"Apple"],[f,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,_,[f,w]],[/\(bb10;\s(\w+)/i],[_,[m,"BlackBerry"],[f,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[_,[m,"Asus"],[f,k]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[_,"Xperia Tablet"],[f,k]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[m,"Sony"],[_,"Xperia Phone"],[f,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,_,[f,y]],[/android.+;\s(shield)\sbuild/i],[_,[m,"Nvidia"],[f,y]],[/(playstation\s[34portablevi]+)/i],[_,[m,"Sony"],[f,y]],[/(sprint\s(\w+))/i],[[m,E.str,P.device.sprint.vendor],[_,E.str,P.device.sprint.model],[f,w]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[m,_,[f,k]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[m,[_,/_/g," "],[f,w]],[/(nexus\s9)/i],[_,[m,"HTC"],[f,k]],[/(nexus\s6p)/i],[_,[m,"Huawei"],[f,w]],[/(microsoft);\s(lumia[\s\w]+)/i],[m,_,[f,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[_,[m,"Microsoft"],[f,y]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[m,"Microsoft"],[f,w]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[_,[m,"Motorola"],[f,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[_,[m,"Motorola"],[f,k]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[m,T.trim],[_,T.trim],[f,C]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[m,"Samsung"],[f,C]],[/\(dtv[\);].+(aquos)/i],[_,[m,"Sharp"],[f,C]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],_,[f,k]],[/smart-tv.+(samsung)/i],[m,[f,C],_],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[m,"Samsung"],_,[f,w]],[/sie-(\w+)*/i],[_,[m,"Siemens"],[f,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[m,"Nokia"],_,[f,w]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[_,[m,"Acer"],[f,k]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],_,[f,k]],[/(lg) netcast\.tv/i],[m,_,[f,C]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[_,[m,"LG"],[f,w]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[_,[m,"Lenovo"],[f,k]],[/linux;.+((jolla));/i],[m,_,[f,w]],[/((pebble))app\/[\d\.]+\s/i],[m,_,[f,x]],[/android.+;\s(glass)\s\d/i],[_,[m,"Google"],[f,x]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[_,/_/g," "],[m,"Xiaomi"],[f,w]],[/android.+a000(1)\s+build/i],[_,[m,"OnePlus"],[f,w]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[f,T.lowerize],m,_]],
engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[g,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[g,v],[/rv\:([\w\.]+).*(gecko)/i],[v,g]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[g,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[g,[v,E.str,P.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[g,"Windows"],[v,E.str,P.os.windows.version]],[/\((bb)(10);/i],[[g,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[g,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[g,"Symbian"],v],[/\((series40);/i],[g],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[g,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[g,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[g,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[g,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[g,v],[/(haiku)\s(\w+)/i],[g,v],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[g,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[g,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[g,v]]},I=function(t,e){if(!(this instanceof I))return new I(t,e).getResult();var i=t||(s&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:a),n=e?T.extend(F,e):F;return this.getBrowser=function(){var t=E.rgx.apply(this,n.browser);return t.major=T.major(t.version),t},this.getCPU=function(){return E.rgx.apply(this,n.cpu)},this.getDevice=function(){return E.rgx.apply(this,n.device)},this.getEngine=function(){return E.rgx.apply(this,n.engine)},this.getOS=function(){return E.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this};I.VERSION=r,I.BROWSER={NAME:g,MAJOR:p,VERSION:v},I.CPU={ARCHITECTURE:b},I.DEVICE={MODEL:_,VENDOR:m,TYPE:f,CONSOLE:y,MOBILE:w,SMARTTV:C,TABLET:k,WEARABLE:x,EMBEDDED:S},I.ENGINE={NAME:g,VERSION:v},I.OS={NAME:g,VERSION:v},typeof e!==u?(typeof t!==u&&t.exports&&(e=t.exports=I),e.UAParser=I):"function"===c&&i(1152)?(n=function(){return I}.call(e,i,e,t),!(n!==o&&(t.exports=n))):s.UAParser=I;var j=s.jQuery||s.Zepto;if(typeof j!==u){var A=new I;j.ua=A.getResult(),j.ua.get=function(){return A.getUA()},j.ua.set=function(t){A.setUA(t);var e=A.getResult();for(var i in e)j.ua[i]=e[i]}}}("object"==typeof window?window:this)},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.allowedEventNames=void 0;var a=i(3),l=n(a),c=i(1147),u=n(c),h=i(1150),d=n(h),p=(e.allowedEventNames=["follow","impression","like","reblog","share","unfollow","unlike","supply_serve","supply_rotate","supply_unload","supply_view","NotificationBlogSwitch","NotificationClick","NotificationFollowClick","NotificationRebloggerClick","NotificationPostPreviewClick","NotificationReplyClick","ActivityClick","NotesInteractionOpen","Messaging:inbox:open","Messaging:inbox:closed","Messaging:conversation:started","Messaging:conversation:deleted","Messaging:conversation:open","Messaging:conversation:closed","Messaging:conversation:follow","Messaging:conversation:windows:loaded","Messaging:conversation:minimized","Messaging:conversation:unminimized","Messaging:conversation:spam:intent","Messaging:conversation:spam:success","Messaging:conversation:spam:fail","Messaging:messaging-image-upload:add","Messaging:messaging-image-upload:dismiss","Messaging:messaging-image-upload:edit","Messaging:messaging-image-upload:intent","Messaging:messaging-gif:add","Messaging:messaging-gif:dismiss","Messaging:messaging-gif:edit","Messaging:messaging-gif:intent","Messaging:post-chrome:add","Messaging:post-chrome:dismiss","Messaging:post-chrome:edit","Messaging:post-chrome:intent","Messaging:message:sent","Messaging:message:failure","Messaging:block","Messaging:notification:display","Messaging:notification:permission:granted","Messaging:notification:permission:denied","Messaging:peepr:open","Messaging:conversation-permalink:open","Messaging:new:inbox:empty:new-message:button:click","Messaging:old:inbox:empty:new-message:button:click","Transparency:report","blocks:block_added","blocks:ip_block_added","blocks:blocklist:more_loaded","blocks:blocklist:opened","blocks:block_added:block_already_exists","blocks:block_removed","abuseform:open","abuseform:close","abuseform:submitted","abuseform:stepviewed","abuseform:contentpreview:close","helpform:closed","helpform:opened:withButton","helpform:close","helpform:open","helpform:opened:withLink","helpform:navigateBackToHelp","loginregister:captchaShown","loginregister:flowComplete","loginregister:beginFlow","peepr:open","peepr:postsAndBlogFetch","peepr:like_update","peepr:close","peepr:follow_update","peepr:timeline:posts-fetched","peepr:log:close","peepr:log:paginate","peepr:log:peepr_reblog","peepr:log:peepr_reblog_success","peepr:log:peepr_like_update","peepr:log:peepr_follow","peepr:log:reload","peepr:log:load","peepr:log:ajax-error","peepr:timeline:posts-fetched","MagicLink:LoginSuccess","MagicLink:Sent","MagicLink:UsePasswordButtonPressed","MagicLink:BackButtonPressed","safeMode:SafeModeToggled","safeMode:BlogFlaggedAdultByUser","safeMode:FilteringSettingLinkClicked","safeMode:SafeModeBlogPageShown","safeMode:NsfwPostPreview","safeMode:PFNSFW","safeMode:SurveyOptionSelected","safeMode:FilteringSettingLinkClicked","safeMode:NsfwDocLinkClicked","safeMode:SafeModeSafeSearchToggleClicked"],function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n)),a=r.data,c=a.extraData,u=a.eventDetails,h=a.eventString,p=a.ts,_=a._experiments,g=a._clientOverrides;r.experiments=_||{},r.overrides=g||{},delete r.data._experiments,delete r.data._clientOverrides;var f=new d.default(window,r.overrides);return r.json.event_data.kraken={event_name:h||r.name,client_session_id:f.sessionID||"",page:f.screenType||"Unknown",section:f.section||"",client_timestamp:p||Date.now(),event_details:l.default.assign({},c,u,l.default.omit(r.data,"pt","extraData","eventDetails")),experiments:r.experiments},r}return r(e,t),e}(u.default));e.default=p},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"reactivation",logOptions:{init_event:!1},events:{"reactivation:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"notes_interactions",logOptions:{init_event:!1},logEnv:{location:document.location.pathname},events:{"notes-interactions:*":"log"}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"postchrome_interactions",logOptions:{init_event:!1},events:{"postchrome-interactions:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"toastlog",events:{"toastlog:*":"log"}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"async_loading",events:{"async-loading:*":"log"}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"ads_interactions",logOptions:{init_event:!1},events:{"ads-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(1120),s=n.extend({logKey:"user_tag_filtering",logOptions:{init_event:!1},events:{"userTagFiltering:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});t.exports=s},function(t,e,i){"use strict";var n=i(237);n({"Tumblr.Prima.Upload":i(530),"Tumblr.Prima.Ligature":i(293),"Tumblr.Events":i(136),"Tumblr.Prima.Events":i(136),"Tumblr.Prima.Dialog":i(213),"Tumblr.Dialog":i(213),"Tumblr.PostMessageChannel":i(943),"Tumblr.Prima.DOMEventor":i(181),"Tumblr.Prima.gutterMediaManager":i(1162),"Tumblr.Prima.Vendor.when":i(192),"Tumblr.Prima.Vendor.sequence":i(239),"Tumblr.log_lady":i(1163),"Tumblr.Prima.logLady":i(1163),"Tumblr.Prima.Models.Post":i(347),"Tumblr.Prima.Models.Tumblelog":i(191),"Tumblr.Prima.CrtPlayer":i(435),"Tumblr.Prima.CrtControl":i(429),"Tumblr.Prima.BlogCard":i(660),"Tumblr.Prima.Url":i(265),"Tumblr.Prima.ToolTip":i(1166),"Tumblr.Prima.SharePopover":i(341),"Tumblr.Prima.Messaging.SharePost":i(1020),"Tumblr.Prima.utils.caniuse":i(437),"Tumblr.Prima.ConfettiView":i(1042),"Tumblr.Prima.FlatSelect":i(1169),"Tumblr.Prima.Mixins.loggingData":i(348),"Tumblr.Prima.Mixins.withFormKeyTrue":i(186),"Tumblr.Prima.Scrollbar":i(492),"Tumblr.Prima.MessageControlsPopover":i(1171),"Tumblr.Prima.Block":i(212),"Tumblr.Prima.SafeMode":i(1173),"Tumblr.Prima.PeeprSearch":i(1174),"Tumblr.Prima.MessagingPopover":i(1188),"Tumblr.Prima.currentUser":i(182),"Tumblr.Prima.AdsPaginationHelper":i(1195),"Tumblr.Prima.SortableView":i(316),"Tumblr.Prima.getLoggingPayloadFromNote":i(1196),"Tumblr.Prima.Snowman":i(666),"Tumblr.Prima.postActivityLoader":i(969),"Tumblr.Prima.KnightRiderLoader":i(331),"Tumblr.Prima.Lib.hosts":i(896),"Tumblr.Prima.LivePhotos":i(551),"Tumblr.Prima.Carousel":i(1197),"Tumblr.Prima.ExpandableTags":i(1202),"Tumblr.Prima.Translate":i(130),"Tumblr.Prima.NativeAudio":i(603),"Tumblr.Prima.CTAButton":i(1205),"Tumblr.Prima.StatusIndicator":i(738),"Tumblr.Prima.Utils.CanvasTools":i(262),"Tumblr.Prima.Utils.Cookie":i(342)}),t.exports=n},function(t,e,i){"use strict";var n=i(214),s=i(181),o=i(136),r=i(8),a=i(3),l=n.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:17,gutterWidth:300,maxViewWidth:300,viewportTransitionWidth:990,initialize:function(){this.layoutHasGutter=this.$right_column().length>0,this.layoutHasGutter||(this.gutterMargin=-65)},$right_column:function(){return this._$right_column||(this._$right_column=r(".right_column")),this._$right_column},toggleBackground:function(t){this.layoutHasGutter&&(t?(this.$right_column().addClass("has_docked_post"),this.$right_column().on("click.gutterManager",a.bind(this.handleGutterClick,this))):(this.$right_column().removeClass("has_docked_post"),this.$right_column().off("click.gutterManager")))},putViewInGutter:function(t,e){return e=a.defaults(e||{},{winRect:s.rect(),gutterPosition:this.gutterPosition(),animation:null,dimRadar:!0,removeOnGutterClick:!1,onDock:a.noop,onUndock:a.noop,dockLoggingName:"post:docked",dockLoggingData:null,undockLoggingName:"post:undocked",undockLoggingData:null}),!!this.isDockable(t,e)&&(e.onDock=e.onDock||a.noop,this.gutteredView&&this.removeGutteredView(),this.gutteredView={view:t,options:e},e.onDock.call(t,e),e.dimRadar&&this.toggleBackground(!0),e.dockLoggingName&&e.dockLoggingData&&o.trigger(e.dockLoggingName,{loggingData:e.dockLoggingData}),this.gutteredView)},removeGutteredView:function(){if(this.gutteredView){var t=this.gutteredView.options,e=this.gutteredView.view;t.onUndock=t.onUndock||a.noop,t.onUndock.call(e,t),this.gutteredView=null,t.dimRadar&&this.toggleBackground(!1),t.undockLoggingName&&t.undockLoggingData&&o.trigger(t.undockLoggingName,{loggingData:t.undockLoggingData})}},isViewInGutter:function(t){return this.gutteredView&&this.gutteredView.view===t},isDockable:function(t,e){if(!this.gutteredView)return!0;var i=!this.gutteredView||this.gutteredView.options.alwaysEvict,n=e.alwaysEvict;return!(this.gutteredView.view===t||n&&!i)},handleGutterClick:function(t){this.gutteredView&&(t.preventDefault(),this.gutteredView.options.removeOnGutterClick&&this.removeGutteredView())},gutterPosition:function(){var t=s.rect(),e=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:e},n=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return t.windowWidth<n&&(i.width=n-t.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});t.exports=new l},function(t,e,i){"use strict";var n=i(1164);t.exports=n},function(t,e,i){"use strict";var n=i(136),s=i(1123),o=i(1132),r=i(1165),a=new s({EventClass:o,event_payload_name:"events",event_filter:r,endpoint:"/svc/log/lady"});n.on("Capture:push",function(t,e,i){a.log(t,{init_event:!1}).trigger(e,i)}),t.exports=a},function(t,e,i){"use strict";var n=i(3),s=i(1127),o=n.keys(s("keys"));t.exports=function(t){return o.indexOf(t.log_key)>=0}},function(t,e,i){"use strict";var n=i(214),s=i(1167),o=n.extend({name:"ToolTip",class_name:"tumblr_tooltip",initialize:function(t){this.toolTipView=new s(t)}});t.exports=o},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(219),r=i(1168),a=o.extend({class_name:"tumblr_tooltip",template:r,defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(t){this.options=t||{},this.options.selector=n.trim((t.selector||this.defaults.selector)+" "),this.options.class_name=t.class_name||this.defaults.class_name,this.options.offset=t.offset||this.defaults.offset,this.options.placement=t.placement||this.defaults.placement,this.tooltips=n(this.options.selector+"[data-tooltip]"),this.tooltips.on("remove",n.proxy(this.remove,this)),this.tooltips.on("mouseenter",s.bind(this.show,this)),this.tooltips.on("mouseleave",s.bind(this.hide,this))},show:function(t){var e=n(t.currentTarget);this.tooltip_template_data={tooltip:e.data("tooltip")};var i=n(this.tooltip(this.tooltip_template_data));e.append(i),this.setElement(i),this.delegateEvents(),i.removeClass("is_closed").addClass("is_open")},hide:function(t){var e=n(t.currentTarget),i=e.find("."+this.class_name);i.removeClass("is_open").addClass("is_closed"),i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",s.bind(function(t){this.remove(t)},this))},remove:function(t){n(t.currentTarget).remove()},tooltip:function(t){return this.class_name="tooltip_wrapper",this.attributes={text:t.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset},this.template(this.attributes)}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tooltip_wrapper '+__e(placement)+" "+__e(class_name)+'" style="left:'+__e(left_css)+'"><div class="tooltip"> '+(null==(__t=text)?"":__t)+" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(214),s=i(1170),o=n.extend({name:"FlatSelect",view:function(t){return new s(t)}});t.exports=o},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(219),r=o.extend({el:"body",defaults:{},events:{"change .flat_select select":"__selectChange"},__selectChange:function(t){var e=n(t.currentTarget);this.updateSelect(e)},initialize:function(t){this.options=s.extend({},this.defaults,t)},updateSelect:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});t.exports=r},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(136),r=i(276),a=i(283),l=i(129),c=i(1172),u=s.extend({className:"popover--message-controls-popover",mixins:[r,a],template:c,events:{'click [data-action="delete"]':"_delete",'click [data-action="block"]':"_block",'click [data-action="flag"]':"_flag"},initialize:function(t){this.options=n.extend({},t),this.showFlagAndBlock=this.options.blockString&&this._notUsersOwnBlog(),this.post=t.post},_getSender:function(){return!(!this.options.blockString||this.options.blockString.indexOf(":")!==-1)&&this.options.blockString},_notUsersOwnBlog:function(){var t=this._getSender();if(t){var e=l.get("Context/userinfo/channels");return e=n.pluck(e,"name"),!n.includes(e,t)}return!0},_delete:function(t){t.preventDefault(),this.post.delete(t)},_block:function(t){t.preventDefault(),this.post.block(t)},_flag:function(t){t.preventDefault();var e={mode:"message",post:this.post.model},i=this._getSender();i&&(e.sender=i),o.trigger("abuseform:open",e),o.trigger("Kraken:abuseform:open",e)},render:function(){return this.$el.html(this.template()),this},teardown:function(){return this.$el.remove(),this}});t.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="popover popover_menu popover_gradient message-controls-popover"><div class="popover_inner"><ul> ',this.showFlagAndBlock&&(__p+=' <li class="popover_menu_item" data-action="block" data-block="'+__e(this.options.blockString)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Block"))+'</a></li><li class="popover_menu_item" data-action="flag"><a class="popover_menu_item_anchor" href="#">'+__e(__("Report"))+"</a></li> "),__p+=' <li class="popover_menu_item" data-action="delete" data-confirm="'+(null==(__t=__("Are you sure you want to delete this?"))?"":__t)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Delete"))+"</a></li></ul></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=[{id:"0",appeal:"OWNER_APPEAL_NSFW_NONE",readable:"none"},{id:"1",appeal:"OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE",readable:"available_prioritize"},{id:"2",appeal:"OWNER_APPEAL_NSFW_AVAILABLE",readable:"available"},{id:"3",appeal:"OWNER_APPEAL_NSFW_IN_REVIEW",readable:"in_review"},{id:"4",appeal:"OWNER_APPEAL_NSFW_COMPLETE",readable:"complete"}],s=i(8),o=i(3),r=i(130),a=i(136),l=i(213),c=function(t){this.xhr&&this.xhr.abort();var e=o.has(this.model,"attributes.blog.name")?this.model.attributes.blog.name:this.model.tumblelog.id;return this.xhr=s.ajax({method:"POST",url:"/svc/appeal",data:{post_id:this.model.get("id"),blog_name:e,state:t},withFormKey:!0}),this.xhr},u=function(t){return parseInt(o.find(n,{appeal:t}).id,10)},h={dismiss:function(t,e,i){var n=s(t.target).closest(".own-post-banner");this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_AVAILABLE")),this.xhr.done(o.bind(function(){n.slideUp()},this)),this.logAction("DismissButtonClicked",e)},request:function(t,e,i){var n=s(t.target).closest(".own-post-banner"),a=s(t.target).closest(".post_wrapper").find(".nsfw-eye");this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_IN_REVIEW")),this.xhr.done(o.bind(function(){a.attr("data-state",u("OWNER_APPEAL_NSFW_IN_REVIEW")),l.alert(r("Okay! We'll review the status of this and email you when we're done.")),n.slideUp()},this)),this.logAction("RequestReviewButtonClicked",e)},eyeTap:function(t,e,i){var n=s(t.currentTarget).attr("data-state"),a=s(t.target).closest(".post_wrapper").find(".own-post-banner"),h=s(t.target).closest(".post_wrapper").find(".nsfw-eye"),d={text:r("This is marked as sensitive content. If that seems like a mistake, you can request a review."),text_ok:r("Request Review"),text_cancel:r("Nevermind"),callback_ok:o.bind(function(){this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_IN_REVIEW")),this.xhr.done(o.bind(function(){o.delay(function(){l.alert(r("Okay! We'll review the status of this and email you when we're done."))},300),h.attr("data-state",u("OWNER_APPEAL_NSFW_IN_REVIEW")),a.slideUp()},this))},this)};switch(parseInt(n,10)){case u("OWNER_APPEAL_NSFW_IN_REVIEW"):l.alert(r("This post is still marked as sensitive, but is currently being reviewed."));break;case u("OWNER_APPEAL_NSFW_COMPLETE"):l.alert(r("After review, it was determined that this post contains sensitive content."));break;case u("OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE"):case u("OWNER_APPEAL_NSFW_AVAILABLE"):l.confirm(d)}this.logAction("NsfwIndicatorClicked",e)},openPeepr:function(t,e){a.trigger("peepr-open-request",{tumblelog_name:t,post_id:e,editing_appearance:!1,should_bypass_safemode:!0}),this.logAction("ShowNsfwPostAnywaysClicked",e)},getAppealArray:function(){return n},logAction:function(t,e){(o.isNumber(e)||o.isString(e))&&a.trigger("safeMode:"+t,{loggingData:{postId:e}})}};t.exports=h},function(t,e,i){"use strict";function n(t){return new s(t)}var s=i(1175);t.exports=n},function(t,e,i){"use strict";var n=i(3),s=i(8),o=i(226),r=i(136),a=i(180),l=i(182),c=i(1176),u=i(1177),h=i(1179),d=i(1186),p=i(1115),_=o.extend({className:"peepr-blog-search",template:c,subviews:{filters:{constructor:u},input:{constructor:h}},events:{"submit .blog-search-form":"formSubmitHandler","click .blog-search-form":"onFormClick","click .clear-search":"clearSearch","click .toggle-search":"toggleSearch"},initialize:function(t){this.options=t,this.user=l(),this.searchActive=!1,this.blog=t.blog,this.model=new p({blogname:this.blog.tumblelog_name_or_id,themeParams:this.blog.get("global_theme_params"),isAdult:this.blog.get("nsfw"),isSafeModeEnabled:a.bool("safe_mode")&&this.user.get("safe_mode")}),n.each(this.subviews,function(t){t.options=t.options||{},t.options.model=this.model},this),this.bindEvents()},bindEvents:function(){this.listenTo(this.model.posts,"reset",this.onPostsReset),this.listenTo(this.model.posts,"add",this.onPostsAdd),this.listenTo(this.model,"search:reset",this.onSearchReset),this.listenTo(this.model,"change:next_offset",this.onOffsetChange),this.listenTo(this.model,"change:term",n.bind(this.log,this,"search-start",{})),this.listenTo(r,"indashblog:search:fetch-requested",this.onFetchRequested),this.listenTo(r,"indashblog:ready-animation-start",this.onPeeprReady)},onPeeprReady:function(){this.setWidth()},setWidth:function(){var t=this.$el.parents(".navigation_inner"),e=t.width(),i=t.find(".header_controls").outerWidth();this.$el.width(e-i)},onFetchRequested:function(t){this.model.fetch(t)},formSubmitHandler:function(t){t.preventDefault(),this.model.search()},onFormClick:function(t){t.stopPropagation()},toggleSearch:function(t){return t=n.defaults(t,{force:null,focus:!0}),this.model.get("term").length&&null===t.force?void this.clearSearch():(this.searchActive=n.isBoolean(t.force)?t.force:!this.searchActive,this.$el.toggleClass("show-search",this.searchActive),s(".indash_header_wrapper").toggleClass("search-active",this.searchActive),void(this.searchActive?t.focus&&n.delay(n.bind(this.input.focusInput,this.input),300):this.model.reset()))},clearSearch:function(){this.toggleSearch({force:!1}),r.trigger("indashblog:search:clear"),this.log("search-clear")},onSearchReset:function(){var t=this.model.get("term").length>0;this.$el.toggleClass("term-entered",t),t&&(r.trigger("indashblog:search:start"),this.searchActive||this.toggleSearch({focus:!1,force:!0}))},onPostsReset:function(t){t.length&&(r.trigger("indashblog:search:complete",t.toJSON()),this.log("search-complete"))},onOffsetChange:function(t,e){e>=0||(r.trigger("indashblog:search:results-end",this.model.posts.length?null:new d({model:this.model})),this.log("search-results-end"))},onPostsAdd:function(t){r.trigger("indashblog:search:post-added",t.toJSON())},log:function(t,e){var i={loggingData:n.defaults({blogname:this.blog.tumblelog_name_or_id,term:this.model.get("term"),sort:this.model.get("sort"),post_type:this.model.get("post_type"),post_role:this.model.get("post_role"),next_offset:this.model.get("next_offset")},e||{})};r.trigger("peepr-search:"+t,i)},remove:function(){this.model.stopListening(),o.prototype.remove.call(this)}});t.exports=_},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<form class="blog-search-form"><div data-subview="filters"></div><i class="icon_arrow_thin_left clear-search nav_icon"></i> ',model.isSafeModeEnabled&&model.isAdult||(__p+=' <i class="icon_search toggle-search nav_icon"></i> '),__p+=' <div data-subview="input"></div></form>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1178),r=i(1110),a=s.extend({className:"search-filters",template:o,events:{"click .show-filter-popover":"showPopover"},initialize:function(){this.listenTo(this.model,"search:reset",this.hidePopover)},showPopover:function(){this.popover||(this.popover=new r({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover,"close",this.onPopoverClose))},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter show-filter-popover nav_icon"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(136),r=i(277),a=i(1180),l=i(1184),c=i(1185),u=s.extend({className:"search-input",template:c,mixins:[r],$$cacheKeys:{"blog-search-input":".blog-search-input"},initialize:function(){this.autocompletePopover=null,this.bindEvents(),this.blogSearchAutocompleteModel=new l({blogname:this.model.get("blogname")})},afterRender:function(){this.blogSearchAutocompleteHelper=new a({model:this.blogSearchAutocompleteModel,el:this.$$(".blog-search-input")})},events:{"focus .blog-search-input":"inputFocusHandler","keyup .blog-search-input":"inputKeyUpHandler","blur .blog-search-input":"inputBlurHandler"},bindEvents:function(){this.listenTo(this.model,"change:term",this.onTermChange),this.listenTo(this.model,"reset",this.onModelReset)},inputKeyUpHandler:function(){this.model.set("unsetTerm",this.getTerm()),this.blogSearchAutocompleteModel.set("matchTerm",this.getTerm())},focusInput:function(){this.$$(".blog-search-input").focus(),this.blogSearchAutocompleteHelper.showPopover()},getTerm:function(){return n.trim(this.$$(".blog-search-input").val())},setTerm:function(t){this.$$(".blog-search-input").val(t).blur()},onTermChange:function(t,e){this.setTerm(e)},onModelReset:function(){this.setTerm("")},inputFocusHandler:function(){o.trigger("indashblog:keycommands:suspend",!0)},inputBlurHandler:function(){o.trigger("indashblog:keycommands:resume")}});t.exports=u},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1181),r=s.extend({events:{click:"showPopover",blur:"onInputBlur"},initialize:function(){this.popover=null,this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:matchTerm",this.onMatchTermChange)},onMatchTermChange:function(){this.model.get("typeAheadMatches").length?this.showPopover():this.hidePopover()},showPopover:function(){this.model.getItems().then(n.bind(function(){!this.popover&&this.model.hasMatches()&&(this.popover=new o({pinnedTarget:this.$el,model:this.model,shift:{x:-this.getLeftOffset(),y:0},preventInteraction:!0,keycommands:!0}).render(),this.listenTo(this.popover,"close",this.onPopoverClose))},this))},getLeftOffset:function(){return this._leftOffset=this._leftOffset||this.$el.width()/2,this._leftOffset},onInputBlur:function(){n.delay(n.bind(this.hidePopover,this),100)},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){n.defer(n.bind(function(){this.popover=null},this))}});t.exports=r},function(t,e,i){"use strict";var n=i(1111),s=i(1182),o=n.extend({className:n.prototype.className+" blog-search-autocomplete-popover",bindEvents:function(){n.prototype.bindEvents.apply(this,arguments),this.listenTo(this,"itemSelected",this.subview.selectTerm)},Subview:s});t.exports=o},function(t,e,i){"use strict";var n=i(8),s=i(136),o=i(226),r=i(1183),a=o.extend({template:r,events:{"click [data-term]":"onTermClick"},initialize:function(){this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:typeAheadMatches",this.render)},onTermClick:function(t){this.selectTerm(n(t.currentTarget))},selectTerm:function(t){s.trigger("peeprsearch:change:term",{term:t.attr("data-term")})}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_header"> '+__e(__("Popular Tags:"))+" </li> ";for(var i=0;i<model.maxRender&&i<model.typeAheadMatches.length;i++)__p+=' <li class="popover_menu_item" data-term="'+__e(model.typeAheadMatches[i].tag)+'"><span class="popover_menu_item_anchor">#'+__e(model.typeAheadMatches[i].tag)+" </span></li> ";__p+=" </ul>"}return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(185),a=i(190),l=r.extend({defaults:{maxRender:20,matchTerm:"",typeAheadMatches:[]},urlRoot:"/svc/search/blog_search_typeahead",url:function(){return this.urlRoot+"/"+this.get("blogname")},initialize:function(){this.items=new a,this.fetched=!1,this.listenTo(o,"peeprsearch:change:unsetTerm",this.onUnsetTermChange),this.listenTo(this,"change:matchTerm sync",this.setMatches)},onUnsetTermChange:function(t){this.set("matchTerm",t.term)},hasMatches:function(){return this.items.length&&this.get("typeAheadMatches").length||!this.fetched},setMatches:function(){var t=this.get("matchTerm");if(!t.length)return void this.set("typeAheadMatches",this.items.toJSON());var e=this.items.filter(function(e){return e.get("tag").indexOf(t)>-1});this.set("typeAheadMatches",s.invoke(e,"toJSON"))},getItems:function(){if(this.items.length){var t=n.Deferred();return t.resolve(),t.promise()}return this.fetch(arguments)},parse:function(t){return this.items.reset(t.tags),this.fetched=!0,s.omit(t,"tags")}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<input type="text" class="blog-search-input" placeholder="'+__e(__("Search %s",model.blogname))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(8),s=i(3),o=i(136),r=i(226),a=i(1187),l=r.extend({
className:"search-no-results",template:a,afterRender:function(){this.setHeight(),this.listenTo(o,"DOMEventor:flatresize",s.throttle(this.setHeight,300))},setHeight:function(){var t=n(".indash_blog .posts"),e=t.outerHeight()-t.height(),i=n(".indash_blog .header").height();this.$el.height(n(window).height()-i-e)}});t.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="no-results-text" style="color: '+__e(model.themeParams.title_color)+'">'+(null==(__t=__("Nothing here about<br/>%s.",_.escape(model.term)))?"":__t)+"</p>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";t.exports=i(1189)},function(t,e,i){"use strict";var n=i(3),s=i(136),o=i(180),r=i(226),a=i(1190),l=i(1194),c=i(738),u=r.extend({template:l,className:"messaging-popover-icon nav_icon",events:{click:"_onIconClick"},initialize:function(t){this.options=n.extend({},this.defaults,t),n.extend(this,n.pick(t,"model"))},subviews:{statusIndicator:{constructor:c,options:function(t){return{isOnline:t.model.get("isOnline"),canSeeUIFlag:o.bool("status_indicator"),name:t.model.get("name")}}}},showPopover:function(){this.popover||(this.popover=new a({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover.getView(),"messagingSelected",this._onMessagingSelected),this.listenTo(this.popover.getView(),"askSelected",this._onAskSelected),this.listenTo(this.popover,"close",this._onPopoverClose))},openMessaging:function(){s.trigger("messaging:conversation:open:tumblelogs",[this.model],"peepr")},openAsk:function(){s.trigger("ask:form:open",{recipient:this.model.get("name"),allow_anonymous:this.model.get("anonymous_asks")})},_onIconClick:function(){this.openMessaging(),(this.model.get("asks")||this.model.get("submissions"))&&this.showPopover()},_onMessagingSelected:function(){this.openMessaging()},_onAskSelected:function(){this.openAsk()},_onPopoverClose:function(){this.stopListening(this.popover),this.stopListening(this.popover.getView()),this.popover=null}});t.exports=u},function(t,e,i){"use strict";var n=i(3),s=i(219),o=i(1191),r=i(276),a=i(283),l=i(1193),c=s.extend({className:"popover--messaging-peepr popover info_popover popover_gradient",template:l,mixins:[r,a],initialize:function(t){this.options=n.extend({},this.defaults,t),this.view=new o({model:this.model})},render:function(){return this.$el.html(this.template),this.$(".popover_inner").append(this.view.render().$el),this.listenTo(this.view,"popoverClose",this.teardown),this},teardown:function(){this.view.remove(),this.remove()},getView:function(){return this.view}});t.exports=c},function(t,e,i){"use strict";var n=i(3),s=i(226),o=i(1192),r=s.extend({tagName:"ul",template:o,events:{"click [data-js-ask]":"_onClickAsk","click [data-js-message]":"_onClickMessage"},getTemplateData:function(){return{hasMessaging:this.model.get("can_receive_messages")===!0,hasAsks:this.model.get("asks")===!0,hasSubmissions:this.model.get("submissions")===!0,url:this.model.get("url")}},_onClickMessage:function(t){t.preventDefault(),this.trigger("messagingSelected"),this.trigger("popoverClose")},_onClickAsk:function(t){t.preventDefault(),this.trigger("askSelected"),n.delay(n.bind(function(){this.trigger("popoverClose")},this),1)}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)hasMessaging&&(__p+=' <li data-js-message><a href="#">'+__e(_("Send a message"))+"</a></li> "),__p+=" ",hasAsks&&(__p+=' <li data-js-ask><a class="ask" href="'+__e(url)+'/ask">'+__e(_("Ask a question"))+"</a></li> "),__p+=" ",hasSubmissions&&(__p+=' <li data-js-submit><a class="submit" target="_blank" href="'+__e(url)+'/submit">'+__e(_("Submit"))+"</a></li> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover_inner"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="statusIndicator"></div> '+__e(_("Send a message"));return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(214),s=n.extend({name:"AdsPaginationHelper",defaults:{nextAdPos:0},initialize:function(){this.set(this.data)},getNextAdPos:function(){return this.get("nextAdPos")}});t.exports=s},function(t,e,i){"use strict";function n(t){var e=t.filter(function(t){return o.includes(r,t)});return e.join("_")}function s(t){var e=t.closest(".post"),i=o.get(e.data("json"),"post-id")||e.attr("data-post-id"),s=e.find(".note_link_current").data("count"),r=n(t.attr("class").split(" "));return{postId:i,noteCount:s,noteType:r}}var o=i(3),r=["like","reblog","answer","reply","photo","with_commentary"];t.exports=s},function(t,e,i){"use strict";var n=i(1198);t.exports=n},function(t,e,i){"use strict";var n=i(226),s=i(1199),o=i(3),r=i(1201),a=i(138),l=i(136),c=i(220),u=i(348),h=n.extend({className:"carousel-container",template:r,hasPeeked:!1,mixins:[u],subviews:{carouselPositionView:{constructor:s,options:function(t){return{photoCount:t.model.get("photoset_photos").length}}}},events:{"click .carousel-item-container a":"contentLinkClick"},initialize:function(t){t=t||{},this.currentItem=0,this.redirectUrlPrimary=t.redirect_url_primary,this.setupWatcher(),this.model.set("is_carousel",!0),this.model.set("carousel_index",this.currentItem)},afterRenderSubviews:function(){var t=this;o.defer(function(){t.imageWidth=t.carouselPositionView.$el.width(),window.parent.postMessage("resize_photoset_iframe;"+t.model.get("id")+";"+t.imageWidth,"*")}),this.carouselItemContainer=this.$(".carousel-item-container"),this.listenTo(this.carouselPositionView,"switchCarouselItem",this.processCarouselItemSwitch),this.listenTo(this.carouselPositionView,"peekLeft",this.peekLeft),this.listenTo(this.carouselPositionView,"peekRight",this.peekRight),this.peekIfInViewport(),this.listenTo(l,"DOMEventor:flatscroll",o.throttle(this.peekIfInViewport,500),this)},render:function(){return this.$el.html(this.template({post:this.model,redirect_url_primary:this.redirectUrlPrimary})),this},peekIfInViewport:function(){var t=this;!this.hasPeeked&&this.watcher&&this.watcher.isFullyInViewport&&(this.carouselItemContainer.addClass("peek-animation"),c.animation(this.carouselItemContainer,function(){t.carouselItemContainer.removeClass("peek-animation")}),this.hasPeeked=!0,this.stopListening(l,"DOMEventor:flatscroll"),this.watcher=null)},peekLeft:function(){var t=this.$(".carousel-wrapper");t.addClass("peek-left-animation"),c.animation(t,function(){t.removeClass("peek-left-animation")})},peekRight:function(){var t=this.$(".carousel-wrapper");t.addClass("peek-right-animation"),c.animation(t,function(){t.removeClass("peek-right-animation")})},processCarouselItemSwitch:function(t){this.model.get("pt")&&l.trigger("carousel:slide",{loggingData:this.loggingData({userAction:"slide",extraData:{offset:this.currentItem,target_offset:t}})}),this.carouselItemContainer.css({transform:"translate3d("+t*-this.imageWidth+"px, 0, 0)"}),this.currentItem=t,this.model.set("carousel_index",t)},setupWatcher:function(){this.watcher=a.create(this.$el,-100)},contentLinkClick:function(){this.model.get("pt")&&l.trigger("carousel:click_thru",{loggingData:this.loggingData({userAction:"click_thru",extraData:{offset:this.currentItem}})})}});t.exports=h},function(t,e,i){"use strict";var n=i(8),s=i(226),o=i(1200),r=s.extend({autoAppend:!0,template:o,events:{"click .carousel-button":"onCarouselButtonClick","click .carousel-arrow-right":"goToNextItem","click .carousel-arrow-left":"goToPrevItem"},initialize:function(t){t=t||{},this.photoCount=t.photoCount||0,this.currentItem=0},switchCarouselItem:function(t){this.trigger("switchCarouselItem",t)},goToItem:function(t){t>=0&&t<=this.photoCount-1?(this.$(".carousel-button").removeClass("current"),this.$('.carousel-button[data-carousel-button-index="'+t+'"]').addClass("current"),this.currentItem=t,this.switchCarouselItem(this.currentItem)):t<0?this.trigger("peekLeft"):t>this.photoCount-1&&this.trigger("peekRight")},goToNextItem:function(t){this.goToItem(this.currentItem+1)},goToPrevItem:function(t){this.goToItem(this.currentItem-1)},onCarouselButtonClick:function(t){var e=n(t.target).data("carousel-button-index");this.goToItem(e)},render:function(){return this.$el.html(this.template({photoCount:this.photoCount})),this}});t.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){for(__p+='<div class="carousel-arrow carousel-arrow-left"></div><div class="carousel-arrow carousel-arrow-right"></div><div class="carousel-button-container"> ',i=0;i<photoCount;i++)__p+=' <span class="carousel-button'+__e(0===i?" current":"")+'" data-carousel-button-index="'+__e(i)+'">&#x25cf;</span> ';__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="carousel-wrapper"><div class="carousel-item-container"> ',_.forEach(post.get("photoset_photos"),function(t,e){__p+=" ",(t.primary_url||redirect_url_primary)&&(__p+=' <a target="_blank" href="'+__e(t.primary_url?t.primary_url:redirect_url_primary)+'"> '),__p+=' <img class="carousel-item carousel-item-'+__e(e)+'" src="'+__e(t.high_res)+'" alt="'+__e(t.caption)+'"> ',(t.primary_url||redirect_url_primary)&&(__p+=" </a> "),__p+=" "}),__p+=' </div></div><div data-subview="carouselPositionView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(1203);t.exports=n},function(t,e,i){"use strict";var n=i(226),s=i(1204),o=i(136),r=i(8),a=n.extend({events:{"click .see-all-tags":"_expandTags","click .post_tag":"_clickTag"},hasExpandedTags:!1,template:s,_expandTags:function(t){o.trigger("postchrome-interactions:expand-tags-click",{loggingData:{action:"expand-tags-click"}}),this.hasExpandedTags=!0,this.$el.removeClass("fadeable"),this.$(".see-all-tags").remove()},render:function(){this.$el.append(this.template())},_clickTag:function(t){var e=r(t.target);o.trigger("postchrome-interactions:tag-click",{loggingData:{action:"tag-click",tag:e.text(),hasExpandedTags:this.hasExpandedTags?"true":"false",wasHidden:this.hasExpandedTags&&e.position().top>81?"true":"false",postId:this.model.get("id"),tagIndex:e.index()}})}});t.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="see-all-tags"><span class="ellipses">...</span> '+__e(__("See all"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(t,e,i){"use strict";var n=i(219),s=i(136),o=n.extend({events:{click:"_onLinkClick"},initialize:function(t){t&&t.postModel?this.postModelJSON=t.postModel.toJSON():this.postModelJSON=""},_onLinkClick:function(){this._triggerEvent("buttonClick")},_triggerEvent:function(t){s.trigger("CTAButton:"+t,{loggingData:{postData:this.postModelJSON,userAction:"action_click"}})}});t.exports=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){}]);